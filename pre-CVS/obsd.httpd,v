head	1.28;
access;
symbols;
locks; strict;
comment	@# @;


1.28
date	2003.03.23.20.20.51;	author tg;	state dead;
branches;
next	1.27;

1.27
date	2003.03.22.22.33.25;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2003.03.22.16.14.16;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2003.03.04.16.52.26;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2003.03.02.01.08.32;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2003.03.01.13.16.05;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2003.03.01.10.05.33;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2003.02.28.18.22.09;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2003.02.24.21.32.05;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2003.02.23.17.59.42;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2003.02.11.21.08.29;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2003.02.11.20.02.17;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2003.02.10.19.41.25;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2003.01.27.21.17.19;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2003.01.27.15.38.17;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.01.26.13.10.24;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.01.21.19.26.00;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.01.19.18.45.38;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.01.17.18.26.38;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.01.16.14.47.50;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.01.10.19.45.29;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.01.06.16.23.42;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.01.05.22.53.18;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2002.12.31.01.38.57;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2002.12.20.23.24.35;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2002.12.05.17.54.39;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2002.12.04.19.11.47;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2002.12.03.20.06.43;	author tg;	state Exp;
branches;
next	;


desc
@@


1.28
log
@sync everything over to MirBSD-new
@
text
@Index: src/usr.sbin/httpd/Makefile.bsd-wrapper
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/Makefile.bsd-wrapper,v
retrieving revision 1.39
diff -u -r1.39 Makefile.bsd-wrapper
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	10 Feb 2003 21:28:04 -0000	1.39
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	4 Mar 2003 16:52:42 -0000
@@@@ -38,7 +38,7 @@@@
 HTTPD_LOGDIR=		${HTTPD_PREFIX}/logs
 
 CONFIG_ARGS=	--with-layout="OpenBSD" --enable-module="ssl" \
-	--enable-module="keynote" \
+	--enable-module="keynote" --enable-rule=INET6 \
 	--enable-suexec --suexec-caller="www" \
 	--suexec-docroot="${HTTPD_HTDOCSDIR}" \
 	--suexec-logfile="/var/log/suexec_log" --suexec-userdir="public_html" \
Index: src/usr.sbin/httpd/conf/httpd.conf
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/conf/httpd.conf,v
retrieving revision 1.15
diff -u -r1.15 httpd.conf
--- src/usr.sbin/httpd/conf/httpd.conf	6 Oct 2002 11:59:59 -0000	1.15
+++ src/usr.sbin/httpd/conf/httpd.conf	22 Mar 2003 14:41:16 -0000
@@@@ -1,3 +1,4 @@@@
+#	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $
 #	$OpenBSD: httpd.conf,v 1.15 2002/10/06 12:00:21 henning Exp $
 #
 # Based upon the NCSA server configuration files originally by Rob McCool.
@@@@ -77,6 +78,7 @@@@
 # identification number when it starts.
 #
 PidFile logs/httpd.pid
+
 #
 # ScoreBoardFile: File used to store internal server process information.
 # Not all architectures require this.  But if yours does (you'll know because
@@@@ -132,14 +134,14 @@@@
 # spares die off.  The default values in httpd.conf-dist are probably OK
 # for most sites.
 #
-MinSpareServers 5
-MaxSpareServers 10
+MinSpareServers 1
+MaxSpareServers 3
 
 #
 # Number of servers to start initially --- should be a reasonable ballpark
 # figure.
 #
-StartServers 5
+StartServers 1
 
 #
 # Limit on total number of servers running, i.e., limit on the number
@@@@ -169,6 +171,14 @@@@
 #Listen 12.34.56.78:80
 
 #
+# Listen can take two arguments. This is an extension for supporting IPv6.
+# Note that apache will listen _only_ to IPv6 addresses by default, because
+# the KAME BSD IPv6 stack does not implement IPv4-mapped addresses for
+# security reasons, so don't comment the following two lines:
+Listen :: 80
+Listen 0.0.0.0 80
+
+#
 # BindAddress: You can support virtual hosts with this option. This directive
 # is used to tell the server which IP address to listen to. It can either
 # contain "*", an IP address, or a fully qualified Internet domain name.
@@@@ -223,7 +233,7 @@@@
 # Port: The port to which the standalone server listens. For
 # ports < 1023, you will need httpd to be run as root initially.
 #
-Port 80
+#Port 80
 
 ##
 ##  SSL Support
@@@@ -232,8 +242,10 @@@@
 ##  standard HTTP port (see above) and to the HTTPS port
 ##
 <IfDefine SSL>
-Listen 80
-Listen 443
+Listen :: 80
+Listen 0.0.0.0 80
+Listen :: 443
+Listen 0.0.0.0 443
 </IfDefine>
 
 #
@@@@ -312,7 +324,7 @@@@
 # Note that "MultiViews" must be named *explicitly* --- "Options All"
 # doesn't give it to you.
 #
-    Options Indexes FollowSymLinks
+    Options Indexes FollowSymLinks ExecCGI
 
 #
 # This controls which options the .htaccess files in directories can
@@@@ -340,7 +352,6 @@@@
 #	UserDir /var/www/users
 # and create per user directories in /var/www/users/<username>
 #
-
 UserDir disabled
 
 #
@@@@ -366,7 +377,7 @@@@
 # DirectoryIndex: Name of the file or files to use as a pre-written HTML
 # directory index.  Separate multiple entries with spaces.
 #
-DirectoryIndex index.html
+DirectoryIndex index.htm default.htm index.php index.html
 
 #
 # AccessFileName: The name of the file to look for in each directory
@@@@ -403,7 +414,7 @@@@
 # use the hostname:port that the client supplied, when possible.  This
 # also affects SERVER_NAME and SERVER_PORT in CGI scripts.
 #
-UseCanonicalName On
+UseCanonicalName Off
 
 #
 # TypesConfig describes where the mime.types file (or equivalent) is
@@@@ -479,7 +490,7 @@@@
 # define per-<VirtualHost> access logfiles, transactions will be
 # logged therein and *not* in this file.
 #
-CustomLog logs/access_log common
+#CustomLog logs/access_log common
 
 #
 # If you would like to have agent and referer logfiles, uncomment the
@@@@ -492,7 +503,7 @@@@
 # If you prefer a single logfile with access, agent, and referer information
 # (Combined Logfile Format) you can use the following directive.
 #
-#CustomLog logs/access_log combined
+CustomLog logs/access_log combined
 
 #
 # Optionally add a line containing the server version and virtual host
@@@@ -501,7 +512,7 @@@@
 # Set to "EMail" to also include a mailto: link to the ServerAdmin.
 # Set to one of:  On | Off | EMail
 #
-ServerSignature On
+ServerSignature EMail
 
 #
 # Aliases: Add here as many aliases as you need (with no limit). The format is 
@@@@ -511,14 +522,14 @@@@
 # require it to be present in the URL.  So "/icons" isn't aliased in this
 # example, only "/icons/"..
 #
-Alias /icons/ "/var/www/icons/"
+#Alias /icons/ "/var/www/icons/"
 
-<Directory "/var/www/icons">
-    Options Indexes MultiViews
-    AllowOverride None
-    Order allow,deny
-    Allow from all
-</Directory>
+#<Directory "/var/www/icons">
+#    Options Indexes MultiViews
+#    AllowOverride None
+#    Order allow,deny
+#    Allow from all
+#</Directory>
 
 <Directory "/var/www/htdocs/manual">
     Options MultiViews
@@@@ -535,18 +546,18 @@@@
 # The same rules about trailing "/" apply to ScriptAlias directives as to
 # Alias.
 #
-ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
+#ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
 
 #
 # "/var/www/cgi-bin" should be changed to whatever your ScriptAliased
 # CGI directory exists, if you have that configured.
 #
-<Directory "/var/www/cgi-bin">
-    AllowOverride None
-    Options None
-    Order allow,deny
-    Allow from all
-</Directory>
+#<Directory "/var/www/cgi-bin">
+#    AllowOverride None
+#    Options None
+#    Order allow,deny
+#    Allow from all
+#</Directory>
 
 #
 # Redirect allows you to tell clients about documents which used to exist in
@@@@ -562,47 +573,47 @@@@
 #
 # FancyIndexing is whether you want fancy directory indexing or standard
 #
-IndexOptions FancyIndexing
+#IndexOptions FancyIndexing
 
 #
 # AddIcon* directives tell the server which icon to show for different
 # files or filename extensions.  These are only displayed for
 # FancyIndexed directories.
 #
-AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip
+#AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip
 
-AddIconByType (TXT,/icons/text.gif) text/*
-AddIconByType (IMG,/icons/image2.gif) image/*
-AddIconByType (SND,/icons/sound2.gif) audio/*
-AddIconByType (VID,/icons/movie.gif) video/*
-
-AddIcon /icons/binary.gif .bin .exe
-AddIcon /icons/binhex.gif .hqx
-AddIcon /icons/tar.gif .tar
-AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
-AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
-AddIcon /icons/a.gif .ps .ai .eps
-AddIcon /icons/layout.gif .html .shtml .htm .pdf
-AddIcon /icons/text.gif .txt
-AddIcon /icons/c.gif .c
-AddIcon /icons/p.gif .pl .py
-AddIcon /icons/f.gif .for
-AddIcon /icons/dvi.gif .dvi
-AddIcon /icons/uuencoded.gif .uu
-AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
-AddIcon /icons/tex.gif .tex
-AddIcon /icons/bomb.gif core
-
-AddIcon /icons/back.gif ..
-AddIcon /icons/hand.right.gif README
-AddIcon /icons/folder.gif ^^DIRECTORY^^
-AddIcon /icons/blank.gif ^^BLANKICON^^
+#AddIconByType (TXT,/icons/text.gif) text/*
+#AddIconByType (IMG,/icons/image2.gif) image/*
+#AddIconByType (SND,/icons/sound2.gif) audio/*
+#AddIconByType (VID,/icons/movie.gif) video/*
+
+#AddIcon /icons/binary.gif .bin .exe
+#AddIcon /icons/binhex.gif .hqx
+#AddIcon /icons/tar.gif .tar
+#AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
+#AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
+#AddIcon /icons/a.gif .ps .ai .eps
+#AddIcon /icons/layout.gif .html .shtml .htm .pdf
+#AddIcon /icons/text.gif .txt
+#AddIcon /icons/c.gif .c
+#AddIcon /icons/p.gif .pl .py
+#AddIcon /icons/f.gif .for
+#AddIcon /icons/dvi.gif .dvi
+#AddIcon /icons/uuencoded.gif .uu
+#AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
+#AddIcon /icons/tex.gif .tex
+#AddIcon /icons/bomb.gif core
+
+#AddIcon /icons/back.gif ..
+#AddIcon /icons/hand.right.gif README
+#AddIcon /icons/folder.gif ^^DIRECTORY^^
+#AddIcon /icons/blank.gif ^^BLANKICON^^
 
 #
 # DefaultIcon is which icon to show for files which do not have an icon
 # explicitly set.
 #
-DefaultIcon /icons/unknown.gif
+#DefaultIcon /icons/unknown.gif
 
 #
 # AddDescription allows you to place a short description after a file in
@@@@ -651,19 +662,19 @@@@
 # net-standard language code is pl) may wish to use "AddLanguage pl .po" 
 # to avoid the ambiguity with the common suffix for perl scripts.
 #
-AddLanguage en .en
-AddLanguage fr .fr
-AddLanguage de .de
-AddLanguage da .da
-AddLanguage el .el
-AddLanguage it .it
+#AddLanguage en .en
+#AddLanguage fr .fr
+#AddLanguage de .de
+#AddLanguage da .da
+#AddLanguage el .el
+#AddLanguage it .it
 
 #
 # LanguagePriority allows you to give precedence to some languages
 # in case of a tie during content negotiation.
 # Just list the languages in decreasing order of preference.
 #
-LanguagePriority en fr de
+#LanguagePriority en fr de
 
 #
 # AddType allows you to tweak mime.types without actually editing it, or to
@@@@ -684,7 +695,7 @@@@
 #
 # To use CGI scripts:
 #
-#AddHandler cgi-script .cgi
+AddHandler cgi-script .cgi
 
 #
 # To use server-parsed HTML files
@@@@ -881,7 +892,7 @@@@
 #   Some MIME-types for downloading Certificates and CRLs
 #
 <IfDefine SSL>
-AddType application/x-x509-ca-cert .crt
+AddType application/x-x509-ca-cert .cer
 AddType application/x-pkcs7-crl    .crl
 </IfDefine>
 
@@@@ -938,8 +949,8 @@@@
 
 #  General setup for the virtual host
 DocumentRoot /var/www/htdocs
-ServerName new.host.name
-ServerAdmin you@@your.address
+#ServerName new.host.name
+#ServerAdmin you@@your.address
 ErrorLog logs/error_log
 TransferLog logs/access_log
 
@@@@ -958,7 +969,7 @@@@
 #   pass phrase.  Note that a kill -HUP will prompt again. A test
 #   certificate can be generated with `make certificate' under
 #   built time.
-SSLCertificateFile    /etc/ssl/server.crt
+SSLCertificateFile    /etc/ssl/server.cer
 
 #   Server Private Key:
 #   If the key is not combined with the certificate, use this
@@@@ -972,8 +983,8 @@@@
 #   Note: Inside SSLCACertificatePath you need hash symlinks
 #         to point to the certificate files. Use the provided
 #         Makefile to update the hash symlinks after changes.
-#SSLCACertificatePath    @@@@ServerRoot@@@@/conf/ssl.crt
-#SSLCACertificateFile    @@@@ServerRoot@@@@/conf/ssl.crt/ca-bundle.crt
+#SSLCACertificatePath    @@@@ServerRoot@@@@/conf/ssl.cer
+#SSLCACertificateFile    @@@@ServerRoot@@@@/conf/ssl/ca-bundle.cer
 
 #   Client Authentication (Type):
 #   Client certificate verification type and depth.  Types are
@@@@ -1016,7 +1027,7 @@@@
 #     This exports obsolete environment variables for backward compatibility
 #     to Apache-SSL 1.x, mod_ssl 2.0.x, Sioux 1.0 and Stronghold 2.x. Use this
 #     to provide compatibility to existing CGI scripts.
-#SSLOptions +FakeBasicAuth +ExportCertData +CompatEnvVars
+SSLOptions +FakeBasicAuth +ExportCertData +CompatEnvVars
 
 #   Per-Server Logging:
 #   The home of a custom SSL log file. Use this when you want a
@@@@ -1027,4 +1038,3 @@@@
 </VirtualHost>                                  
 
 </IfDefine>
-
Index: src/usr.sbin/httpd/conf/httpd.conf-dist
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/conf/httpd.conf-dist,v
retrieving revision 1.14
diff -u -r1.14 httpd.conf-dist
--- src/usr.sbin/httpd/conf/httpd.conf-dist	7 Oct 2002 20:22:44 -0000	1.14
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	4 Mar 2003 16:52:42 -0000
@@@@ -175,6 +175,14 @@@@
 #Listen 12.34.56.78:80
 
 #
+# Listen can take two arguments. This is an extension for supporting IPv6.
+# Note that apache will listen _only_ to IPv6 addresses by default, because
+# the OpenBSD IPv6 stack does not implement IPv4-mapped addresses for
+# security reasons, so don't comment the following two lines:
+Listen :: 80
+Listen 0.0.0.0 80
+
+#
 # BindAddress: You can support virtual hosts with this option. This directive
 # is used to tell the server which IP address to listen to. It can either
 # contain "*", an IP address, or a fully qualified Internet domain name.
Index: src/usr.sbin/httpd/htdocs/manual/mod/core.html.html
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/mod/core.html.html,v
retrieving revision 1.4
diff -u -r1.4 core.html.html
--- src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	4 Mar 2003 16:52:42 -0000
@@@@ -1,12 +1,8 @@@@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
-    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
 <html xmlns="http://www.w3.org/1999/xhtml">
   <head>
-    <meta name="generator" content="HTML Tidy, see www.w3.org" />
-
     <title>Apache Core Features</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
@@@@ -150,6 +146,8 @@@@
 
       <li><a href="#rlimitcpu">RLimitCPU</a></li>
 
+      <li><a href="#rlimittime">RLimitTime</a></li>
+
       <li><a href="#rlimitmem">RLimitMEM</a></li>
 
       <li><a href="#rlimitnproc">RLimitNPROC</a></li>
@@@@ -3112,6 +3110,46 @@@@
     logs.</p>
 
     <p>CPU resource limits are expressed in seconds per
+    process.</p>
+
+    <p>See also <a href="#rlimitmem">RLimitMEM</a> or <a
+    href="#rlimitnproc">RLimitNPROC</a>.</p>
+    <hr />
+
+    <h2><a id="rlimit" name="rlimit">RLimitTime</a> <a
+    id="rlimittime" name="rlimittime">directive</a></h2>
+
+    <a href="directive-dict.html#Syntax"
+    rel="Help"><strong>Syntax:</strong></a> RLimitTime
+    <em>number</em>|max [<em>number</em>|max] <br />
+     <a href="directive-dict.html#Default"
+    rel="Help"><strong>Default:</strong></a> <em>Unset; uses
+    operating system defaults</em> <br />
+     <a href="directive-dict.html#Context"
+    rel="Help"><strong>Context:</strong></a> server config, virtual
+    host<br />
+     <a href="directive-dict.html#Status"
+    rel="Help"><strong>Status:</strong></a> core<br />
+     <a href="directive-dict.html#Compatibility"
+    rel="Help"><strong>Compatibility:</strong></a> RLimitTime is
+    only available on OpenBSD
+
+    <p>Takes 1 or 2 parameters. The first parameter sets the soft
+    resource limit for all processes and the second parameter sets
+    the maximum resource limit. Either parameter can be a number,
+    or <code>max</code> to indicate to the server that the limit
+    should be set to the maximum allowed by the operating system
+    configuration. Raising the maximum resource limit requires that
+    the server is running as root, or in the initial startup
+    phase.</p>
+
+    <p>This applies to processes forked off from Apache children
+    servicing requests, not the Apache children themselves. This
+    includes CGI scripts and SSI exec commands, but not any
+    processes forked off from the Apache parent such as piped
+    logs.</p>
+
+    <p>Human-time resource limits are expressed in seconds per
     process.</p>
 
     <p>See also <a href="#rlimitmem">RLimitMEM</a> or <a
Index: src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de,v
retrieving revision 1.1
diff -u -r1.1 directives.html.de
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	12 Feb 2002 07:56:25 -0000	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	4 Mar 2003 16:52:42 -0000
@@@@ -202,6 +202,7 @@@@
 <LI><A HREF="mod_rewrite.html#RewriteOptions">RewriteOptions</A>
 <LI><A HREF="mod_rewrite.html#RewriteRule">RewriteRule</A>
 <LI><A HREF="core.html#rlimitcpu">RLimitCPU</A>
+<LI><A HREF="core.html#rlimittime">RLimitTime</A>
 <LI><A HREF="core.html#rlimitmem">RLimitMEM</A>
 <LI><A HREF="core.html#rlimitnproc">RLimitNPROC</A>
 <LI><A HREF="core.html#satisfy">Satisfy</A>
Index: src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en,v
retrieving revision 1.4
diff -u -r1.4 directives.html.en
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	4 Mar 2003 16:52:42 -0000
@@@@ -483,6 +483,8 @@@@
 
       <li><a href="core.html#rlimitcpu">RLimitCPU</a></li>
 
+      <li><a href="core.html#rlimittime">RLimitTime</a></li>
+
       <li><a href="core.html#rlimitmem">RLimitMEM</a></li>
 
       <li><a href="core.html#rlimitnproc">RLimitNPROC</a></li>
Index: src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr,v
retrieving revision 1.1
diff -u -r1.1 directives.html.fr
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	12 Feb 2002 07:56:25 -0000	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	4 Mar 2003 16:52:42 -0000
@@@@ -474,6 +474,8 @@@@
       href="mod_rewrite.html#RewriteRule">RewriteRule</a></li>
 
       <li><a href="core.html#rlimitcpu">RLimitCPU</a></li>
+      
+      <li><a href="core.html#rlimittime">RLimitTime</a></li>      
 
       <li><a href="core.html#rlimitmem">RLimitMEM</a></li>
 
Index: src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html,v
retrieving revision 1.3
diff -u -r1.3 directives.html.html
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	7 Oct 2002 21:04:22 -0000	1.3
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	4 Mar 2003 16:52:42 -0000
@@@@ -1,12 +1,8 @@@@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
-    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
 <html xmlns="http://www.w3.org/1999/xhtml">
   <head>
-    <meta name="generator" content="HTML Tidy, see www.w3.org" />
-
     <title>Apache directives</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
@@@@ -482,6 +478,8 @@@@
       href="mod_rewrite.html#RewriteRule">RewriteRule</a></li>
 
       <li><a href="core.html#rlimitcpu">RLimitCPU</a></li>
+
+      <li><a href="core.html#rlimittime">RLimitTime</a></li>
 
       <li><a href="core.html#rlimitmem">RLimitMEM</a></li>
 
Index: src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis,v
retrieving revision 1.4
diff -u -r1.4 directives.html.ja.jis
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	4 Mar 2003 16:52:42 -0000
@@@@ -479,6 +479,8 @@@@
 
       <li><a href="core.html#rlimitcpu">RLimitCPU</a></li>
 
+      <li><a href="core.html#rlimittime">RLimitTime</a></li>
+
       <li><a href="core.html#rlimitmem">RLimitMEM</a></li>
 
       <li><a href="core.html#rlimitnproc">RLimitNPROC</a></li>
Index: src/usr.sbin/httpd/htdocs/manual/server-wide.html.en
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/server-wide.html.en,v
retrieving revision 1.2
diff -u -r1.2 server-wide.html.en
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	4 Mar 2003 16:52:42 -0000
@@@@ -249,6 +249,7 @@@@
          <a
         href="mod/core.html#limitrequestline">LimitRequestLine</a><br />
          <a href="mod/core.html#rlimitcpu">RLimitCPU</a><br />
+         <a href="mod/core.html#rlimittime">RLimitTime</a><br />         
          <a href="mod/core.html#rlimitmem">RLimitMEM</a><br />
          <a href="mod/core.html#rlimitnproc">RLimitNPROC</a><br />
          <a
Index: src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr,v
retrieving revision 1.2
diff -u -r1.2 server-wide.html.fr
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	4 Mar 2003 16:52:42 -0000
@@@@ -284,6 +284,7 @@@@
          <a
         href="mod/core.html#limitrequestline">LimitRequestLine</a><br />
          <a href="mod/core.html#rlimitcpu">RLimitCPU</a><br />
+         <a href="mod/core.html#rlimittime">RLimitTime</a><br />         
          <a href="mod/core.html#rlimitmem">RLimitMEM</a><br />
          <a href="mod/core.html#rlimitnproc">RLimitNPROC</a><br />
          <a
Index: src/usr.sbin/httpd/htdocs/manual/server-wide.html.html
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/server-wide.html.html,v
retrieving revision 1.2
diff -u -r1.2 server-wide.html.html
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	4 Mar 2003 16:52:42 -0000
@@@@ -1,12 +1,8 @@@@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
-    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
 <html xmlns="http://www.w3.org/1999/xhtml">
   <head>
-    <meta name="generator" content="HTML Tidy, see www.w3.org" />
-
     <title>Server-Wide Configuration</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
@@@@ -251,6 +247,7 @@@@
          <a
         href="mod/core.html#limitrequestline">LimitRequestLine</a><br />
          <a href="mod/core.html#rlimitcpu">RLimitCPU</a><br />
+         <a href="mod/core.html#rlimittime">RLimitTime</a><br />
          <a href="mod/core.html#rlimitmem">RLimitMEM</a><br />
          <a href="mod/core.html#rlimitnproc">RLimitNPROC</a><br />
          <a
Index: src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis,v
retrieving revision 1.3
diff -u -r1.3 server-wide.html.ja.jis
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	19 Jul 2002 21:30:52 -0000	1.3
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	4 Mar 2003 16:52:42 -0000
@@@@ -250,6 +250,7 @@@@
         <a
        href="mod/core.html#limitrequestline">LimitRequestLine</a><br />
         <a href="mod/core.html#rlimitcpu">RLimitCPU</a><br />
+        <a href="mod/core.html#rlimittime">RLimitTime</a><br />        
         <a href="mod/core.html#rlimitmem">RLimitMEM</a><br />
         <a href="mod/core.html#rlimitnproc">RLimitNPROC</a><br />
         <a
Index: src/usr.sbin/httpd/src/Configuration.tmpl
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/Configuration.tmpl,v
retrieving revision 1.9
diff -u -r1.9 Configuration.tmpl
--- src/usr.sbin/httpd/src/Configuration.tmpl	12 Feb 2002 07:56:27 -0000	1.9
+++ src/usr.sbin/httpd/src/Configuration.tmpl	22 Mar 2003 14:39:34 -0000
@@@@ -1,3 +1,4 @@@@
+#	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $
 # Config file for the Apache httpd.
 
 # Configuration.tmpl is the template for Configuration. Configuration should
@@@@ -243,6 +244,7 @@@@
 Rule PARANOID=no
 Rule EXPAT=default
 Rule CYGWIN_WINSOCK=no 
+Rule INET6=no
 
 # DEV_RANDOM:
 #  Note: this rule is only used when compiling mod_auth_digest.
Index: src/usr.sbin/httpd/src/Configure
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/Configure,v
retrieving revision 1.21
diff -u -r1.21 Configure
--- src/usr.sbin/httpd/src/Configure	7 Oct 2002 20:22:44 -0000	1.21
+++ src/usr.sbin/httpd/src/Configure	22 Mar 2003 15:04:53 -0000
@@@@ -1,4 +1,5 @@@@
 #!/bin/sh
+# $MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $
 # $OpenBSD: Configure,v 1.21 2002/10/07 20:23:06 henning Exp $
 ## ====================================================================
 ## The Apache Software License, Version 1.1
@@@@ -240,6 +241,7 @@@@
 RULE_CYGWIN_WINSOCK=`${SHELL} helpers/CutRule CYGWIN_WINSOCK $file` 
 RULE_SHARED_CORE=`${SHELL} helpers/CutRule SHARED_CORE $file`
 RULE_SHARED_CHAIN=`${SHELL} helpers/CutRule SHARED_CHAIN $file`
+RULE_INET6=$(${SHELL} helpers/CutRule INET6 $file)
 
 ####################################################################
 ## Rule SHARED_CORE implies required DSO support
@@@@ -1663,7 +1665,7 @@@@
 	# Test for the presence of the "union semun":
 	if TCADDINCL='#include <sys/types.h>
 #include <sys/ipc.h>
-#include <sys/sem.h>' ./helpers/TestCompile sizeof "union semun"; then
+#include <sys/sem.h>' ${SHELL} ./helpers/TestCompile sizeof "union semun"; then
             : Okay, union semun is defined
 	else
 	    CFLAGS="$CFLAGS -DNEED_UNION_SEMUN"
@@@@ -1718,6 +1720,124 @@@@
 	    ;;
     esac
 fi
+
+# INET6 support.
+if [ "$RULE_INET6" = "yes" ]; then
+    echo " + enabling INET6 support"
+    CFLAGS="$CFLAGS -DINET6"
+    CFLAGS="$CFLAGS -Dss_family=__ss_family -Dss_len=__ss_len"
+    IPV6_STACKTYPE="UNKNOWN"
+    for i in KAME Linux Solaris; do
+	case "$i" in
+	KAME)
+	    if [ -f /usr/include/netinet6/in6.h -a "x`egrep '__KAME__' /usr/include/netinet6/in6.h 2>/dev/null`" != "x" ]; then
+		IPV6_STACKTYPE=$i
+	    fi
+	    ;;
+	Linux)
+	    if [ /usr/include/netinet/ip6.h -a -d /usr/include/linux ]; then
+		IPV6_STACKTYPE=$i
+	    fi
+	    ;;
+	Solaris)
+	    SOL_VERSION=`(uname -v) 2>/dev/null` || SOL_VERSION="unknown"
+	    case "${PLAT}-${SOL_VERSION}" in
+		*-solaris2.27*-*IPv6*)
+		    if [ -f /etc/hostname -o -f /etc/hostname.[a-z]*[0-9] ]; then
+			IPV6_STACKTYPE="Solaris 7 (${SOL_VERSION})"
+		    fi
+		    ;;
+	    esac
+	    ;;
+	esac
+	if [ "$IPV6_STACKTYPE" != "UNKNOWN" ]; then
+	    break
+	fi
+    done
+    if [ "$IPV6_STACKTYPE" != "UNKNOWN" ]; then
+	echo " + You seem to be using $IPV6_STACKTYPE stack"
+	if ${SHELL} ./helpers/TestCompile func getaddrinfo; then
+	    echo "   - Assuming you have working getaddrinfo in libc"
+	else
+	    if [ -f /usr/local/v6/lib/libinet6.a -a "x`egrep '^EXTRA_L' Makefile.config | grep linet6`" = "x" ]; then
+		LIBS="$LIBS -L/usr/local/v6/lib -linet6"
+		echo "   - using getaddrinfo in libinet6"
+	    elif [ -f /usr/local/lib/libinet6.a -a "x`egrep '^EXTRA_L' Makefile.config | grep linet6`" = "x" ]; then
+		LIBS="$LIBS -L/usr/local/lib -linet6"
+		echo "   - using getaddrinfo in libinet6"
+	    elif [ -f /usr/inet6/lib/libinet6.a -a "x`egrep '^EXTRA_L' Makefile.config | grep linet6`" = "x" ]; then
+		echo "   - using getaddrinfo in libinet6"
+	    else
+		echo "** WARNING: No getaddrinfo found, linkage may fail"
+	    fi
+	fi
+    else
+	echo ""
+	echo "** WARNING: We have no explicit knowledge about the IPv6"
+	echo "** implementation on this host.  You may need to specify"
+	echo "** EXTRA_LIBS so that we can find getaddrinfo() and"
+	echo "** getnameinfo() library functions."
+	echo ""
+    fi
+    case $PLAT in
+	*-solaris2* )
+	    LIBS="$LIBS -lresolv"
+	    ;;
+    esac
+else
+    CFLAGS="$CFLAGS -DNEED_GETADDRINFO -DNEED_GETNAMEINFO"
+    if [ -f /usr/include/netdb.h -a "x`egrep 'addrinfo' /usr/include/netdb.h`" = "x" ]; then
+	CFLAGS="$CFLAGS -DNEED_ADDRINFO"
+    fi
+fi
+
+echo '#include <sys/types.h>' >testfunc.c
+echo '#include <sys/socket.h>' >>testfunc.c
+echo 'int testfunc(){ struct sockaddr sa; int i = sa.sa_len; };' >>testfunc.c
+rm -f testfunc.o
+eval "${MAKE-make} -f Makefile.config testfunc.o >/dev/null 2>/dev/null"
+if [ -f testfunc.o ]; then
+    echo " + you have sa_len in struct sockaddr."
+    CFLAGS="$CFLAGS -DHAVE_SOCKADDR_LEN"
+else
+    echo " + you don't have sa_len in struct sockaddr."
+fi
+rm -f testfunc.c testfunc.o
+
+echo '#include <sys/types.h>' >testfunc.c
+echo '#include <sys/socket.h>' >>testfunc.c
+echo 'struct sockaddr_storage sockaddr_storage;' >>testfunc.c
+rm -f testfunc.o
+eval "${MAKE-make} -f Makefile.config testfunc.o >/dev/null 2>/dev/null"
+if [ -f testfunc.o ]; then
+    echo " + assuming you have struct sockaddr_storage"
+else
+    CFLAGS="$CFLAGS -DNEED_SOCKADDR_STORAGE"
+    echo " + you need struct sockaddr_storage"
+fi
+rm -f testfunc.c testfunc.o
+
+echo '#include <sys/types.h>' >testfunc.c
+echo '#include <sys/socket.h>' >>testfunc.c
+echo 'int testfunc(){ socklen_t t; }' >>testfunc.c
+rm -f testfunc.o
+eval "${MAKE-make} -f Makefile.config testfunc.o >/dev/null 2>/dev/null"
+if [ ! -f testfunc.o ]; then
+    CFLAGS="$CFLAGS -Dsocklen_t=int"
+fi
+rm -f testfunc.c testfunc.o
+
+echo '#include <sys/types.h>' >testfunc.c
+echo '#include <sys/socket.h>' >>testfunc.c
+echo 'struct sockaddr_in sin;' >>testfunc.c
+echo 'int main(){ int i = sin.sin_len; }' >>testfunc.c
+rm -f testfunc.o
+eval "${MAKE-make} -f Makefile.config testfunc.o >/dev/null 2>/dev/null"
+if [ -f testfunc.o ]; then
+    CFLAGS="$CFLAGS -DSIN_LEN"
+fi
+rm -f testfunc.c testfunc.o
+
 
 ####################################################################
 ## Find out what modules we want and try and configure things for them
Index: src/usr.sbin/httpd/src/ap/ap_snprintf.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/ap/ap_snprintf.c,v
retrieving revision 1.9
diff -u -r1.9 ap_snprintf.c
--- src/usr.sbin/httpd/src/ap/ap_snprintf.c	11 Dec 2002 17:22:34 -0000	1.9
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	22 Mar 2003 14:39:28 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -76,6 +77,7 @@@@
 #ifdef WIN32
 #include <float.h>
 #endif
+#include "sa_len.h"
 
 typedef enum {
     NO = 0, YES = 1
@@@@ -505,6 +507,42 @@@@
 
 
 
+#ifdef INET6
+static char *conv_sockaddr(struct sockaddr *sa, char *buf_end, int *len)
+{
+    char *p = buf_end;
+    char hostnamebuf[MAXHOSTNAMELEN];
+    char portnamebuf[MAXHOSTNAMELEN];
+    char *q;
+    int salen;
+
+#ifndef SIN6_LEN
+    salen = SA_LEN(sa);
+#else
+    salen = sa->sa_len;
+#endif
+    if (getnameinfo(sa, salen, hostnamebuf, sizeof(hostnamebuf),
+	    portnamebuf, sizeof(portnamebuf), NI_NUMERICHOST | NI_NUMERICSERV)) {
+	strcpy(hostnamebuf, "???");
+	strcpy(portnamebuf, "???");
+    }
+    if (strcmp(portnamebuf,"0") == 0)
+	strcpy(portnamebuf, "*");
+    q = portnamebuf + strlen(portnamebuf);
+    while (portnamebuf < q)
+	*--p = *--q;
+    *--p = ':';
+    q = hostnamebuf + strlen(hostnamebuf);
+    while (hostnamebuf < q)
+	*--p = *--q;
+
+    *len = buf_end - p;
+    return (p);
+}
+#endif /*INET6*/
+
+
+
 /*
  * Convert a floating point number to a string formats 'f', 'e' or 'E'.
  * The result is placed in buf, and len denotes the length of the string
@@@@ -1056,6 +1094,7 @@@@
 		    /* print a struct sockaddr_in as a.b.c.d:port */
 		case 'I':
 		    {
+#ifndef INET6
 			struct sockaddr_in *si;
 
 			si = va_arg(ap, struct sockaddr_in *);
@@@@ -1064,6 +1103,16 @@@@
 			    if (adjust_precision && precision < s_len)
 				s_len = precision;
 			}
+#else
+			struct sockaddr *sa;
+
+			sa = va_arg(ap, struct sockaddr *);
+			if (sa != NULL) {
+			    s = conv_sockaddr(sa, &num_buf[NUM_BUF_SIZE], &s_len);
+			    if (adjust_precision && precision < s_len)
+				s_len = precision;
+			}
+#endif
 			else {
 			    s = S_NULL;
 			    s_len = S_NULL_LEN;
Index: src/usr.sbin/httpd/src/include/ap.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/ap.h,v
retrieving revision 1.9
diff -u -r1.9 ap.h
--- src/usr.sbin/httpd/src/include/ap.h	7 Oct 2002 20:22:44 -0000	1.9
+++ src/usr.sbin/httpd/src/include/ap.h	22 Mar 2003 15:04:44 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -95,7 +96,8 @@@@
  * with some extensions.  The extensions are:
  *
  * %pA	takes a struct in_addr *, and prints it as a.b.c.d
- * %pI	takes a struct sockaddr_in * and prints it as a.b.c.d:port
+ * %pI	takes a struct sockaddr * and prints it as a.b.c.d:port, or
+ *	ipv6-numeric-addr:port
  * %pp  takes a void * and outputs it in hex
  *
  * The %p hacks are to force gcc's printf warning code to skip
Index: src/usr.sbin/httpd/src/include/ap_config.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/ap_config.h,v
retrieving revision 1.15
diff -u -r1.15 ap_config.h
--- src/usr.sbin/httpd/src/include/ap_config.h	10 Sep 2002 17:48:59 -0000	1.15
+++ src/usr.sbin/httpd/src/include/ap_config.h	22 Mar 2003 14:39:25 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /*	$OpenBSD: ap_config.h,v 1.15 2002/09/10 17:49:21 henning Exp $ */
 
 /* ====================================================================
@@@@ -409,6 +410,10 @@@@
 #endif
 #ifndef S_IWOTH
 #define S_IWOTH 000002
+#ifndef rlim_t
+typedef int rlim_t;
+#endif
+typedef u_long n_long;
 #endif
 
 #define STDIN_FILENO  0
@@@@ -1517,6 +1522,70 @@@@
 
 #ifndef ap_wait_t
 #define ap_wait_t int
+#endif
+
+#ifndef INET6
+#define sockaddr_storage	sockaddr
+#define ss_family		sa_family
+#define ss_len			sa_len
+#else
+#include "sockaddr_storage.h"	/* sshida@@st.rim.or.jp */
+#endif
+
+#ifndef INET6_ADDRSTRLEN
+#define INET6_ADDRSTRLEN	46
+#endif
+#ifndef INET_ADDRSTRLEN
+#define INET_ADDRSTRLEN		16
+#endif
+#ifndef NI_MAXHOST
+#define NI_MAXHOST		1025
+#endif
+#ifndef NI_MAXSERV
+#define	NI_MAXSERV		32
+#endif
+
+#if defined(NEED_GETADDRINFO) || defined(NEED_GETNAMEINFO)
+/*
+ * minimal definitions for fake getaddrinfo()/getnameinfo().
+ */
+#ifndef EAI_NODATA
+#define EAI_NODATA	1
+#define EAI_MEMORY	2
+#endif
+
+#ifndef AI_PASSIVE
+#define AI_PASSIVE	1
+#define AI_CANONNAME	2
+#define AI_NUMERICHOST	4
+#define NI_NUMERICHOST	8
+#define NI_NAMEREQD	16
+#define NI_NUMERICSERV	32
+#endif
+#endif
+
+#ifdef NEED_GETADDRINFO
+#ifdef NEED_ADDRINFO
+struct addrinfo {
+	int	ai_flags;	/* AI_PASSIVE, AI_CANONNAME */
+	int	ai_family;	/* PF_xxx */
+	int	ai_socktype;	/* SOCK_xxx */
+	int	ai_protocol;	/* 0 or IPPROTO_xxx for IPv4 and IPv6 */
+	size_t	ai_addrlen;	/* length of ai_addr */
+	char	*ai_canonname;	/* canonical name for hostname */
+	struct sockaddr *ai_addr;	/* binary address */
+	struct addrinfo *ai_next;	/* next structure in linked list */
+};
+#endif
+extern char *gai_strerror(int ecode);
+extern void freeaddrinfo(struct addrinfo *ai);
+extern int getaddrinfo(const char *hostname, const char *servname,
+	const struct addrinfo *hints, struct addrinfo **res);
+#endif
+#ifdef NEED_GETNAMEINFO
+extern int getnameinfo(const struct sockaddr *sa, size_t salen,
+	char *host, size_t hostlen, char *serv, size_t servlen,
+	int flag);
 #endif
 
 #ifdef __cplusplus
Index: src/usr.sbin/httpd/src/include/http_conf_globals.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/http_conf_globals.h,v
retrieving revision 1.10
diff -u -r1.10 http_conf_globals.h
--- src/usr.sbin/httpd/src/include/http_conf_globals.h	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	22 Mar 2003 15:04:43 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -82,7 +83,8 @@@@
 extern API_VAR_EXPORT int ap_max_requests_per_child;
 extern API_VAR_EXPORT int ap_threads_per_child;
 extern API_VAR_EXPORT int ap_excess_requests_per_child;
-extern API_VAR_EXPORT struct in_addr ap_bind_address;
+extern API_VAR_EXPORT struct sockaddr_storage ap_bind_address;
+extern API_VAR_EXPORT int ap_default_family;
 extern listen_rec *ap_listeners;
 extern API_VAR_EXPORT int ap_daemons_to_start;
 extern API_VAR_EXPORT int ap_daemons_min_free;
Index: src/usr.sbin/httpd/src/include/http_core.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/http_core.h,v
retrieving revision 1.7
diff -u -r1.7 http_core.h
--- src/usr.sbin/httpd/src/include/http_core.h	29 Mar 2002 02:07:43 -0000	1.7
+++ src/usr.sbin/httpd/src/include/http_core.h	22 Mar 2003 14:39:22 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -277,6 +278,9 @@@@
     /* System Resource Control */
 #ifdef RLIMIT_CPU
     struct rlimit *limit_cpu;
+#endif
+#ifdef RLIMIT_TIME
+    struct rlimit *limit_time;
 #endif
 #if defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined(RLIMIT_AS)
     struct rlimit *limit_mem;
Index: src/usr.sbin/httpd/src/include/http_vhost.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/http_vhost.h,v
retrieving revision 1.5
diff -u -r1.5 http_vhost.h
--- src/usr.sbin/httpd/src/include/http_vhost.h	29 Mar 2002 02:07:43 -0000	1.5
+++ src/usr.sbin/httpd/src/include/http_vhost.h	22 Mar 2003 15:04:41 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -73,7 +74,7 @@@@
 API_EXPORT(const char *) ap_parse_vhost_addrs(pool *p, const char *hostname, server_rec *s);
 
 /* handle NameVirtualHost directive */
-API_EXPORT_NONSTD(const char *) ap_set_name_virtual_host (cmd_parms *cmd, void *dummy, char *arg);
+API_EXPORT_NONSTD(const char *) ap_set_name_virtual_host (cmd_parms *cmd, void *dummy, char *h, char *p);
 
 /* given an ip address only, give our best guess as to what vhost it is */
 API_EXPORT(void) ap_update_vhost_given_ip(conn_rec *conn);
Index: src/usr.sbin/httpd/src/include/httpd.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/httpd.h,v
retrieving revision 1.17
diff -u -r1.17 httpd.h
--- src/usr.sbin/httpd/src/include/httpd.h	7 Oct 2002 20:22:44 -0000	1.17
+++ src/usr.sbin/httpd/src/include/httpd.h	22 Mar 2003 14:39:20 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -64,6 +65,13 @@@@
 #endif
 
 /*
+ * Define APACHE6 so that additional modules depending on Apache can
+ * tell if this a pacthed apache-1.3.*. With this definition apache6
+ * is working together with e.g. the ap-perl module in NetBSD.
+ */
+#define APACHE6 1
+
+/*
  * httpd.h: header for simple (ha! not anymore) http daemon
  */
 
@@@@ -903,8 +911,8 @@@@
 
     /* Who is the client? */
 
-    struct sockaddr_in local_addr;	/* local address */
-    struct sockaddr_in remote_addr;	/* remote address */
+    struct sockaddr_storage local_addr;	/* local address */
+    struct sockaddr_storage remote_addr; /* remote address */
     char *remote_ip;		/* Client's IP address */
     char *remote_host;		/* Client's DNS name, if known.
 				 * NULL if DNS hasn't been checked,
@@@@ -946,8 +954,8 @@@@
 typedef struct server_addr_rec server_addr_rec;
 struct server_addr_rec {
     server_addr_rec *next;
-    struct in_addr host_addr;	/* The bound address, for this server */
-    unsigned short host_port;	/* The bound port, for this server */
+    struct sockaddr_storage host_addr;	/* The bound address, for this server */
+    unsigned short host_port;	/* The bound port, for this server XXX */
     char *virthost;		/* The name given in <VirtualHost> */
 };
 
@@@@ -1015,7 +1023,7 @@@@
 /* These are more like real hosts than virtual hosts */
 struct listen_rec {
     listen_rec *next;
-    struct sockaddr_in local_addr;	/* local IP address and port */
+    struct sockaddr_storage local_addr;	/* local IP address and port */
     int fd;
     int used;			/* Only used during restart */        
 /* more stuff here, like which protocol is bound to the port */
@@@@ -1183,7 +1191,7 @@@@
 #endif /*#ifdef CHARSET_EBCDIC*/
 
 API_EXPORT(char *) ap_get_local_host(pool *);
-API_EXPORT(unsigned long) ap_get_virthost_addr(char *hostname, unsigned short *port);
+API_EXPORT(struct sockaddr *) ap_get_virthost_addr(char *hostname, unsigned short *port);
 
 extern API_VAR_EXPORT time_t ap_restart_time;
 
Index: src/usr.sbin/httpd/src/main/http_config.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/http_config.c,v
retrieving revision 1.12
diff -u -r1.12 http_config.c
--- src/usr.sbin/httpd/src/main/http_config.c	7 Oct 2002 20:22:44 -0000	1.12
+++ src/usr.sbin/httpd/src/main/http_config.c	22 Mar 2003 15:04:35 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* $OpenBSD: http_config.c,v 1.12 2002/10/07 20:23:06 henning Exp $ */
 
 /* ====================================================================
@@@@ -1599,7 +1600,6 @@@@
     ap_scoreboard_fname = DEFAULT_SCOREBOARD;
     ap_lock_fname = DEFAULT_LOCKFILE;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
-    ap_bind_address.s_addr = htonl(INADDR_ANY);
     ap_listeners = NULL;
     ap_listenbacklog = DEFAULT_LISTENBACKLOG;
     ap_extended_status = 0;
@@@@ -1632,7 +1632,13 @@@@
     s->next = NULL;
     s->addrs = ap_pcalloc(p, sizeof(server_addr_rec));
     /* NOT virtual host; don't match any real network interface */
-    s->addrs->host_addr.s_addr = htonl(INADDR_ANY);
+    memset(&s->addrs->host_addr, 0, sizeof(s->addrs->host_addr));
+#if 0
+    s->addrs->host_addr.ss_family = ap_default_family; /* XXX: needed?, XXX: PF_xxx can be different from AF_xxx */
+#endif
+#ifdef HAVE_SOCKADDR_LEN
+    s->addrs->host_addr.ss_len = sizeof(s->addrs->host_addr); /* XXX: needed ? */
+#endif
     s->addrs->host_port = 0;	/* matches any port */
     s->addrs->virthost = "";	/* must be non-NULL */
     s->names = s->wild_names = NULL;
@@@@ -1651,21 +1657,33 @@@@
 static void default_listeners(pool *p, server_rec *s)
 {
     listen_rec *new;
+    struct addrinfo hints, *res0, *res;
+    int gai;
+    char servbuf[NI_MAXSERV];
 
     if (ap_listeners != NULL) {
 	return;
     }
+    ap_snprintf(servbuf, sizeof(servbuf), "%d", s->port ? s->port : DEFAULT_HTTP_PORT);
+    memset (&hints, 0, sizeof(hints));
+    hints.ai_family = ap_default_family;
+    hints.ai_socktype = SOCK_STREAM;
+    hints.ai_flags = AI_PASSIVE;
+    gai = getaddrinfo(NULL, servbuf, &hints, &res0);
+    if (gai){
+	fprintf(stderr, "default_listeners(): getaddrinfo(PASSIVE) for family %u: %s\n",
+		ap_default_family, gai_strerror(gai));
+	exit (1);
+    }
     /* allocate a default listener */
     new = ap_pcalloc(p, sizeof(listen_rec));
-    new->local_addr.sin_family = AF_INET;
-    new->local_addr.sin_addr = ap_bind_address;
-    /* Buck ugly cast to get around terniary op bug in some (MS) compilers */
-    new->local_addr.sin_port = htons((unsigned short)(s->port ? s->port 
-                                                        : DEFAULT_HTTP_PORT));
+    memcpy(&new->local_addr, res0->ai_addr, res0->ai_addrlen);
     new->fd = -1;
     new->used = 0;
     new->next = NULL;
     ap_listeners = new;
+
+    freeaddrinfo(res0);
 }
 
 
Index: src/usr.sbin/httpd/src/main/http_core.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/http_core.c,v
retrieving revision 1.14
diff -u -r1.14 http_core.c
--- src/usr.sbin/httpd/src/main/http_core.c	7 Oct 2002 20:22:44 -0000	1.14
+++ src/usr.sbin/httpd/src/main/http_core.c	22 Mar 2003 14:37:44 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* $OpenBSD: http_core.c,v 1.14 2002/10/07 20:23:06 henning Exp $ */
 
 /* ====================================================================
@@@@ -73,6 +74,7 @@@@
 #include "util_md5.h"
 #include "scoreboard.h"
 #include "fnmatch.h"
+#include "sa_len.h"
 
 #ifdef USE_MMAP_FILES
 #include <sys/mman.h>
@@@@ -143,6 +145,9 @@@@
 #ifdef RLIMIT_CPU
     conf->limit_cpu = NULL;
 #endif
+#ifdef RLIMIT_TIME
+    conf->limit_time = NULL;
+#endif
 #if defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_AS)
     conf->limit_mem = NULL;
 #endif
@@@@ -276,6 +281,11 @@@@
         conf->limit_cpu = new->limit_cpu;
     }
 #endif
+#ifdef RLIMIT_TIME
+    if (new->limit_time) {
+        conf->limit_time = new->limit_time;
+    }
+#endif
 #if defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_AS)
     if (new->limit_mem) {
         conf->limit_mem = new->limit_mem;
@@@@ -641,7 +651,9 @@@@
  */
 static ap_inline void do_double_reverse (conn_rec *conn)
 {
-    struct hostent *hptr;
+    struct addrinfo hints, *res, *res0;
+    char hostbuf1[128], hostbuf2[128]; /* INET6_ADDRSTRLEN(=46) is enough */
+    int ok = 0;
 
     if (conn->double_reverse) {
 	/* already done */
@@@@ -653,30 +665,51 @@@@
         conn->remote_host = ""; /* prevent another lookup */
 	return;
     }
-    hptr = gethostbyname(conn->remote_host);
-    if (hptr) {
-	char **haddr;
-
-	for (haddr = hptr->h_addr_list; *haddr; haddr++) {
-	    if (((struct in_addr *)(*haddr))->s_addr
-		== conn->remote_addr.sin_addr.s_addr) {
-		conn->double_reverse = 1;
-		return;
-	    }
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_family = PF_UNSPEC;
+    hints.ai_socktype = SOCK_STREAM;
+    if (getaddrinfo(conn->remote_host, NULL, &hints, &res0)) {
+	conn->double_reverse = -1;
+	return;
+    }
+    for (res = res0; res; res = res->ai_next) {
+	if (res->ai_addr->sa_family != conn->remote_addr.ss_family ||
+	    !(res->ai_family == AF_INET
+#ifdef INET6
+	      || res->ai_family == AF_INET6
+#endif
+	      )
+	    )
+	    continue;
+#ifndef HAVE_SOCKADDR_LEN
+	if (res->ai_addrlen != SA_LEN((struct sockaddr *)&conn->remote_addr))
+#else
+	if (res->ai_addr->sa_len != conn->remote_addr.ss_len)
+#endif
+	    continue;
+	if (getnameinfo(res->ai_addr, res->ai_addrlen,
+            hostbuf1, sizeof(hostbuf1), NULL, 0,
+            NI_NUMERICHOST))
+	    continue;
+	if (getnameinfo(((struct sockaddr *)&conn->remote_addr), res->ai_addrlen,
+            hostbuf2, sizeof(hostbuf2), NULL, 0,
+            NI_NUMERICHOST))
+	    continue;
+	if (strcmp(hostbuf1, hostbuf2) == 0){
+	    ok = 1;
+	    break;
 	}
     }
-    conn->double_reverse = -1;
-    /* invalidate possible reverse-resolved hostname if forward lookup fails */
-    conn->remote_host = "";
+    conn->double_reverse = ok ? 1 : -1;
+    freeaddrinfo(res0);
 }
 
 API_EXPORT(const char *) ap_get_remote_host(conn_rec *conn, void *dir_config,
 					    int type)
 {
-    struct in_addr *iaddr;
-    struct hostent *hptr;
     int hostname_lookups;
     int old_stat = SERVER_DEAD;	/* we shouldn't ever be in this state */
+    char hostnamebuf[MAXHOSTNAMELEN];
 
     /* If we haven't checked the host name, and we want to */
     if (dir_config) {
@@@@ -698,10 +731,14 @@@@
 	    || hostname_lookups != HOSTNAME_LOOKUP_OFF)) {
 	old_stat = ap_update_child_status(conn->child_num, SERVER_BUSY_DNS,
 					  (request_rec*)NULL);
-	iaddr = &(conn->remote_addr.sin_addr);
-	hptr = gethostbyaddr((char *)iaddr, sizeof(struct in_addr), AF_INET);
-	if (hptr != NULL) {
-	    conn->remote_host = ap_pstrdup(conn->pool, (void *)hptr->h_name);
+	if (!getnameinfo((struct sockaddr *)&conn->remote_addr,
+#ifndef SIN6_LEN
+		SA_LEN((struct sockaddr *)&conn->remote_addr),
+#else
+		conn->remote_addr.ss_len,
+#endif
+		hostnamebuf, sizeof(hostnamebuf), NULL, 0, 0)) {
+	    conn->remote_host = ap_pstrdup(conn->pool, (void *)hostnamebuf);
 	    ap_str_tolower(conn->remote_host);
 	   
 	    if (hostname_lookups == HOSTNAME_LOOKUP_DOUBLE) {
@@@@ -779,6 +816,7 @@@@
 {
     conn_rec *conn = r->connection;
     core_dir_config *d;
+    char hbuf[MAXHOSTNAMELEN];
 
     d = (core_dir_config *)ap_get_module_config(r->per_dir_config,
 						&core_module);
@@@@ -788,23 +826,22 @@@@
     }
     if (d->use_canonical_name == USE_CANONICAL_NAME_DNS) {
         if (conn->local_host == NULL) {
-	    struct in_addr *iaddr;
-	    struct hostent *hptr;
             int old_stat;
 	    old_stat = ap_update_child_status(conn->child_num,
 					      SERVER_BUSY_DNS, r);
-	    iaddr = &(conn->local_addr.sin_addr);
-	    hptr = gethostbyaddr((char *)iaddr, sizeof(struct in_addr),
-				 AF_INET);
-	    if (hptr != NULL) {
-	        conn->local_host = ap_pstrdup(conn->pool,
-					      (void *)hptr->h_name);
-		ap_str_tolower(conn->local_host);
-	    }
-	    else {
-	        conn->local_host = ap_pstrdup(conn->pool,
-					      r->server->server_hostname);
+	    if (getnameinfo((struct sockaddr *)&conn->local_addr,
+#ifndef SIN6_LEN
+		    SA_LEN((struct sockaddr *)&conn->local_addr),
+#else
+		    conn->local_addr.ss_len,
+#endif
+		    hbuf, sizeof(hbuf), NULL, 0, 0) == 0) {
+		conn->local_host = ap_pstrdup(conn->pool, hbuf);
+	    } else {
+		conn->local_host = ap_pstrdup(conn->pool,
+		    r->server->server_hostname);
 	    }
+	    ap_str_tolower(conn->local_host);
 	    (void) ap_update_child_status(conn->child_num, old_stat, r);
 	}
 	return conn->local_host;
@@@@ -823,11 +860,13 @@@@
 
     if (d->use_canonical_name == USE_CANONICAL_NAME_OFF
 	|| d->use_canonical_name == USE_CANONICAL_NAME_DNS) {
-        return r->hostname ? ntohs(r->connection->local_addr.sin_port)
-			   : port;
-    }
-    /* default */
-    return port;
+        return r->hostname
+	    ?  ntohs(((struct sockaddr_in *)&r->connection->local_addr)->sin_port)
+	    : port;
+    }
+    return r->hostname
+	? ntohs(((struct sockaddr_in *)&r->connection->local_addr)->sin_port)
+	: port;
 }
 
 API_EXPORT(char *) ap_construct_url(pool *p, const char *uri,
@@@@ -2503,7 +2542,7 @@@@
 }
 
 
-#if defined(RLIMIT_CPU) || defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_NPROC) || defined(RLIMIT_AS)
+#if defined(RLIMIT_CPU) || defined(RLIMIT_TIME) || defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_NPROC) || defined(RLIMIT_AS)
 static void set_rlimit(cmd_parms *cmd, struct rlimit **plimit, const char *arg,
                        const char * arg2, int type)
 {
@@@@ -2559,7 +2598,7 @@@@
 }
 #endif
 
-#if !defined (RLIMIT_CPU) || !(defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined(RLIMIT_AS)) || !defined (RLIMIT_NPROC)
+#if !defined (RLIMIT_CPU) || defined (RLIMIT_TIME) || !(defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined(RLIMIT_AS)) || !defined (RLIMIT_NPROC)
 static const char *no_set_limit(cmd_parms *cmd, core_dir_config *conf,
 				char *arg, char *arg2)
 {
@@@@ -2578,6 +2617,15 @@@@
 }
 #endif
 
+#ifdef RLIMIT_TIME
+static const char *set_limit_time(cmd_parms *cmd, core_dir_config *conf,
+				 char *arg, char *arg2)
+{
+    set_rlimit(cmd, &conf->limit_time, arg, arg2, RLIMIT_TIME);
+    return NULL;
+}
+#endif
+
 #if defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined(RLIMIT_AS)
 static const char *set_limit_mem(cmd_parms *cmd, core_dir_config *conf, 
 				 char *arg, char * arg2)
@@@@ -2604,12 +2652,25 @@@@
 
 static const char *set_bind_address(cmd_parms *cmd, void *dummy, char *arg) 
 {
+    struct addrinfo hints, *res;
+    struct sockaddr *sa;
+    size_t sa_len;
+    int error;
     const char *err = ap_check_cmd_context(cmd, GLOBAL_ONLY);
     if (err != NULL) {
         return err;
     }
 
-    ap_bind_address.s_addr = ap_get_virthost_addr(arg, NULL);
+    if (strcmp(arg, "*") == 0)
+      arg = NULL;
+
+    sa = ap_get_virthost_addr(arg, NULL);
+#ifdef HAVE_SOCKADDR_LEN
+    sa_len = sa->sa_len;
+#else
+    sa_len = SA_LEN(sa);
+#endif
+    memcpy(&ap_bind_address, &sa, sa_len);
     return NULL;
 }
 
@@@@ -2641,44 +2702,70 @@@@
     return NULL;
 }
 
-static const char *set_listener(cmd_parms *cmd, void *dummy, char *ips)
+static const char *set_listener(cmd_parms *cmd, void *dummy, char *h, char *p)
 {
     listen_rec *new;
-    char *ports;
-    unsigned short port;
+    char *host, *port;
+    struct addrinfo hints, *res;
+    int error;
     
     const char *err = ap_check_cmd_context(cmd, GLOBAL_ONLY);
     if (err != NULL) {
         return err;
     }
 
-    ports = strchr(ips, ':');
-    if (ports != NULL) {
-	if (ports == ips) {
-	    return "Missing IP address";
-	}
-	else if (ports[1] == '\0') {
-	    return "Address must end in :<port-number>";
+    host = port = NULL;
+    if (!p) {
+	port = strrchr(h, ':');
+	if (port != NULL) {
+	    if (port == h) {
+		return "Missing IP address";
+	    }
+	    else if (port[1] == '\0') {
+		return "Address must end in :<port-number>";
+	    }
+	    *(port++) = '\0';
+	    if (*h)
+		host = h;
+	} else {
+	    host = NULL;
+	    port = h;
 	}
-	*(ports++) = '\0';
-    }
-    else {
-	ports = ips;
+    } else {
+	host = h;
+	port = p;
     }
 
-    new=ap_pcalloc(cmd->pool, sizeof(listen_rec));
-    new->local_addr.sin_family = AF_INET;
-    if (ports == ips) { /* no address */
-	new->local_addr.sin_addr.s_addr = htonl(INADDR_ANY);
-    }
-    else {
-	new->local_addr.sin_addr.s_addr = ap_get_virthost_addr(ips, NULL);
-    }
-    port = atoi(ports);
-    if (!port) {
-	return "Port must be numeric";
+    if (host && strcmp(host, "*") == 0)
+	host = NULL;
+
+    new = ap_pcalloc(cmd->pool, sizeof(listen_rec));
+
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_family = host ? PF_UNSPEC : ap_default_family;
+    hints.ai_flags = AI_PASSIVE;
+    hints.ai_socktype = SOCK_STREAM;
+    error = getaddrinfo(host, port, &hints, &res);
+    if (error || !res) {
+	fprintf(stderr, "could not resolve ");
+	if (host)
+	    fprintf(stderr, "host \"%s\" ", host);
+	if (port)
+	    fprintf(stderr, "port \"%s\" ", port);
+	fprintf(stderr, "--- %s\n", gai_strerror(error));
+	exit(1);
+    }
+    if (res->ai_next) {
+        if (host)
+	    fprintf(stderr, "host \"%s\" ", host);
+	if (port)
+	    fprintf(stderr, "port \"%s\" ", port);
+	fprintf(stderr, "resolved to multiple addresses, ambiguous.\n");
+	exit(1);
     }
-    new->local_addr.sin_port = htons(port);
+
+    memcpy(&new->local_addr, res->ai_addr, res->ai_addrlen);
+
     new->fd = -1;
     new->used = 0;
     new->next = ap_listeners;
@@@@ -3407,6 +3494,13 @@@@
   no_set_limit, NULL,
 #endif
   OR_ALL, TAKE12, "Soft/hard limits for max CPU usage in seconds" },
+{ "RLimitTime",
+#ifdef RLIMIT_TIME
+  set_limit_time, (void*)XtOffsetOf(core_dir_config, limit_time),
+#else
+  no_set_limit, NULL,
+#endif
+  OR_ALL, TAKE12, "Soft/hard limits for max human time in seconds" },
 { "RLimitMEM",
 #if defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined (RLIMIT_AS)
   set_limit_mem, (void*)XtOffsetOf(core_dir_config, limit_mem),
@@@@ -3427,7 +3521,7 @@@@
 { "ThreadStackSize", set_threadstacksize, NULL, RSRC_CONF, TAKE1,
   "Stack size each created thread will use."},
 #endif
-{ "Listen", set_listener, NULL, RSRC_CONF, TAKE1,
+{ "Listen", set_listener, NULL, RSRC_CONF, TAKE12,
   "A port number or a numeric IP address and a port number"},
 { "SendBufferSize", set_send_buffer_size, NULL, RSRC_CONF, TAKE1,
   "Send buffer size in bytes"},
@@@@ -3461,7 +3555,7 @@@@
   "Name of the config file to be included" },
 { "LogLevel", set_loglevel, NULL, RSRC_CONF, TAKE1,
   "Level of verbosity in error logging" },
-{ "NameVirtualHost", ap_set_name_virtual_host, NULL, RSRC_CONF, TAKE1,
+{ "NameVirtualHost", ap_set_name_virtual_host, NULL, RSRC_CONF, TAKE12,
   "A numeric IP address:port, or the name of a host" },
 #ifdef _OSD_POSIX
 { "BS2000Account", set_bs2000_account, NULL, RSRC_CONF, TAKE1,
Index: src/usr.sbin/httpd/src/main/http_main.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/http_main.c,v
retrieving revision 1.28
diff -u -r1.28 http_main.c
--- src/usr.sbin/httpd/src/main/http_main.c	16 Feb 2003 17:15:50 -0000	1.28
+++ src/usr.sbin/httpd/src/main/http_main.c	22 Mar 2003 15:04:33 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* $OpenBSD: http_main.c,v 1.28 2003/02/16 17:16:12 cloder Exp $ */
 
 /* ====================================================================
@@@@ -129,6 +130,8 @@@@
 #include <openssl/evp.h>
 #endif
 
+#include "sa_len.h"
+
 #ifdef MULTITHREAD
 /* special debug stuff -- PCS */
 
@@@@ -254,7 +257,12 @@@@
 API_VAR_EXPORT char *ap_scoreboard_fname=NULL;
 API_VAR_EXPORT char *ap_lock_fname=NULL;
 API_VAR_EXPORT char *ap_server_argv0=NULL;
-API_VAR_EXPORT struct in_addr ap_bind_address={0};
+#ifdef INET6
+API_VAR_EXPORT int ap_default_family = PF_INET6;
+#else
+API_VAR_EXPORT int ap_default_family = PF_INET;
+#endif
+API_VAR_EXPORT struct sockaddr_storage ap_bind_address;
 API_VAR_EXPORT int ap_daemons_to_start=0;
 API_VAR_EXPORT int ap_daemons_min_free=0;
 API_VAR_EXPORT int ap_daemons_max_free=0;
@@@@ -1400,7 +1408,11 @@@@
     fprintf(stderr, "Usage: %s [-D name] [-d directory] [-f file]\n", bin);
 #endif
     fprintf(stderr, "       %s [-C \"directive\"] [-c \"directive\"]\n", pad);
-    fprintf(stderr, "       %s [-v] [-V] [-h] [-l] [-L] [-S] [-t] [-T] [-F] [-u]\n", pad);
+    fprintf(stderr, "       %s [-v] [-V] [-h] [-l] [-L] [-S] [-t] [-T] [-F] [-u]"
+#ifdef INET6
+			" [-4|-6]"
+#endif
+			"\n", pad);
     fprintf(stderr, "Options:\n");
 #ifdef SHARED_CORE
     fprintf(stderr, "  -R directory     : specify an alternate location for shared object files\n");
@@@@ -1427,6 +1439,10 @@@@
     fprintf(stderr, "  -F               : run main process in foreground, for process supervisors\n");
     fprintf(stderr, "  -u               : Unsecure mode. Do not chroot into ServerRoot.\n");
 #endif
+#ifdef INET6
+    fprintf(stderr, "  -4               : assume IPv4 on parsing configuration file\n");
+    fprintf(stderr, "  -6               : assume IPv6 on parsing configuration file\n");
+#endif
 #ifdef WIN32
     fprintf(stderr, "  -n name          : name the Apache service for -k options below;\n");
     fprintf(stderr, "  -k stop|shutdown : tell running Apache to shutdown\n");
@@@@ -3611,11 +3627,13 @@@@
 
 
 static conn_rec *new_connection(pool *p, server_rec *server, BUFF *inout,
-			     const struct sockaddr_in *remaddr,
-			     const struct sockaddr_in *saddr,
+			     const struct sockaddr *remaddr,
+			     const struct sockaddr *saddr,
 			     int child_num)
 {
     conn_rec *conn = (conn_rec *) ap_pcalloc(p, sizeof(conn_rec));
+    char hostnamebuf[MAXHOSTNAMELEN];
+    size_t addr_len;
 
     /* Got a connection structure, so initialize what fields we can
      * (the rest are zeroed out by pcalloc).
@@@@ -3624,17 +3642,30 @@@@
     conn->child_num = child_num;
 
     conn->pool = p;
-    conn->local_addr = *saddr;
-    conn->local_ip = ap_pstrdup(conn->pool,
-				inet_ntoa(conn->local_addr.sin_addr));
+#ifndef SIN6_LEN
+    addr_len = SA_LEN(saddr);
+#else
+    addr_len = saddr->sa_len;
+#endif
+    memcpy(&conn->local_addr, saddr, addr_len);
+    getnameinfo((struct sockaddr *)&conn->local_addr, addr_len,
+	hostnamebuf, sizeof(hostnamebuf), NULL, 0, NI_NUMERICHOST);
+    conn->local_ip = ap_pstrdup(conn->pool, hostnamebuf);
     conn->server = server; /* just a guess for now */
     ap_update_vhost_given_ip(conn);
     conn->base_server = conn->server;
     conn->client = inout;
 
-    conn->remote_addr = *remaddr;
-    conn->remote_ip = ap_pstrdup(conn->pool,
-			      inet_ntoa(conn->remote_addr.sin_addr));
+#ifndef SIN6_LEN
+    addr_len = SA_LEN(remaddr);
+#else
+    addr_len = remaddr->sa_len;
+#endif
+    memcpy(&conn->remote_addr, remaddr, addr_len);
+    getnameinfo((struct sockaddr *)&conn->remote_addr, addr_len,
+	hostnamebuf, sizeof(hostnamebuf), NULL, 0, NI_NUMERICHOST);
+    conn->remote_ip = ap_pstrdup(conn->pool, hostnamebuf);
+
 #ifdef EAPI
     conn->ctx = ap_ctx_new(conn->pool);
 #endif /* EAPI */
@@@@ -3685,21 +3716,47 @@@@
 #define sock_disable_nagle(s)	/* NOOP */
 #endif
 
-static int make_sock(pool *p, const struct sockaddr_in *server)
+static int make_sock(pool *p, const struct sockaddr *server)
 {
     int s;
     int one = 1;
-    char addr[512];
+    char addr[INET6_ADDRSTRLEN + 128];
+    char a0[INET6_ADDRSTRLEN];
+    char p0[NI_MAXSERV];
+#ifdef MPE
+    int privport = 0;
+#endif
 
-    if (server->sin_addr.s_addr != htonl(INADDR_ANY))
-	ap_snprintf(addr, sizeof(addr), "address %s port %d",
-		inet_ntoa(server->sin_addr), ntohs(server->sin_port));
-    else
-	ap_snprintf(addr, sizeof(addr), "port %d", ntohs(server->sin_port));
+    switch(server->sa_family){
+    case AF_INET:
+#ifdef INET6
+    case AF_INET6:
+#endif
+      break;
+    default:
+      ap_log_error(APLOG_MARK, APLOG_CRIT, server_conf,
+                   "make_sock: unsupported address family %u",
+		   server->sa_family);
+      ap_unblock_alarms();
+      exit(1);
+    }
+
+    getnameinfo(server,
+#ifndef SIN6_LEN
+		SA_LEN(server),
+#else
+		server->sa_len,
+#endif
+		a0, sizeof(a0), p0, sizeof(p0), NI_NUMERICHOST | NI_NUMERICSERV);
+    ap_snprintf(addr, sizeof(addr), "address %s port %s", a0, p0);
+#ifdef MPE
+    if (atoi(p0) < 1024)
+      privport++;
+#endif
 
     /* note that because we're about to slack we don't use psocket */
     ap_block_alarms();
-    if ((s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)) == -1) {
+    if ((s = socket(server->sa_family, SOCK_STREAM, IPPROTO_TCP)) == -1) {
 	    ap_log_error(APLOG_MARK, APLOG_CRIT, server_conf,
 		    "make_sock: failed to get a socket for %s", addr);
 
@@@@ -3802,15 +3859,19 @@@@
 
 #ifdef MPE
 /* MPE requires CAP=PM and GETPRIVMODE to bind to ports less than 1024 */
-    if (ntohs(server->sin_port) < 1024)
+    if (privport)
 	GETPRIVMODE();
 #endif
-
-    if (bind(s, (struct sockaddr *) server, sizeof(struct sockaddr_in)) == -1) {
+#ifndef SIN6_LEN
+    if (bind(s, server, SA_LEN(server)) == -1)
+#else
+    if (bind(s, server, server->sa_len) == -1)
+#endif
+    {
 	ap_log_error(APLOG_MARK, APLOG_CRIT, server_conf,
 	    "make_sock: could not bind to %s", addr);
 #ifdef MPE
-	if (ntohs(server->sin_port) < 1024)
+	if (privport)
 	    GETUSERMODE();
 #endif
 
@@@@ -3823,7 +3884,7 @@@@
 	exit(1);
     }
 #ifdef MPE
-    if (ntohs(server->sin_port) < 1024)
+    if (privport)
 	GETUSERMODE();
 #endif
 
@@@@ -3976,15 +4037,17 @@@@
     for (;;) {
 	fd = find_listener(lr);
 	if (fd < 0) {
-	    fd = make_sock(p, &lr->local_addr);
+	    fd = make_sock(p, (struct sockaddr *)&lr->local_addr);
 	}
 	else {
 	    ap_note_cleanups_for_socket(p, fd);
 	}
 	/* if we get here, (fd >= 0) && (fd < FD_SETSIZE) */
-	FD_SET(fd, &listenfds);
-	if (fd > listenmaxfd)
-	    listenmaxfd = fd;
+	if (fd >= 0) {
+	    FD_SET(fd, &listenfds);
+	    if (fd > listenmaxfd)
+		listenmaxfd = fd;
+	}
 	lr->fd = fd;
 	if (lr->next == NULL)
 	    break;
@@@@ -4300,8 +4363,8 @@@@
 static void child_main(int child_num_arg)
 {
     NET_SIZE_T clen;
-    struct sockaddr sa_server;
-    struct sockaddr sa_client;
+    struct sockaddr_storage sa_server;
+    struct sockaddr_storage sa_client;
     listen_rec *lr;
 
     /* All of initialization is a critical section, we don't care if we're
@@@@ -4477,7 +4540,7 @@@@
 	    usr1_just_die = 0;
 	    for (;;) {
 		clen = sizeof(sa_client);
-		csd = ap_accept(sd, &sa_client, &clen);
+		csd = ap_accept(sd, (struct sockaddr *)&sa_client, &clen);
 		if (csd >= 0 || errno != EINTR)
 		    break;
 		if (deferred_die) {
@@@@ -4640,7 +4703,7 @@@@
 	 */
 
 	clen = sizeof(sa_server);
-	if (getsockname(csd, &sa_server, &clen) < 0) {
+	if (getsockname(csd, (struct sockaddr *)&sa_server, &clen) < 0) {
 	    ap_log_error(APLOG_MARK, APLOG_ERR, server_conf, "getsockname");
 	    continue;
 	}
@@@@ -4685,8 +4748,8 @@@@
 	ap_bpushfd(conn_io, csd, dupped_csd);
 
 	current_conn = new_connection(ptrans, server_conf, conn_io,
-				          (struct sockaddr_in *) &sa_client,
-				          (struct sockaddr_in *) &sa_server,
+				          (struct sockaddr *)&sa_client,
+				          (struct sockaddr *)&sa_server,
 				          my_child_num);
 
 	/*
@@@@ -4841,12 +4904,13 @@@@
 
 #ifdef _OSD_POSIX
     /* BS2000 requires a "special" version of fork() before a setuid() call */
-    if ((pid = os_fork(ap_user_name)) == -1) {
+    if ((pid = os_fork(ap_user_name)) == -1)
 #elif defined(TPF)
-    if ((pid = os_fork(s, slot)) == -1) {
+    if ((pid = os_fork(s, slot)) == -1)
 #else
-    if ((pid = fork()) == -1) {
+    if ((pid = fork()) == -1)
 #endif
+    {
 	ap_log_error(APLOG_MARK, APLOG_ERR, s, "fork: Unable to fork new process");
 
 	/* fork didn't succeed. Fix the scoreboard or else
@@@@ -5509,7 +5573,10 @@@@
     ap_setup_prelinked_modules();
 
     while ((c = getopt(argc, argv,
-				    "D:C:c:xXd:Ff:vVlLR:StThu"
+				    "D:C:c:xXd:Ff:vVlLR:StTh4u"
+#ifdef INET6
+				    "6"
+#endif
 #ifdef DEBUG_SIGSTOP
 				    "Z:"
 #endif
@@@@ -5587,8 +5654,14 @@@@
 	    ap_configtestonly = 1;
 	    ap_docrootcheck = 0;
 	    break;
-	case 'h':
-	    usage(argv[0]);
+	case '4':
+	    ap_default_family = PF_INET;
+	    break;
+#ifdef INET6
+	case '6':
+	    ap_default_family = PF_INET6;
+	    break;
+#endif
 	case 'u':
 	    ap_server_chroot = 0;
 	    break;
@@@@ -5680,9 +5753,10 @@@@
     else {
 	conn_rec *conn;
 	request_rec *r;
-	struct sockaddr sa_server, sa_client;
 	BUFF *cio;
+	struct sockaddr_storage sa_server, sa_client;
 	NET_SIZE_T l;
+	char servbuf[NI_MAXSERV];
 
 	ap_set_version();
 	/* Yes this is called twice. */
@@@@ -5737,25 +5811,32 @@@@
 #endif
 
 	l = sizeof(sa_client);
-	if ((getpeername(sock_in, &sa_client, &l)) < 0) {
+	if ((getpeername(sock_in, (struct sockaddr *)&sa_client, &l)) < 0) {
 /* get peername will fail if the input isn't a socket */
 	    perror("getpeername");
 	    memset(&sa_client, '\0', sizeof(sa_client));
 	}
 
 	l = sizeof(sa_server);
-	if (getsockname(sock_in, &sa_server, &l) < 0) {
+	if (getsockname(sock_in, (struct sockaddr *)&sa_server, &l) < 0) {
 	    perror("getsockname");
 	    fprintf(stderr, "Error getting local address\n");
 	    exit(1);
 	}
-	server_conf->port = ntohs(((struct sockaddr_in *) &sa_server)->sin_port);
+	if (getnameinfo(((struct sockaddr *)&sa_server), l,
+			NULL, 0, servbuf, sizeof(servbuf),
+			NI_NUMERICSERV)){
+	    fprintf(stderr, "getnameinfo(): family=%d\n", sa_server.ss_family);
+	    exit(1);
+	}
+	servbuf[sizeof(servbuf)-1] = '\0';
+	server_conf->port = atoi(servbuf);
 	cio = ap_bcreate(ptrans, B_RDWR | B_SOCKET);
         cio->fd = sock_out;
         cio->fd_in = sock_in;
 	conn = new_connection(ptrans, server_conf, cio,
-			          (struct sockaddr_in *) &sa_client,
-			          (struct sockaddr_in *) &sa_server, -1);
+			          (struct sockaddr *)&sa_client,
+			          (struct sockaddr *)&sa_server, -1);
 
 	while ((r = ap_read_request(conn)) != NULL) {
 
@@@@ -7990,7 +8071,11 @@@@
      * but only handle the -L option 
      */
     llp_dir = SHARED_CORE_DIR;
-    while ((c = getopt(argc, argv, "D:C:c:Xd:Ff:vVlLR:SZ:tTh")) != -1) {
+    while ((c = getopt(argc, argv, "D:C:c:Xd:Ff:vVlLR:SZ:tTh4"
+#ifdef INET6
+		"6"
+#endif
+		)) != -1) {
 	switch (c) {
 	case 'D':
 	case 'C':
@@@@ -8008,6 +8093,10 @@@@
 	case 't':
 	case 'T':
 	case 'h':
+	case '4':
+#ifdef INET6
+	case '6':
+#endif
 	case '?':
 	    break;
 	case 'R':
Index: src/usr.sbin/httpd/src/main/http_vhost.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/http_vhost.c,v
retrieving revision 1.6
diff -u -r1.6 http_vhost.c
--- src/usr.sbin/httpd/src/main/http_vhost.c	29 Mar 2002 02:07:44 -0000	1.6
+++ src/usr.sbin/httpd/src/main/http_vhost.c	22 Mar 2003 14:37:32 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -68,6 +69,7 @@@@
 #include "http_log.h"
 #include "http_vhost.h"
 #include "http_protocol.h"
+#include "sa_len.h"
 
 /*
  * After all the definitions there's an explanation of how it's all put
@@@@ -165,78 +167,114 @@@@
  * *paddr is the variable used to keep track of **paddr between calls
  * port is the default port to assume
  */
-static const char *get_addresses(pool *p, char *w, server_addr_rec ***paddr,
-			    unsigned port)
+static const char *get_addresses(pool *p, char *w, char *pstr,
+	server_addr_rec ***paddr, unsigned port)
 {
-    struct hostent *hep;
-    unsigned long my_addr;
+    struct addrinfo hints, *res, *res0;
     server_addr_rec *sar;
-    char *t;
-    int i, is_an_ip_addr;
+    char *t = NULL, *u = NULL, *v = NULL;
+    char *hoststr = NULL, *portstr = NULL;
+    char portpool[10];
+    int error;
+    char servbuf[NI_MAXSERV];
 
-    if (*w == 0)
+    if (w == 0 || *w == 0)
 	return NULL;
 
-    t = strchr(w, ':');
-    if (t) {
-	if (strcmp(t + 1, "*") == 0) {
-	    port = 0;
+    portstr = portpool;
+    ap_snprintf(portpool, sizeof(portpool), "%u", port);
+    if (!pstr) {
+	v = w;
+	u = NULL;
+	if (*w == '['){
+	    u = strrchr(w, ']');
+	    if (u) {	/* [host]:port or [host] */
+		w++;
+		*u = '\0';
+		v = u + 1;
+	    }
 	}
-	else if ((i = atoi(t + 1))) {
-	    port = i;
+	/*        w   uv     ,       w=v        , w=v  */
+	/* u!=0: [host]:port , u==0: [host:port , host */
+	t = strchr(v, ':');
+	if (t != NULL && strchr(t+1, ':') == NULL) {
+	    /* [host]:port-w/o-colons, host-without-colons:port-w/o-colons */
+	    *t = '\0';
+	    portstr = t + 1;
 	}
 	else {
-	    return ":port must be numeric";
+	    portstr = "0";
 	}
-	*t = 0;
+    } else {
+	portstr = pstr;
     }
 
-    is_an_ip_addr = 0;
-    if (strcmp(w, "*") == 0) {
-	my_addr = htonl(INADDR_ANY);
-	is_an_ip_addr = 1;
-    }
-    else if (strcasecmp(w, "_default_") == 0
-	     || strcmp(w, "255.255.255.255") == 0) {
-	my_addr = DEFAULT_VHOST_ADDR;
-	is_an_ip_addr = 1;
-    }
-    else if ((my_addr = ap_inet_addr(w)) != INADDR_NONE) {
-	is_an_ip_addr = 1;
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_socktype = SOCK_STREAM;
+    if (strcmp(w, "*") == 0 || strlen(w) == 0) {
+	hoststr = NULL;
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_flags = AI_PASSIVE;
+    }
+    else if (strcasecmp(w, "_default4_") == 0 ||
+	     ((ap_default_family == PF_INET
+#ifndef INET6
+	       || ap_default_family == PF_UNSPEC
+#endif
+	       ) && strcasecmp(w, "_default_") == 0)){
+	hoststr = "255.255.255.255";
+	hints.ai_family = PF_INET;
+    }
+#ifdef INET6
+    else if (strcasecmp(w, "_default6_") == 0 ||
+	     ((ap_default_family == PF_INET6
+	       || ap_default_family == PF_UNSPEC
+	       ) && strcasecmp(w, "_default_") == 0)){
+	hoststr = "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff";
+	hints.ai_family = PF_INET6;
     }
-    if (is_an_ip_addr) {
-	sar = ap_pcalloc(p, sizeof(server_addr_rec));
-	**paddr = sar;
-	*paddr = &sar->next;
-	sar->host_addr.s_addr = my_addr;
-	sar->host_port = port;
-	sar->virthost = ap_pstrdup(p, w);
-	if (t != NULL)
-	    *t = ':';
-	return NULL;
+#endif
+    else{
+	hoststr = w;
+	hints.ai_family = PF_UNSPEC;
     }
 
-    hep = gethostbyname(w);
-
-    if ((!hep) || (hep->h_addrtype != AF_INET || !hep->h_addr_list[0])) {
+    error = getaddrinfo(hoststr, portstr, &hints, &res0);
+    if (error || !res0) {
 	ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, NULL,
-	    "Cannot resolve host name %s --- ignoring!", w);
-	if (t != NULL)
-	    *t = ':';
+	    "Cannot resolve host %s port %s --- ignoring!", hoststr, portstr);
+	if (t != NULL) *t = ':';
+	if (u != NULL) *u = ']';
 	return NULL;
     }
-
-    for (i = 0; hep->h_addr_list[i]; ++i) {
+    for (res=res0; res; res=res->ai_next) {
+	switch (res->ai_addr->sa_family) {
+	case AF_INET:
+#ifdef INET6
+	case AF_INET6:
+#endif
+	    break;
+	default:
+	    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, NULL,
+			 "Unsupported address family %u, for host %s port %s --- ignoring!",
+			 res->ai_addr->sa_family, hoststr, portstr);
+	    continue;
+	}
 	sar = ap_pcalloc(p, sizeof(server_addr_rec));
 	**paddr = sar;
 	*paddr = &sar->next;
-	sar->host_addr = *(struct in_addr *) hep->h_addr_list[i];
-	sar->host_port = port;
+	memcpy(&sar->host_addr, res->ai_addr, res->ai_addrlen);
+	if (getnameinfo(res->ai_addr, res->ai_addrlen, NULL, 0, servbuf,
+			sizeof(servbuf), NI_NUMERICSERV) == 0)
+		sar->host_port = atoi(servbuf);
+	else
+		sar->host_port = 0;
 	sar->virthost = ap_pstrdup(p, w);
     }
 
-    if (t != NULL)
-	*t = ':';
+    freeaddrinfo(res0);
+    if (t != NULL) *t = ':';
+    if (u != NULL) *u = ']';
     return NULL;
 }
 
@@@@ -250,7 +288,8 @@@@
     /* start the list of addreses */
     addrs = &s->addrs;
     while (hostname[0]) {
-	err = get_addresses(p, ap_getword_conf(p, &hostname), &addrs, s->port);
+	err = get_addresses(p, ap_getword_conf(p, &hostname), NULL,
+		&addrs, s->port);
 	if (err) {
 	    *addrs = NULL;
 	    return err;
@@@@ -268,10 +307,11 @@@@
 }
 
 
-API_EXPORT_NONSTD(const char *) ap_set_name_virtual_host (cmd_parms *cmd, void *dummy, char *arg)
+API_EXPORT_NONSTD(const char *) ap_set_name_virtual_host (cmd_parms *cmd, void *dummy, char *h,
+	char *p)
 {
     /* use whatever port the main server has at this point */
-    return get_addresses(cmd->pool, arg, &name_vhost_list_tail,
+    return get_addresses(cmd->pool, h, p, &name_vhost_list_tail,
 			    cmd->server->port);
 }
 
@@@@ -345,6 +385,19 @@@@
     return ((key >> 8) ^ key) % IPHASH_TABLE_SIZE;
 }
 
+static unsigned hash_addr(struct sockaddr *sa)
+{
+    switch (sa->sa_family) {
+    case AF_INET:
+	return hash_inaddr(((struct sockaddr_in *)sa)->sin_addr.s_addr);
+#ifdef INET6
+    case AF_INET6:
+	return hash_inaddr(((struct sockaddr_in6 *)sa)->sin6_addr.s6_addr[12]);
+#endif
+    default:
+	return hash_inaddr(sa->sa_family);
+    }
+}
 
 
 static ipaddr_chain *new_ipaddr_chain(pool *p,
@@@@ -372,25 +425,77 @@@@
     return new;
 }
 
-
-static ap_inline ipaddr_chain *find_ipaddr(struct in_addr *server_ip,
-    unsigned port)
+static ap_inline ipaddr_chain *find_ipaddr(struct sockaddr *sa)
 {
     unsigned bucket;
     ipaddr_chain *trav;
-    unsigned addr;
+    char a[NI_MAXHOST], b[NI_MAXHOST];
 
     /* scan the hash table for an exact match first */
-    addr = server_ip->s_addr;
-    bucket = hash_inaddr(addr);
+    bucket = hash_addr(sa);
     for (trav = iphash_table[bucket]; trav; trav = trav->next) {
 	server_addr_rec *sar = trav->sar;
-	if ((sar->host_addr.s_addr == addr)
-	    && (sar->host_port == 0 || sar->host_port == port
-		|| port == 0)) {
-	    return trav;
+	if (sar->host_addr.ss_family != sa->sa_family)
+	    continue;
+	switch (sa->sa_family) {
+	case AF_INET:
+	  {
+	    struct sockaddr_in *sin1, *sin2;
+	    sin1 = (struct sockaddr_in *)&sar->host_addr;
+	    sin2 = (struct sockaddr_in *)sa;
+	    if (sin1->sin_port == 0 || sin2->sin_port == 0
+	     || sin1->sin_port == sin2->sin_port) {
+		if (memcmp(&sin1->sin_addr, &sin2->sin_addr,
+			sizeof(sin1->sin_addr)) == 0) {
+		    return trav;
+		}
+	    }
+	    break;
+	  }
+#ifdef INET6
+	case AF_INET6:
+	  {
+	    struct sockaddr_in6 *sin1, *sin2;
+	    sin1 = (struct sockaddr_in6 *)&sar->host_addr;
+	    sin2 = (struct sockaddr_in6 *)sa;
+	    if (sin1->sin6_port == 0 || sin2->sin6_port == 0
+	     || sin1->sin6_port == sin2->sin6_port) {
+		if (memcmp(&sin1->sin6_addr, &sin2->sin6_addr,
+			sizeof(sin1->sin6_addr)) == 0) {
+		    return trav;
+		}
+	    }
+	    break;
+	  }
+#endif
+	default: /*unsupported*/
+	    break;
 	}
     }
+
+#ifdef INET6
+    if (sa->sa_family == AF_INET6 &&
+	IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)sa)->sin6_addr)) {
+	/*
+	 * This is just horrible.  I just hate IPv4 mapped address.  It
+	 * complicates access control too much.
+	 * Due to hashed lookup, we need to visit it again.
+	 */
+	struct sockaddr_in sin;
+
+	memset(&sin, 0, sizeof(sin));
+	sin.sin_family = AF_INET;
+#ifdef SIN6_LEN
+	sin.sin_len = sizeof(sin);
+#endif
+	sin.sin_port = ((struct sockaddr_in6 *)sa)->sin6_port;
+	memcpy(&sin.sin_addr,
+	    &((struct sockaddr_in6 *)sa)->sin6_addr.s6_addr[12],
+	    sizeof(sin.sin_addr));
+	return find_ipaddr((struct sockaddr *)&sin);
+    }
+#endif
+
     return NULL;
 }
 
@@@@ -416,21 +521,7 @@@@
     int len;
     char buf[MAX_STRING_LEN];
 
-    if (ic->sar->host_addr.s_addr == DEFAULT_VHOST_ADDR) {
-	len = ap_snprintf(buf, sizeof(buf), "_default_:%u",
-		ic->sar->host_port);
-    }
-    else if (ic->sar->host_addr.s_addr == INADDR_ANY) {
-	len = ap_snprintf(buf, sizeof(buf), "*:%u",
-		ic->sar->host_port);
-    }
-    else {
-	len = ap_snprintf(buf, sizeof(buf), "%pA:%u",
-		&ic->sar->host_addr, ic->sar->host_port);
-    }
-    if (ic->sar->host_port == 0) {
-	buf[len-1] = '*';
-    }
+    len = ap_snprintf(buf, sizeof(buf), "%pI", &ic->sar->host_addr);
     if (ic->names == NULL) {
 	if (ic->server == NULL)
 	    fprintf(f, "%-22s WARNING: No <VirtualHost> defined for this NameVirtualHost!\n", buf);
@@@@ -558,10 +649,37 @@@@
      * occured in the config file, we'll copy it in that order.
      */
     for (sar = name_vhost_list; sar; sar = sar->next) {
-	unsigned bucket = hash_inaddr(sar->host_addr.s_addr);
+	unsigned bucket = hash_addr((struct sockaddr *)&sar->host_addr);
 	ipaddr_chain *ic = new_ipaddr_chain(p, NULL, sar);
+	int wildcard;
 
-	if (sar->host_addr.s_addr != INADDR_ANY) {
+	wildcard = 0;
+	switch (sar->host_addr.ss_family) {
+	case AF_INET:
+	  {
+	    struct sockaddr_in *sin;
+	    sin = (struct sockaddr_in *)&sar->host_addr;
+	    if (sin->sin_addr.s_addr == INADDR_ANY)
+		wildcard++;
+	    break;
+	  }
+#ifdef INET6
+	case AF_INET6:
+	  {
+	    struct sockaddr_in6 *sin6;
+	    sin6 = (struct sockaddr_in6 *)&sar->host_addr;
+	    if (*(u_int32_t *)&sin6->sin6_addr.s6_addr[0] == 0
+	     && *(u_int32_t *)&sin6->sin6_addr.s6_addr[4] == 0
+	     && *(u_int32_t *)&sin6->sin6_addr.s6_addr[8] == 0
+	     && *(u_int32_t *)&sin6->sin6_addr.s6_addr[12] == 0) {
+		wildcard++;
+	    }
+	    break;
+	  }
+#endif
+	}
+
+	if (!wildcard) {
 	    *iphash_table_tail[bucket] = ic;
 	    iphash_table_tail[bucket] = &ic->next;
 	}
@@@@ -588,12 +706,45 @@@@
 	has_default_vhost_addr = 0;
 	for (sar = s->addrs; sar; sar = sar->next) {
 	    ipaddr_chain *ic;
+	    int wildcard;
 
-	    if (sar->host_addr.s_addr == DEFAULT_VHOST_ADDR
-		|| sar->host_addr.s_addr == INADDR_ANY) {
-		ic = find_default_server(sar->host_port);
-		if (!ic || !add_name_vhost_config(p, main_s, s, sar, ic)) {
-		    if (ic && ic->sar->host_port != 0) {
+	    wildcard = 0;
+	    switch (sar->host_addr.ss_family) {
+	    case AF_INET:
+	      {
+		struct sockaddr_in *sin;
+		sin = (struct sockaddr_in *)&sar->host_addr;
+		if (sin->sin_addr.s_addr == DEFAULT_VHOST_ADDR)
+		    wildcard++;
+		else if (sin->sin_addr.s_addr == INADDR_ANY)
+		    wildcard++;
+		break;
+	      }
+#ifdef INET6
+	    case AF_INET6:
+	      {
+		struct sockaddr_in6 *sin6;
+		sin6 = (struct sockaddr_in6 *)&sar->host_addr;
+		if (*(u_int32_t *)&sin6->sin6_addr.s6_addr[0] == ~0
+		 && *(u_int32_t *)&sin6->sin6_addr.s6_addr[4] == ~0
+		 && *(u_int32_t *)&sin6->sin6_addr.s6_addr[8] == ~0
+		 && *(u_int32_t *)&sin6->sin6_addr.s6_addr[12] == ~0) {
+		    wildcard++;
+		}
+		break;
+	      }
+#endif
+	    }
+
+	    if (wildcard) {
+		/* add it to default bucket for each appropriate sar
+		 * since we need to do a port test
+		 */
+		ipaddr_chain *other;
+
+		other = find_default_server(sar->host_port);
+		if (!other || !add_name_vhost_config(p, main_s, s, sar, other)) {
+		    if (other && other->sar->host_port != 0) {
 			ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING,
 			    main_s, "_default_ VirtualHost overlap on port %u,"
 			    " the first has precedence", sar->host_port);
@@@@ -606,10 +757,11 @@@@
 	    }
 	    else {
 		/* see if it matches something we've already got */
-		ic = find_ipaddr(&sar->host_addr, sar->host_port);
+		ic = find_ipaddr((struct sockaddr *)&sar->host_addr);
 
 		if (!ic) {
-		    unsigned bucket = hash_inaddr(sar->host_addr.s_addr);
+		    unsigned bucket =
+		        hash_addr((struct sockaddr *)&sar->host_addr);
 
 		    ic = new_ipaddr_chain(p, s, sar);
 		    ic->next = *iphash_table_tail[bucket];
@@@@ -646,19 +798,33 @@@@
 	    }
 	    else {
 		struct hostent *h;
+		char hostnamebuf[MAXHOSTNAMELEN];
 
-		if ((h = gethostbyaddr((char *) &(s->addrs->host_addr),
-					sizeof(struct in_addr), AF_INET))) {
-		    s->server_hostname = ap_pstrdup(p, (char *) h->h_name);
+		if (!getnameinfo((struct sockaddr *)&s->addrs->host_addr,
+#ifndef SIN6_LEN
+			SA_LEN((struct sockaddr *)&s->addrs->host_addr),
+#else
+			s->addrs->host_addr.ss_len,
+#endif
+			hostnamebuf, sizeof(hostnamebuf),
+			NULL, 0, 0)) {
+		    s->server_hostname = ap_pstrdup(p, hostnamebuf);
 		}
 		else {
 		    /* again, what can we do?  They didn't specify a
 		       ServerName, and their DNS isn't working. -djg */
+		    getnameinfo((struct sockaddr *)&s->addrs->host_addr,
+#ifndef SIN6_LEN
+			SA_LEN((struct sockaddr *)&s->addrs->host_addr),
+#else
+			s->addrs->host_addr.ss_len,
+#endif
+			hostnamebuf, sizeof(hostnamebuf),
+			NULL, 0, NI_NUMERICHOST);
 		    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, main_s,
 			    "Failed to resolve server name "
 			    "for %s (check DNS) -- or specify an explicit "
-			    "ServerName",
-			    inet_ntoa(s->addrs->host_addr));
+			    "ServerName", hostnamebuf);
 		    s->server_hostname =
 			ap_pstrdup(p, "bogus_host_without_reverse_dns");
 		}
@@@@ -705,35 +871,58 @@@@
     char *host = ap_palloc(r->pool, strlen(r->hostname) + 1);
     const char *src;
     char *dst;
+    const char *u = NULL, *v = NULL;
 
     /* check and copy the host part */
-    src = r->hostname;
+    u = src = r->hostname;
 
     dst = host;
-    while (*src) {
-	if (*src == '.') {
-	    *dst++ = *src++;
-	    if (*src == '.')
-		goto bad;
-	    else
-		continue;
-	}
-	if (*src == '/' || *src == '\\') {
-	    goto bad;
+    if (*u == '[') { /* IPv6 numeral address in brackets */
+        v = strchr(u, ']');
+	if (v == NULL) {
+	    /* missing closing bracket */
+            goto bad;
+	}
+        if (v == (u + 1)) {
+            /* bad empty address */
+            goto bad;
+	}
+	for (src = u+1; src < v; src++)  /* copy IPv6 adress */
+	    *dst = *src;
+	v++;
+	if (*v == ':') {
+	   v++;
+	   while (*v) {  /* check if portnum is correct */
+	       if (!ap_isdigit(*v++))
+		   goto bad;
+	   }
 	}
-        if (*src == ':') {
-            /* check the port part */
-            while (*++src) {
-                if (!ap_isdigit(*src)) {
-                    goto bad;
-                }
-            }
-            if (src[-1] == ':')
-                goto bad;
-            else
-                break;
+    } else {
+        while (*src) {
+	    if (*src == '.') {
+		*dst++ = *src++;
+		if (*src == '.')
+		    goto bad;
+		else
+		    continue;
+	    }
+	    if (*src == '/' || *src == '\\') {
+		goto bad;
+	    }
+	    if (*src == ':') {
+		/* sheck the port part */
+		while (*++src) {
+		    if (!ap_isdigit(*src)) {
+			goto bad;
+		    }
+		}
+		if (src[-1] == ':')
+		    goto bad;
+		else
+		    break;
+	    }
+	    *dst++ = *src++;
         }
-	*dst++ = *src++;
     }
     /* strip trailing gubbins */
     if (dst > host && dst[-1] == '.') {
@@@@ -748,7 +937,7 @@@@
 bad:
     r->status = HTTP_BAD_REQUEST;
     ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, r,
-		  "Client sent malformed Host header");
+		  "Client sent malformed Host header <<%s>>",u);
     return;
 }
 
@@@@ -851,11 +1040,25 @@@@
      *   names we'll match have ports associated with them
      */
     const char *host = r->hostname;
-    unsigned port = ntohs(r->connection->local_addr.sin_port);
+    unsigned port;
     server_rec *s;
     server_rec *last_s;
     name_chain *src;
 
+    switch (r->connection->local_addr.ss_family) {
+    case AF_INET:
+    	port = ntohs(((struct sockaddr_in *)
+		    &r->connection->local_addr)->sin_port);
+	break;
+#ifdef INET6
+    case AF_INET6:
+    	port = ntohs(((struct sockaddr_in6 *)
+		    &r->connection->local_addr)->sin6_port);
+	break;
+#endif
+    default:
+	port = 0;	/*XXX*/
+    }
     last_s = NULL;
 
     /* Recall that the name_chain is a list of server_addr_recs, some of
@@@@ -910,7 +1113,22 @@@@
     server_rec *s;
     server_rec *last_s;
     name_chain *src;
-    unsigned port = ntohs(r->connection->local_addr.sin_port);
+    unsigned port;
+
+    switch (r->connection->local_addr.ss_family) {
+    case AF_INET:
+    	port = ntohs(((struct sockaddr_in *)
+		    &r->connection->local_addr)->sin_port);
+	break;
+#ifdef INET6
+    case AF_INET6:
+    	port = ntohs(((struct sockaddr_in6 *)
+		    &r->connection->local_addr)->sin6_port);
+	break;
+#endif
+    default:
+	port = 0;	/*XXX*/
+    }
 
     /*
      * This is in conjunction with the ServerPath code in http_core, so we
@@@@ -970,10 +1188,22 @@@@
 API_EXPORT(void) ap_update_vhost_given_ip(conn_rec *conn)
 {
     ipaddr_chain *trav;
-    unsigned port = ntohs(conn->local_addr.sin_port);
+    char portbuf[NI_MAXSERV];
+    unsigned port;
+
+    if (getnameinfo((struct sockaddr *)&conn->local_addr,
+#ifndef SIN6_LEN
+	SA_LEN((struct sockaddr *)&conn->local_addr),
+#else
+	conn->local_addr.ss_len,
+#endif
+	NULL, 0, portbuf, sizeof(portbuf), NI_NUMERICSERV) != 0) {
+	goto fail;
+    }
+    port = atoi(portbuf);
 
     /* scan the hash table for an exact match first */
-    trav = find_ipaddr(&conn->local_addr.sin_addr, port);
+    trav = find_ipaddr((struct sockaddr *)&conn->local_addr);
     if (trav) {
 	/* save the name_chain for later in case this is a name-vhost */
 	conn->vhost_lookup_data = trav->names;
@@@@ -991,6 +1221,7 @@@@
 	return;
     }
 
+fail:
     /* otherwise we're stuck with just the main server
      * and no name-based vhosts
      */
Index: src/usr.sbin/httpd/src/main/rfc1413.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/rfc1413.c,v
retrieving revision 1.6
diff -u -r1.6 rfc1413.c
--- src/usr.sbin/httpd/src/main/rfc1413.c	29 Mar 2002 02:07:44 -0000	1.6
+++ src/usr.sbin/httpd/src/main/rfc1413.c	22 Mar 2003 15:04:30 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -82,6 +83,7 @@@@
 #include "http_log.h"		/* for aplog_error */
 #include "rfc1413.h"
 #include "http_main.h"		/* set_callback_and_alarm */
+#include "sa_len.h"
 
 /* Local stuff. */
 /* Semi-well-known port */
@@@@ -109,12 +111,13 @@@@
 
 /* bind_connect - bind both ends of a socket */
 /* Ambarish fix this. Very broken */
-static int get_rfc1413(int sock, const struct sockaddr_in *our_sin,
-		       const struct sockaddr_in *rmt_sin, 
+static int get_rfc1413(int sock, const struct sockaddr *our_sin,
+		       const struct sockaddr *rmt_sin,
 		       char user[RFC1413_USERLEN+1], server_rec *srv)
 {
-    struct sockaddr_in rmt_query_sin, our_query_sin;
-    unsigned int rmt_port, our_port;
+    struct sockaddr_storage rmt_query_sin, our_query_sin;
+    unsigned int o_rmt_port, o_our_port;	/* original port pair */
+    unsigned int rmt_port, our_port;		/* replied port pair */
     int i;
     char *cp;
     char buffer[RFC1413_MAXDATA + 1];
@@@@ -129,16 +132,47 @@@@
      * addresses from the query socket.
      */
 
-    our_query_sin = *our_sin;
-    our_query_sin.sin_port = htons(ANY_PORT);
-#ifdef MPE 
-    our_query_sin.sin_addr.s_addr = INADDR_ANY;
+#ifndef SIN6_LEN
+    memcpy(&our_query_sin, our_sin, SA_LEN(our_sin));
+    memcpy(&rmt_query_sin, rmt_sin, SA_LEN(rmt_sin));
+#else
+    memcpy(&our_query_sin, our_sin, our_sin->sa_len);
+    memcpy(&rmt_query_sin, rmt_sin, rmt_sin->sa_len);
 #endif
-    rmt_query_sin = *rmt_sin;
-    rmt_query_sin.sin_port = htons(RFC1413_PORT);
+    switch (our_sin->sa_family) {
+    case AF_INET:
+#ifdef MPE
+      ((struct sockaddr_in *)&our_query_sin)->sin_addr.s_addr = INADDR_ANY; /* XXX: htonl(??) */
+#endif
+      ((struct sockaddr_in *)&our_query_sin)->sin_port = htons(ANY_PORT);
+      o_our_port = ntohs(((struct sockaddr_in *)our_sin)->sin_port);
+      ((struct sockaddr_in *)&rmt_query_sin)->sin_port = htons(RFC1413_PORT);
+      o_rmt_port = ntohs(((struct sockaddr_in *)rmt_sin)->sin_port);
+      break;
+#ifdef INET6
+    case AF_INET6:
+#ifdef MPE
+      memcpy(&((struct sockaddr_in6 *)&our_query_sin)->sin6_addr,
+	     &in6addr_any, sizeof(struct in6_addr));
+#endif
+      ((struct sockaddr_in6 *)&our_query_sin)->sin6_port = htons(ANY_PORT);
+      o_our_port = ntohs(((struct sockaddr_in6 *)our_sin)->sin6_port);
+      ((struct sockaddr_in6 *)&rmt_query_sin)->sin6_port = htons(RFC1413_PORT);
+      o_rmt_port = ntohs(((struct sockaddr_in6 *)rmt_sin)->sin6_port);
+      break;
+#endif
+    default:
+      /* unsupported AF */
+      return -1;
+    }
 
     if (bind(sock, (struct sockaddr *) &our_query_sin,
-	     sizeof(struct sockaddr_in)) < 0) {
+#ifndef SIN6_LEN
+	     SA_LEN((struct sockaddr *) &our_query_sin)
+#else
+	     our_query_sin.ss_len
+#endif
+	     ) < 0) {
 	ap_log_error(APLOG_MARK, APLOG_CRIT, srv,
 		    "bind: rfc1413: Error binding to local port");
 	return -1;
@@@@ -149,12 +183,18 @@@@
  * the service
  */
     if (connect(sock, (struct sockaddr *) &rmt_query_sin,
-		sizeof(struct sockaddr_in)) < 0)
-	            return -1;
+#ifndef SIN6_LEN
+		SA_LEN((struct sockaddr *) &rmt_query_sin)
+#else
+		rmt_query_sin.ss_len
+#endif
+		) < 0) {
+	return -1;
+    }
 
 /* send the data */
-    buflen = ap_snprintf(buffer, sizeof(buffer), "%u,%u\r\n", ntohs(rmt_sin->sin_port),
-		ntohs(our_sin->sin_port));
+    buflen = ap_snprintf(buffer, sizeof(buffer), "%u,%u\r\n", o_rmt_port,
+		o_our_port);
 
     /* send query to server. Handle short write. */
 #ifdef CHARSET_EBCDIC
@@@@ -219,9 +259,9 @@@@
     ascii2ebcdic(buffer, buffer, (size_t)i);
 #endif
     if (sscanf(buffer, "%u , %u : USERID :%*[^:]:%512s", &rmt_port, &our_port,
-	       user) != 3 || ntohs(rmt_sin->sin_port) != rmt_port
-	|| ntohs(our_sin->sin_port) != our_port)
+	       user) != 3 || o_rmt_port != rmt_port || o_our_port != our_port) {
 	return -1;
+    }
 
     /*
      * Strip trailing carriage return. It is part of the
@@@@ -243,7 +283,7 @@@@
 
     result = FROM_UNKNOWN;
 
-    sock = ap_psocket(conn->pool, AF_INET, SOCK_STREAM, IPPROTO_TCP);
+    sock = ap_psocket(conn->pool, conn->remote_addr.ss_family, SOCK_STREAM, IPPROTO_TCP);
     if (sock < 0) {
 	ap_log_error(APLOG_MARK, APLOG_CRIT, srv,
 		    "socket: rfc1413: error creating socket");
@@@@ -256,8 +296,10 @@@@
     if (ap_setjmp(timebuf) == 0) {
 	ap_set_callback_and_alarm(ident_timeout, ap_rfc1413_timeout);
 
-	if (get_rfc1413(sock, &conn->local_addr, &conn->remote_addr, user, srv) >= 0)
+	if (get_rfc1413(sock, (struct sockaddr *)&conn->local_addr,
+		(struct sockaddr *)&conn->remote_addr, user, srv) >= 0) {
 	    result = user;
+	}
     }
     ap_set_callback_and_alarm(NULL, 0);
     ap_pclosesocket(conn->pool, sock);
Index: src/usr.sbin/httpd/src/main/util.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/util.c,v
retrieving revision 1.13
diff -u -r1.13 util.c
--- src/usr.sbin/httpd/src/main/util.c	11 Dec 2002 12:22:35 -0000	1.13
+++ src/usr.sbin/httpd/src/main/util.c	22 Mar 2003 14:37:29 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -2017,52 +2018,87 @@@@
  * Parses a host of the form <address>[:port]
  * :port is permitted if 'port' is not NULL
  */
-API_EXPORT(unsigned long) ap_get_virthost_addr(char *w, unsigned short *ports)
+API_EXPORT(struct sockaddr *) ap_get_virthost_addr(char *w, unsigned short *ports)
 {
-    struct hostent *hep;
-    unsigned long my_addr;
-    char *p;
-
-    p = strchr(w, ':');
+    static struct sockaddr_storage ss;
+    struct addrinfo hints, *res;
+    char *p, *r;
+    char *host;
+    char *port = "0";
+    int error;
+    char servbuf[NI_MAXSERV];
+
+    if (w == NULL)
+	w = "*";
+    p = r = NULL;
+    if (*w == '['){
+	if (r = strrchr(w+1, ']')){
+	    *r = '\0';
+	    p = r + 1;
+	    switch(*p){
+	    case ':':
+	      p++;
+	      /* nobreak; */
+	    case '\0':
+	      w++;
+	      break;
+	    default:
+	      p = NULL;
+	    }
+	}
+    }
+    else{
+	p = strchr(w, ':');
+	if (p != NULL && strchr(p+1, ':') != NULL)
+	    p = NULL;
+    }
     if (ports != NULL) {
-	*ports = 0;
-	if (p != NULL && strcmp(p + 1, "*") != 0)
-	    *ports = atoi(p + 1);
+	if (p != NULL && *p && strcmp(p + 1, "*") != 0)
+	    port = p + 1;
     }
 
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_socktype = SOCK_STREAM;
     if (p != NULL)
 	*p = '\0';
     if (strcmp(w, "*") == 0) {
-	if (p != NULL)
-	    *p = ':';
-	return htonl(INADDR_ANY);
-    }
-
-    my_addr = ap_inet_addr((char *)w);
-    if (my_addr != INADDR_NONE) {
-	if (p != NULL)
-	    *p = ':';
-	return my_addr;
+	host = NULL;
+	hints.ai_flags = AI_PASSIVE;
+	hints.ai_family = ap_default_family;
+    } else {
+	host = w;
+	hints.ai_family = PF_UNSPEC;
     }
 
-    hep = gethostbyname(w);
+    error = getaddrinfo(host, port, &hints, &res);
 
-    if ((!hep) || (hep->h_addrtype != AF_INET || !hep->h_addr_list[0])) {
-	fprintf(stderr, "Cannot resolve host name %s --- exiting!\n", w);
+    if (error || !res) {
+	fprintf(stderr, "ap_get_vitrhost_addr(): getaddrinfo(%s):%s --- exiting!\n", w, gai_strerror(error));
 	exit(1);
     }
 
-    if (hep->h_addr_list[1]) {
-	fprintf(stderr, "Host %s has multiple addresses ---\n", w);
+    if (res->ai_next) {
+	fprintf(stderr, "ap_get_vitrhost_addr(): Host %s has multiple addresses ---\n", w);
 	fprintf(stderr, "you must choose one explicitly for use as\n");
 	fprintf(stderr, "a virtual host.  Exiting!!!\n");
 	exit(1);
     }
 
+    if (r != NULL)
+	*r = ']';
     if (p != NULL)
 	*p = ':';
 
-    return ((struct in_addr *) (hep->h_addr))->s_addr;
+    memcpy(&ss, res->ai_addr, res->ai_addrlen);
+    if (getnameinfo(res->ai_addr, res->ai_addrlen,
+		    NULL, 0, servbuf, sizeof(servbuf),
+		    NI_NUMERICSERV)){
+	fprintf(stderr, "ap_get_virthost_addr(): getnameinfo() failed --- Exiting!!!\n");
+	exit(1);
+    }
+    if (ports) *ports = atoi(servbuf);
+    freeaddrinfo(res);
+    return (struct sockaddr *)&ss;
 }
 
 
@@@@ -2090,7 +2126,8 @@@@
 #endif
     char str[MAXHOSTNAMELEN];
     char *server_hostname = NULL;
-    struct hostent *p;
+    struct addrinfo hints, *res;
+    int error;
 
 #ifdef BEOS /* BeOS returns zero as an error for gethostname */
     if (gethostname(str, sizeof(str) - 1) == 0) {
@@@@ -2103,23 +2140,22 @@@@
     }
     else 
     {
-        str[sizeof(str) - 1] = '\0';
-        if ((!(p = gethostbyname(str))) 
-            || (!(server_hostname = find_fqdn(a, p)))) {
-           if (p == NULL || p->h_addr_list == NULL)
-              server_hostname=NULL;
-           else {
-              /* Recovery - return the default servername by IP: */
-              if (p->h_addr_list[0]) {
-		      ap_snprintf(str, sizeof(str), "%pA", p->h_addr_list[0]);
-		      server_hostname = ap_pstrdup(a, str);
-                    /* We will drop through to report the IP-named server */
-	      }
-	   }
-        }
-	else
-            /* Since we found a fqdn, return it with no logged message. */
-            return server_hostname;
+	str[sizeof(str) - 1] = '\0';
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_flags = AI_CANONNAME;
+	res = NULL;
+	error = getaddrinfo(str, NULL, &hints, &res);
+	if (error == 0 && res) {
+	    /* Since we found a fdqn, return it with no logged message. */
+	    server_hostname = ap_pstrdup(a, res->ai_canonname);
+	    freeaddrinfo(res);
+	    return server_hostname;
+	} else {
+	    /* Recovery - return the default servername by IP: */
+	    server_hostname = ap_pstrdup(a, str);
+	    /* We will drop through to report the IP-named server */
+	}
     }
 
     /* If we don't have an fqdn or IP, fall back to the loopback addr */
@@@@ -2131,6 +2167,8 @@@@
                  "domain name, using %s for ServerName",
                  ap_server_argv0, server_hostname);
     
+    if (res)
+	freeaddrinfo(res);
     return server_hostname;
 }
 
@@@@ -2373,3 +2411,11 @@@@
     }
     *dest = 0;
 }
+
+#ifdef NEED_GETADDRINFO
+#include "getaddrinfo.c"
+#endif
+
+#ifdef NEED_GETNAMEINFO
+#include "getnameinfo.c"
+#endif
Index: src/usr.sbin/httpd/src/main/util_script.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/util_script.c,v
retrieving revision 1.10
diff -u -r1.10 util_script.c
--- src/usr.sbin/httpd/src/main/util_script.c	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/main/util_script.c	22 Mar 2003 15:04:26 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -67,6 +68,7 @@@@
 #include "http_request.h"	/* for sub_req_lookup_uri() */
 #include "util_script.h"
 #include "util_date.h"		/* For parseHTTPdate() */
+#include "sa_len.h"
 
 #ifdef OS2
 #define INCL_DOS
@@@@ -203,6 +205,7 @@@@
     array_header *hdrs_arr = ap_table_elts(r->headers_in);
     table_entry *hdrs = (table_entry *) hdrs_arr->elts;
     int i;
+    char servbuf[NI_MAXSERV];
 
     /* use a temporary table which we'll overlap onto
      * r->subprocess_env later
@@@@ -294,8 +297,16 @@@@
     ap_table_addn(e, "SERVER_ADMIN", s->server_admin);	/* Apache */
     ap_table_addn(e, "SCRIPT_FILENAME", r->filename);	/* Apache */
 
-    ap_table_addn(e, "REMOTE_PORT",
-		  ap_psprintf(r->pool, "%d", ntohs(c->remote_addr.sin_port)));
+    servbuf[0] = '\0';
+    if (!getnameinfo((struct sockaddr *)&c->remote_addr,
+#ifndef HAVE_SOCKADDR_LEN
+		     SA_LEN((struct sockaddr *)&c->remote_addr),
+#else
+		     c->remote_addr.ss_len,
+#endif
+		     NULL, 0, servbuf, sizeof(servbuf), NI_NUMERICSERV)){
+	ap_table_addn(e, "REMOTE_PORT", ap_pstrdup(r->pool, servbuf));
+    }
 
     if (c->user) {
 	ap_table_addn(e, "REMOTE_USER", c->user);
@@@@ -749,6 +760,14 @@@@
         if ((setrlimit(RLIMIT_CPU, conf->limit_cpu)) != 0) {
 	    ap_log_error(APLOG_MARK, APLOG_ERR, r->server,
 			 "setrlimit: failed to set CPU usage limit");
+	}
+    }
+#endif
+#ifdef RLIMIT_TIME
+    if (conf->limit_time != NULL) {
+        if ((setrlimit(RLIMIT_TIME, conf->limit_time)) != 0) {
+	    ap_log_error(APLOG_MARK, APLOG_ERR, r->server,
+			 "setrlimit: failed to set max real time limit");
 	}
     }
 #endif
Index: src/usr.sbin/httpd/src/main/util_uri.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/util_uri.c,v
retrieving revision 1.6
diff -u -r1.6 util_uri.c
--- src/usr.sbin/httpd/src/main/util_uri.c	19 Jul 2002 21:30:54 -0000	1.6
+++ src/usr.sbin/httpd/src/main/util_uri.c	22 Mar 2003 14:37:26 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -410,45 +411,50 @@@@
      * &hostinfo[-1] < &hostinfo[0] ... and this loop is valid C.
      */
     do {
-        --s;
+	--s;
     } while (s >= hostinfo && *s != '@@');
     if (s < hostinfo) {
-        /* again we want the common case to be fall through */
-      deal_with_host:
-        /* We expect hostinfo to point to the first character of
-         * the hostname.  If there's a port it is the first colon.
-         */
-        s = memchr(hostinfo, ':', uri - hostinfo);
-        if (s == NULL) {
-            /* we expect the common case to have no port */
-            uptr->hostname = ap_pstrndup(p, hostinfo, uri - hostinfo);
-            goto deal_with_path;
-        }
-        uptr->hostname = ap_pstrndup(p, hostinfo, s - hostinfo);
-        ++s;
-        uptr->port_str = ap_pstrndup(p, s, uri - s);
-        if (uri != s) {
-            port = ap_strtol(uptr->port_str, &endstr, 10);
-            uptr->port = port;
-            if (*endstr == '\0') {
-                goto deal_with_path;
-            }
-            /* Invalid characters after ':' found */
-            return HTTP_BAD_REQUEST;
-        }
-        uptr->port = ap_default_port_for_scheme(uptr->scheme);
-        goto deal_with_path;
+	/* again we want the common case to be fall through */
+deal_with_host:
+	/* We expect hostinfo to point to the first character of
+	 * the hostname.  If there's a port it is the first colon.
+	 */
+	if (*hostinfo == '[') {
+	    s = memchr(hostinfo+1, ']', uri - hostinfo - 1);
+	    if (s)
+		s = strchr(s, ':');
+	} else
+	    s = memchr(hostinfo, ':', uri - hostinfo);
+	if (s == NULL) {
+	    /* we expect the common case to have no port */
+	    uptr->hostname = ap_pstrndup(p, hostinfo, uri - hostinfo);
+	    goto deal_with_path;
+	}
+	uptr->hostname = ap_pstrndup(p, hostinfo, s - hostinfo);
+	++s;
+	uptr->port_str = ap_pstrndup(p, s, uri - s);
+	if (uri != s) {
+	    port = ap_strtol(uptr->port_str, &endstr, 10);
+	    uptr->port = port;
+	    if (*endstr == '\0') {
+		goto deal_with_path;
+	    }
+	    /* Invalid characters after ':' found */
+	    return HTTP_BAD_REQUEST;
+	}
+	uptr->port = ap_default_port_for_scheme(uptr->scheme);
+	goto deal_with_path;
     }
 
     /* first colon delimits username:password */
     s1 = memchr(hostinfo, ':', s - hostinfo);
     if (s1) {
-        uptr->user = ap_pstrndup(p, hostinfo, s1 - hostinfo);
-        ++s1;
-        uptr->password = ap_pstrndup(p, s1, s - s1);
+	uptr->user = ap_pstrndup(p, hostinfo, s1 - hostinfo);
+	++s1;
+	uptr->password = ap_pstrndup(p, s1, s - s1);
     }
     else {
-        uptr->user = ap_pstrndup(p, hostinfo, s - hostinfo);
+	uptr->user = ap_pstrndup(p, hostinfo, s - hostinfo);
     }
     hostinfo = s + 1;
     goto deal_with_host;
@@@@ -475,7 +481,12 @@@@
     /* We expect hostinfo to point to the first character of
      * the hostname.  There must be a port, separated by a colon
      */
-    s = strchr(hostinfo, ':');
+    if (*hostinfo == '[') {
+        s = strchr(hostinfo+1, ']');
+        if (s)
+            s = strchr(s, ':');
+    } else
+        s = strchr(hostinfo, ':');
     if (s == NULL) {
         return HTTP_BAD_REQUEST;
     }
Index: src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c,v
retrieving revision 1.11
diff -u -r1.11 mod_proxy.c
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	30 Jul 2002 10:51:26 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	22 Mar 2003 15:04:25 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -574,11 +575,31 @@@@
     struct proxy_remote *new;
     char *p, *q;
     int port;
+    char *bl = NULL, *br = NULL;
 
     p = strchr(r, ':');
     if (p == NULL || p[1] != '/' || p[2] != '/' || p[3] == '\0')
-        return "ProxyRemote: Bad syntax for a remote proxy server";
-    q = strchr(p + 3, ':');
+	return "ProxyRemote: Bad syntax for a remote proxy server";
+    bl = p + 3;
+    if (*bl == '['){
+	br = strrchr(bl+1, ']');
+	if (br){
+	    bl++;
+	    *br = '\0';
+	    if (*(br+1) == ':'){	/* [host]:xx */
+		q = br+1;
+	    }
+	    else if (*(br+1) == '\0'){	/* [host] */
+		q = NULL;
+	    }
+	    else
+		q = strrchr(br, ':');	/* XXX */
+	}
+	else
+	    q = strrchr(bl, ':');	/* XXX */
+    }
+    else
+	q = strrchr(bl, ':');
     if (q != NULL) {
         if (sscanf(q + 1, "%u", &port) != 1 || port > 65535)
             return "ProxyRemote: Bad syntax for a remote proxy server (bad port number)";
@@@@ -589,7 +610,7 @@@@
     *p = '\0';
     if (strchr(f, ':') == NULL)
         ap_str_tolower(f);      /* lowercase scheme */
-    ap_str_tolower(p + 3);      /* lowercase hostname */
+    ap_str_tolower(bl);         /* lowercase hostname */
 
     if (port == -1) {
         int i;
@@@@ -602,7 +623,7 @@@@
     new = ap_push_array(conf->proxies);
     new->scheme = f;
     new->protocol = r;
-    new->hostname = p + 3;
+    new->hostname = bl;
     new->port = port;
     return NULL;
 }
Index: src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h,v
retrieving revision 1.8
diff -u -r1.8 mod_proxy.h
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	22 Mar 2003 14:37:23 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -310,7 +311,7 @@@@
 int ap_proxy_is_domainname(struct dirconn_entry *This, pool *p);
 int ap_proxy_is_hostname(struct dirconn_entry *This, pool *p);
 int ap_proxy_is_word(struct dirconn_entry *This, pool *p);
-int ap_proxy_doconnect(int sock, struct sockaddr_in *addr, request_rec *r);
+int ap_proxy_doconnect(int sock, struct sockaddr *addr, request_rec *r);
 int ap_proxy_garbage_init(server_rec *, pool *);
 /* This function is called by ap_table_do() for all header lines */
 int ap_proxy_send_hdr_line(void *p, const char *key, const char *value);
Index: src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c,v
retrieving revision 1.8
diff -u -r1.8 proxy_connect.c
--- src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	22 Mar 2003 15:04:23 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -113,14 +114,15 @@@@
                                  const char *proxyhost, int proxyport)
 {
     struct sockaddr_in server;
-    struct in_addr destaddr;
-    struct hostent server_hp;
-    const char *host, *err;
+    struct addrinfo hints, *res, *res0;
+    const char *hoststr;
+    const char *portstr = NULL;
     char *p;
     int port, sock;
     char buffer[HUGE_STRING_LEN];
-    int nbytes, i, j;
+    int nbytes, i;
     fd_set fds;
+    int error;
 
     void *sconf = r->server->module_config;
     proxy_server_conf *conf =
@@@@ -128,27 +130,60 @@@@
     struct noproxy_entry *npent = (struct noproxy_entry *) conf->noproxies->elts;
 
     memset(&server, '\0', sizeof(server));
+#ifdef HAVE_SOCKADDR_LEN
+    server.sin_len = sizeof(server);
+#endif
     server.sin_family = AF_INET;
 
     /* Break the URL into host:port pairs */
 
-    host = url;
+    hoststr = url;
     p = strchr(url, ':');
-    if (p == NULL)
-        port = DEFAULT_HTTPS_PORT;
-    else {
-        port = atoi(p + 1);
-        *p = '\0';
+    if (p == NULL) {
+	char pbuf[32];
+	ap_snprintf(pbuf, sizeof(pbuf), "%d", DEFAULT_HTTPS_PORT);
+	portstr = pbuf;
+    } else {
+	portstr = p + 1;
+	*p = '\0';
+    }
+    port = atoi(portstr);
+
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_family = PF_UNSPEC;
+    hints.ai_socktype = SOCK_STREAM;
+    hints.ai_protocol = IPPROTO_TCP;
+    error = getaddrinfo(hoststr, portstr, &hints, &res0);
+    if (error && proxyhost == NULL) {
+	return ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
+		    gai_strerror(error));       /* give up */
     }
 
 /* check if ProxyBlock directive on this host */
-    destaddr.s_addr = ap_inet_addr(host);
     for (i = 0; i < conf->noproxies->nelts; i++) {
-        if ((npent[i].name != NULL && strstr(host, npent[i].name) != NULL)
-            || destaddr.s_addr == npent[i].addr.s_addr
-            || npent[i].name[0] == '*')
-            return ap_proxyerror(r, HTTP_FORBIDDEN,
-                                 "Connect to remote machine blocked");
+	int fail;
+	struct sockaddr_in *sin;
+
+	fail = 0;
+	if (npent[i].name != NULL && strstr(hoststr, npent[i].name))
+	    fail++;
+	if (npent[i].name != NULL && strcmp(npent[i].name, "*") == 0)
+	    fail++;
+	for (res = res0; res; res = res->ai_next) {
+	    switch (res->ai_family) {
+	    case AF_INET:
+		sin = (struct sockaddr_in *)res->ai_addr;
+		if (sin->sin_addr.s_addr == npent[i].addr.s_addr)
+		    fail++;
+		break;
+	    }
+	}
+	if (fail) {
+	    if (res0 != NULL)
+		freeaddrinfo(res0);
+	    return ap_proxyerror(r, HTTP_FORBIDDEN,
+				 "Connect to remote machine blocked");
+	}
     }
 
     /* Check if it is an allowed port */
@@@@ -159,56 +194,62 @@@@
         case DEFAULT_SNEWS_PORT:
             break;
         default:
+            if (res0 != NULL)
+                freeaddrinfo(res0);
             return HTTP_FORBIDDEN;
         }
     }
-    else if (!allowed_port(conf, port))
+    else if(!allowed_port(conf, port)) {
+        if (res0 == NULL)
+                freeaddrinfo(res0);
         return HTTP_FORBIDDEN;
+    }
 
     if (proxyhost) {
+	char pbuf[10];
+
+	if (res0 != NULL)
+		freeaddrinfo(res0);
+	ap_snprintf(pbuf, sizeof(pbuf), "%d", proxyport);
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_socktype = SOCK_STREAM;
+	hints.ai_protocol = IPPROTO_TCP;
+	error = getaddrinfo(proxyhost, pbuf, &hints, &res0);
+	if (error)
+		return HTTP_INTERNAL_SERVER_ERROR;  /* XXX */
+
         ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, r->server,
              "CONNECT to remote proxy %s on port %d", proxyhost, proxyport);
     }
     else {
         ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, r->server,
-                     "CONNECT to %s on port %d", host, port);
+                     "CONNECT to %s on port %d", hoststr, port);
     }
 
-    /* Nasty cast to work around broken terniary expressions on MSVC */
-    server.sin_port = htons((unsigned short)(proxyport ? proxyport : port));
-    err = ap_proxy_host2addr(proxyhost ? proxyhost : host, &server_hp);
-
-    if (err != NULL)
-        return ap_proxyerror(r,
-            proxyhost ? HTTP_BAD_GATEWAY : HTTP_INTERNAL_SERVER_ERROR, err);
-
-    sock = ap_psocket(r->pool, PF_INET, SOCK_STREAM, IPPROTO_TCP);
-    if (sock == -1) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR, r, "proxy: error creating socket");
-        return HTTP_INTERNAL_SERVER_ERROR;
-    }
+    sock = i = -1;
+    for (res = res0; res; res = res->ai_next) {
+	sock = ap_psocket(r->pool, res->ai_family, res->ai_socktype, res->ai_protocol);
+	if (sock == -1)
+	    continue;
 
 #ifdef CHECK_FD_SETSIZE
-    if (sock >= FD_SETSIZE) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_WARNING, NULL,
-                     "proxy_connect_handler: filedescriptor (%u) "
-                     "larger than FD_SETSIZE (%u) "
-                     "found, you probably need to rebuild Apache with a "
-                     "larger FD_SETSIZE", sock, FD_SETSIZE);
-        ap_pclosesocket(r->pool, sock);
-        return HTTP_INTERNAL_SERVER_ERROR;
-    }
+        if (sock >= FD_SETSIZE) {
+            ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_WARNING, NULL,
+                         "proxy_connect_handler: filedescriptor (%u) "
+                         "larger than FD_SETSIZE (%u) "
+                         "found, you probably need to rebuild Apache with a "
+                         "larger FD_SETSIZE", sock, FD_SETSIZE);
+            ap_pclosesocket(r->pool, sock);
+            return HTTP_INTERNAL_SERVER_ERROR;
+        }
 #endif
 
-    j = 0;
-    while (server_hp.h_addr_list[j] != NULL) {
-        memcpy(&server.sin_addr, server_hp.h_addr_list[j],
-               sizeof(struct in_addr));
-        i = ap_proxy_doconnect(sock, &server, r);
-        if (i == 0)
-            break;
-        j++;
+	i = ap_proxy_doconnect(sock, res->ai_addr, r);
+	if (i == 0)
+	    break;
     }
+    freeaddrinfo(res0);
     if (i == -1) {
         ap_pclosesocket(r->pool, sock);
         return ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR, ap_pstrcat(r->pool,
Index: src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c,v
retrieving revision 1.8
diff -u -r1.8 proxy_ftp.c
--- src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	22 Mar 2003 14:37:20 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -62,6 +63,7 @@@@
 #include "http_main.h"
 #include "http_log.h"
 #include "http_core.h"
+#include "sa_len.h"
 
 #define AUTODETECT_PWD
 
@@@@ -555,8 +557,10 @@@@
     const char *err;
     int port, i, j, len, rc, nocache = 0;
     int csd = 0, sock = -1, dsock = -1;
-    struct sockaddr_in server;
-    struct hostent server_hp;
+    struct sockaddr_storage server;
+    struct addrinfo hints, *res, *res0;
+    char portbuf[10];
+    int error;
     struct in_addr destaddr;
     table *resp_hdrs;
     BUFF *ctrl = NULL;
@@@@ -577,11 +581,18 @@@@
     unsigned int presult, h0, h1, h2, h3, p0, p1;
     unsigned int paddr;
     unsigned short pport;
-    struct sockaddr_in data_addr;
+    struct sockaddr_storage data_addr;
+    struct sockaddr_in *sin;
     int pasvmode = 0;
     char pasv[64];
     char *pstr;
 
+/* stuff for LPSV/EPSV */
+    unsigned int paf, holen, ho[16], polen, po[2];
+    struct sockaddr_in6 *sin6;
+    int lpsvmode = 0;
+    char *cmd;
+
 /* stuff for responses */
     char resp[MAX_STRING_LEN];
     char *size = NULL;
@@@@ -658,19 +669,22 @@@@
     if (parms != NULL)
         *(parms++) = '\0';
 
-    memset(&server, 0, sizeof(struct sockaddr_in));
-    server.sin_family = AF_INET;
-    server.sin_port = htons((unsigned short)port);
-    err = ap_proxy_host2addr(host, &server_hp);
-    if (err != NULL)
-        return ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR, err);
-
-    sock = ap_psocket(p, PF_INET, SOCK_STREAM, IPPROTO_TCP);
-    if (sock == -1) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR, r,
-                      "proxy: error creating socket");
-        return HTTP_INTERNAL_SERVER_ERROR;
-    }
+    ap_snprintf(portbuf, sizeof(portbuf), "%d", port);
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_family = PF_UNSPEC;
+    hints.ai_socktype = SOCK_STREAM;
+    error = getaddrinfo(host, portbuf, &hints, &res0);
+    if (error) {
+       return ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
+           gai_strerror(error));
+    }
+
+    i = -1;
+    for (res = res0; res; res = res->ai_next) {
+       sock = ap_psocket(p, res->ai_family, res->ai_socktype,
+           res->ai_protocol);
+       if (sock == -1)
+           continue;
 
 #if !defined(TPF) && !defined(BEOS)
     if (conf->recv_buffer_size > 0
@@@@ -688,32 +702,19 @@@@
         ap_log_rerror(APLOG_MARK, APLOG_ERR, r,
          "proxy: error setting reuseaddr option: setsockopt(SO_REUSEADDR)");
         ap_pclosesocket(p, sock);
+            freeaddrinfo(res0);
         return HTTP_INTERNAL_SERVER_ERROR;
 #endif                          /* _OSD_POSIX */
     }
 
-#ifdef SINIX_D_RESOLVER_BUG
-    {
-        struct in_addr *ip_addr = (struct in_addr *)*server_hp.h_addr_list;
-
-        for (; ip_addr->s_addr != 0; ++ip_addr) {
-            memcpy(&server.sin_addr, ip_addr, sizeof(struct in_addr));
-            i = ap_proxy_doconnect(sock, &server, r);
-            if (i == 0)
-                break;
-        }
-    }
-#else
-    j = 0;
-    while (server_hp.h_addr_list[j] != NULL) {
-        memcpy(&server.sin_addr, server_hp.h_addr_list[j],
-               sizeof(struct in_addr));
-        i = ap_proxy_doconnect(sock, &server, r);
-        if (i == 0)
+        i = ap_proxy_doconnect(sock, res->ai_addr, r);
+        if (i == 0){
+            memcpy(&server, res->ai_addr, res->ai_addrlen);
             break;
-        j++;
+        }
+        ap_pclosesocket(p, sock);
     }
-#endif
+    freeaddrinfo(res0);
     if (i == -1) {
         return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
                       ap_proxyerror(r, HTTP_BAD_GATEWAY, ap_pstrcat(r->pool,
@@@@ -944,7 +945,7 @@@@
     }
 
 /* try to set up PASV data connection first */
-    dsock = ap_psocket(p, PF_INET, SOCK_STREAM, IPPROTO_TCP);
+    dsock = ap_psocket(p, server.ss_family, SOCK_STREAM, IPPROTO_TCP);
     if (dsock == -1) {
         return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
                                 ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
@@@@ -961,11 +962,21 @@@@
     }
 #endif
 
-    ap_bputs("PASV" CRLF, ctrl);
+lpsvagain:
+    if (server.ss_family == AF_INET)
+      cmd = "PASV";
+    else if (lpsvmode)
+      cmd = "LPSV";
+    else
+      cmd = "EPSV";
+    ap_bputs(cmd, ctrl);
+    ap_bputs(CRLF, ctrl);
     ap_bflush(ctrl);
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, r->server, "FTP: PASV command issued");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, r->server, "FTP: passive command issued");
 /* possible results: 227, 421, 500, 501, 502, 530 */
     /* 227 Entering Passive Mode (h1,h2,h3,h4,p1,p2). */
+    /* 228 Entering Long Passive Mode (...). */
+    /* 229 Entering Extended Passive Mode (...). */
     /* 421 Service not available, closing control connection. */
     /* 500 Syntax error, command unrecognized. */
     /* 501 Syntax error in parameters or arguments. */
@@@@ -976,7 +987,7 @@@@
     if (i == -1 || i == 421) {
         return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
                                 ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
-                               "proxy: PASV: control connection is toast"));
+                               "proxy: passive: control connection is toast"));
     }
     else {
         pasv[i - 1] = '\0';
@@@@ -1004,10 +1015,14 @@@@
             pport = (p1 << 8) + p0;
             ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, r->server, "FTP: contacting host %d.%d.%d.%d:%d",
                          h3, h2, h1, h0, pport);
-            data_addr.sin_family = AF_INET;
-            data_addr.sin_addr.s_addr = htonl(paddr);
-            data_addr.sin_port = htons(pport);
-            i = ap_proxy_doconnect(dsock, &data_addr, r);
+            sin = (struct sockaddr_in *)&data_addr;
+            sin->sin_family = AF_INET;
+#ifdef SIN6_LEN
+            sin->sin_len = sizeof(*sin);
+#endif
+            sin->sin_addr.s_addr = htonl(paddr);
+            sin->sin_port = htons(pport);
+            i = ap_proxy_doconnect(dsock, (struct sockaddr *)&data_addr, r);
 
             if (i == -1) {
                 return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
@@@@ -1017,6 +1032,64 @@@@
                                                    strerror(errno), NULL)));
             }
             pasvmode = 1;
+	} else if (presult == 228 && pstr != NULL
+		&& sscanf(pstr,
+"%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u,%u",
+		    &paf, &holen, &ho[0], &ho[1], &ho[2], &ho[3],
+		    &ho[4], &ho[5], &ho[6], &ho[7], &ho[8], &ho[9], &ho[10], &ho[11],
+		    &ho[12], &ho[13], &ho[14], &ho[15], &polen, &po[0], &po[1]) == 21
+		&& paf == 6 && holen == 16 && polen == 2) {
+	    int i;
+	    sin6 = (struct sockaddr_in6 *)&data_addr;
+	    sin6->sin6_family = AF_INET6;
+#ifdef SIN6_LEN
+	    sin6->sin6_len = sizeof(*sin6);
+#endif
+	    for (i = 0; i < 16; i++)
+		sin6->sin6_addr.s6_addr[i] = ho[i] & 0xff;
+	    sin6->sin6_port = htons(((po[0] & 0xff) << 8) | (po[1] & 0xff));
+	    i = ap_proxy_doconnect(dsock, (struct sockaddr *)&data_addr, r);
+
+	    if (i == -1) {
+		ap_kill_timeout(r);
+		return ap_proxyerror(r, HTTP_BAD_GATEWAY,
+				     ap_pstrcat(r->pool,
+						"Could not connect to remote machine: ",
+						strerror(errno), NULL));
+	    }
+ 	    pasvmode = 1;
+	} else if (presult == 229 && pstr != NULL
+		&& pstr[0] == pstr[1] && pstr[0] == pstr[2]
+		&& pstr[0] == pstr[strlen(pstr) - 1]) {
+	    /* expect "|||port|" */
+#ifndef SIN6_LEN
+	    memcpy(&data_addr, &server, SA_LEN((struct sockaddr *)&server));
+#else
+	    memcpy(&data_addr, &server, server.ss_len);
+#endif
+	    switch (data_addr.ss_family) {
+	    case AF_INET:
+		sin = (struct sockaddr_in *)&data_addr;
+		sin->sin_port = htons(atoi(pstr + 3));
+		break;
+	    case AF_INET6:
+		sin6 = (struct sockaddr_in6 *)&data_addr;
+		sin6->sin6_port = htons(atoi(pstr + 3));
+		break;
+	    }
+	    i = ap_proxy_doconnect(dsock, (struct sockaddr *)&data_addr, r);
+
+	    if (i == -1) {
+		ap_kill_timeout(r);
+		return ap_proxyerror(r, HTTP_BAD_GATEWAY,
+				     ap_pstrcat(r->pool,
+						"Could not connect to remote machine: ",
+						strerror(errno), NULL));
+	    }
+	    pasvmode = 1;
+	} else if (!lpsvmode && strcmp(cmd, "EPSV") == 0) {
+	    lpsvmode = 1;
+	    goto lpsvagain;
         }
         else {
             ap_pclosesocket(p, dsock);  /* and try the regular way */
@@@@ -1025,14 +1098,14 @@@@
     }
 
     if (!pasvmode) {            /* set up data connection */
-        clen = sizeof(struct sockaddr_in);
+	clen = sizeof(server);
         if (getsockname(sock, (struct sockaddr *)&server, &clen) < 0) {
             return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
                                 ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
                                     "proxy: error getting socket address"));
         }
 
-        dsock = ap_psocket(p, PF_INET, SOCK_STREAM, IPPROTO_TCP);
+	dsock = ap_psocket(p, server.ss_family, SOCK_STREAM, IPPROTO_TCP);
         if (dsock == -1) {
             return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
                                 ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
@@@@ -1048,13 +1121,28 @@@@
 #endif                          /* _OSD_POSIX */
         }
 
-        if (bind(dsock, (struct sockaddr *)&server,
-                 sizeof(struct sockaddr_in)) == -1) {
+#ifndef SIN6_LEN
+	if (bind(dsock, (struct sockaddr *) &server, SA_LEN((struct sockaddr *)&server)) == -1)
+#else
+	if (bind(dsock, (struct sockaddr *) &server, server.ss_len) == -1)
+#endif
+	{
+	    char hostnamebuf[MAXHOSTNAMELEN], portnamebuf[MAXHOSTNAMELEN];
+
+	    getnameinfo((struct sockaddr *)&server,
+#ifndef SIN6_LEN
+		    SA_LEN((struct sockaddr *)&server),
+#else
+		    server.ss_len,
+#endif
+		hostnamebuf, sizeof(hostnamebuf),
+		portnamebuf, sizeof(portnamebuf),
+		NI_NUMERICHOST | NI_NUMERICSERV);
 
             return ftp_cleanup_and_return(r, ctrl, data, sock, dsock,
                                 ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
-             ap_psprintf(p, "proxy: error binding to ftp data socket %s:%d",
-                         inet_ntoa(server.sin_addr), server.sin_port)));
+             ap_psprintf(p, "proxy: error binding to ftp data socket %s:%s",
+                         hostnamebuf, portnamebuf)));
         }
         listen(dsock, 2);       /* only need a short queue */
     }
@@@@ -1308,7 +1396,7 @@@@
 
     if (!pasvmode) {            /* wait for connection */
         ap_hard_timeout("proxy ftp data connect", r);
-        clen = sizeof(struct sockaddr_in);
+        clen = sizeof(server);
         do
             csd = accept(dsock, (struct sockaddr *)&server, &clen);
         while (csd == -1 && errno == EINTR);
Index: src/usr.sbin/httpd/src/modules/proxy/proxy_http.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/proxy/proxy_http.c,v
retrieving revision 1.11
diff -u -r1.11 proxy_http.c
--- src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	7 Oct 2002 20:22:44 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	22 Mar 2003 15:04:22 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -156,9 +157,6 @@@@
     table *req_hdrs, *resp_hdrs;
     array_header *reqhdrs_arr;
     table_entry *reqhdrs_elts;
-    struct sockaddr_in server;
-    struct in_addr destaddr;
-    struct hostent server_hp;
     BUFF *f;
     char buffer[HUGE_STRING_LEN];
     char portstr[32];
@@@@ -170,6 +168,8 @@@@
     const char *datestr, *urlstr;
     int result, major, minor;
     const char *content_length;
+    struct addrinfo hints, *res, *res0;
+    int error;
 #ifdef EAPI
     char *peer;
 #endif
@@@@ -184,9 +184,6 @@@@
     if (conf->cache.root == NULL)
         nocache = 1;
 
-    memset(&server, '\0', sizeof(server));
-    server.sin_family = AF_INET;
-
     /* We break the URL into host, port, path-search */
 
     urlptr = strstr(url, "://");
@@@@ -194,6 +191,8 @@@@
         return HTTP_BAD_REQUEST;
     urlptr += 3;
     destport = DEFAULT_HTTP_PORT;
+    ap_snprintf(portstr, sizeof(portstr), "%d", DEFAULT_HTTP_PORT);
+    destportstr = portstr;
 #ifdef EAPI
     ap_hook_use("ap::mod_proxy::http::handler::set_destport", 
                 AP_HOOK_SIG2(int,ptr), 
@@@@ -213,7 +212,25 @@@@
         desthost = q;
     }
 
-    strp2 = strchr(desthost, ':');
+    if (*desthost == '['){
+	char *u = strrchr(desthost+1, ']');
+	if (u){
+	    desthost++;
+	    *u = '\0';
+	    if (*(u+1) == ':'){		/* [host]:xx */
+		strp2 = u+1;
+	    }
+	    else if (*(u+1) == '\0'){	/* [host] */
+		strp2 = NULL;
+	    }
+	    else
+		return HTTP_BAD_REQUEST;
+	}
+	else
+	    return HTTP_BAD_REQUEST;
+    }
+    else
+	strp2 = strrchr(desthost, ':');
     if (strp2 != NULL) {
         *(strp2++) = '\0';
         if (ap_isdigit(*strp2)) {
@@@@ -222,80 +239,91 @@@@
         }
     }
 
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_family = PF_UNSPEC;
+    hints.ai_socktype = SOCK_STREAM;
+    hints.ai_protocol = IPPROTO_TCP;
+    error = getaddrinfo(desthost, destportstr, &hints, &res0);
+    if (error && proxyhost == NULL) {
+	return ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR,
+		    gai_strerror(error));	/* give up */
+    }
+
     /* check if ProxyBlock directive on this host */
-    destaddr.s_addr = ap_inet_addr(desthost);
     for (i = 0; i < conf->noproxies->nelts; i++) {
-        if (destaddr.s_addr == npent[i].addr.s_addr ||
-            (npent[i].name != NULL &&
-             (npent[i].name[0] == '*' || strstr(desthost, npent[i].name) != NULL)))
+	int fail;
+	struct sockaddr_in *sin;
+
+	fail = 0;
+	if (npent[i].name != NULL && strstr(desthost, npent[i].name))
+	    fail++;
+	if (npent[i].name != NULL && strcmp(npent[i].name, "*") == 0)
+	    fail++;
+	for (res = res0; res; res = res->ai_next) {
+	    switch (res->ai_family) {
+	    case AF_INET:
+		sin = (struct sockaddr_in *)res->ai_addr;
+		if (sin->sin_addr.s_addr == npent[i].addr.s_addr)
+		    fail++;
+		break;
+	    }
+	}
+	if (fail) {
+	    if (res0 != NULL)
+		freeaddrinfo(res0);
             return ap_proxyerror(r, HTTP_FORBIDDEN,
                                  "Connect to remote machine blocked");
+	}
     }
 
     if (proxyhost != NULL) {
-        server.sin_port = htons((unsigned short)proxyport);
-        err = ap_proxy_host2addr(proxyhost, &server_hp);
-        if (err != NULL)
+	char pbuf[10];
+
+	if (res0 != NULL)
+	    freeaddrinfo(res0);
+
+	ap_snprintf(pbuf, sizeof(pbuf), "%d", proxyport);
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_socktype = SOCK_STREAM;
+	hints.ai_protocol = IPPROTO_TCP;
+	error = getaddrinfo(proxyhost, pbuf, &hints, &res0);
+	if (error)
             return DECLINED;    /* try another */
 #ifdef EAPI
 	peer = ap_psprintf(p, "%s:%u", proxyhost, proxyport);  
 #endif
     }
-    else {
-        server.sin_port = htons((unsigned short)destport);
-        err = ap_proxy_host2addr(desthost, &server_hp);
-        if (err != NULL)
-            return ap_proxyerror(r, HTTP_INTERNAL_SERVER_ERROR, err);
-#ifdef EAPI
-	peer =  ap_psprintf(p, "%s:%u", desthost, destport);  
-#endif
-    }
 
 
     /*
      * we have worked out who exactly we are going to connect to, now make
      * that connection...
      */
-    sock = ap_psocket(p, PF_INET, SOCK_STREAM, IPPROTO_TCP);
-    if (sock == -1) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR, r,
-                      "proxy: error creating socket");
-        return HTTP_INTERNAL_SERVER_ERROR;
-    }
+    sock = i = -1;
+    for (res = res0; res; res = res->ai_next) {
+	sock = ap_psocket(p, res->ai_family, res->ai_socktype,
+	    res->ai_protocol);
+	if (sock < 0)
+	    continue;
 
 #if !defined(TPF) && !defined(BEOS)
-    if (conf->recv_buffer_size) {
-        if (setsockopt(sock, SOL_SOCKET, SO_RCVBUF,
-                       (const char *)&conf->recv_buffer_size, sizeof(int))
-            == -1) {
-            ap_log_rerror(APLOG_MARK, APLOG_ERR, r,
-                          "setsockopt(SO_RCVBUF): Failed to set ProxyReceiveBufferSize, using default");
+        if (conf->recv_buffer_size) {
+            if (setsockopt(sock, SOL_SOCKET, SO_RCVBUF,
+                           (const char *)&conf->recv_buffer_size, sizeof(int))
+                == -1) {
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, r,
+                              "setsockopt(SO_RCVBUF): Failed to set ProxyReceiveBufferSize, using default");
+            }
         }
-    }
 #endif
 
-#ifdef SINIX_D_RESOLVER_BUG
-    {
-        struct in_addr *ip_addr = (struct in_addr *)*server_hp.h_addr_list;
-
-        for (; ip_addr->s_addr != 0; ++ip_addr) {
-            memcpy(&server.sin_addr, ip_addr, sizeof(struct in_addr));
-            i = ap_proxy_doconnect(sock, &server, r);
-            if (i == 0)
-                break;
-        }
-    }
-#else
-    j = 0;
-    while (server_hp.h_addr_list[j] != NULL) {
-        memcpy(&server.sin_addr, server_hp.h_addr_list[j],
-               sizeof(struct in_addr));
-        i = ap_proxy_doconnect(sock, &server, r);
+	i = ap_proxy_doconnect(sock, res->ai_addr, r);
         if (i == 0)
             break;
-        j++;
+	ap_pclosesocket(p, sock);
     }
-#endif
+    freeaddrinfo(res0);
     if (i == -1) {
         if (proxyhost != NULL)
             return DECLINED;    /* try again another way */
@@@@ -597,31 +625,44 @@@@
         ap_table_set(resp_hdrs, "Content-Location", proxy_location_reverse_map(r, urlstr));
 
 /* check if NoCache directive on this host */
+  {
+    struct sockaddr_in *sin;
+#ifdef INET6
+    struct sockaddr_in6 *sin6;
+#endif
+
     if (nocache == 0) {
         for (i = 0; i < conf->nocaches->nelts; i++) {
-            if (destaddr.s_addr == ncent[i].addr.s_addr ||
-                (ncent[i].name != NULL &&
-                 (ncent[i].name[0] == '*' ||
-                  strstr(desthost, ncent[i].name) != NULL))) {
-                nocache = 1;
-                break;
-            }
-        }
-
-        /*
-         * update the cache file, possibly even fulfilling the request if it
-         * turns out a conditional allowed us to serve the object from the
-         * cache...
-         */
-        i = ap_proxy_cache_update(c, resp_hdrs, !backasswards, nocache);
-        if (i != DECLINED) {
-            ap_bclose(f);
-            return i;
-        }
+	    if (ncent[i].name != NULL &&
+                  (ncent[i].name[0] == '*' ||
+		 strstr(desthost, ncent[i].name) != NULL)) {
+		nocache = 1;
+		break;
+	    }
+	    switch (res->ai_addr->sa_family) {
+	    case AF_INET:
+		sin = (struct sockaddr_in *)res->ai_addr;
+		if (sin->sin_addr.s_addr == ncent[i].addr.s_addr) {
+		    nocache = 1;
+		    break;
+		}
+	    }
+	}
+
+	/* update the cache file, possibly even fulfilling the request if
+	 * it turns out a conditional allowed us to serve the object from the
+	 * cache...
+	 */
+	i = ap_proxy_cache_update(c, resp_hdrs, !backasswards, nocache);
+	if (i != DECLINED) {
+	    ap_bclose(f);
+	    return i;
+	}
 
         /* write status line and headers to the cache file */
         ap_proxy_write_headers(c, ap_pstrcat(p, "HTTP/1.1 ", r->status_line, NULL), resp_hdrs);
     }
+  }
 
     /* Setup the headers for our client from upstreams response-headers */
     ap_proxy_table_replace(r->headers_out, resp_hdrs);
Index: src/usr.sbin/httpd/src/modules/proxy/proxy_util.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/proxy/proxy_util.c,v
retrieving revision 1.11
diff -u -r1.11 proxy_util.c
--- src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	7 Oct 2002 20:22:44 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	22 Mar 2003 14:37:17 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -64,6 +65,7 @@@@
 #include "http_log.h"
 #include "util_uri.h"
 #include "util_date.h"          /* get ap_checkmask() decl. */
+#include "sa_len.h"
 
 static int proxy_match_ipaddr(struct dirconn_entry *This, request_rec *r);
 static int proxy_match_domainname(struct dirconn_entry *This, request_rec *r);
@@@@ -219,6 +221,7 @@@@
     int i;
     char *strp, *host, *url = *urlp;
     char *user = NULL, *password = NULL;
+    char *t = NULL, *u = NULL, *v = NULL;
 
     if (url[0] != '/' || url[1] != '/')
         return "Malformed URL";
@@@@ -257,40 +260,63 @@@@
         *passwordp = password;
     }
 
-    strp = strrchr(host, ':');
-    if (strp != NULL) {
-        *(strp++) = '\0';
-
-        for (i = 0; strp[i] != '\0'; i++)
-            if (!ap_isdigit(strp[i]))
-                break;
-
-        /* if (i == 0) the no port was given; keep default */
-        if (strp[i] != '\0') {
-            return "Bad port number in URL";
-        }
+    v = host;
+    if (*host == '['){
+	u = strrchr(host, ']');
+	if (u){
+	    host++;
+	    *u = '\0';
+	    v = u + 1;
+	}
+    }
+    t = strrchr(v, ':');
+    if (t){
+	*t = '\0';
+	strp = t + 1;
+    }
+    if (strp){
+	for (i=0; strp[i] != '\0'; i++)
+	    if (!ap_isdigit(strp[i]))
+		break;
+
+	/* if (i == 0) the no port was given; keep default */
+	if (strp[i] != '\0') {
+	    return "Bad port number in URL";
+	}
         else if (i > 0) {
-            *port = atoi(strp);
-            if (*port > 65535)
-                return "Port number in URL > 65535";
-        }
+	    *port = atoi(strp);
+	    if (*port > 65535)
+		return "Port number in URL > 65535";
+	}
     }
     ap_str_tolower(host);       /* DNS names are case-insensitive */
     if (*host == '\0')
         return "Missing host in URL";
 /* check hostname syntax */
     for (i = 0; host[i] != '\0'; i++)
-        if (!ap_isdigit(host[i]) && host[i] != '.')
-            break;
+	if (!ap_isxdigit(host[i]) && host[i] != '.' && host[i] != ':')
+	    break;
     /* must be an IP address */
 #if defined(WIN32) || defined(NETWARE) || defined(TPF) || defined(BEOS)
     if (host[i] == '\0' && (inet_addr(host) == -1))
+	return "Bad IP address in URL";
 #else
-    if (host[i] == '\0' && (ap_inet_addr(host) == -1 || inet_network(host) == -1))
+    if (host[i] == '\0') {
+	struct addrinfo hints, *res0;
+	int gai;
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_flags = AI_NUMERICHOST;
+	if (gai = getaddrinfo(host, NULL, &hints, &res0)) {
+#if 0
+	    return gai_strerror(gai);
+#else
+	    return "Bad IP address in URL";
 #endif
-    {
-        return "Bad IP address in URL";
+	}
+	freeaddrinfo(res0);
     }
+#endif
 
 /*    if (strchr(host,'.') == NULL && domain != NULL)
    host = pstrcat(p, host, domain, NULL);
@@@@ -1359,22 +1385,45 @@@@
     return host != NULL && strstr(host, This->name) != NULL;
 }
 
-int ap_proxy_doconnect(int sock, struct sockaddr_in *addr, request_rec *r)
+int ap_proxy_doconnect(int sock, struct sockaddr *addr, request_rec *r)
 {
     int i;
+    int salen;
+    char hbuf[NI_MAXHOST], pbuf[NI_MAXSERV];
+#ifdef NI_WITHSCOPEID
+    const int niflags = NI_NUMERICHOST | NI_NUMERICSERV | NI_WITHSCOPEID;
+#else
+    const int niflags = NI_NUMERICHOST | NI_NUMERICSERV;
+#endif
 
     ap_hard_timeout("proxy connect", r);
+#ifdef HAVE_SOCKADDR_LEN
+    salen = addr->sa_len;
+#else
+    switch (addr->sa_family) {
+    case AF_INET6:
+	salen = sizeof(struct sockaddr_in6);
+	break;
+    default:
+	salen = sizeof(struct sockaddr_in);
+	break;
+    }
+#endif
     do {
-        i = connect(sock, (struct sockaddr *)addr, sizeof(struct sockaddr_in));
+	i = connect(sock,  addr, salen);
 #if defined(WIN32) || defined(NETWARE)
         if (i == SOCKET_ERROR)
             errno = WSAGetLastError();
 #endif                          /* WIN32 */
     } while (i == -1 && errno == EINTR);
     if (i == -1) {
+	if (getnameinfo(addr, salen, hbuf, sizeof(hbuf), pbuf, sizeof(pbuf),
+		niflags) != 0) {
+	    strcpy(hbuf, "?");
+	    strcpy(pbuf, "?");
+	}
         ap_log_rerror(APLOG_MARK, APLOG_ERR, r,
-                      "proxy connect to %s port %d failed",
-                      inet_ntoa(addr->sin_addr), ntohs(addr->sin_port));
+                      "proxy connect to %s port %s failed", hbuf, pbuf);
     }
     ap_kill_timeout(r);
 
Index: src/usr.sbin/httpd/src/modules/standard/mod_access.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/standard/mod_access.c,v
retrieving revision 1.5
diff -u -r1.5 mod_access.c
--- src/usr.sbin/httpd/src/modules/standard/mod_access.c	29 Mar 2002 02:07:44 -0000	1.5
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	22 Mar 2003 15:04:20 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -74,7 +75,10 @@@@
     T_ALL,
     T_IP,
     T_HOST,
-    T_FAIL
+    T_FAIL,
+#ifdef INET6
+    T_IP6,
+#endif
 };
 
 typedef struct {
@@@@ -82,9 +86,15 @@@@
     union {
 	char *from;
 	struct {
-	    unsigned long net;
-	    unsigned long mask;
+	    struct in_addr net;
+	    struct in_addr mask;
 	} ip;
+#ifdef INET6
+	struct {
+	    struct in6_addr net6;
+	    struct in6_addr mask6;
+	} ip6;
+#endif
     } x;
     enum allowdeny_type type;
 } allowdeny;
@@@@ -167,90 +177,230 @@@@
 
     }
     else if ((s = strchr(where, '/'))) {
-	unsigned long mask;
+	struct addrinfo hints, *resnet, *resmask;
+	struct sockaddr_storage net, mask;
+	int error;
+	char *p;
+	int justdigits;
 
-	a->type = T_IP;
+	a->type = T_FAIL;	/*just in case*/
 	/* trample on where, we won't be using it any more */
 	*s++ = '\0';
 
-	if (!is_ip(where)
-	    || (a->x.ip.net = ap_inet_addr(where)) == INADDR_NONE) {
+	justdigits = 0;
+	for (p = s; *p; p++) {
+	    if (!isdigit(*p))
+		break;
+	}
+	if (!*p)
+	    justdigits++;
+
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_socktype = SOCK_STREAM;	/*dummy*/
+#ifdef AI_NUMERICHOST
+	hints.ai_flags = AI_NUMERICHOST;	/*don't resolve*/
+#endif
+	resnet = NULL;
+	error = getaddrinfo(where, NULL, &hints, &resnet);
+	if (error || !resnet) {
+	    if (resnet)
+		freeaddrinfo(resnet);
 	    a->type = T_FAIL;
 	    return "syntax error in network portion of network/netmask";
 	}
+	if (resnet->ai_next) {
+	    freeaddrinfo(resnet);
+	    a->type = T_FAIL;
+	    return "network/netmask resolved to multiple addresses";
+	}
+	memcpy(&net, resnet->ai_addr, resnet->ai_addrlen);
+	freeaddrinfo(resnet);
 
-	/* is_ip just tests if it matches [\d.]+ */
-	if (!is_ip(s)) {
+	switch (net.ss_family) {
+	case AF_INET:
+	    a->type = T_IP;
+	    a->x.ip.net.s_addr = ((struct sockaddr_in *)&net)->sin_addr.s_addr;
+	    break;
+#ifdef INET6
+	case AF_INET6:
+	    a->type = T_IP6;
+	    memcpy(&a->x.ip6.net6, &((struct sockaddr_in6 *)&net)->sin6_addr,
+		sizeof(a->x.ip6.net6));
+	    break;
+#endif
+	default:
 	    a->type = T_FAIL;
-	    return "syntax error in mask portion of network/netmask";
+	    return "unknown address family for network";
 	}
-	/* is it in /a.b.c.d form? */
-	if (strchr(s, '.')) {
-	    mask = ap_inet_addr(s);
-	    if (mask == INADDR_NONE) {
+
+	if (!justdigits) {
+	    memset(&hints, 0, sizeof(hints));
+	    hints.ai_family = PF_UNSPEC;
+	    hints.ai_socktype = SOCK_STREAM;	/*dummy*/
+#ifdef AI_NUMERICHOST
+	    hints.ai_flags = AI_NUMERICHOST;	/*don't resolve*/
+#endif
+	    resmask = NULL;
+	    error = getaddrinfo(s, NULL, &hints, &resmask);
+	    if (error || !resmask) {
+		if (resmask)
+		    freeaddrinfo(resmask);
 		a->type = T_FAIL;
 		return "syntax error in mask portion of network/netmask";
 	    }
-	}
-	else {
-	    /* assume it's in /nnn form */
-	    mask = atoi(s);
-	    if (mask > 32 || mask <= 0) {
-		a->type = T_FAIL;
-		return "invalid mask in network/netmask";
-	    }
-	    mask = 0xFFFFFFFFUL << (32 - mask);
-	    mask = htonl(mask);
-	}
-	a->x.ip.mask = mask;
-        a->x.ip.net  = (a->x.ip.net & mask);   /* pjr - This fixes PR 4770 */
-    }
-    else if (ap_isdigit(*where) && is_ip(where)) {
-	/* legacy syntax for ip addrs: a.b.c. ==> a.b.c.0/24 for example */
-	int shift;
-	char *t;
-	int octet;
-
-	a->type = T_IP;
-	/* parse components */
-	s = where;
-	a->x.ip.net = 0;
-	a->x.ip.mask = 0;
-	shift = 24;
-	while (*s) {
-	    t = s;
-	    if (!ap_isdigit(*t)) {
+	    if (resmask->ai_next) {
+		freeaddrinfo(resmask);
 		a->type = T_FAIL;
-		return "invalid ip address";
+		return "network/netmask resolved to multiple addresses";
 	    }
-	    while (ap_isdigit(*t)) {
-		++t;
-	    }
-	    if (*t == '.') {
-		*t++ = 0;
-	    }
-	    else if (*t) {
+	    memcpy(&mask, resmask->ai_addr, resmask->ai_addrlen);
+	    freeaddrinfo(resmask);
+
+	    if (net.ss_family != mask.ss_family) {
 		a->type = T_FAIL;
-		return "invalid ip address";
+		return "network/netmask resolved to different address family";
 	    }
-	    if (shift < 0) {
-		return "invalid ip address, only 4 octets allowed";
+
+	    switch (a->type) {
+	    case T_IP:
+		a->x.ip.mask.s_addr =
+		    ((struct sockaddr_in *)&mask)->sin_addr.s_addr;
+		break;
+#ifdef INET6
+	    case T_IP6:
+		memcpy(&a->x.ip6.mask6,
+		    &((struct sockaddr_in6 *)&mask)->sin6_addr,
+		    sizeof(a->x.ip6.mask6));
+		break;
+#endif
 	    }
-	    octet = atoi(s);
-	    if (octet < 0 || octet > 255) {
-		a->type = T_FAIL;
-		return "each octet must be between 0 and 255 inclusive";
+	} else {
+	    int mask;
+	    mask = atoi(s);
+	    switch (a->type) {
+	    case T_IP:
+		if (mask < 0 || 32 < mask) {
+		    a->type = T_FAIL;
+		    return "netmask out of range";
+		}
+		a->x.ip.mask.s_addr = htonl(0xFFFFFFFFUL << (32 - mask));
+		break;
+#ifdef INET6
+	    case T_IP6:
+	      {
+		int i;
+		if (mask < 0 || 128 < mask) {
+		    a->type = T_FAIL;
+		    return "netmask out of range";
+		}
+		for (i = 0; i < mask / 8; i++) {
+		    a->x.ip6.mask6.s6_addr[i] = 0xff;
+		}
+		if (mask % 8)
+		    a->x.ip6.mask6.s6_addr[i] = 0xff << (8 - (mask % 8));
+		break;
+	      }
+#endif
 	    }
-	    a->x.ip.net |= octet << shift;
-	    a->x.ip.mask |= 0xFFUL << shift;
-	    s = t;
-	    shift -= 8;
 	}
-	a->x.ip.net = ntohl(a->x.ip.net);
-	a->x.ip.mask = ntohl(a->x.ip.mask);
     }
     else {
-	a->type = T_HOST;
+	struct addrinfo hints, *res;
+	struct sockaddr_storage ss;
+	int error;
+
+	a->type = T_FAIL;	/*just in case*/
+
+	/* First, try using the old apache code to match */
+	/* legacy syntax for ip addrs: a.b.c. ==> a.b.c.0/24 for example */
+	if (ap_isdigit(*where) && is_ip(where)) {
+	    int shift;
+	    char *t;
+	    int octet;
+
+	    a->type = T_IP;
+	    /* parse components */
+	    s = where;
+	    a->x.ip.net.s_addr = 0;
+	    a->x.ip.mask.s_addr = 0;
+	    shift = 24;
+	    while (*s) {
+		t = s;
+		if (!ap_isdigit(*t)) {
+		    a->type = T_FAIL;
+		    return "invalid ip address";
+		}
+		while (ap_isdigit(*t)) {
+		    ++t;
+		}
+		if (*t == '.') {
+		    *t++ = 0;
+		}
+		else if (*t) {
+		    a->type = T_FAIL;
+		    return "invalid ip address";
+		}
+		if (shift < 0) {
+		    return "invalid ip address, only 4 octets allowed";
+		}
+		octet = atoi(s);
+		if (octet < 0 || octet > 255) {
+		    a->type = T_FAIL;
+		    return "each octet must be between 0 and 255 inclusive";
+		}
+		a->x.ip.net.s_addr |= octet << shift;
+		a->x.ip.mask.s_addr |= 0xFFUL << shift;
+		s = t;
+		shift -= 8;
+	    }
+	    a->x.ip.net.s_addr = ntohl(a->x.ip.net.s_addr);
+	    a->x.ip.mask.s_addr = ntohl(a->x.ip.mask.s_addr);
+
+	    return NULL;
+	}
+
+	/* IPv4/v6 numeric address */
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	hints.ai_socktype = SOCK_STREAM;	/*dummy*/
+#ifdef AI_NUMERICHOST
+	hints.ai_flags = AI_NUMERICHOST;	/*don't resolve*/
+#endif
+	res = NULL;
+	error = getaddrinfo(where, NULL, &hints, &res);
+	if (error || !res) {
+	    if (res)
+		freeaddrinfo(res);
+	    a->type = T_HOST;
+	    return NULL;
+	}
+	if (res->ai_next) {
+	    freeaddrinfo(res);
+	    a->type = T_FAIL;
+	    return "network/netmask resolved to multiple addresses";
+	}
+	memcpy(&ss, res->ai_addr, res->ai_addrlen);
+	freeaddrinfo(res);
+
+	switch (ss.ss_family) {
+	case AF_INET:
+	    a->type = T_IP;
+	    a->x.ip.net.s_addr = ((struct sockaddr_in *)&ss)->sin_addr.s_addr;
+	    memset(&a->x.ip.mask, 0xff, sizeof(a->x.ip.mask));
+	    break;
+#ifdef INET6
+	case AF_INET6:
+	    a->type = T_IP6;
+	    memcpy(&a->x.ip6.net6, &((struct sockaddr_in6 *)&ss)->sin6_addr,
+		sizeof(a->x.ip6.net6));
+	    memset(&a->x.ip6.mask6, 0xff, sizeof(a->x.ip6.mask6));
+	    break;
+#endif
+	default:
+	    a->type = T_FAIL;
+	    return "unknown address family for network";
+	}
     }
 
     return NULL;
@@@@ -315,12 +465,63 @@@@
 	    return 1;
 
 	case T_IP:
-	    if (ap[i].x.ip.net != INADDR_NONE
-		&& (r->connection->remote_addr.sin_addr.s_addr
-		    & ap[i].x.ip.mask) == ap[i].x.ip.net) {
-		return 1;
+	    if (ap[i].x.ip.net.s_addr == INADDR_NONE)
+		break;
+	    switch (r->connection->remote_addr.ss_family) {
+	    case AF_INET:
+		if ((((struct sockaddr_in *)&r->connection->remote_addr)->sin_addr.s_addr
+			& ap[i].x.ip.mask.s_addr) == ap[i].x.ip.net.s_addr) {
+		    return 1;
+		}
+		break;
+#ifdef INET6
+	    case AF_INET6:
+		if (!IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)&r->connection->remote_addr)->sin6_addr))	/*XXX*/
+		    break;
+		if ((*(u_int32_t *)&((struct sockaddr_in6 *)&r->connection->remote_addr)->sin6_addr.s6_addr[12]
+			& ap[i].x.ip.mask.s_addr) == ap[i].x.ip.net.s_addr) {
+		    return 1;
+		}
+		break;
+#endif
+	    }
+	    break;
+
+#ifdef INET6
+	case T_IP6:
+	  {
+	    struct in6_addr masked;
+	    int j;
+	    if (IN6_IS_ADDR_UNSPECIFIED(&ap[i].x.ip6.net6))
+		break;
+	    switch (r->connection->remote_addr.ss_family) {
+	    case AF_INET:
+		if (!IN6_IS_ADDR_V4MAPPED(&ap[i].x.ip6.net6))	/*XXX*/
+		    break;
+		memset(&masked, 0, sizeof(masked));
+		masked.s6_addr[10] = masked.s6_addr[11] = 0xff;
+		memcpy(&masked.s6_addr[12],
+		    &((struct sockaddr_in *)&r->connection->remote_addr)->sin_addr.s_addr,
+		    sizeof(struct sockaddr_in));
+		for (j = 0; j < sizeof(struct in6_addr); j++)
+			masked.s6_addr[j] &= ap[i].x.ip6.mask6.s6_addr[j];
+		if (memcmp(&masked, &ap[i].x.ip6.net6, sizeof(masked)) == 0)
+		    return 1;
+		break;
+	    case AF_INET6:
+		memset(&masked, 0, sizeof(masked));
+		memcpy(&masked,
+		    &((struct sockaddr_in6 *)&r->connection->remote_addr)->sin6_addr,
+		    sizeof(masked));
+		for (j = 0; j < sizeof(struct in6_addr); j++)
+		    masked.s6_addr[j] &= ap[i].x.ip6.mask6.s6_addr[j];
+		if (memcmp(&masked, &ap[i].x.ip6.net6, sizeof(masked)) == 0)
+		    return 1;
+		break;
 	    }
 	    break;
+	  }
+#endif
 
 	case T_HOST:
 	    if (!gothost) {
Index: src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c,v
retrieving revision 1.6
diff -u -r1.6 mod_unique_id.c
--- src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	29 Mar 2002 02:07:45 -0000	1.6
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	22 Mar 2003 14:37:14 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -67,10 +68,20 @@@@
 #include "http_config.h"
 #include "http_log.h"
 #include "multithread.h"
+#include "sa_len.h"
 
 typedef struct {
     unsigned int stamp;
-    unsigned int in_addr;
+    union {
+      u_int32_t     in;
+#ifdef INET6
+# ifdef SHORT_UNIQUE_ID
+      u_int32_t     in6;
+# else
+      struct in6_addr in6;
+# endif
+#endif
+    } addr;
     unsigned int pid;
 #ifdef MULTITHREAD
     unsigned int tid;
@@@@ -142,7 +153,7 @@@@
  * this shouldn't be a problem till year 2106.
  */
 
-static unsigned global_in_addr;
+static struct sockaddr_storage global_addr;
 
 #ifdef WIN32
 
@@@@ -221,7 +232,8 @@@@
 #define MAXHOSTNAMELEN 256
 #endif
     char str[MAXHOSTNAMELEN + 1];
-    struct hostent *hent;
+    struct addrinfo hints, *res, *res0;
+    int error;
 #ifndef NO_GETTIMEOFDAY
     struct timeval tv;
 #endif
@@@@ -232,8 +244,8 @@@@
      */
     unique_id_rec_offset[0] = XtOffsetOf(unique_id_rec, stamp);
     unique_id_rec_size[0] = sizeof(cur_unique_id->stamp);
-    unique_id_rec_offset[1] = XtOffsetOf(unique_id_rec, in_addr);
-    unique_id_rec_size[1] = sizeof(cur_unique_id->in_addr);
+    unique_id_rec_offset[1] = XtOffsetOf(unique_id_rec, addr);
+    unique_id_rec_size[1] = sizeof(cur_unique_id->addr);
     unique_id_rec_offset[2] = XtOffsetOf(unique_id_rec, pid);
     unique_id_rec_size[2] = sizeof(cur_unique_id->pid);
 #ifdef MULTITHREAD
@@@@ -269,17 +281,44 @@@@
     }
     str[sizeof(str) - 1] = '\0';
 
-    if ((hent = gethostbyname(str)) == NULL) {
+    memset(&hints, 0, sizeof(hints));
+    hints.ai_family = PF_UNSPEC;
+    error = getaddrinfo(str, NULL, &hints, &res0);
+    if (error) {
         ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, s,
-		     "mod_unique_id: unable to gethostbyname(\"%s\")", str);
+                     "mod_unique_id: getaddrinfo failed for \"%s\" (%s)", str,
+		     gai_strerror(error));
         exit(1);
     }
 
-    global_in_addr = ((struct in_addr *) hent->h_addr_list[0])->s_addr;
+    error = 1;
+    for (res = res0; res; res = res->ai_next) {
+	switch (res->ai_family) {
+	case AF_INET:
+#ifdef INET6
+	case AF_INET6:
+#endif
+	    memcpy(&global_addr, res->ai_addr, res->ai_addrlen);
+	    error = 0;
+	    break;
+	}
+    }
+    freeaddrinfo(res0);
+    if (error) {
+        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, s,
+                    "mod_unique_id: no known AF found for \"%s\"", str);
+        exit(1);
+    }
 
+    getnameinfo((struct sockaddr *)&global_addr,
+#ifndef SIN6_LEN
+	SA_LEN((struct sockaddr *)&global_addr),
+#else
+	global_addr.ss_len,
+#endif
+	str, sizeof(str), NULL, 0, NI_NUMERICHOST);
     ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, s,
-		 "mod_unique_id: using ip addr %s",
-		 inet_ntoa(*(struct in_addr *) hent->h_addr_list[0]));
+                 "mod_unique_id: using ip addr %s", str);
 
     /*
      * If the server is pummelled with restart requests we could possibly end
@@@@ -336,7 +375,24 @@@@
 		     "oh no! pids are greater than 32-bits!  I'm broken!");
     }
 
-    cur_unique_id->in_addr = global_in_addr;
+    memset(&cur_unique_id->addr, 0, sizeof(cur_unique_id->addr));
+    switch (global_addr.ss_family) {
+    case AF_INET:
+      cur_unique_id->addr.in =
+          ((struct sockaddr_in *)&global_addr)->sin_addr.s_addr;
+      break;
+#ifdef INET6
+    case AF_INET6:
+#ifdef SHORT_UNIQUE_ID
+      cur_unique_id->addr.in6 =
+          ((struct sockaddr_in6 *)&global_addr)->sin6_addr.s6_addr32[3];
+#else
+      cur_unique_id->addr.in6 =
+          ((struct sockaddr_in6 *)&global_addr)->sin6_addr;
+#endif
+      break;
+#endif
+    }
 
     /*
      * If we use 0 as the initial counter we have a little less protection
Index: src/usr.sbin/httpd/src/support/ab.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/support/ab.c,v
retrieving revision 1.10
diff -u -r1.10 ab.c
--- src/usr.sbin/httpd/src/support/ab.c	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/support/ab.c	22 Mar 2003 15:04:18 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /* ====================================================================
  * The Apache Software License, Version 1.1
  *
@@@@ -158,6 +159,8 @@@@
 #include <sys/uio.h>
 #endif
 
+#include "sa_len.h"
+
 #endif				/* NO_APACHE_INCLUDES */
 
 #ifdef	USE_SSL
@@@@ -262,7 +265,7 @@@@
      auth[1024],		/* optional (basic/uuencoded)
 				 * authentification */
      hdrs[4096];		/* optional arbitrary headers */
-int port = 80;			/* port number */
+char *port = "80";		/* port number */
 
 int use_html = 0;		/* use html in the report */
 char *tablestring;
@@@@ -299,7 +302,7 @@@@
 struct data *stats;		/* date for each request */
 
 fd_set readbits, writebits;	/* bits for select */
-struct sockaddr_in server;	/* server addr structure */
+struct sockaddr_storage server;      /* server addr structure */
 
 #ifndef BEOS
 #define ab_close(s) close(s)
@@@@ -525,7 +528,7 @@@@
     printf("\r                                                                           \r");
     printf("Server Software:        %s\n", servername);
     printf("Server Hostname:        %s\n", hostname);
-    printf("Server Port:            %d\n", port);
+    printf("Server Port:            %s\n", port);
     printf("\n");
     printf("Document Path:          %s\n", path);
     printf("Document Length:        %d bytes\n", doclen);
@@@@ -878,7 +881,7 @@@@
     c->cbx = 0;
     c->gotheader = 0;
 
-    c->fd = socket(AF_INET, SOCK_STREAM, 0);
+    c->fd = socket(server.ss_family, SOCK_STREAM, 0);
     if (c->fd < 0) {
 	what = "SOCKET";
 	goto _bad;
@@@@ -895,11 +898,16 @@@@
 
 again:
     gettimeofday(&c->start, 0);
-    if (connect(c->fd, (struct sockaddr *) & server, sizeof(server)) < 0) {
-	if (errno != EINPROGRESS) {
-	    what = "CONNECT";
-	    goto _bad;
-	};
+#ifndef SIN6_LEN
+    if (connect(c->fd, (struct sockaddr *) & server, SA_LEN((struct sockaddr*)&server)) < 0)
+#else
+    if (connect(c->fd, (struct sockaddr *) & server, server.ss_len) < 0)
+#endif
+    {
+        if (errno != EINPROGRESS) {
+            what = "CONNECT";
+            goto _bad;
+        };
     }
     c->state = STATE_CONNECTING;
 
@@@@ -1203,7 +1211,7 @@@@
 	 * perhaps we should NOT send any
 	 * when we are proxying.
 	 */
-	connecthost  = proxyhost;
+	connecthost = proxyhost;
 	connectport = proxyport;
     	url_on_request = fullurl;
     }
@@@@ -1214,8 +1222,8 @@@@
 	 * header; and do not quote a full
 	 * URL in the GET/POST line.
 	 */
-	connecthost  = hostname;
-	connectport = port;
+	connecthost = hostname;
+	connectport = atoi(port);
     	url_on_request = path;
     }
     
@@@@ -1226,17 +1234,21 @@@@
     }
     {
 	/* get server information */
-	struct hostent *he;
-	he = gethostbyname(connecthost);
-	if (!he) {
-	    char theerror[1024];
-	    ap_snprintf(theerror, sizeof(theerror),
+	struct addrinfo hints, *res;
+	int error;
+
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+        hints.ai_socktype = SOCK_STREAM;
+	error = getaddrinfo(connecthost, port, &hints, &res);
+	if (error) {
+            char theerror[1024];
+            ap_snprintf(theerror, sizeof(theerror),
                         "Bad hostname: %s\n", connecthost);
-	    err(theerror);
-	}
-	server.sin_family = he->h_addrtype;
-	server.sin_port = htons(connectport);
-	server.sin_addr.s_addr = ((unsigned long *) (he->h_addr_list[0]))[0];
+            err(theerror);
+        }
+	memcpy(&server, res->ai_addr, res->ai_addrlen);
+	freeaddrinfo(res);
     }
 
     con = malloc(concurrency * sizeof(struct connection));
@@@@ -1423,7 +1435,7 @@@@
     if (strlen(purl) > 8 && strncmp(purl, "https://", 8) == 0) {
 	purl += 8;
 	ssl = 1;
-	port = 443;
+	port = "443";
     }
 #else
     if (strlen(purl) > 8 && strncmp(purl, "https://", 8) == 0) {
@@@@ -1444,13 +1456,13 @@@@
     *cp = '\0';
     strcpy(hostname, h);
     if (p != NULL)
-	port = atoi(p);
+        port = strdup(p);
 
     if ((
 #ifdef USE_SSL
-	(ssl != 0) && (port != 443)) || ((ssl == 0) && 
+	(ssl != 0) && (atoi(port) != 443)) || ((ssl == 0) &&
 #endif
-	(port != 80))) 
+	(atoi(port) != 80)))
    {
 	ap_snprintf(colonport,sizeof(colonport),":%d",port);
    } else {
@@@@ -1698,3 +1710,7 @@@@
 
     exit(0);
 }
+
+#ifdef NEED_GETADDRINFO
+#include "../main/getaddrinfo.c"
+#endif
Index: src/usr.sbin/httpd/src/support/logresolve.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/support/logresolve.c,v
retrieving revision 1.5
diff -u -r1.5 logresolve.c
--- src/usr.sbin/httpd/src/support/logresolve.c	29 Mar 2002 02:07:46 -0000	1.5
+++ src/usr.sbin/httpd/src/support/logresolve.c	22 Mar 2003 14:37:11 -0000
@@@@ -1,3 +1,4 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
 /*
  * logresolve 1.1
  *
@@@@ -54,7 +55,9 @@@@
 #endif /* BEOS */
 #endif /* !MPE && !WIN32*/
 
-static void cgethost(struct in_addr ipnum, char *string, int check);
+#include "sa_len.h"
+
+static void cgethost(struct sockaddr *sa, char *string, int check);
 static int getline(char *s, int n);
 static void stats(FILE *output);
 
@@@@ -91,7 +94,7 @@@@
  */
 
 struct nsrec {
-    struct in_addr ipnum;
+    struct sockaddr_storage addr;
     char *hostname;
     int noname;
     struct nsrec *next;
@@@@ -122,17 +125,48 @@@@
  * IP numbers with their IP number as hostname, setting noname flag
  */
 
-static void cgethost (struct in_addr ipnum, char *string, int check)
+static void cgethost (struct sockaddr *sa, char *string, int check)
 {
+    u_int32_t hashval;
+    struct sockaddr_in *sin;
+#ifdef INET6
+    struct sockaddr_in6 *sin6;
+#endif
     struct nsrec **current, *new;
-    struct hostent *hostdata;
     char *name;
+    char hostnamebuf[MAXHOSTNAMELEN];
+
+    switch (sa->sa_family) {
+    case AF_INET:
+	hashval = ((struct sockaddr_in *)sa)->sin_addr.s_addr;
+	break;
+#ifdef INET6
+    case AF_INET6:
+	hashval = *(u_int32_t *)&((struct sockaddr_in6 *)sa)->sin6_addr.s6_addr[12];
+	break;
+#endif
+    default:
+	hashval = 0;
+	break;
+    }
 
-    current = &nscache[((ipnum.s_addr + (ipnum.s_addr >> 8) +
-			 (ipnum.s_addr >> 16) + (ipnum.s_addr >> 24)) % BUCKETS)];
+    current = &nscache[((hashval + (hashval >> 8) +
+			 (hashval >> 16) + (hashval >> 24)) % BUCKETS)];
+
+    while (*current) {
+#ifndef SIN6_LEN
+	if (SA_LEN(sa) == SA_LEN((struct sockaddr *)&(*current)->addr)
+	 && memcmp(sa, &(*current)->addr, SA_LEN(sa)) == 0)
+#else
+	if (sa->sa_len == (*current)->addr.ss_len
+	 && memcmp(sa, &(*current)->addr, sa->sa_len) == 0)
+#endif
+	{
+	    break;
+	}
 
-    while (*current != NULL && ipnum.s_addr != (*current)->ipnum.s_addr)
 	current = &(*current)->next;
+    }
 
     if (*current == NULL) {
 	cachesize++;
@@@@ -145,45 +179,55 @@@@
 	*current = new;
 	new->next = NULL;
 
-	new->ipnum = ipnum;
+#ifndef SIN6_LEN
+	memcpy(&new->addr, sa, SA_LEN(sa));
+#else
+	memcpy(&new->addr, sa, sa->sa_len);
+#endif
 
-	hostdata = gethostbyaddr((const char *) &ipnum, sizeof(struct in_addr),
-				 AF_INET);
-	if (hostdata == NULL) {
-	    if (h_errno > MAX_ERR)
-		errors[UNKNOWN_ERR]++;
-	    else
-		errors[h_errno]++;
-	    new->noname = h_errno;
-	    name = strdup(inet_ntoa(ipnum));
-	}
-	else {
-	    new->noname = 0;
-	    name = strdup(hostdata->h_name);
-	    if (check) {
-		if (name == NULL) {
-		    perror("strdup");
-		    fprintf(stderr, "Insufficient memory\n");
-		    exit(1);
-		}
-		hostdata = gethostbyname(name);
-		if (hostdata != NULL) {
-		    char **hptr;
-
-		    for (hptr = hostdata->h_addr_list; *hptr != NULL; hptr++)
-			if (((struct in_addr *) (*hptr))->s_addr == ipnum.s_addr)
-			    break;
-		    if (*hptr == NULL)
-			hostdata = NULL;
-		}
-		if (hostdata == NULL) {
-		    fprintf(stderr, "Bad host: %s != %s\n", name,
-			    inet_ntoa(ipnum));
-		    new->noname = NO_REVERSE;
-		    free(name);
-		    name = strdup(inet_ntoa(ipnum));
-		    errors[NO_REVERSE]++;
+	new->noname = getnameinfo(sa,
+#ifndef SIN6_LEN
+		SA_LEN(sa),
+#else
+		sa->sa_len,
+#endif
+		    hostnamebuf, sizeof(hostnamebuf), NULL, 0, 0);
+	name = strdup(hostnamebuf);
+	if (check) {
+	    struct addrinfo hints, *res;
+	    int error;
+	    memset(&hints, 0, sizeof(hints));
+	    hints.ai_family = PF_UNSPEC;
+	    error = getaddrinfo(hostnamebuf, NULL, &hints, &res);
+	    if (!error) {
+		while (res) {
+#ifndef SIN6_LEN
+		    if (SA_LEN(sa) == res->ai_addrlen
+		     && memcmp(sa, res->ai_addr, SA_LEN(sa)) == 0)
+#else
+		    if (sa->sa_len == res->ai_addrlen
+		     && memcmp(sa, res->ai_addr, sa->sa_len) == 0)
+#endif
+		    {
+			break;
+		    }
+		    res = res->ai_next;
 		}
+		if (!res)
+		    error++;
+	    }
+	    if (error) {
+		getnameinfo(sa,
+#ifndef SIN6_LEN
+		    SA_LEN(sa),
+#else
+		    sa->sa_len,
+#endif
+		    hostnamebuf, sizeof(hostnamebuf), NULL, 0, NI_NUMERICHOST);
+		fprintf(stderr, "Bad host: %s != %s\n", name, hostnamebuf);
+		new->noname = NO_REVERSE;
+		free(name);
+		name = strdup(hostnamebuf);
 	    }
 	}
 	new->hostname = name;
@@@@ -211,6 +255,7 @@@@
     char *ipstring;
     struct nsrec *current;
     char *errstring[MAX_ERR + 3];
+    char hostnamebuf[MAXHOSTNAMELEN];
 
     for (i = 0; i < MAX_ERR + 3; i++)
 	errstring[i] = "Unknown error";
@@@@ -242,7 +287,14 @@@@
 
     for (i = 0; i < BUCKETS; i++)
 	for (current = nscache[i]; current != NULL; current = current->next) {
-	    ipstring = inet_ntoa(current->ipnum);
+	    getnameinfo((struct sockaddr *)&current->addr,
+#ifndef SIN6_LEN
+		    SA_LEN((struct sockaddr *)&current->addr),
+#else
+		    current->addr.ss_len,
+#endif
+		    hostnamebuf, sizeof(hostnamebuf), NULL, 0, NI_NUMERICHOST);
+	    ipstring = hostnamebuf;
 	    if (current->noname == 0)
 		fprintf(output, "  %3d  %15s - %s\n", i, ipstring,
 			current->hostname);
@@@@ -276,9 +328,10 @@@@
 
 int main (int argc, char *argv[])
 {
-    struct in_addr ipnum;
     char *bar, hoststring[MAXDNAME + 1], line[MAXLINE], *statfile;
     int i, check;
+    struct addrinfo hints, *res;
+    int error;
 
 #ifdef WIN32
     WSADATA wsaData;
@@@@ -322,8 +375,10 @@@@
 	bar = strchr(line, ' ');
 	if (bar != NULL)
 	    *bar = '\0';
-	ipnum.s_addr = inet_addr(line);
-	if (ipnum.s_addr == 0xffffffffu) {
+	memset(&hints, 0, sizeof(hints));
+	hints.ai_family = PF_UNSPEC;
+	error = getaddrinfo(line, NULL, &hints, &res);
+	if (error) {
 	    if (bar != NULL)
 		*bar = ' ';
 	    puts(line);
@@@@ -333,11 +388,12 @@@@
 
 	resolves++;
 
-	cgethost(ipnum, hoststring, check);
+	cgethost(res->ai_addr, hoststring, check);
 	if (bar != NULL)
 	    printf("%s %s\n", hoststring, bar + 1);
 	else
 	    puts(hoststring);
+	freeaddrinfo(res);
     }
 
 #ifdef WIN32
@@@@ -358,3 +414,11 @@@@
 
     return (0);
 }
+
+#ifdef NEED_GETADDRINFO
+#include "../main/getaddrinfo.c"
+#endif
+
+#ifdef NEED_GETNAMEINFO
+#include "../main/getnameinfo.c"
+#endif
index: src/usr.sbin/httpd/src/include/sa_len.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/sa_len.h,v
retrieving revision DEAD
--- /dev/null	Sat Mar 22 14:34:57 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sat Mar 22 15:04:40 2003
@@@@ -0,0 +1,42 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
+/* sa_len.h : tiny version of SA_LEN (written by <yoshfuji@@ecei.tohoku.ac.jp>) */
+
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+#include <sys/un.h>
+
+#ifndef HAVE_SOCKADDR_LEN
+#ifndef SA_LEN
+#define SA_LEN(s_)	ap_sa_len((s_)->sa_family)
+
+static NET_SIZE_T ap_sa_len (sa_family_t af)
+{
+    switch (af){
+#if defined(AF_INET)
+    case AF_INET:
+	return (sizeof(struct sockaddr_in));
+#endif /* AF_INET */
+#if defined(AF_INET6)
+    case AF_INET6:
+	return (sizeof(struct sockaddr_in6));
+#endif
+#ifdef AF_LOCAL
+    case AF_LOCAL:
+#endif /* AF_LOCAL */
+#if defined(AF_UNIX) && (AF_UNIX != AF_LOCAL)
+    case AF_UNIX:
+#endif /* AF_UNIX */
+#if defined(AF_FILE) && (AF_FILE != AF_LOCAL || AF_FILE != AF_UNIX)
+    case AF_FILE:
+#endif /* AF_FILE */
+#if defined(AF_LOCAL) || defined(AF_UNIX) || defined(AF_FILE)
+	return (sizeof(struct sockaddr_un));
+#endif /* defined(AF_LOCAL) || defined(AF_UNIX) || defined(AF_FILE) */
+    default:
+	return 0;
+    }
+    return 0;
+}
+#endif /* SA_LEN */
+#endif /* HAVE_SOCKADDR_LEN */
index: src/usr.sbin/httpd/src/include/sockaddr_storage.h
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/include/sockaddr_storage.h,v
retrieving revision DEAD
--- /dev/null	Sat Mar 22 14:34:57 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sat Mar 22 14:39:12 2003
@@@@ -0,0 +1,54 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
+/*
+struct sockaddr_storage
+
+   RFC2553 proposes struct sockaddr_storage.
+   This is a placeholder for all sockaddr-variant structures. This is
+   implemented like follows:
+
+   You should use this structure to hold any of sockaddr-variant
+   structures.
+*/
+#ifdef NEED_SOCKADDR_STORAGE
+
+struct sockaddr_storage {
+#ifdef HAVE_SOCKADDR_LEN
+	u_char ss_len;
+	u_char ss_family;
+#else
+	u_short ss_family;
+#endif
+	u_char __padding[128 - 2];
+};
+
+/*
+union sockunion
+
+   Alternatively, you may want to implement sockunion.h, with the
+   following content:
+
+   NOTE: For better portability, struct sockaddr_storage should be used.
+   union sockunion is okay, but is not really portable enough.
+*/
+union sockunion {
+	struct sockinet {
+#ifdef HAVE_SOCKADDR_LEN
+		u_char si_len;
+		u_char si_family;
+#else
+		u_short si_family;
+#endif
+		u_short si_port;
+	} su_si;
+	struct sockaddr_in  su_sin;
+#ifdef INET6
+	struct sockaddr_in6 su_sin6;
+#endif
+};
+#ifdef HAVE_SOCKADDR_LEN
+#define su_len		su_si.si_len
+#endif
+#define su_family	su_si.si_family
+#define su_port		su_si.si_port
+
+#endif /* NEED_SOCKADDR_STORAGE */
index: src/usr.sbin/httpd/src/main/getaddrinfo.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/getaddrinfo.c,v
retrieving revision DEAD
--- /dev/null	Sat Mar 22 14:34:57 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sat Mar 22 15:04:38 2003
@@@@ -0,0 +1,163 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
+/*
+ * Copyright (C) 1995, 1996, 1997, 1998, and 1999 WIDE Project.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ * 3. Neither the name of the project nor the names of its contributors
+ *    may be used to endorse or promote products derived from this software
+ *    without specific prior written permission.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ */
+/*
+ * fake library for ssh v6 enabler patch
+ *
+ * This file includes getaddrinfo(), freeaddrinfo() and gai_strerror().
+ * These funtions are defined in rfc2133.
+ *
+ * But these functions are not implemented correctly. The minimum subset
+ * is implemented for ssh use only. For exapmle, this routine assumes
+ * that ai_family is AF_INET. Don't use it for another purpose.
+ *
+ * In the case not using 'configure --enable-ipv6', this getaddrinfo.c
+ * will be used if you have broken getaddrinfo or no getaddrinfo.
+ */
+
+#if 0
+#include <stdlib.h>
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+#include <arpa/inet.h>
+#include <netdb.h>
+#include "gai.h"
+#endif
+
+static struct addrinfo *
+malloc_ai(port, addr, socktype, protocol)
+int port;
+u_long addr;
+int socktype;
+int protocol;
+{
+  struct addrinfo *ai;
+
+  if (ai = (struct addrinfo *)malloc(sizeof(struct addrinfo) +
+				     sizeof(struct sockaddr_in))) {
+    memset(ai, 0, sizeof(struct addrinfo) + sizeof(struct sockaddr_in));
+    ai->ai_addr = (struct sockaddr *)(ai + 1);
+#if defined(HAVE_SOCKADDR_LEN)
+    ai->ai_addr->sa_len =
+#endif
+      ai->ai_addrlen = sizeof(struct sockaddr_in);
+    ai->ai_addr->sa_family = ai->ai_family = AF_INET;
+    ai->ai_socktype = socktype;
+    ai->ai_protocol = protocol;
+    ((struct sockaddr_in *)(ai)->ai_addr)->sin_port = port;
+    ((struct sockaddr_in *)(ai)->ai_addr)->sin_addr.s_addr = addr;
+    return ai;
+  } else {
+    return NULL;
+  }
+}
+
+char *
+gai_strerror(ecode)
+int ecode;
+{
+  switch (ecode) {
+  case EAI_NODATA:
+    return "no address associated with hostname.";
+  case EAI_MEMORY:
+    return "memory allocation failure.";
+  default:
+    return "unknown error.";
+  }
+}
+
+void
+freeaddrinfo(ai)
+struct addrinfo *ai;
+{
+  struct addrinfo *next;
+
+  do {
+    next = ai->ai_next;
+    free(ai);
+  } while (ai = next);
+}
+
+int
+getaddrinfo(hostname, servname, hints, res)
+const char *hostname, *servname;
+const struct addrinfo *hints;
+struct addrinfo **res;
+{
+  struct addrinfo *cur, *prev = NULL;
+  struct hostent *hp;
+  int i, port;
+
+  if (servname)
+    port = htons(atoi(servname));
+  else
+    port = 0;
+  if (hints && hints->ai_flags & AI_PASSIVE)
+    if (*res = malloc_ai(port, htonl(0x00000000),
+			 res->ai_socktype ? res->ai_socktype : SOCK_STREAM,
+			 res->ai_protocol))
+      return 0;
+    else
+      return EAI_MEMORY;
+  if (!hostname)
+    if (*res = malloc_ai(port, htonl(0x7f000001),
+			 res->ai_socktype ? res->ai_socktype : SOCK_STREAM,
+			 res->ai_protocol))
+      return 0;
+    else
+      return EAI_MEMORY;
+  if (inet_addr(hostname) != -1)
+    if (*res = malloc_ai(port, inet_addr(hostname),
+			 res->ai_socktype ? res->ai_socktype : SOCK_STREAM,
+			 res->ai_protocol))
+      return 0;
+    else
+      return EAI_MEMORY;
+  if ((hp = gethostbyname(hostname)) &&
+      hp->h_name && hp->h_name[0] && hp->h_addr_list[0]) {
+    for (i = 0; hp->h_addr_list[i]; i++)
+      if (cur = malloc_ai(port,
+			  ((struct in_addr *)hp->h_addr_list[i])->s_addr,
+			  res->ai_socktype ? res->ai_socktype : SOCK_STREAM,
+			  res->ai_protocol)) {
+	if (prev)
+	  prev->ai_next = cur;
+	else
+	  *res = cur;
+	prev = cur;
+      } else {
+	if (*res)
+	  freeaddrinfo(*res);
+	return EAI_MEMORY;
+      }
+    return 0;
+  }
+  return EAI_NODATA;
+}
index: src/usr.sbin/httpd/src/main/getnameinfo.c
===================================================================
RCS file: /cvs/src/usr.sbin/httpd/src/main/getnameinfo.c,v
retrieving revision DEAD
--- /dev/null	Sat Mar 22 14:34:57 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sat Mar 22 14:38:49 2003
@@@@ -0,0 +1,96 @@@@
+/*	$MirBSD: obsd.httpd,v 1.27 2003/03/22 22:33:25 tg Exp $	*/
+/*
+ * Copyright (C) 1995, 1996, 1997, 1998, and 1999 WIDE Project.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ * 3. Neither the name of the project nor the names of its contributors
+ *    may be used to endorse or promote products derived from this software
+ *    without specific prior written permission.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ */
+/*
+ * fake library for ssh v6 enabler patch
+ *
+ * This file includes getnameinfo().
+ * These funtions are defined in rfc2133.
+ *
+ * But these functions are not implemented correctly. The minimum subset
+ * is implemented for ssh use only. For exapmle, this routine assumes
+ * that ai_family is AF_INET. Don't use it for another purpose.
+ *
+ * In the case not using 'configure --enable-ipv6', this getnameinfo.c
+ * will be used if you have broken getnameinfo or no getnameinfo.
+ */
+
+#if 0
+#include <stdlib.h>
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+#include <arpa/inet.h>
+#include <netdb.h>
+#include <string.h>
+#include "gai.h"
+#endif
+
+int
+getnameinfo(sa, salen, host, hostlen, serv, servlen, flags)
+const struct sockaddr *sa;
+size_t salen;
+char *host;
+size_t hostlen;
+char *serv;
+size_t servlen;
+int flags;
+{
+  struct sockaddr_in *sin = (struct sockaddr_in *)sa;
+  struct hostent *hp;
+  char tmpserv[16];
+
+  if (serv) {
+    sprintf(tmpserv, "%d", ntohs(sin->sin_port));
+    if (strlen(tmpserv) > servlen)
+      return EAI_MEMORY;
+    else
+      strcpy(serv, tmpserv);
+  }
+  if (host)
+    if (flags & NI_NUMERICHOST)
+      if (strlen(inet_ntoa(sin->sin_addr)) > hostlen)
+	return EAI_MEMORY;
+      else {
+	strcpy(host, inet_ntoa(sin->sin_addr));
+	return 0;
+      }
+    else
+      if (hp = gethostbyaddr((char *)&sin->sin_addr, sizeof(struct in_addr),
+			     AF_INET))
+	if (strlen(hp->h_name) > hostlen)
+	  return EAI_MEMORY;
+	else {
+	  strcpy(host, hp->h_name);
+	  return 0;
+	}
+      else
+	return EAI_NODATA;
+  return 0;
+}

@


1.27
log
@- sync with repo
- rm fixed stuff
- tmp""ly add file list (for reference)
@
text
@d25 1
a25 1
+#	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $
d640 1
a640 1
+#	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $
d661 1
a661 1
+# $MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $
d815 1
a815 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d903 1
a903 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d925 1
a925 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1019 1
a1019 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1041 1
a1041 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1063 1
a1063 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1084 1
a1084 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1150 1
a1150 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1224 1
a1224 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1616 1
a1616 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d1999 1
a1999 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d2657 1
a2657 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d2806 1
a2806 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3002 1
a3002 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3064 1
a3064 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3171 1
a3171 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3235 1
a3235 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3256 1
a3256 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3456 1
a3456 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d3770 1
a3770 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d4051 1
a4051 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d4214 1
a4214 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d4617 1
a4617 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d4757 1
a4757 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d4922 1
a4922 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d5175 1
a5175 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d5224 1
a5224 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d5285 1
a5285 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
d5455 1
a5455 1
+/*	$MirBSD: obsd.httpd,v 1.26 2003/03/22 16:14:16 tg Exp $	*/
@


1.26
log
@intermediate, broken, does not even apply
cvs and jupp in combination can produce weird results
jupp should be audited, or rewritten even
@
text
@a0 23
>> http://templeofhate.com/tglaser/MirBSD/index.php
>> MirBSD is a modified version of OpenBSD (http://www.OpenBSD.org/)

Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
Copyright  1968-2003  The authors of And contributors to UNIX, the
    "C" Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.

Anyone who obtained a copy of this work is hereby permitted to freely use,
distribute, modify, merge, sublicence, give away or sell it as long as the
authors are given due credit and the following notice is retained:

This work is provided "as is", with no explicit or implicit warranty what-
soever. Use it only at your own risk. In no event may an author or contri-
butor be held liable for any damage, directly or indirectly, that origina-
ted through or is caused by creation or modification of this work.


This diff, ID $MirBSD: regen-obsdp.sh,v 1.15 2003/03/09 21:54:38 tg Exp $
(/usr/ports/mystuff/httpd-metafiles to obsd.httpd) is made
against CTM on Sat Mar 22 15:17:56 UTC 2003.

### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.15 2003/03/09 21:54:38 tg Exp $
### CTM OpenBSD-cvs 3132
d25 1
a25 1
+#	$MirBSD: obsd.httpd,v 1.25 2003/03/04 16:52:26 tg Exp $
d640 1
a640 1
+#	$MirBSD$
d661 1
a661 1
+# $MirBSD$
d815 1
a815 1
+/*	$MirBSD$	*/
d903 1
a903 1
+/*	$MirBSD$	*/
d925 1
a925 1
+/*	$MirBSD$	*/
d1019 1
a1019 1
+/*	$MirBSD$	*/
d1041 1
a1041 1
+/*	$MirBSD$	*/
d1063 1
a1063 1
+/*	$MirBSD$	*/
d1084 1
a1084 1
+/*	$MirBSD$	*/
d1150 1
a1150 1
+/*	$MirBSD$	*/
d1224 1
a1224 1
+/*	$MirBSD$	*/
d1616 1
a1616 1
+/*	$MirBSD$	*/
d1999 1
a1999 1
+/*	$MirBSD$	*/
d2657 1
a2657 1
+/*	$MirBSD$	*/
d2806 1
a2806 1
+/*	$MirBSD$	*/
d3002 1
a3002 1
+/*	$MirBSD$	*/
d3064 1
a3064 1
+/*	$MirBSD$	*/
d3171 1
a3171 1
+/*	$MirBSD$	*/
d3235 1
a3235 1
+/*	$MirBSD$	*/
d3256 1
a3256 1
+/*	$MirBSD$	*/
d3456 1
a3456 1
+/*	$MirBSD$	*/
d3770 1
a3770 1
+/*	$MirBSD$	*/
d4051 1
a4051 1
+/*	$MirBSD$	*/
d4214 1
a4214 1
+/*	$MirBSD$	*/
d4617 1
a4617 1
+/*	$MirBSD$	*/
d4757 1
a4757 1
+/*	$MirBSD$	*/
d4922 1
a4922 1
+/*	$MirBSD$	*/
d5175 1
a5175 1
+/*	$MirBSD$	*/
d5224 1
a5224 1
+/*	$MirBSD$	*/
d5285 1
a5285 1
+/*	$MirBSD$	*/
d5455 1
a5455 1
+/*	$MirBSD$	*/
a5551 62
Index: ports/mystuff/httpd-metafiles (meta file)
===================================================================
ports/mystuff/httpd-metafiles	.
ports/mystuff/httpd-patchfiles	.
ports/mystuff/httpd-addedfiles	.
ports/mystuff/httpd-notes	.
Index: ports/mystuff/httpd-patchfiles (meta file)
===================================================================
src/usr.sbin/httpd/Makefile.bsd-wrapper
src/usr.sbin/httpd/conf/httpd.conf
src/usr.sbin/httpd/conf/httpd.conf-dist
src/usr.sbin/httpd/htdocs/manual/mod/core.html.html
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis
src/usr.sbin/httpd/htdocs/manual/server-wide.html.en
src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr
src/usr.sbin/httpd/htdocs/manual/server-wide.html.html
src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis
src/usr.sbin/httpd/src/Configuration.tmpl
src/usr.sbin/httpd/src/Configure
src/usr.sbin/httpd/src/ap/ap_snprintf.c
src/usr.sbin/httpd/src/include/ap.h
src/usr.sbin/httpd/src/include/ap_config.h
src/usr.sbin/httpd/src/include/http_conf_globals.h
src/usr.sbin/httpd/src/include/http_core.h
src/usr.sbin/httpd/src/include/http_vhost.h
src/usr.sbin/httpd/src/include/httpd.h
src/usr.sbin/httpd/src/main/http_config.c
src/usr.sbin/httpd/src/main/http_core.c
src/usr.sbin/httpd/src/main/http_main.c
src/usr.sbin/httpd/src/main/http_vhost.c
src/usr.sbin/httpd/src/main/rfc1413.c
src/usr.sbin/httpd/src/main/util.c
src/usr.sbin/httpd/src/main/util_script.c
src/usr.sbin/httpd/src/main/util_uri.c
src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c
src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h
src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c
src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c
src/usr.sbin/httpd/src/modules/proxy/proxy_http.c
src/usr.sbin/httpd/src/modules/proxy/proxy_util.c
src/usr.sbin/httpd/src/modules/standard/mod_access.c
src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c
src/usr.sbin/httpd/src/support/ab.c
src/usr.sbin/httpd/src/support/logresolve.c
Index: ports/mystuff/httpd-addedfiles (meta file)
===================================================================
src/usr.sbin/httpd/src/include/sa_len.h			IPv6
src/usr.sbin/httpd/src/include/sockaddr_storage.h	IPv6
src/usr.sbin/httpd/src/main/getaddrinfo.c		IPv6
src/usr.sbin/httpd/src/main/getnameinfo.c		IPv6
Index: ports/mystuff/httpd-notes (meta file)
===================================================================
. add -I${.CURDIR} to many CFLAGS where missing (gcc 3.2 is more picky)
. add new ulimit (humantime) (Jedi/Sector one)
. fix stuff done to pristine apache that breaks IPv6
. make Apache IPv6, will not RSN committed (security issues)
. plus everything I've forgotten
. sync config with what I am going to use
@


1.25
log
@the usual sync/update post-release
pre-build
@
text
@d5 2
a6 5
Copyright  1968-2003 NOP by the authors of and contributors to AT&T
    UNIX; the "C" Language, xBSD/Berkeley Unix; 386BSD, NetBSD 1.1,
    OpenBSD and MirBSD. The licence conditions of specific files be-
    fore patching also applies to the patched unless the file is re-
    placed in its entirety.
d8 3
a10 3
I hereby permit everyone who obtained a copy of this work to distri-
bute, sell, give away, modify, sublicense, merge and use it, freely.
I retain the right to be known as an author of the work.
d12 4
a15 5
The work is provided "as is", with no explicit or implicit warranty.
Use at your own risk. Neither author nor any contributor may be held
liable for any damage, directly or indirectly, which originated thru
creation or modification of this work. Because computing devices are
error-prone, flawless behaviour cannot be expected.
d18 1
a18 1
This diff, ID $MirBSD: regen-obsdp.sh,v 1.14 2003/03/01 22:12:48 tg Exp $
d20 1
a20 1
against CTM on Tue Mar  4 16:46:58 UTC 2003.
d22 2
a23 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.14 2003/03/01 22:12:48 tg Exp $
### CTM OpenBSD-cvs 3085
d30 1
a30 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	2 Mar 2003 01:08:46 -0000
d46 1
a46 1
+++ src/usr.sbin/httpd/conf/httpd.conf	2 Mar 2003 01:08:46 -0000
d48 1
a48 1
+#	$MirBSD: obsd.httpd,v 1.24 2003/03/02 01:08:32 tg Exp $
d93 9
d398 1
a398 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	2 Mar 2003 01:08:46 -0000
d420 1
a420 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	2 Mar 2003 01:08:46 -0000
d496 1
a496 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	2 Mar 2003 01:08:47 -0000
d511 1
a511 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	2 Mar 2003 01:08:47 -0000
d527 1
a527 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	2 Mar 2003 01:08:47 -0000
d543 1
a543 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	2 Mar 2003 01:08:47 -0000
d572 1
a572 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	2 Mar 2003 01:08:47 -0000
d588 1
a588 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	2 Mar 2003 01:08:47 -0000
d603 1
a603 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	2 Mar 2003 01:08:47 -0000
d618 1
a618 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	2 Mar 2003 01:08:47 -0000
d646 1
a646 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	2 Mar 2003 01:08:47 -0000
d661 7
a667 2
+++ src/usr.sbin/httpd/src/Configuration.tmpl	2 Mar 2003 01:08:47 -0000
@@@@ -243,6 +243,7 @@@@
d681 8
a688 2
+++ src/usr.sbin/httpd/src/Configure	2 Mar 2003 01:08:47 -0000
@@@@ -240,6 +240,7 @@@@
d696 1
a696 1
@@@@ -1663,7 +1664,7 @@@@
d705 1
a705 1
@@@@ -1718,6 +1719,124 @@@@
d836 7
a842 2
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	2 Mar 2003 01:08:47 -0000
@@@@ -76,6 +76,7 @@@@
d850 1
a850 1
@@@@ -505,6 +506,42 @@@@
d893 1
a893 1
@@@@ -1056,6 +1093,7 @@@@
d901 1
a901 1
@@@@ -1064,6 +1102,16 @@@@
d924 7
a930 2
+++ src/usr.sbin/httpd/src/include/ap.h	2 Mar 2003 01:08:47 -0000
@@@@ -95,7 +95,8 @@@@
d946 7
a952 2
+++ src/usr.sbin/httpd/src/include/ap_config.h	2 Mar 2003 01:08:47 -0000
@@@@ -409,6 +409,10 @@@@
d963 1
a963 1
@@@@ -1517,6 +1521,70 @@@@
d1040 7
a1046 2
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	2 Mar 2003 01:08:47 -0000
@@@@ -82,7 +82,8 @@@@
d1062 8
a1069 2
+++ src/usr.sbin/httpd/src/include/http_core.h	2 Mar 2003 01:08:47 -0000
@@@@ -278,6 +278,9 @@@@
d1072 1
a1072 1
 #endif
d1075 1
a1075 1
+#endif
a1077 1
 #endif
d1084 7
a1090 2
+++ src/usr.sbin/httpd/src/include/http_vhost.h	2 Mar 2003 01:08:47 -0000
@@@@ -73,7 +73,7 @@@@
d1105 7
a1111 2
+++ src/usr.sbin/httpd/src/include/httpd.h	2 Mar 2003 01:08:47 -0000
@@@@ -64,6 +64,13 @@@@
d1125 1
a1125 1
@@@@ -903,8 +910,8 @@@@
d1136 1
a1136 1
@@@@ -946,8 +953,8 @@@@
d1147 1
a1147 1
@@@@ -1015,7 +1022,7 @@@@
d1156 1
a1156 1
@@@@ -1183,7 +1190,7 @@@@
d1171 7
a1177 2
+++ src/usr.sbin/httpd/src/main/http_config.c	2 Mar 2003 01:08:50 -0000
@@@@ -1599,7 +1599,6 @@@@
d1185 1
a1185 1
@@@@ -1632,7 +1631,13 @@@@
d1200 1
a1200 1
@@@@ -1651,21 +1656,33 @@@@
d1245 7
a1251 2
+++ src/usr.sbin/httpd/src/main/http_core.c	2 Mar 2003 01:08:50 -0000
@@@@ -73,6 +73,7 @@@@
d1259 1
a1259 1
@@@@ -143,6 +144,9 @@@@
d1269 1
a1269 1
@@@@ -276,6 +280,11 @@@@
d1281 1
a1281 1
@@@@ -641,7 +650,9 @@@@
d1292 1
a1292 1
@@@@ -653,30 +664,51 @@@@
d1359 1
a1359 1
@@@@ -698,10 +730,14 @@@@
d1378 1
a1378 1
@@@@ -779,6 +815,7 @@@@
d1386 1
a1386 1
@@@@ -788,23 +825,22 @@@@
d1422 1
a1422 1
@@@@ -823,11 +859,13 @@@@
d1441 1
a1441 1
@@@@ -2503,7 +2541,7 @@@@
d1450 1
a1450 1
@@@@ -2559,7 +2597,7 @@@@
d1459 1
a1459 1
@@@@ -2578,6 +2616,15 @@@@
d1475 1
a1475 1
@@@@ -2604,12 +2651,25 @@@@
d1502 1
a1502 1
@@@@ -2641,44 +2701,70 @@@@
d1599 1
a1599 1
@@@@ -3407,6 +3493,13 @@@@
d1613 1
a1613 1
@@@@ -3427,7 +3520,7 @@@@
d1622 1
a1622 1
@@@@ -3461,7 +3554,7 @@@@
d1637 7
a1643 2
+++ src/usr.sbin/httpd/src/main/http_main.c	2 Mar 2003 01:08:50 -0000
@@@@ -129,6 +129,8 @@@@
d1652 1
a1652 1
@@@@ -254,7 +256,12 @@@@
d1666 1
a1666 1
@@@@ -1400,7 +1407,11 @@@@
d1679 1
a1679 1
@@@@ -1427,6 +1438,10 @@@@
d1690 1
a1690 1
@@@@ -3611,11 +3626,13 @@@@
d1706 1
a1706 1
@@@@ -3624,17 +3641,30 @@@@
d1743 1
a1743 1
@@@@ -3685,21 +3715,47 @@@@
d1799 1
a1799 1
@@@@ -3802,15 +3858,19 @@@@
d1823 1
a1823 1
@@@@ -3823,7 +3883,7 @@@@
d1832 1
a1832 1
@@@@ -3976,15 +4036,17 @@@@
d1854 1
a1854 1
@@@@ -4300,8 +4362,8 @@@@
d1865 1
a1865 1
@@@@ -4477,7 +4539,7 @@@@
d1874 1
a1874 1
@@@@ -4640,7 +4702,7 @@@@
d1883 1
a1883 1
@@@@ -4685,8 +4747,8 @@@@
d1894 1
a1894 1
@@@@ -4841,12 +4903,13 @@@@
d1911 1
a1911 1
@@@@ -5509,7 +5572,10 @@@@
d1923 1
a1923 1
@@@@ -5587,8 +5653,14 @@@@
d1940 1
a1940 1
@@@@ -5680,9 +5752,10 @@@@
d1952 1
a1952 1
@@@@ -5737,25 +5810,32 @@@@
d1990 1
a1990 1
@@@@ -7990,7 +8070,11 @@@@
d2003 1
a2003 1
@@@@ -8008,6 +8092,10 @@@@
d2020 7
a2026 2
+++ src/usr.sbin/httpd/src/main/http_vhost.c	2 Mar 2003 01:08:50 -0000
@@@@ -68,6 +68,7 @@@@
d2034 1
a2034 1
@@@@ -165,78 +166,114 @@@@
d2198 1
a2198 1
@@@@ -250,7 +287,8 @@@@
d2208 1
a2208 1
@@@@ -268,10 +306,11 @@@@
d2222 1
a2222 1
@@@@ -345,6 +384,19 @@@@
d2242 1
a2242 1
@@@@ -372,25 +424,77 @@@@
d2330 1
a2330 1
@@@@ -416,21 +520,7 @@@@
d2353 1
a2353 1
@@@@ -558,10 +648,37 @@@@
d2393 1
a2393 1
@@@@ -588,12 +705,45 @@@@
d2444 1
a2444 1
@@@@ -606,10 +756,11 @@@@
d2458 1
a2458 1
@@@@ -646,19 +797,33 @@@@
d2497 1
a2497 1
@@@@ -705,35 +870,58 @@@@
d2579 1
a2579 1
@@@@ -748,7 +936,7 @@@@
d2588 1
a2588 1
@@@@ -851,11 +1039,25 @@@@
d2615 1
a2615 1
@@@@ -910,7 +1112,22 @@@@
d2639 1
a2639 1
@@@@ -970,10 +1187,22 @@@@
d2664 1
a2664 1
@@@@ -991,6 +1220,7 @@@@
d2678 7
a2684 2
+++ src/usr.sbin/httpd/src/main/rfc1413.c	2 Mar 2003 01:08:50 -0000
@@@@ -82,6 +82,7 @@@@
d2692 1
a2692 1
@@@@ -109,12 +110,13 @@@@
d2710 1
a2710 1
@@@@ -129,16 +131,47 @@@@
d2765 1
a2765 1
@@@@ -149,12 +182,18 @@@@
d2788 1
a2788 1
@@@@ -219,9 +258,9 @@@@
d2800 1
a2800 1
@@@@ -243,7 +282,7 @@@@
d2809 1
a2809 1
@@@@ -256,8 +295,10 @@@@
d2827 7
a2833 2
+++ src/usr.sbin/httpd/src/main/util.c	2 Mar 2003 01:08:50 -0000
@@@@ -2017,52 +2017,87 @@@@
d2946 1
a2946 1
@@@@ -2090,7 +2125,8 @@@@
d2956 1
a2956 1
@@@@ -2103,23 +2139,22 @@@@
d2996 1
a2996 1
@@@@ -2131,6 +2166,8 @@@@
d3005 1
a3005 1
@@@@ -2373,3 +2410,11 @@@@
d3023 7
a3029 2
+++ src/usr.sbin/httpd/src/main/util_script.c	2 Mar 2003 01:08:50 -0000
@@@@ -67,6 +67,7 @@@@
d3037 1
a3037 1
@@@@ -203,6 +204,7 @@@@
d3045 1
a3045 1
@@@@ -294,8 +296,16 @@@@
d3064 1
a3064 1
@@@@ -749,6 +759,14 @@@@
d3085 7
a3091 2
+++ src/usr.sbin/httpd/src/main/util_uri.c	2 Mar 2003 01:08:50 -0000
@@@@ -410,45 +410,50 @@@@
d3172 1
a3172 1
@@@@ -475,7 +480,12 @@@@
d3192 7
a3198 2
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	2 Mar 2003 01:08:50 -0000
@@@@ -574,11 +574,31 @@@@
d3232 1
a3232 1
@@@@ -589,7 +609,7 @@@@
d3241 1
a3241 1
@@@@ -602,7 +622,7 @@@@
d3256 7
a3262 2
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	2 Mar 2003 01:08:50 -0000
@@@@ -310,7 +310,7 @@@@
d3277 7
a3283 2
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	2 Mar 2003 01:08:50 -0000
@@@@ -113,14 +113,15 @@@@
d3303 1
a3303 1
@@@@ -128,27 +129,60 @@@@
d3376 1
a3376 1
@@@@ -159,56 +193,62 @@@@
d3477 7
a3483 2
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	2 Mar 2003 01:08:50 -0000
@@@@ -62,6 +62,7 @@@@
d3491 1
a3491 1
@@@@ -555,8 +556,10 @@@@
d3504 1
a3504 1
@@@@ -577,11 +580,18 @@@@
d3524 1
a3524 1
@@@@ -658,19 +668,22 @@@@
d3560 1
a3560 1
@@@@ -688,32 +701,19 @@@@
d3600 1
a3600 1
@@@@ -944,7 +944,7 @@@@
d3609 1
a3609 1
@@@@ -961,11 +961,21 @@@@
d3633 1
a3633 1
@@@@ -976,7 +986,7 @@@@
d3642 1
a3642 1
@@@@ -1004,10 +1014,14 @@@@
d3661 1
a3661 1
@@@@ -1017,6 +1031,64 @@@@
d3726 1
a3726 1
@@@@ -1025,14 +1097,14 @@@@
d3743 1
a3743 1
@@@@ -1048,13 +1120,28 @@@@
d3776 1
a3776 1
@@@@ -1308,7 +1395,7 @@@@
d3791 7
a3797 2
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	2 Mar 2003 01:08:50 -0000
@@@@ -156,9 +156,6 @@@@
d3807 1
a3807 1
@@@@ -170,6 +167,8 @@@@
d3816 1
a3816 1
@@@@ -184,9 +183,6 @@@@
d3826 1
a3826 1
@@@@ -194,6 +190,8 @@@@
d3835 1
a3835 1
@@@@ -213,7 +211,25 @@@@
d3862 1
a3862 1
@@@@ -222,80 +238,91 @@@@
d4002 1
a4002 1
@@@@ -597,31 +624,44 @@@@
d4072 7
a4078 2
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	2 Mar 2003 01:08:50 -0000
@@@@ -64,6 +64,7 @@@@
d4086 1
a4086 1
@@@@ -219,6 +220,7 @@@@
d4094 1
a4094 1
@@@@ -257,40 +259,63 @@@@
d4179 1
a4179 1
@@@@ -1359,22 +1384,45 @@@@
d4235 7
a4241 2
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	2 Mar 2003 01:08:50 -0000
@@@@ -74,7 +74,10 @@@@
d4253 1
a4253 1
@@@@ -82,9 +85,15 @@@@
d4271 1
a4271 1
@@@@ -167,90 +176,230 @@@@
d4564 1
a4564 1
@@@@ -315,12 +464,63 @@@@
d4638 7
a4644 2
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	2 Mar 2003 01:08:50 -0000
@@@@ -67,10 +67,20 @@@@
d4666 1
a4666 1
@@@@ -142,7 +152,7 @@@@
d4675 1
a4675 1
@@@@ -221,7 +231,8 @@@@
d4685 1
a4685 1
@@@@ -232,8 +243,8 @@@@
d4696 1
a4696 1
@@@@ -269,17 +280,44 @@@@
d4746 1
a4746 1
@@@@ -336,7 +374,24 @@@@
d4778 7
a4784 2
+++ src/usr.sbin/httpd/src/support/ab.c	2 Mar 2003 01:08:50 -0000
@@@@ -158,6 +158,8 @@@@
d4793 1
a4793 1
@@@@ -262,7 +264,7 @@@@
d4802 1
a4802 1
@@@@ -299,7 +301,7 @@@@
d4811 1
a4811 1
@@@@ -525,7 +527,7 @@@@
d4820 1
a4820 1
@@@@ -878,7 +880,7 @@@@
d4829 1
a4829 1
@@@@ -895,11 +897,16 @@@@
d4851 1
a4851 1
@@@@ -1203,7 +1210,7 @@@@
d4860 1
a4860 1
@@@@ -1214,8 +1221,8 @@@@
d4871 1
a4871 1
@@@@ -1226,17 +1233,21 @@@@
d4903 1
a4903 1
@@@@ -1423,7 +1434,7 @@@@
d4912 1
a4912 1
@@@@ -1444,13 +1455,13 @@@@
d4929 1
a4929 1
@@@@ -1698,3 +1709,7 @@@@
d4943 7
a4949 2
+++ src/usr.sbin/httpd/src/support/logresolve.c	2 Mar 2003 01:08:50 -0000
@@@@ -54,7 +54,9 @@@@
d4960 1
a4960 1
@@@@ -91,7 +93,7 @@@@
d4969 1
a4969 1
@@@@ -122,17 +124,48 @@@@
a4998 3
+
+    current = &nscache[((hashval + (hashval >> 8) +
+			 (hashval >> 16) + (hashval >> 24)) % BUCKETS)];
d5002 3
d5023 1
a5023 1
@@@@ -145,45 +178,55 @@@@
d5116 1
a5116 1
@@@@ -211,6 +254,7 @@@@
d5124 1
a5124 1
@@@@ -242,7 +286,14 @@@@
d5140 1
a5140 1
@@@@ -276,9 +327,10 @@@@
d5152 1
a5152 1
@@@@ -322,8 +374,10 @@@@
d5165 1
a5165 1
@@@@ -333,11 +387,12 @@@@
d5179 1
a5179 1
@@@@ -358,3 +413,11 @@@@
d5195 4
a5198 3
--- /dev/null	Tue Mar  4 16:46:20 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sun Mar  2 01:08:51 2003
@@@@ -0,0 +1,41 @@@@
d5244 4
a5247 3
--- /dev/null	Tue Mar  4 16:46:20 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sun Mar  2 01:08:51 2003
@@@@ -0,0 +1,53 @@@@
d5305 4
a5308 3
--- /dev/null	Tue Mar  4 16:46:20 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sun Mar  2 01:08:51 2003
@@@@ -0,0 +1,162 @@@@
d5475 4
a5478 3
--- /dev/null	Tue Mar  4 16:46:20 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sun Mar  2 01:08:51 2003
@@@@ -0,0 +1,95 @@@@
@


1.24
log
@pre-build Sn#3-RC2

1914 KiB
@
text
@d24 1
a24 1
against anoncvs@@anoncvs.comstyle.com:/cvs on Sat Mar  1 20:45:58 UTC 2003.
d27 1
d33 2
a34 2
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	2003/02/10 21:28:26	1.39
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	2003/03/02 00:58:30
d49 2
a50 2
--- src/usr.sbin/httpd/conf/httpd.conf	2002/10/06 12:00:21	1.15
+++ src/usr.sbin/httpd/conf/httpd.conf	2003/03/02 00:58:31
d52 1
a52 1
+#	$MirBSD: obsd.httpd,v 1.23 2003/03/01 13:16:05 tg Exp $
d392 2
a393 2
--- src/usr.sbin/httpd/conf/httpd.conf-dist	2002/10/07 20:23:06	1.14
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	2003/03/02 00:58:33
d414 2
a415 2
--- src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	2002/10/07 21:04:44	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	2003/03/02 00:58:35
d490 2
a491 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	2002/02/12 07:56:47	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	2003/03/02 00:58:35
d505 2
a506 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	2002/10/07 21:04:44	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	2003/03/02 00:58:36
d521 2
a522 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	2002/02/12 07:56:47	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	2003/03/02 00:58:36
d537 2
a538 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	2002/10/07 21:04:44	1.3
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	2003/03/02 00:58:36
d566 2
a567 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	2002/10/07 21:04:44	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	2003/03/02 00:58:36
d582 2
a583 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	2002/02/12 07:56:47	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	2003/03/02 00:58:36
d597 2
a598 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	2002/02/12 07:56:47	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	2003/03/02 00:58:37
d612 2
a613 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	2002/02/12 07:56:47	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	2003/03/02 00:58:37
d640 2
a641 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	2002/07/19 21:31:14	1.3
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	2003/03/02 00:58:38
d655 2
a656 2
--- src/usr.sbin/httpd/src/Configuration.tmpl	2002/02/12 07:56:49	1.9
+++ src/usr.sbin/httpd/src/Configuration.tmpl	2003/03/02 00:58:38
d670 2
a671 2
--- src/usr.sbin/httpd/src/Configure	2002/10/07 20:23:06	1.21
+++ src/usr.sbin/httpd/src/Configure	2003/03/02 00:58:39
d819 2
a820 2
--- src/usr.sbin/httpd/src/ap/ap_snprintf.c	2002/12/11 17:22:56	1.9
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	2003/03/02 00:58:40
d902 2
a903 2
--- src/usr.sbin/httpd/src/include/ap.h	2002/10/07 20:23:06	1.9
+++ src/usr.sbin/httpd/src/include/ap.h	2003/03/02 00:58:40
d919 2
a920 2
--- src/usr.sbin/httpd/src/include/ap_config.h	2002/09/10 17:49:21	1.15
+++ src/usr.sbin/httpd/src/include/ap_config.h	2003/03/02 00:58:42
d1008 2
a1009 2
--- src/usr.sbin/httpd/src/include/http_conf_globals.h	2002/10/07 20:23:06	1.10
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	2003/03/02 00:58:42
d1025 2
a1026 2
--- src/usr.sbin/httpd/src/include/http_core.h	2002/03/29 02:08:05	1.7
+++ src/usr.sbin/httpd/src/include/http_core.h	2003/03/02 00:58:42
d1042 2
a1043 2
--- src/usr.sbin/httpd/src/include/http_vhost.h	2002/03/29 02:08:05	1.5
+++ src/usr.sbin/httpd/src/include/http_vhost.h	2003/03/02 00:58:42
d1058 2
a1059 2
--- src/usr.sbin/httpd/src/include/httpd.h	2002/10/07 20:23:06	1.17
+++ src/usr.sbin/httpd/src/include/httpd.h	2003/03/02 00:58:43
d1119 2
a1120 2
--- src/usr.sbin/httpd/src/main/http_config.c	2002/10/07 20:23:06	1.12
+++ src/usr.sbin/httpd/src/main/http_config.c	2003/03/02 00:58:44
d1188 2
a1189 2
--- src/usr.sbin/httpd/src/main/http_core.c	2002/10/07 20:23:06	1.14
+++ src/usr.sbin/httpd/src/main/http_core.c	2003/03/02 00:58:47
d1426 2
a1427 1
+
d1430 1
a1430 2
 
-    ap_bind_address.s_addr = ap_get_virthost_addr(arg, NULL);
d1575 2
a1576 2
--- src/usr.sbin/httpd/src/main/http_main.c	2003/02/16 17:16:12	1.28
+++ src/usr.sbin/httpd/src/main/http_main.c	2003/03/02 00:58:53
d1903 2
a1904 1
+	}
d1910 1
a1910 2
 	}
-	server_conf->port = ntohs(((struct sockaddr_in *) &sa_server)->sin_port);
d1953 2
a1954 2
--- src/usr.sbin/httpd/src/main/http_vhost.c	2002/03/29 02:08:06	1.6
+++ src/usr.sbin/httpd/src/main/http_vhost.c	2003/03/02 00:58:53
d2075 2
a2077 2
-    hep = gethostbyname(w);
 
d2544 1
a2544 1
@@@@ -910,8 +1112,23 @@@@
d2550 1
a2550 1
 
d2565 1
a2565 1
+
a2567 1
      * get the right host attached to a non- Host-sending request.
d2606 2
a2607 2
--- src/usr.sbin/httpd/src/main/rfc1413.c	2002/03/29 02:08:06	1.6
+++ src/usr.sbin/httpd/src/main/rfc1413.c	2003/03/02 00:58:54
d2750 2
a2751 2
--- src/usr.sbin/httpd/src/main/util.c	2002/12/11 12:22:57	1.13
+++ src/usr.sbin/httpd/src/main/util.c	2003/03/02 00:58:55
d2941 2
a2942 2
--- src/usr.sbin/httpd/src/main/util_script.c	2002/10/07 20:23:06	1.10
+++ src/usr.sbin/httpd/src/main/util_script.c	2003/03/02 00:58:57
d2998 2
a2999 2
--- src/usr.sbin/httpd/src/main/util_uri.c	2002/07/19 21:31:16	1.6
+++ src/usr.sbin/httpd/src/main/util_uri.c	2003/03/02 00:58:57
d3100 2
a3101 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	2002/07/30 10:51:48	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	2003/03/02 00:58:57
d3159 2
a3160 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	2002/07/19 21:31:16	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	2003/03/02 00:58:58
d3175 2
a3176 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	2002/07/19 21:31:16	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	2003/03/02 00:58:58
d3312 1
a3312 6
+    sock = i = -1;
+    for (res = res0; res; res = res->ai_next) {
+	sock = ap_psocket(r->pool, res->ai_family, res->ai_socktype, res->ai_protocol);
+	if (sock == -1)
+	    continue;
 
d3322 6
a3327 1
-
d3370 2
a3371 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	2002/07/19 21:31:16	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	2003/03/02 00:58:59
d3413 1
a3413 2
@@@@ -657,20 +667,23 @@@@
     parms = strchr(path, ';');
d3416 1
a3416 1
-
d3423 1
a3423 1
 
d3679 2
a3680 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	2002/10/07 20:23:06	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	2003/03/02 00:58:59
d3857 1
a3857 1
-
d3861 1
a3861 1
 
d3955 2
a3956 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	2002/10/07 20:23:06	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	2003/03/02 00:59:00
d4113 2
a4114 2
--- src/usr.sbin/httpd/src/modules/standard/mod_access.c	2002/03/29 02:08:06	1.5
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	2003/03/02 00:59:02
d4160 3
a4162 1
+
d4170 1
a4170 3
 
-	if (!is_ip(where)
-	    || (a->x.ip.net = ap_inet_addr(where)) == INADDR_NONE) {
d4231 1
a4231 1
-	    }
d4239 1
a4239 1
 	    }
d4511 2
a4512 2
--- src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	2002/03/29 02:08:07	1.6
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	2003/03/02 00:59:02
d4646 2
a4647 2
--- src/usr.sbin/httpd/src/support/ab.c	2002/10/07 20:23:06	1.10
+++ src/usr.sbin/httpd/src/support/ab.c	2003/03/02 00:59:02
d4806 2
a4807 2
--- src/usr.sbin/httpd/src/support/logresolve.c	2002/03/29 02:08:08	1.5
+++ src/usr.sbin/httpd/src/support/logresolve.c	2003/03/02 00:59:02
d5054 2
a5055 2
--- /dev/null	Sun Mar  2 00:56:39 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sat Mar  1 13:40:37 2003
d5102 2
a5103 2
--- /dev/null	Sun Mar  2 00:56:39 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sat Mar  1 13:40:37 2003
d5162 2
a5163 2
--- /dev/null	Sun Mar  2 00:56:39 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sat Mar  1 13:40:37 2003
d5331 2
a5332 2
--- /dev/null	Sun Mar  2 00:56:39 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sat Mar  1 13:40:37 2003
@


1.23
log
@pre-build

fix ELF, file lists, domain, misc. stuff
@
text
@d9 1
a9 1
    placed in its entirety (not easily distinguishable in the diff).
d22 1
a22 1
This diff, ID $MirBSD: regen-obsdp.sh,v 1.13 2003/02/28 22:52:54 tg Exp $
d24 1
a24 1
against CTM on Sat Mar  1 13:07:31 UTC 2003.
d26 1
a26 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.13 2003/02/28 22:52:54 tg Exp $
### CTM OpenBSD-cvs 3075
d32 2
a33 2
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	10 Feb 2003 21:28:04 -0000	1.39
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	1 Mar 2003 10:26:03 -0000
d48 2
a49 2
--- src/usr.sbin/httpd/conf/httpd.conf	6 Oct 2002 11:59:59 -0000	1.15
+++ src/usr.sbin/httpd/conf/httpd.conf	1 Mar 2003 10:26:03 -0000
d51 1
a51 1
+#	$MirBSD: obsd.httpd,v 1.22 2003/03/01 10:05:33 tg Exp $
d391 2
a392 2
--- src/usr.sbin/httpd/conf/httpd.conf-dist	7 Oct 2002 20:22:44 -0000	1.14
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	1 Mar 2003 10:26:03 -0000
d413 2
a414 2
--- src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	1 Mar 2003 10:26:03 -0000
d489 2
a490 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	12 Feb 2002 07:56:25 -0000	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	1 Mar 2003 10:26:03 -0000
d504 2
a505 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	1 Mar 2003 10:26:03 -0000
d520 2
a521 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	12 Feb 2002 07:56:25 -0000	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	1 Mar 2003 10:26:03 -0000
d536 2
a537 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	7 Oct 2002 21:04:22 -0000	1.3
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	1 Mar 2003 10:26:03 -0000
d565 2
a566 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	1 Mar 2003 10:26:03 -0000
d581 2
a582 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	1 Mar 2003 10:26:03 -0000
d596 2
a597 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	1 Mar 2003 10:26:03 -0000
d611 2
a612 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	1 Mar 2003 10:26:03 -0000
d639 2
a640 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	19 Jul 2002 21:30:52 -0000	1.3
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	1 Mar 2003 10:26:03 -0000
d654 2
a655 2
--- src/usr.sbin/httpd/src/Configuration.tmpl	12 Feb 2002 07:56:27 -0000	1.9
+++ src/usr.sbin/httpd/src/Configuration.tmpl	1 Mar 2003 10:26:03 -0000
d669 2
a670 2
--- src/usr.sbin/httpd/src/Configure	7 Oct 2002 20:22:44 -0000	1.21
+++ src/usr.sbin/httpd/src/Configure	1 Mar 2003 10:26:03 -0000
d818 2
a819 2
--- src/usr.sbin/httpd/src/ap/ap_snprintf.c	11 Dec 2002 17:22:34 -0000	1.9
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	1 Mar 2003 10:26:03 -0000
d901 2
a902 2
--- src/usr.sbin/httpd/src/include/ap.h	7 Oct 2002 20:22:44 -0000	1.9
+++ src/usr.sbin/httpd/src/include/ap.h	1 Mar 2003 10:26:04 -0000
d918 2
a919 2
--- src/usr.sbin/httpd/src/include/ap_config.h	10 Sep 2002 17:48:59 -0000	1.15
+++ src/usr.sbin/httpd/src/include/ap_config.h	1 Mar 2003 10:26:04 -0000
d1007 2
a1008 2
--- src/usr.sbin/httpd/src/include/http_conf_globals.h	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	1 Mar 2003 10:26:04 -0000
d1024 2
a1025 2
--- src/usr.sbin/httpd/src/include/http_core.h	29 Mar 2002 02:07:43 -0000	1.7
+++ src/usr.sbin/httpd/src/include/http_core.h	1 Mar 2003 10:26:04 -0000
d1041 2
a1042 2
--- src/usr.sbin/httpd/src/include/http_vhost.h	29 Mar 2002 02:07:43 -0000	1.5
+++ src/usr.sbin/httpd/src/include/http_vhost.h	1 Mar 2003 10:26:04 -0000
d1057 2
a1058 2
--- src/usr.sbin/httpd/src/include/httpd.h	7 Oct 2002 20:22:44 -0000	1.17
+++ src/usr.sbin/httpd/src/include/httpd.h	1 Mar 2003 10:26:04 -0000
d1118 2
a1119 2
--- src/usr.sbin/httpd/src/main/http_config.c	7 Oct 2002 20:22:44 -0000	1.12
+++ src/usr.sbin/httpd/src/main/http_config.c	1 Mar 2003 10:26:04 -0000
d1187 2
a1188 2
--- src/usr.sbin/httpd/src/main/http_core.c	7 Oct 2002 20:22:44 -0000	1.14
+++ src/usr.sbin/httpd/src/main/http_core.c	1 Mar 2003 10:26:04 -0000
d1425 3
a1429 3
+    if (strcmp(arg, "*") == 0)
+      arg = NULL;
+
d1574 2
a1575 2
--- src/usr.sbin/httpd/src/main/http_main.c	16 Feb 2003 17:15:50 -0000	1.28
+++ src/usr.sbin/httpd/src/main/http_main.c	1 Mar 2003 10:26:04 -0000
d1902 1
a1902 2
 	}
-	server_conf->port = ntohs(((struct sockaddr_in *) &sa_server)->sin_port);
d1908 2
a1909 1
+	}
d1952 2
a1953 2
--- src/usr.sbin/httpd/src/main/http_vhost.c	29 Mar 2002 02:07:44 -0000	1.6
+++ src/usr.sbin/httpd/src/main/http_vhost.c	1 Mar 2003 10:26:04 -0000
d2074 2
a2076 2
-    hep = gethostbyname(w);
-
d2543 1
a2543 1
@@@@ -910,7 +1112,22 @@@@
d2549 1
a2549 1
+
d2564 1
a2564 1
 
d2567 1
d2606 2
a2607 2
--- src/usr.sbin/httpd/src/main/rfc1413.c	29 Mar 2002 02:07:44 -0000	1.6
+++ src/usr.sbin/httpd/src/main/rfc1413.c	1 Mar 2003 10:26:04 -0000
d2750 2
a2751 2
--- src/usr.sbin/httpd/src/main/util.c	11 Dec 2002 12:22:35 -0000	1.13
+++ src/usr.sbin/httpd/src/main/util.c	1 Mar 2003 10:26:04 -0000
d2941 2
a2942 2
--- src/usr.sbin/httpd/src/main/util_script.c	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/main/util_script.c	1 Mar 2003 10:26:04 -0000
d2998 2
a2999 2
--- src/usr.sbin/httpd/src/main/util_uri.c	19 Jul 2002 21:30:54 -0000	1.6
+++ src/usr.sbin/httpd/src/main/util_uri.c	1 Mar 2003 10:26:04 -0000
d3100 2
a3101 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	30 Jul 2002 10:51:26 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	1 Mar 2003 10:26:04 -0000
d3159 2
a3160 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	1 Mar 2003 10:26:04 -0000
d3175 2
a3176 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	1 Mar 2003 10:26:04 -0000
d3312 6
a3317 1
-
d3327 1
a3327 6
+    sock = i = -1;
+    for (res = res0; res; res = res->ai_next) {
+	sock = ap_psocket(r->pool, res->ai_family, res->ai_socktype, res->ai_protocol);
+	if (sock == -1)
+	    continue;
 
d3370 2
a3371 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	1 Mar 2003 10:26:04 -0000
d3413 2
a3414 1
@@@@ -658,19 +668,22 @@@@
d3417 1
a3417 1
 
d3424 1
a3424 1
-
d3680 2
a3681 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	7 Oct 2002 20:22:44 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	1 Mar 2003 10:26:04 -0000
d3858 1
a3858 1
 
d3862 1
a3862 1
-
d3956 2
a3957 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	7 Oct 2002 20:22:44 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	1 Mar 2003 10:26:04 -0000
d4114 2
a4115 2
--- src/usr.sbin/httpd/src/modules/standard/mod_access.c	29 Mar 2002 02:07:44 -0000	1.5
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	1 Mar 2003 10:26:07 -0000
d4161 1
a4161 3
 
-	if (!is_ip(where)
-	    || (a->x.ip.net = ap_inet_addr(where)) == INADDR_NONE) {
d4169 3
a4171 1
+
d4232 1
a4232 1
 	    }
d4240 1
a4240 1
-	    }
d4512 2
a4513 2
--- src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	29 Mar 2002 02:07:45 -0000	1.6
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	1 Mar 2003 10:26:07 -0000
d4647 2
a4648 2
--- src/usr.sbin/httpd/src/support/ab.c	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/support/ab.c	1 Mar 2003 10:26:07 -0000
d4807 2
a4808 2
--- src/usr.sbin/httpd/src/support/logresolve.c	29 Mar 2002 02:07:46 -0000	1.5
+++ src/usr.sbin/httpd/src/support/logresolve.c	1 Mar 2003 10:26:07 -0000
d5051 1
a5051 1
Index: src/usr.sbin/httpd/src/include/sa_len.h
d5055 2
a5056 2
--- /dev/null	Sat Mar  1 13:07:36 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sat Mar  1 10:26:07 2003
d5099 1
a5099 1
Index: src/usr.sbin/httpd/src/include/sockaddr_storage.h
d5103 2
a5104 2
--- /dev/null	Sat Mar  1 13:07:36 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sat Mar  1 10:26:07 2003
d5159 1
a5159 1
Index: src/usr.sbin/httpd/src/main/getaddrinfo.c
d5163 2
a5164 2
--- /dev/null	Sat Mar  1 13:07:36 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sat Mar  1 10:26:07 2003
d5328 1
a5328 1
Index: src/usr.sbin/httpd/src/main/getnameinfo.c
d5332 2
a5333 2
--- /dev/null	Sat Mar  1 13:07:36 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sat Mar  1 10:26:07 2003
@


1.22
log
@post-build developer

I'm not sure if egcs builds now...
@
text
@d24 1
a24 1
against CTM on Sat Mar  1 10:03:30 UTC 2003.
d27 1
a27 1
### CTM OpenBSD-cvs 3073
d34 1
a34 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	28 Feb 2003 18:22:30 -0000
d50 1
a50 1
+++ src/usr.sbin/httpd/conf/httpd.conf	28 Feb 2003 18:22:30 -0000
d52 1
a52 1
+#	$MirBSD: obsd.httpd,v 1.21 2003/02/28 18:22:09 tg Exp $
d393 1
a393 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	28 Feb 2003 18:22:30 -0000
d415 1
a415 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	28 Feb 2003 18:22:30 -0000
d491 1
a491 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	28 Feb 2003 18:22:30 -0000
d506 1
a506 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	28 Feb 2003 18:22:30 -0000
d522 1
a522 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	28 Feb 2003 18:22:30 -0000
d538 1
a538 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	28 Feb 2003 18:22:30 -0000
d567 1
a567 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	28 Feb 2003 18:22:30 -0000
d583 1
a583 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	28 Feb 2003 18:22:30 -0000
d598 1
a598 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	28 Feb 2003 18:22:30 -0000
d613 1
a613 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	28 Feb 2003 18:22:30 -0000
d641 1
a641 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	28 Feb 2003 18:22:30 -0000
d656 1
a656 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	28 Feb 2003 18:22:30 -0000
d671 1
a671 1
+++ src/usr.sbin/httpd/src/Configure	28 Feb 2003 18:22:30 -0000
d820 1
a820 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	28 Feb 2003 18:22:30 -0000
d903 1
a903 1
+++ src/usr.sbin/httpd/src/include/ap.h	28 Feb 2003 18:22:30 -0000
d920 1
a920 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	28 Feb 2003 18:22:30 -0000
d1009 1
a1009 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	28 Feb 2003 18:22:30 -0000
d1026 1
a1026 1
+++ src/usr.sbin/httpd/src/include/http_core.h	28 Feb 2003 18:22:30 -0000
d1043 1
a1043 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	28 Feb 2003 18:22:30 -0000
d1059 1
a1059 1
+++ src/usr.sbin/httpd/src/include/httpd.h	28 Feb 2003 18:22:30 -0000
d1120 1
a1120 1
+++ src/usr.sbin/httpd/src/main/http_config.c	28 Feb 2003 18:22:33 -0000
d1189 1
a1189 1
+++ src/usr.sbin/httpd/src/main/http_core.c	28 Feb 2003 18:22:34 -0000
d1576 1
a1576 1
+++ src/usr.sbin/httpd/src/main/http_main.c	28 Feb 2003 18:22:35 -0000
d1954 1
a1954 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	28 Feb 2003 18:22:35 -0000
d2607 1
a2607 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	28 Feb 2003 18:22:35 -0000
d2751 1
a2751 1
+++ src/usr.sbin/httpd/src/main/util.c	28 Feb 2003 18:22:35 -0000
d2942 1
a2942 1
+++ src/usr.sbin/httpd/src/main/util_script.c	28 Feb 2003 18:22:35 -0000
d2999 1
a2999 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	28 Feb 2003 18:22:35 -0000
d3101 1
a3101 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	28 Feb 2003 18:22:35 -0000
d3160 1
a3160 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	28 Feb 2003 18:22:35 -0000
d3176 1
a3176 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	28 Feb 2003 18:22:35 -0000
d3371 1
a3371 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	28 Feb 2003 18:22:35 -0000
d3680 1
a3680 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	28 Feb 2003 18:22:35 -0000
d3956 1
a3956 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	28 Feb 2003 18:22:35 -0000
d4114 1
a4114 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	28 Feb 2003 18:22:35 -0000
d4512 1
a4512 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	28 Feb 2003 18:22:35 -0000
d4647 1
a4647 1
+++ src/usr.sbin/httpd/src/support/ab.c	28 Feb 2003 18:22:35 -0000
d4807 1
a4807 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	28 Feb 2003 18:22:35 -0000
d5054 2
a5055 2
--- /dev/null	Sat Mar  1 10:00:31 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Fri Feb 28 18:22:35 2003
d5102 2
a5103 2
--- /dev/null	Sat Mar  1 10:00:31 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Fri Feb 28 18:22:35 2003
d5162 2
a5163 2
--- /dev/null	Sat Mar  1 10:00:31 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Fri Feb 28 18:22:35 2003
d5331 2
a5332 2
--- /dev/null	Sat Mar  1 10:00:31 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Fri Feb 28 18:22:35 2003
@


1.21
log
@intermediate broken

to survive a make build, does not mean,
to be able to build a kernel (not even a.out)

gcc was broken prior, too. hope it is fixed now.
@
text
@a0 1
>>> Apache diffs for MirBSD against OpenBSD-current
a2 1
>> Thank you, Theo de Raadt and all other contributors to OpenBSD.
a4 1
Contributors:
d13 1
a13 1
I retain the right to be known as the author of the work.
d16 4
a19 4
Use it at your own risk. Neither the author, nor contributors may be
held liable for any damage, directly or indirectly, which originated
by the creation or modification of this work. Since modern computing
devices are error-prone, flawless behaviour cannot be expected.
d22 1
a22 1
This diff, ID $MirBSD: regen-obsdp.sh,v 1.11 2003/02/23 17:34:59 tg Exp $
d24 1
a24 1
against CTM on Fri Feb 28 18:14:38 UTC 2003.
d26 1
a26 1
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.11 2003/02/23 17:34:59 tg Exp $
d34 1
a34 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	24 Feb 2003 21:32:35 -0000
d50 1
a50 1
+++ src/usr.sbin/httpd/conf/httpd.conf	24 Feb 2003 21:32:35 -0000
d52 1
a52 1
+#	$MirBSD: obsd.httpd,v 1.20 2003/02/24 21:32:05 tg Exp $
d393 1
a393 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	24 Feb 2003 21:32:35 -0000
d415 1
a415 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	24 Feb 2003 21:32:35 -0000
d491 1
a491 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	24 Feb 2003 21:32:35 -0000
d506 1
a506 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	24 Feb 2003 21:32:35 -0000
d522 1
a522 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	24 Feb 2003 21:32:35 -0000
d538 1
a538 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	24 Feb 2003 21:32:35 -0000
d567 1
a567 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	24 Feb 2003 21:32:35 -0000
d583 1
a583 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	24 Feb 2003 21:32:35 -0000
d598 1
a598 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	24 Feb 2003 21:32:35 -0000
d613 1
a613 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	24 Feb 2003 21:32:35 -0000
d641 1
a641 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	24 Feb 2003 21:32:35 -0000
d656 1
a656 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	24 Feb 2003 21:32:35 -0000
d671 1
a671 1
+++ src/usr.sbin/httpd/src/Configure	24 Feb 2003 21:32:35 -0000
d820 1
a820 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	24 Feb 2003 21:32:35 -0000
d903 1
a903 1
+++ src/usr.sbin/httpd/src/include/ap.h	24 Feb 2003 21:32:35 -0000
d920 1
a920 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	24 Feb 2003 21:32:35 -0000
d1009 1
a1009 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	24 Feb 2003 21:32:35 -0000
d1026 1
a1026 1
+++ src/usr.sbin/httpd/src/include/http_core.h	24 Feb 2003 21:32:35 -0000
d1043 1
a1043 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	24 Feb 2003 21:32:35 -0000
d1059 1
a1059 1
+++ src/usr.sbin/httpd/src/include/httpd.h	24 Feb 2003 21:32:35 -0000
d1120 1
a1120 1
+++ src/usr.sbin/httpd/src/main/http_config.c	24 Feb 2003 21:32:36 -0000
d1189 1
a1189 1
+++ src/usr.sbin/httpd/src/main/http_core.c	24 Feb 2003 21:32:39 -0000
d1576 1
a1576 1
+++ src/usr.sbin/httpd/src/main/http_main.c	24 Feb 2003 21:32:39 -0000
d1954 1
a1954 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	24 Feb 2003 21:32:39 -0000
d2607 1
a2607 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	24 Feb 2003 21:32:39 -0000
d2751 1
a2751 1
+++ src/usr.sbin/httpd/src/main/util.c	24 Feb 2003 21:32:39 -0000
d2942 1
a2942 1
+++ src/usr.sbin/httpd/src/main/util_script.c	24 Feb 2003 21:32:39 -0000
d2999 1
a2999 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	24 Feb 2003 21:32:39 -0000
d3101 1
a3101 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	24 Feb 2003 21:32:39 -0000
d3160 1
a3160 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	24 Feb 2003 21:32:39 -0000
d3176 1
a3176 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	24 Feb 2003 21:32:39 -0000
d3371 1
a3371 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	24 Feb 2003 21:32:39 -0000
d3680 1
a3680 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	24 Feb 2003 21:32:39 -0000
d3956 1
a3956 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	24 Feb 2003 21:32:39 -0000
d4114 1
a4114 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	24 Feb 2003 21:32:39 -0000
d4512 1
a4512 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	24 Feb 2003 21:32:39 -0000
d4647 1
a4647 1
+++ src/usr.sbin/httpd/src/support/ab.c	24 Feb 2003 21:32:39 -0000
d4807 1
a4807 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	24 Feb 2003 21:32:39 -0000
d5054 2
a5055 2
--- /dev/null	Fri Feb 28 18:11:26 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Mon Feb 24 21:32:39 2003
d5102 2
a5103 2
--- /dev/null	Fri Feb 28 18:11:26 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Mon Feb 24 21:32:39 2003
d5162 2
a5163 2
--- /dev/null	Fri Feb 28 18:11:26 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Mon Feb 24 21:32:39 2003
d5331 2
a5332 2
--- /dev/null	Fri Feb 28 18:11:26 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Mon Feb 24 21:32:39 2003
@


1.20
log
@post-release development

Made make build release succeed and synched plists to the amount needed.
OTOH I don't know if a _kernel_ build with this will succeed...
@
text
@d27 1
a27 1
against CTM on Mon Feb 24 21:27:47 UTC 2003.
d30 1
a30 1
### CTM OpenBSD-cvs 3060
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	23 Feb 2003 18:22:10 -0000
d53 1
a53 1
+++ src/usr.sbin/httpd/conf/httpd.conf	23 Feb 2003 18:22:10 -0000
d55 1
a55 1
+#	$MirBSD: obsd.httpd,v 1.19 2003/02/23 17:59:42 tg Exp $
d396 1
a396 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	23 Feb 2003 18:22:10 -0000
d418 1
a418 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	23 Feb 2003 18:22:10 -0000
d494 1
a494 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	23 Feb 2003 18:22:10 -0000
d509 1
a509 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	23 Feb 2003 18:22:10 -0000
d525 1
a525 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	23 Feb 2003 18:22:10 -0000
d541 1
a541 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	23 Feb 2003 18:22:10 -0000
d570 1
a570 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	23 Feb 2003 18:22:10 -0000
d586 1
a586 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	23 Feb 2003 18:22:10 -0000
d601 1
a601 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	23 Feb 2003 18:22:10 -0000
d616 1
a616 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	23 Feb 2003 18:22:10 -0000
d644 1
a644 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	23 Feb 2003 18:22:10 -0000
d659 1
a659 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	23 Feb 2003 18:22:10 -0000
d674 1
a674 1
+++ src/usr.sbin/httpd/src/Configure	23 Feb 2003 18:22:10 -0000
d823 1
a823 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	23 Feb 2003 18:22:10 -0000
d906 1
a906 1
+++ src/usr.sbin/httpd/src/include/ap.h	23 Feb 2003 18:22:10 -0000
d923 1
a923 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	23 Feb 2003 18:22:10 -0000
d1012 1
a1012 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	23 Feb 2003 18:22:10 -0000
d1029 1
a1029 1
+++ src/usr.sbin/httpd/src/include/http_core.h	23 Feb 2003 18:22:10 -0000
d1046 1
a1046 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	23 Feb 2003 18:22:10 -0000
d1062 1
a1062 1
+++ src/usr.sbin/httpd/src/include/httpd.h	23 Feb 2003 18:22:11 -0000
d1123 1
a1123 1
+++ src/usr.sbin/httpd/src/main/http_config.c	23 Feb 2003 18:22:11 -0000
d1192 1
a1192 1
+++ src/usr.sbin/httpd/src/main/http_core.c	23 Feb 2003 18:22:11 -0000
d1579 1
a1579 1
+++ src/usr.sbin/httpd/src/main/http_main.c	23 Feb 2003 18:22:11 -0000
d1957 1
a1957 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	23 Feb 2003 18:22:11 -0000
d2610 1
a2610 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	23 Feb 2003 18:22:11 -0000
d2754 1
a2754 1
+++ src/usr.sbin/httpd/src/main/util.c	23 Feb 2003 18:22:11 -0000
d2945 1
a2945 1
+++ src/usr.sbin/httpd/src/main/util_script.c	23 Feb 2003 18:22:11 -0000
d3002 1
a3002 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	23 Feb 2003 18:22:11 -0000
d3104 1
a3104 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	23 Feb 2003 18:22:11 -0000
d3163 1
a3163 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	23 Feb 2003 18:22:11 -0000
d3179 1
a3179 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	23 Feb 2003 18:22:11 -0000
d3374 1
a3374 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	23 Feb 2003 18:22:11 -0000
d3683 1
a3683 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	23 Feb 2003 18:22:11 -0000
d3959 1
a3959 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	23 Feb 2003 18:22:11 -0000
d4117 1
a4117 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	23 Feb 2003 18:22:11 -0000
d4515 1
a4515 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	23 Feb 2003 18:22:11 -0000
d4650 1
a4650 1
+++ src/usr.sbin/httpd/src/support/ab.c	23 Feb 2003 18:22:11 -0000
d4810 1
a4810 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	23 Feb 2003 18:22:11 -0000
d5057 2
a5058 2
--- /dev/null	Mon Feb 24 21:18:01 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sun Feb 23 18:22:11 2003
d5105 2
a5106 2
--- /dev/null	Mon Feb 24 21:18:01 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sun Feb 23 18:22:11 2003
d5165 2
a5166 2
--- /dev/null	Mon Feb 24 21:18:01 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sun Feb 23 18:22:11 2003
d5334 2
a5335 2
--- /dev/null	Mon Feb 24 21:18:01 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sun Feb 23 18:22:11 2003
@


1.19
log
@intermediate broken

first attempt to upgrade source tree and clean it up
additionally it makes libkern smaller by another like 20 bytes...
@
text
@d27 1
a27 1
against CTM on Sun Feb 23 17:36:14 UTC 2003.
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	17 Feb 2003 19:22:11 -0000
d53 1
a53 1
+++ src/usr.sbin/httpd/conf/httpd.conf	11 Feb 2003 21:09:34 -0000
d55 1
a55 1
+#	$MirBSD: obsd.httpd,v 1.18 2003/02/11 21:08:29 tg Exp $
d396 1
a396 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	11 Feb 2003 21:09:34 -0000
d418 1
a418 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	11 Feb 2003 21:09:34 -0000
d494 1
a494 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	11 Feb 2003 21:09:34 -0000
d509 1
a509 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	11 Feb 2003 21:09:34 -0000
d525 1
a525 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	11 Feb 2003 21:09:34 -0000
d541 1
a541 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	11 Feb 2003 21:09:34 -0000
d570 1
a570 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	11 Feb 2003 21:09:37 -0000
d586 1
a586 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	11 Feb 2003 21:09:37 -0000
d601 1
a601 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	11 Feb 2003 21:09:37 -0000
d616 1
a616 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	11 Feb 2003 21:09:37 -0000
d644 1
a644 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	11 Feb 2003 21:09:37 -0000
d659 1
a659 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	11 Feb 2003 21:09:37 -0000
d674 1
a674 1
+++ src/usr.sbin/httpd/src/Configure	11 Feb 2003 21:09:37 -0000
d823 1
a823 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	11 Feb 2003 21:09:37 -0000
d906 1
a906 1
+++ src/usr.sbin/httpd/src/include/ap.h	11 Feb 2003 21:09:37 -0000
d923 1
a923 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	11 Feb 2003 21:09:37 -0000
d1012 1
a1012 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	11 Feb 2003 21:09:37 -0000
d1029 1
a1029 1
+++ src/usr.sbin/httpd/src/include/http_core.h	11 Feb 2003 21:09:37 -0000
d1046 1
a1046 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	11 Feb 2003 21:09:37 -0000
d1062 1
a1062 1
+++ src/usr.sbin/httpd/src/include/httpd.h	11 Feb 2003 21:09:37 -0000
d1123 1
a1123 1
+++ src/usr.sbin/httpd/src/main/http_config.c	11 Feb 2003 21:09:38 -0000
d1192 1
a1192 1
+++ src/usr.sbin/httpd/src/main/http_core.c	11 Feb 2003 21:09:38 -0000
d1579 1
a1579 1
+++ src/usr.sbin/httpd/src/main/http_main.c	17 Feb 2003 19:22:18 -0000
d1957 1
a1957 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	11 Feb 2003 21:09:38 -0000
d2610 1
a2610 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	11 Feb 2003 21:09:38 -0000
d2754 1
a2754 1
+++ src/usr.sbin/httpd/src/main/util.c	11 Feb 2003 21:09:38 -0000
d2945 1
a2945 1
+++ src/usr.sbin/httpd/src/main/util_script.c	11 Feb 2003 21:09:38 -0000
d3002 1
a3002 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	11 Feb 2003 21:09:38 -0000
d3104 1
a3104 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	11 Feb 2003 21:09:38 -0000
d3163 1
a3163 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	11 Feb 2003 21:09:38 -0000
d3179 1
a3179 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	11 Feb 2003 21:09:38 -0000
d3374 1
a3374 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	11 Feb 2003 21:09:38 -0000
d3683 1
a3683 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	11 Feb 2003 21:09:38 -0000
d3959 1
a3959 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	11 Feb 2003 21:09:38 -0000
d4117 1
a4117 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	11 Feb 2003 21:09:38 -0000
d4515 1
a4515 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	11 Feb 2003 21:09:38 -0000
d4650 1
a4650 1
+++ src/usr.sbin/httpd/src/support/ab.c	11 Feb 2003 21:09:38 -0000
d4810 1
a4810 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	11 Feb 2003 21:09:38 -0000
d5057 2
a5058 2
--- /dev/null	Sun Feb 23 17:24:43 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Tue Feb 11 21:09:38 2003
d5105 2
a5106 2
--- /dev/null	Sun Feb 23 17:24:43 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Tue Feb 11 21:09:38 2003
d5165 2
a5166 2
--- /dev/null	Sun Feb 23 17:24:43 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Tue Feb 11 21:09:38 2003
d5334 2
a5335 2
--- /dev/null	Sun Feb 23 17:24:43 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Tue Feb 11 21:09:38 2003
@


1.18
log
@post-build

MirBSD goes ELF now
still needs a.out loader (and kernel?)

add more signatures; fix hostname
@
text
@d2 3
a4 1
>>> http://templeofhate.com/tglaser/MirBSD/index.php
d6 1
a6 1
Copyright (c) 2000-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
d8 5
a12 4
Copyright (c) 1968-2003 NOP by the authors of and contributors to C,
    UNIX, BSD/Berkeley Unix, 386BSD, NetBSD and OpenBSD. The licen-
    ce of the file before patching also applies to the patch, unless
    special provisions are made.
d16 1
a16 4
I retain the right to be known as the author of the work. The author
and every single contributor, unless marked with "NOP" above, hereby
waive their right to require additional patent licences for usage of
this work, even if the work could infringe patents hold by them.
d25 1
a25 1
This diff, ID $MirBSD: regen-obsdp.sh,v 1.7 2003/02/10 19:33:07 tg Exp $
d27 1
a27 1
against /cvs on Tue Jan 28 23:58:42 UTC 2003.
d29 2
a30 1
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.7 2003/02/10 19:33:07 tg Exp $
d34 4
a37 4
retrieving revision 1.38
diff -u -r1.38 Makefile.bsd-wrapper
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	25 Dec 2002 23:13:03 -0000	1.38
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	11 Feb 2003 20:15:47 -0000
d53 1
a53 1
+++ src/usr.sbin/httpd/conf/httpd.conf	11 Feb 2003 20:15:47 -0000
d55 1
a55 1
+#	$MirBSD: obsd.httpd,v 1.17 2003/02/11 20:02:17 tg Exp $
d396 1
a396 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	11 Feb 2003 20:15:47 -0000
d418 1
a418 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	11 Feb 2003 20:15:48 -0000
d494 1
a494 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	11 Feb 2003 20:15:48 -0000
d509 1
a509 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	11 Feb 2003 20:15:48 -0000
d525 1
a525 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	11 Feb 2003 20:15:48 -0000
d541 1
a541 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	11 Feb 2003 20:15:48 -0000
d570 1
a570 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	11 Feb 2003 20:15:48 -0000
d586 1
a586 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	11 Feb 2003 20:15:48 -0000
d601 1
a601 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	11 Feb 2003 20:15:48 -0000
d616 1
a616 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	11 Feb 2003 20:15:48 -0000
d644 1
a644 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	11 Feb 2003 20:15:48 -0000
d659 1
a659 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	11 Feb 2003 20:15:48 -0000
d674 1
a674 1
+++ src/usr.sbin/httpd/src/Configure	11 Feb 2003 20:15:48 -0000
d823 1
a823 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	11 Feb 2003 20:15:51 -0000
d906 1
a906 1
+++ src/usr.sbin/httpd/src/include/ap.h	11 Feb 2003 20:15:51 -0000
d923 1
a923 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	11 Feb 2003 20:15:51 -0000
d1012 1
a1012 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	11 Feb 2003 20:15:51 -0000
d1029 1
a1029 1
+++ src/usr.sbin/httpd/src/include/http_core.h	11 Feb 2003 20:15:51 -0000
d1046 1
a1046 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	11 Feb 2003 20:15:51 -0000
d1062 1
a1062 1
+++ src/usr.sbin/httpd/src/include/httpd.h	11 Feb 2003 20:15:51 -0000
d1123 1
a1123 1
+++ src/usr.sbin/httpd/src/main/http_config.c	11 Feb 2003 20:15:51 -0000
d1192 1
a1192 1
+++ src/usr.sbin/httpd/src/main/http_core.c	11 Feb 2003 20:15:51 -0000
d1576 4
a1579 4
retrieving revision 1.27
diff -u -r1.27 http_main.c
--- src/usr.sbin/httpd/src/main/http_main.c	5 Dec 2002 23:44:39 -0000	1.27
+++ src/usr.sbin/httpd/src/main/http_main.c	11 Feb 2003 20:15:51 -0000
d1848 1
a1848 1
@@@@ -5508,7 +5571,10 @@@@
d1860 1
a1860 1
@@@@ -5586,8 +5652,14 @@@@
d1877 1
a1877 1
@@@@ -5679,9 +5751,10 @@@@
d1889 1
a1889 1
@@@@ -5736,25 +5809,32 @@@@
d1927 1
a1927 1
@@@@ -7989,7 +8069,11 @@@@
d1940 1
a1940 1
@@@@ -8007,6 +8091,10 @@@@
d1957 1
a1957 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	11 Feb 2003 20:15:51 -0000
d2610 1
a2610 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	11 Feb 2003 20:15:51 -0000
d2754 1
a2754 1
+++ src/usr.sbin/httpd/src/main/util.c	11 Feb 2003 20:15:51 -0000
d2945 1
a2945 1
+++ src/usr.sbin/httpd/src/main/util_script.c	11 Feb 2003 20:15:52 -0000
d3002 1
a3002 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	11 Feb 2003 20:15:52 -0000
d3104 1
a3104 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	11 Feb 2003 20:15:52 -0000
d3163 1
a3163 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	11 Feb 2003 20:15:52 -0000
d3179 1
a3179 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	11 Feb 2003 20:15:52 -0000
d3374 1
a3374 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	11 Feb 2003 20:15:52 -0000
d3683 1
a3683 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	11 Feb 2003 20:15:52 -0000
d3959 1
a3959 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	11 Feb 2003 20:15:52 -0000
d4117 1
a4117 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	11 Feb 2003 20:15:52 -0000
d4515 1
a4515 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	11 Feb 2003 20:15:52 -0000
d4650 1
a4650 1
+++ src/usr.sbin/httpd/src/support/ab.c	11 Feb 2003 20:15:52 -0000
d4810 1
a4810 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	11 Feb 2003 20:15:52 -0000
d5057 2
a5058 2
--- /dev/null	Tue Feb 11 20:26:13 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Tue Feb 11 20:15:52 2003
d5105 2
a5106 2
--- /dev/null	Tue Feb 11 20:26:13 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Tue Feb 11 20:15:52 2003
d5165 2
a5166 2
--- /dev/null	Tue Feb 11 20:26:13 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Tue Feb 11 20:15:52 2003
d5334 2
a5335 2
--- /dev/null	Tue Feb 11 20:26:13 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Tue Feb 11 20:15:52 2003
@


1.17
log
@Uhm. Prepare for MirBSD -> ELF and obsd/ -> mbsd/
Did not mean to checkin diffs yet. They are incomplete.
@
text
@d36 1
a36 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	10 Feb 2003 19:41:45 -0000
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	10 Feb 2003 19:41:45 -0000
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.16 2003/02/10 19:41:25 tg Exp $
d395 1
a395 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	10 Feb 2003 19:41:45 -0000
d417 1
a417 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	10 Feb 2003 19:41:45 -0000
d493 1
a493 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	10 Feb 2003 19:41:48 -0000
d508 1
a508 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	10 Feb 2003 19:41:48 -0000
d524 1
a524 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	10 Feb 2003 19:41:48 -0000
d540 1
a540 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	10 Feb 2003 19:41:48 -0000
d569 1
a569 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	10 Feb 2003 19:41:48 -0000
d585 1
a585 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	10 Feb 2003 19:41:48 -0000
d600 1
a600 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	10 Feb 2003 19:41:48 -0000
d615 1
a615 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	10 Feb 2003 19:41:48 -0000
d643 1
a643 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	10 Feb 2003 19:41:48 -0000
d658 1
a658 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	10 Feb 2003 19:41:48 -0000
d673 1
a673 1
+++ src/usr.sbin/httpd/src/Configure	10 Feb 2003 19:41:48 -0000
d822 1
a822 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	10 Feb 2003 19:41:48 -0000
d905 1
a905 1
+++ src/usr.sbin/httpd/src/include/ap.h	10 Feb 2003 19:41:48 -0000
d922 1
a922 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	10 Feb 2003 19:41:48 -0000
d1011 1
a1011 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	10 Feb 2003 19:41:48 -0000
d1028 1
a1028 1
+++ src/usr.sbin/httpd/src/include/http_core.h	10 Feb 2003 19:41:48 -0000
d1045 1
a1045 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	10 Feb 2003 19:41:48 -0000
d1061 1
a1061 1
+++ src/usr.sbin/httpd/src/include/httpd.h	10 Feb 2003 19:41:48 -0000
d1122 1
a1122 1
+++ src/usr.sbin/httpd/src/main/http_config.c	10 Feb 2003 19:41:48 -0000
d1191 1
a1191 1
+++ src/usr.sbin/httpd/src/main/http_core.c	10 Feb 2003 19:41:48 -0000
d1578 1
a1578 1
+++ src/usr.sbin/httpd/src/main/http_main.c	10 Feb 2003 19:41:48 -0000
d1956 1
a1956 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	10 Feb 2003 19:41:48 -0000
d2609 1
a2609 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	10 Feb 2003 19:41:48 -0000
d2753 1
a2753 1
+++ src/usr.sbin/httpd/src/main/util.c	10 Feb 2003 19:41:48 -0000
d2944 1
a2944 1
+++ src/usr.sbin/httpd/src/main/util_script.c	10 Feb 2003 19:41:48 -0000
d3001 1
a3001 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	10 Feb 2003 19:41:48 -0000
d3103 1
a3103 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	10 Feb 2003 19:41:49 -0000
d3162 1
a3162 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	10 Feb 2003 19:41:49 -0000
d3178 1
a3178 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	10 Feb 2003 19:41:49 -0000
d3373 1
a3373 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	10 Feb 2003 19:41:49 -0000
d3682 1
a3682 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	10 Feb 2003 19:41:49 -0000
d3958 1
a3958 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	10 Feb 2003 19:41:49 -0000
d4116 1
a4116 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	10 Feb 2003 19:41:49 -0000
d4514 1
a4514 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	10 Feb 2003 19:41:49 -0000
d4649 1
a4649 1
+++ src/usr.sbin/httpd/src/support/ab.c	10 Feb 2003 19:41:49 -0000
d4809 1
a4809 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	10 Feb 2003 19:41:49 -0000
d5056 2
a5057 2
--- /dev/null	Tue Feb 11 19:40:44 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Mon Feb 10 19:41:49 2003
d5104 2
a5105 2
--- /dev/null	Tue Feb 11 19:40:44 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Mon Feb 10 19:41:49 2003
d5164 2
a5165 2
--- /dev/null	Tue Feb 11 19:40:44 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Mon Feb 10 19:41:49 2003
d5333 2
a5334 2
--- /dev/null	Tue Feb 11 19:40:44 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Mon Feb 10 19:41:49 2003
d5440 14
a5453 14
src/usr.sbin/httpd/Makefile.bsd-wrapper				LDFLAGS, ipv6,...
src/usr.sbin/httpd/conf/httpd.conf				ipv6, local mods
src/usr.sbin/httpd/conf/httpd.conf-dist				ipv6
src/usr.sbin/httpd/htdocs/manual/mod/core.html.html		humantime
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de		humantime
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en		humantime
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr		humantime
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	humantime
src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	humantime
src/usr.sbin/httpd/htdocs/manual/server-wide.html.en		humantime
src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr		humantime
src/usr.sbin/httpd/htdocs/manual/server-wide.html.html		humantime
src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	humantime
src/usr.sbin/httpd/src/Configuration.tmpl			ipv6 ,...
a5488 1
. add microBSD jumbo patch minor kernel fixes (Jedi/Sector one, local mods+KNF)
a5489 1
. add several lots of gcc-3.2 related small patches or fixes
d5491 1
a5491 1
. make Apache IPv6, will not RSN committed (security issues) (me, patch team)
@


1.16
log
@pre-build (development!)

+---------------.,
| ELF is there! ||
+===============''

- ports did not update INDEX
  there are conflicts in it
- diff set lists are not synched
- distrib sets are not touched at all
- still statically linked :)
- needs ELF system and EGCC to build
- no kernel yet, sorry

not to be used. backup only.
@
text
@d27 1
a27 1
against /cvs on Tue Jan 28 22:02:42 UTC 2003.
d36 1
a36 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	27 Jan 2003 21:18:30 -0000
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	27 Jan 2003 21:18:30 -0000
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.15 2003/01/27 21:17:19 tg Exp $
d395 1
a395 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	27 Jan 2003 21:18:30 -0000
d417 1
a417 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	27 Jan 2003 21:18:30 -0000
d493 1
a493 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	27 Jan 2003 21:18:30 -0000
d508 1
a508 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	27 Jan 2003 21:18:30 -0000
d524 1
a524 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	27 Jan 2003 21:18:30 -0000
d540 1
a540 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	27 Jan 2003 21:18:30 -0000
d569 1
a569 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	27 Jan 2003 21:18:30 -0000
d585 1
a585 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	27 Jan 2003 21:18:30 -0000
d600 1
a600 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	27 Jan 2003 21:18:30 -0000
d615 1
a615 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	27 Jan 2003 21:18:30 -0000
d643 1
a643 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	27 Jan 2003 21:18:30 -0000
d658 1
a658 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	27 Jan 2003 21:18:31 -0000
d673 1
a673 1
+++ src/usr.sbin/httpd/src/Configure	27 Jan 2003 21:18:31 -0000
d822 1
a822 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	27 Jan 2003 21:18:31 -0000
d905 1
a905 1
+++ src/usr.sbin/httpd/src/include/ap.h	27 Jan 2003 21:18:31 -0000
d922 1
a922 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	27 Jan 2003 21:18:31 -0000
d1011 1
a1011 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	27 Jan 2003 21:18:31 -0000
d1028 1
a1028 1
+++ src/usr.sbin/httpd/src/include/http_core.h	27 Jan 2003 21:18:31 -0000
d1045 1
a1045 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	27 Jan 2003 21:18:31 -0000
d1061 1
a1061 1
+++ src/usr.sbin/httpd/src/include/httpd.h	27 Jan 2003 21:18:31 -0000
d1122 1
a1122 1
+++ src/usr.sbin/httpd/src/main/http_config.c	27 Jan 2003 21:18:31 -0000
d1191 1
a1191 1
+++ src/usr.sbin/httpd/src/main/http_core.c	27 Jan 2003 21:18:31 -0000
d1578 1
a1578 1
+++ src/usr.sbin/httpd/src/main/http_main.c	27 Jan 2003 21:18:31 -0000
d1956 1
a1956 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	27 Jan 2003 21:18:31 -0000
d2609 1
a2609 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	27 Jan 2003 21:18:31 -0000
d2753 1
a2753 1
+++ src/usr.sbin/httpd/src/main/util.c	27 Jan 2003 21:18:31 -0000
d2944 1
a2944 1
+++ src/usr.sbin/httpd/src/main/util_script.c	27 Jan 2003 21:18:31 -0000
d3001 1
a3001 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	27 Jan 2003 21:18:31 -0000
d3103 1
a3103 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	27 Jan 2003 21:18:31 -0000
d3162 1
a3162 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	27 Jan 2003 21:18:31 -0000
d3178 1
a3178 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	27 Jan 2003 21:18:31 -0000
d3373 1
a3373 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	27 Jan 2003 21:18:31 -0000
d3682 1
a3682 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	27 Jan 2003 21:18:31 -0000
d3958 1
a3958 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	27 Jan 2003 21:18:31 -0000
d4116 1
a4116 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	27 Jan 2003 21:18:31 -0000
d4514 1
a4514 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	27 Jan 2003 21:18:31 -0000
d4649 1
a4649 1
+++ src/usr.sbin/httpd/src/support/ab.c	27 Jan 2003 21:18:31 -0000
d4809 1
a4809 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	27 Jan 2003 21:18:35 -0000
d5056 2
a5057 2
--- /dev/null	Mon Feb 10 19:17:46 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Mon Jan 27 21:18:35 2003
d5104 2
a5105 2
--- /dev/null	Mon Feb 10 19:17:46 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Mon Jan 27 21:18:35 2003
d5164 2
a5165 2
--- /dev/null	Mon Feb 10 19:17:46 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Mon Jan 27 21:18:35 2003
d5333 2
a5334 2
--- /dev/null	Mon Feb 10 19:17:46 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Mon Jan 27 21:18:35 2003
@


1.15
log
@another
MirBSD Snapshot #2 RC3
@
text
@d25 1
a25 1
This diff, ID $MirBSD: regen-obsdp.sh,v 1.6 2003/01/21 19:56:49 tg Exp $
d27 1
a27 1
against anoncvs@@anoncvs.ca.openbsd.org:/cvs on Mon Jan 27 17:30:00 UTC 2003.
d29 1
a29 1
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.6 2003/01/21 19:56:49 tg Exp $
d35 2
a36 2
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	2002/12/25 23:13:25	1.38
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	2003/01/27 21:07:01
d51 2
a52 2
--- src/usr.sbin/httpd/conf/httpd.conf	2002/10/06 12:00:21	1.15
+++ src/usr.sbin/httpd/conf/httpd.conf	2003/01/27 21:07:02
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.14 2003/01/27 15:38:17 tg Exp $
d394 2
a395 2
--- src/usr.sbin/httpd/conf/httpd.conf-dist	2002/10/07 20:23:06	1.14
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	2003/01/27 21:07:03
d416 2
a417 2
--- src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	2002/10/07 21:04:44	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	2003/01/27 21:07:06
d492 2
a493 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	2002/02/12 07:56:47	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	2003/01/27 21:07:06
d507 2
a508 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	2002/10/07 21:04:44	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	2003/01/27 21:07:07
d523 2
a524 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	2002/02/12 07:56:47	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	2003/01/27 21:07:07
d539 2
a540 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	2002/10/07 21:04:44	1.3
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	2003/01/27 21:07:07
d568 2
a569 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	2002/10/07 21:04:44	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	2003/01/27 21:07:07
d584 2
a585 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	2002/02/12 07:56:47	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	2003/01/27 21:07:07
d599 2
a600 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	2002/02/12 07:56:47	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	2003/01/27 21:07:07
d614 2
a615 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	2002/02/12 07:56:47	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	2003/01/27 21:07:07
d642 2
a643 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	2002/07/19 21:31:14	1.3
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	2003/01/27 21:07:08
d657 2
a658 2
--- src/usr.sbin/httpd/src/Configuration.tmpl	2002/02/12 07:56:49	1.9
+++ src/usr.sbin/httpd/src/Configuration.tmpl	2003/01/27 21:07:08
d672 2
a673 2
--- src/usr.sbin/httpd/src/Configure	2002/10/07 20:23:06	1.21
+++ src/usr.sbin/httpd/src/Configure	2003/01/27 21:07:10
d821 2
a822 2
--- src/usr.sbin/httpd/src/ap/ap_snprintf.c	2002/12/11 17:22:56	1.9
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	2003/01/27 21:07:11
d904 2
a905 2
--- src/usr.sbin/httpd/src/include/ap.h	2002/10/07 20:23:06	1.9
+++ src/usr.sbin/httpd/src/include/ap.h	2003/01/27 21:07:11
d921 2
a922 2
--- src/usr.sbin/httpd/src/include/ap_config.h	2002/09/10 17:49:21	1.15
+++ src/usr.sbin/httpd/src/include/ap_config.h	2003/01/27 21:07:12
d1010 2
a1011 2
--- src/usr.sbin/httpd/src/include/http_conf_globals.h	2002/10/07 20:23:06	1.10
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	2003/01/27 21:07:12
d1027 2
a1028 2
--- src/usr.sbin/httpd/src/include/http_core.h	2002/03/29 02:08:05	1.7
+++ src/usr.sbin/httpd/src/include/http_core.h	2003/01/27 21:07:12
d1044 2
a1045 2
--- src/usr.sbin/httpd/src/include/http_vhost.h	2002/03/29 02:08:05	1.5
+++ src/usr.sbin/httpd/src/include/http_vhost.h	2003/01/27 21:07:12
d1060 2
a1061 2
--- src/usr.sbin/httpd/src/include/httpd.h	2002/10/07 20:23:06	1.17
+++ src/usr.sbin/httpd/src/include/httpd.h	2003/01/27 21:07:14
d1121 2
a1122 2
--- src/usr.sbin/httpd/src/main/http_config.c	2002/10/07 20:23:06	1.12
+++ src/usr.sbin/httpd/src/main/http_config.c	2003/01/27 21:07:15
d1190 2
a1191 2
--- src/usr.sbin/httpd/src/main/http_core.c	2002/10/07 20:23:06	1.14
+++ src/usr.sbin/httpd/src/main/http_core.c	2003/01/27 21:07:18
d1428 2
a1429 1
+
d1432 1
a1432 2
 
-    ap_bind_address.s_addr = ap_get_virthost_addr(arg, NULL);
d1577 2
a1578 2
--- src/usr.sbin/httpd/src/main/http_main.c	2002/12/05 23:45:01	1.27
+++ src/usr.sbin/httpd/src/main/http_main.c	2003/01/27 21:07:24
d1905 2
a1906 1
+	}
d1912 1
a1912 2
 	}
-	server_conf->port = ntohs(((struct sockaddr_in *) &sa_server)->sin_port);
d1955 2
a1956 2
--- src/usr.sbin/httpd/src/main/http_vhost.c	2002/03/29 02:08:06	1.6
+++ src/usr.sbin/httpd/src/main/http_vhost.c	2003/01/27 21:07:24
d2077 2
a2079 2
-    hep = gethostbyname(w);
 
d2546 1
a2546 1
@@@@ -910,8 +1112,23 @@@@
d2552 1
a2552 1
 
d2567 1
a2567 1
+
a2569 1
      * get the right host attached to a non- Host-sending request.
d2608 2
a2609 2
--- src/usr.sbin/httpd/src/main/rfc1413.c	2002/03/29 02:08:06	1.6
+++ src/usr.sbin/httpd/src/main/rfc1413.c	2003/01/27 21:07:25
d2752 2
a2753 2
--- src/usr.sbin/httpd/src/main/util.c	2002/12/11 12:22:57	1.13
+++ src/usr.sbin/httpd/src/main/util.c	2003/01/27 21:07:26
d2943 2
a2944 2
--- src/usr.sbin/httpd/src/main/util_script.c	2002/10/07 20:23:06	1.10
+++ src/usr.sbin/httpd/src/main/util_script.c	2003/01/27 21:07:28
d3000 2
a3001 2
--- src/usr.sbin/httpd/src/main/util_uri.c	2002/07/19 21:31:16	1.6
+++ src/usr.sbin/httpd/src/main/util_uri.c	2003/01/27 21:07:28
d3102 2
a3103 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	2002/07/30 10:51:48	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	2003/01/27 21:07:28
d3161 2
a3162 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	2002/07/19 21:31:16	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	2003/01/27 21:07:29
d3177 2
a3178 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	2002/07/19 21:31:16	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	2003/01/27 21:07:29
d3314 1
a3314 6
+    sock = i = -1;
+    for (res = res0; res; res = res->ai_next) {
+	sock = ap_psocket(r->pool, res->ai_family, res->ai_socktype, res->ai_protocol);
+	if (sock == -1)
+	    continue;
 
d3324 6
a3329 1
-
d3372 2
a3373 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	2002/07/19 21:31:16	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	2003/01/27 21:07:30
d3415 1
a3415 2
@@@@ -657,20 +667,23 @@@@
     parms = strchr(path, ';');
d3418 1
a3418 1
-
d3425 1
a3425 1
 
d3681 2
a3682 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	2002/10/07 20:23:06	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	2003/01/27 21:07:30
d3859 1
a3859 1
-
d3863 1
a3863 1
 
d3957 2
a3958 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	2002/10/07 20:23:06	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	2003/01/27 21:07:32
d4115 2
a4116 2
--- src/usr.sbin/httpd/src/modules/standard/mod_access.c	2002/03/29 02:08:06	1.5
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	2003/01/27 21:07:33
d4162 3
a4164 1
+
d4172 1
a4172 3
 
-	if (!is_ip(where)
-	    || (a->x.ip.net = ap_inet_addr(where)) == INADDR_NONE) {
d4233 1
a4233 1
-	    }
d4241 1
a4241 1
 	    }
d4513 2
a4514 2
--- src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	2002/03/29 02:08:07	1.6
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	2003/01/27 21:07:33
d4648 2
a4649 2
--- src/usr.sbin/httpd/src/support/ab.c	2002/10/07 20:23:06	1.10
+++ src/usr.sbin/httpd/src/support/ab.c	2003/01/27 21:07:34
d4808 2
a4809 2
--- src/usr.sbin/httpd/src/support/logresolve.c	2002/03/29 02:08:08	1.5
+++ src/usr.sbin/httpd/src/support/logresolve.c	2003/01/27 21:07:34
d5056 2
a5057 2
--- /dev/null	Mon Jan 27 20:12:38 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Mon Jan 27 17:47:37 2003
d5104 2
a5105 2
--- /dev/null	Mon Jan 27 20:12:38 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Mon Jan 27 17:47:37 2003
d5164 2
a5165 2
--- /dev/null	Mon Jan 27 20:12:38 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Mon Jan 27 17:47:37 2003
d5333 2
a5334 2
--- /dev/null	Mon Jan 27 20:12:38 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Mon Jan 27 17:47:37 2003
d5482 4
a5485 4
src/usr.sbin/httpd/src/include/sa_len.h		ipv6...
src/usr.sbin/httpd/src/include/sockaddr_storage.h
src/usr.sbin/httpd/src/main/getaddrinfo.c
src/usr.sbin/httpd/src/main/getnameinfo.c
@


1.14
log
@snapshot release candidate
todo:
 + cvs repo (ports, src) check for diff
 + make build
 + make release
 + checkflist
 + if !correct: regen diffs, do again
 + upload
@
text
@d27 1
a27 1
against anoncvs@@anoncvs.ca.openbsd.org:/cvs on Mon Jan 27 12:20:00 UTC 2003.
d36 1
a36 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	2003/01/27 15:33:39
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	2003/01/27 15:33:40
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.13 2003/01/26 13:10:24 tg Exp $
d395 1
a395 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	2003/01/27 15:33:41
d417 1
a417 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	2003/01/27 15:33:44
d493 1
a493 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	2003/01/27 15:33:44
d508 1
a508 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	2003/01/27 15:33:45
d524 1
a524 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	2003/01/27 15:33:45
d540 1
a540 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	2003/01/27 15:33:45
d569 1
a569 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	2003/01/27 15:33:45
d585 1
a585 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	2003/01/27 15:33:45
d600 1
a600 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	2003/01/27 15:33:45
d615 1
a615 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	2003/01/27 15:33:45
d643 1
a643 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	2003/01/27 15:33:46
d658 1
a658 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	2003/01/27 15:33:46
d673 1
a673 1
+++ src/usr.sbin/httpd/src/Configure	2003/01/27 15:33:48
d822 1
a822 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	2003/01/27 15:33:49
d905 1
a905 1
+++ src/usr.sbin/httpd/src/include/ap.h	2003/01/27 15:33:49
d922 1
a922 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	2003/01/27 15:33:50
d1011 1
a1011 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	2003/01/27 15:33:50
d1028 1
a1028 1
+++ src/usr.sbin/httpd/src/include/http_core.h	2003/01/27 15:33:50
d1045 1
a1045 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	2003/01/27 15:33:50
d1061 1
a1061 1
+++ src/usr.sbin/httpd/src/include/httpd.h	2003/01/27 15:33:51
d1122 1
a1122 1
+++ src/usr.sbin/httpd/src/main/http_config.c	2003/01/27 15:33:53
d1191 1
a1191 1
+++ src/usr.sbin/httpd/src/main/http_core.c	2003/01/27 15:33:55
d1578 1
a1578 1
+++ src/usr.sbin/httpd/src/main/http_main.c	2003/01/27 15:34:01
d1956 1
a1956 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	2003/01/27 15:34:01
d2610 1
a2610 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	2003/01/27 15:34:02
d2754 1
a2754 1
+++ src/usr.sbin/httpd/src/main/util.c	2003/01/27 15:34:04
d2945 1
a2945 1
+++ src/usr.sbin/httpd/src/main/util_script.c	2003/01/27 15:34:05
d3002 1
a3002 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	2003/01/27 15:34:05
d3104 1
a3104 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	2003/01/27 15:34:05
d3163 1
a3163 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	2003/01/27 15:34:06
d3179 1
a3179 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	2003/01/27 15:34:06
d3374 1
a3374 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	2003/01/27 15:34:07
d3684 1
a3684 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	2003/01/27 15:34:07
d3960 1
a3960 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	2003/01/27 15:34:09
d4118 1
a4118 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	2003/01/27 15:34:10
d4516 1
a4516 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	2003/01/27 15:34:10
d4651 1
a4651 1
+++ src/usr.sbin/httpd/src/support/ab.c	2003/01/27 15:34:11
d4811 1
a4811 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	2003/01/27 15:34:11
d5058 2
a5059 2
--- /dev/null	Mon Jan 27 14:30:41 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sun Jan 26 13:11:01 2003
d5106 2
a5107 2
--- /dev/null	Mon Jan 27 14:30:41 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sun Jan 26 13:11:01 2003
d5166 2
a5167 2
--- /dev/null	Mon Jan 27 14:30:41 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sun Jan 26 13:11:01 2003
d5335 2
a5336 2
--- /dev/null	Mon Jan 27 14:30:41 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sun Jan 26 13:11:01 2003
@


1.13
log
@sync
fix gcc-3.2 port (uses humantime-ulimit!)
switch system CXX to g++-3.2
bump mc
make build, fix
plug some compiler warnings (uninitialized, trigraph, ...)
make release, sync plists

merge obsd.gcc and obsd.mini to obsd.misc
@
text
@d27 1
a27 1
against CTM on Sun Jan 26 12:59:00 UTC 2003.
a29 1
### CTM OpenBSD-cvs 2976
d35 2
a36 2
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	25 Dec 2002 23:13:03 -0000	1.38
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	21 Jan 2003 20:14:30 -0000
d51 2
a52 2
--- src/usr.sbin/httpd/conf/httpd.conf	6 Oct 2002 11:59:59 -0000	1.15
+++ src/usr.sbin/httpd/conf/httpd.conf	25 Jan 2003 19:04:51 -0000
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.12 2003/01/21 19:26:00 tg Exp $
d394 2
a395 2
--- src/usr.sbin/httpd/conf/httpd.conf-dist	7 Oct 2002 20:22:44 -0000	1.14
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	21 Jan 2003 20:14:30 -0000
d416 2
a417 2
--- src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	21 Jan 2003 20:14:31 -0000
d492 2
a493 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	12 Feb 2002 07:56:25 -0000	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	21 Jan 2003 20:14:31 -0000
d507 2
a508 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	21 Jan 2003 20:14:31 -0000
d523 2
a524 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	12 Feb 2002 07:56:25 -0000	1.1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	21 Jan 2003 20:14:31 -0000
d539 2
a540 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	7 Oct 2002 21:04:22 -0000	1.3
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	21 Jan 2003 20:14:31 -0000
d568 2
a569 2
--- src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	7 Oct 2002 21:04:22 -0000	1.4
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	21 Jan 2003 20:14:31 -0000
d584 2
a585 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	21 Jan 2003 20:14:31 -0000
d599 2
a600 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	21 Jan 2003 20:14:31 -0000
d614 2
a615 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	12 Feb 2002 07:56:25 -0000	1.2
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	21 Jan 2003 20:14:31 -0000
d642 2
a643 2
--- src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	19 Jul 2002 21:30:52 -0000	1.3
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	21 Jan 2003 20:14:31 -0000
d657 2
a658 2
--- src/usr.sbin/httpd/src/Configuration.tmpl	12 Feb 2002 07:56:27 -0000	1.9
+++ src/usr.sbin/httpd/src/Configuration.tmpl	21 Jan 2003 20:14:31 -0000
d672 2
a673 2
--- src/usr.sbin/httpd/src/Configure	7 Oct 2002 20:22:44 -0000	1.21
+++ src/usr.sbin/httpd/src/Configure	21 Jan 2003 20:14:31 -0000
d821 2
a822 2
--- src/usr.sbin/httpd/src/ap/ap_snprintf.c	11 Dec 2002 17:22:34 -0000	1.9
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	21 Jan 2003 20:14:31 -0000
d904 2
a905 2
--- src/usr.sbin/httpd/src/include/ap.h	7 Oct 2002 20:22:44 -0000	1.9
+++ src/usr.sbin/httpd/src/include/ap.h	21 Jan 2003 20:14:31 -0000
d921 2
a922 2
--- src/usr.sbin/httpd/src/include/ap_config.h	10 Sep 2002 17:48:59 -0000	1.15
+++ src/usr.sbin/httpd/src/include/ap_config.h	21 Jan 2003 20:14:31 -0000
d1010 2
a1011 2
--- src/usr.sbin/httpd/src/include/http_conf_globals.h	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	21 Jan 2003 20:14:31 -0000
d1027 2
a1028 2
--- src/usr.sbin/httpd/src/include/http_core.h	29 Mar 2002 02:07:43 -0000	1.7
+++ src/usr.sbin/httpd/src/include/http_core.h	21 Jan 2003 20:14:31 -0000
d1044 2
a1045 2
--- src/usr.sbin/httpd/src/include/http_vhost.h	29 Mar 2002 02:07:43 -0000	1.5
+++ src/usr.sbin/httpd/src/include/http_vhost.h	21 Jan 2003 20:14:31 -0000
d1060 2
a1061 2
--- src/usr.sbin/httpd/src/include/httpd.h	7 Oct 2002 20:22:44 -0000	1.17
+++ src/usr.sbin/httpd/src/include/httpd.h	21 Jan 2003 20:14:31 -0000
d1121 2
a1122 2
--- src/usr.sbin/httpd/src/main/http_config.c	7 Oct 2002 20:22:44 -0000	1.12
+++ src/usr.sbin/httpd/src/main/http_config.c	21 Jan 2003 20:14:31 -0000
d1190 2
a1191 2
--- src/usr.sbin/httpd/src/main/http_core.c	7 Oct 2002 20:22:44 -0000	1.14
+++ src/usr.sbin/httpd/src/main/http_core.c	21 Jan 2003 20:14:31 -0000
d1428 3
a1432 3
+    if (strcmp(arg, "*") == 0)
+      arg = NULL;
+
d1577 2
a1578 2
--- src/usr.sbin/httpd/src/main/http_main.c	5 Dec 2002 23:44:39 -0000	1.27
+++ src/usr.sbin/httpd/src/main/http_main.c	21 Jan 2003 20:14:31 -0000
d1905 1
a1905 2
 	}
-	server_conf->port = ntohs(((struct sockaddr_in *) &sa_server)->sin_port);
d1911 2
a1912 1
+	}
d1955 2
a1956 2
--- src/usr.sbin/httpd/src/main/http_vhost.c	29 Mar 2002 02:07:44 -0000	1.6
+++ src/usr.sbin/httpd/src/main/http_vhost.c	21 Jan 2003 20:14:31 -0000
d2077 2
a2079 2
-    hep = gethostbyname(w);
-
d2546 1
a2546 1
@@@@ -910,7 +1112,22 @@@@
d2552 1
a2552 1
+
d2567 1
a2567 1
 
d2570 1
d2609 2
a2610 2
--- src/usr.sbin/httpd/src/main/rfc1413.c	29 Mar 2002 02:07:44 -0000	1.6
+++ src/usr.sbin/httpd/src/main/rfc1413.c	21 Jan 2003 20:14:31 -0000
d2753 2
a2754 2
--- src/usr.sbin/httpd/src/main/util.c	11 Dec 2002 12:22:35 -0000	1.13
+++ src/usr.sbin/httpd/src/main/util.c	21 Jan 2003 20:14:32 -0000
d2944 2
a2945 2
--- src/usr.sbin/httpd/src/main/util_script.c	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/main/util_script.c	21 Jan 2003 20:14:32 -0000
d3001 2
a3002 2
--- src/usr.sbin/httpd/src/main/util_uri.c	19 Jul 2002 21:30:54 -0000	1.6
+++ src/usr.sbin/httpd/src/main/util_uri.c	21 Jan 2003 20:14:32 -0000
d3103 2
a3104 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	30 Jul 2002 10:51:26 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	21 Jan 2003 20:14:32 -0000
d3162 2
a3163 2
--- src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	21 Jan 2003 20:14:35 -0000
d3178 2
a3179 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	21 Jan 2003 20:14:35 -0000
d3315 6
a3320 1
-
d3330 1
a3330 6
+    sock = i = -1;
+    for (res = res0; res; res = res->ai_next) {
+	sock = ap_psocket(r->pool, res->ai_family, res->ai_socktype, res->ai_protocol);
+	if (sock == -1)
+	    continue;
 
d3373 2
a3374 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	19 Jul 2002 21:30:54 -0000	1.8
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	21 Jan 2003 20:14:35 -0000
d3416 2
a3417 1
@@@@ -658,19 +668,22 @@@@
d3420 1
a3420 1
 
d3427 1
a3427 1
-
d3683 2
a3684 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	7 Oct 2002 20:22:44 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	21 Jan 2003 20:14:35 -0000
d3861 1
a3861 1
 
d3865 1
a3865 1
-
d3959 2
a3960 2
--- src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	7 Oct 2002 20:22:44 -0000	1.11
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	21 Jan 2003 20:14:35 -0000
d4117 2
a4118 2
--- src/usr.sbin/httpd/src/modules/standard/mod_access.c	29 Mar 2002 02:07:44 -0000	1.5
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	21 Jan 2003 20:14:35 -0000
d4164 1
a4164 3
 
-	if (!is_ip(where)
-	    || (a->x.ip.net = ap_inet_addr(where)) == INADDR_NONE) {
d4172 3
a4174 1
+
d4235 1
a4235 1
 	    }
d4243 1
a4243 1
-	    }
d4515 2
a4516 2
--- src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	29 Mar 2002 02:07:45 -0000	1.6
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	21 Jan 2003 20:14:35 -0000
d4650 2
a4651 2
--- src/usr.sbin/httpd/src/support/ab.c	7 Oct 2002 20:22:44 -0000	1.10
+++ src/usr.sbin/httpd/src/support/ab.c	21 Jan 2003 20:14:35 -0000
d4810 2
a4811 2
--- src/usr.sbin/httpd/src/support/logresolve.c	29 Mar 2002 02:07:46 -0000	1.5
+++ src/usr.sbin/httpd/src/support/logresolve.c	21 Jan 2003 20:14:36 -0000
d5058 2
a5059 2
--- /dev/null	Sun Jan 26 12:57:40 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Tue Jan 21 20:14:36 2003
d5106 2
a5107 2
--- /dev/null	Sun Jan 26 12:57:40 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Tue Jan 21 20:14:36 2003
d5166 2
a5167 2
--- /dev/null	Sun Jan 26 12:57:40 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Tue Jan 21 20:14:36 2003
d5335 2
a5336 2
--- /dev/null	Sun Jan 26 12:57:40 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Tue Jan 21 20:14:36 2003
@


1.12
log
@first part of system-wide sync
second part to come (check packaging list of diffs)
@
text
@d6 1
a6 1
Copyright (c) 1968-2002 NOP by the authors of and contributors to C,
d25 1
a25 1
This diff, ID $MirBSD: regen-obsdp.sh,v 1.5 2003/01/17 18:50:51 tg Exp $
d27 1
a27 1
against CTM on Tue Jan 21 19:18:44 UTC 2003.
d29 2
a30 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.5 2003/01/17 18:50:51 tg Exp $
### CTM OpenBSD-cvs 2962
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	19 Jan 2003 18:45:51 -0000
d53 1
a53 1
+++ src/usr.sbin/httpd/conf/httpd.conf	19 Jan 2003 18:45:51 -0000
d55 1
a55 1
+#	$MirBSD: obsd.httpd,v 1.11 2003/01/19 18:45:38 tg Exp $
d100 14
a113 1
@@@@ -312,7 +322,7 @@@@
d122 1
a122 1
@@@@ -340,7 +350,6 @@@@
d130 1
a130 1
@@@@ -366,7 +375,7 @@@@
d139 1
a139 1
@@@@ -403,7 +412,7 @@@@
d148 1
a148 1
@@@@ -479,7 +488,7 @@@@
d157 1
a157 1
@@@@ -492,7 +501,7 @@@@
d166 1
a166 1
@@@@ -501,7 +510,7 @@@@
d175 1
a175 1
@@@@ -511,14 +520,14 @@@@
d197 1
a197 1
@@@@ -535,18 +544,18 @@@@
d223 1
a223 1
@@@@ -562,47 +571,47 @@@@
d300 1
a300 1
@@@@ -651,19 +660,19 @@@@
d327 1
a327 1
@@@@ -684,7 +693,7 @@@@
d336 1
a336 1
@@@@ -881,7 +890,7 @@@@
d345 12
a356 1
@@@@ -958,7 +967,7 @@@@
d365 12
a376 1
@@@@ -1016,7 +1025,7 @@@@
d385 5
d396 1
a396 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	19 Jan 2003 18:45:51 -0000
d418 1
a418 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	19 Jan 2003 18:45:51 -0000
d494 1
a494 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	19 Jan 2003 18:45:51 -0000
d509 1
a509 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	19 Jan 2003 18:45:51 -0000
d525 1
a525 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	19 Jan 2003 18:45:51 -0000
d541 1
a541 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	19 Jan 2003 18:45:51 -0000
d570 1
a570 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	19 Jan 2003 18:45:51 -0000
d586 1
a586 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	19 Jan 2003 18:45:51 -0000
d601 1
a601 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	19 Jan 2003 18:45:51 -0000
d616 1
a616 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	19 Jan 2003 18:45:51 -0000
d644 1
a644 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	19 Jan 2003 18:45:51 -0000
d659 1
a659 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	19 Jan 2003 18:45:51 -0000
d674 1
a674 1
+++ src/usr.sbin/httpd/src/Configure	19 Jan 2003 18:45:51 -0000
d823 1
a823 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	19 Jan 2003 18:45:51 -0000
d906 1
a906 1
+++ src/usr.sbin/httpd/src/include/ap.h	19 Jan 2003 18:45:51 -0000
d923 1
a923 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	19 Jan 2003 18:45:51 -0000
d1012 1
a1012 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	19 Jan 2003 18:45:51 -0000
d1029 1
a1029 1
+++ src/usr.sbin/httpd/src/include/http_core.h	19 Jan 2003 18:45:51 -0000
d1046 1
a1046 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	19 Jan 2003 18:45:51 -0000
d1062 1
a1062 1
+++ src/usr.sbin/httpd/src/include/httpd.h	19 Jan 2003 18:45:51 -0000
d1123 1
a1123 1
+++ src/usr.sbin/httpd/src/main/http_config.c	19 Jan 2003 18:45:51 -0000
d1192 1
a1192 1
+++ src/usr.sbin/httpd/src/main/http_core.c	19 Jan 2003 18:45:51 -0000
d1579 1
a1579 1
+++ src/usr.sbin/httpd/src/main/http_main.c	19 Jan 2003 18:45:52 -0000
d1957 1
a1957 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	19 Jan 2003 18:45:52 -0000
d2610 1
a2610 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	19 Jan 2003 18:45:52 -0000
d2754 1
a2754 1
+++ src/usr.sbin/httpd/src/main/util.c	19 Jan 2003 18:45:52 -0000
d2945 1
a2945 1
+++ src/usr.sbin/httpd/src/main/util_script.c	19 Jan 2003 18:45:52 -0000
d3002 1
a3002 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	19 Jan 2003 18:45:52 -0000
d3104 1
a3104 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	19 Jan 2003 18:45:52 -0000
d3163 1
a3163 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	19 Jan 2003 18:45:52 -0000
d3179 1
a3179 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	19 Jan 2003 18:45:52 -0000
d3374 1
a3374 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	19 Jan 2003 18:45:52 -0000
d3683 1
a3683 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	19 Jan 2003 18:45:52 -0000
d3959 1
a3959 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	19 Jan 2003 18:45:52 -0000
d4117 1
a4117 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	19 Jan 2003 18:45:52 -0000
d4515 1
a4515 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	19 Jan 2003 18:45:52 -0000
d4650 1
a4650 1
+++ src/usr.sbin/httpd/src/support/ab.c	19 Jan 2003 18:45:52 -0000
d4810 1
a4810 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	19 Jan 2003 18:45:52 -0000
d5057 2
a5058 2
--- /dev/null	Tue Jan 21 18:57:41 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sun Jan 19 18:45:52 2003
d5105 2
a5106 2
--- /dev/null	Tue Jan 21 18:57:41 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sun Jan 19 18:45:52 2003
d5165 2
a5166 2
--- /dev/null	Tue Jan 21 18:57:41 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sun Jan 19 18:45:52 2003
d5334 2
a5335 2
--- /dev/null	Tue Jan 21 18:57:41 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sun Jan 19 18:45:52 2003
d5490 2
a5491 2
. add microBSD jumbo patch minor kernel fixes (j; mod me; partially merged)
. add new ulimit (humantime) (jedi/sector one)
a5492 3
. be lazy and don't have a SECURITY AUDIT done yet (me, henning@@)
. build using gcc-3.2
. get back some of the humantime documentation (j)
@


1.11
log
@fuck you cvs(1)
@
text
@d27 1
a27 1
against CTM on Sun Jan 19 18:43:23 UTC 2003.
d30 1
a30 1
### CTM OpenBSD-cvs 2956
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	17 Jan 2003 18:27:19 -0000
d53 3
a55 3
+++ src/usr.sbin/httpd/conf/httpd.conf	17 Jan 2003 18:27:19 -0000
@@@@ -1,5 +1,6 @@@@
+#	$MirBSD: obsd.httpd,v 1.10 2003/01/17 18:26:38 tg Exp $
d59 1
a59 3
 #
 # This is the main Apache server configuration file.  It contains the
@@@@ -77,6 +77,7 @@@@
d67 1
a67 1
@@@@ -132,14 +133,14 @@@@
d85 1
a85 1
@@@@ -169,6 +170,14 @@@@
d100 1
a100 1
@@@@ -312,7 +321,7 @@@@
d109 1
a109 1
@@@@ -340,7 +349,6 @@@@
d117 1
a117 1
@@@@ -366,7 +374,7 @@@@
d126 1
a126 1
@@@@ -403,7 +411,7 @@@@
d135 1
a135 1
@@@@ -479,7 +487,7 @@@@
d144 1
a144 1
@@@@ -492,7 +500,7 @@@@
d153 1
a153 1
@@@@ -501,7 +509,7 @@@@
d162 1
a162 1
@@@@ -511,14 +519,14 @@@@
d184 1
a184 1
@@@@ -535,18 +543,18 @@@@
d210 1
a210 1
@@@@ -562,47 +570,47 @@@@
d287 1
a287 1
@@@@ -651,19 +659,19 @@@@
d314 1
a314 1
@@@@ -684,7 +692,7 @@@@
d323 1
a323 1
@@@@ -881,7 +889,7 @@@@
d332 1
a332 1
@@@@ -958,7 +966,7 @@@@
d341 1
a341 1
@@@@ -1016,7 +1024,7 @@@@
d356 1
a356 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	17 Jan 2003 18:27:19 -0000
d378 1
a378 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	17 Jan 2003 18:27:20 -0000
d454 1
a454 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	17 Jan 2003 18:27:20 -0000
d469 1
a469 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	17 Jan 2003 18:27:20 -0000
d485 1
a485 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	17 Jan 2003 18:27:20 -0000
d501 1
a501 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	17 Jan 2003 18:27:20 -0000
d530 1
a530 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	17 Jan 2003 18:27:20 -0000
d546 1
a546 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	17 Jan 2003 18:27:20 -0000
d561 1
a561 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	17 Jan 2003 18:27:20 -0000
d576 1
a576 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	17 Jan 2003 18:27:20 -0000
d604 1
a604 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	17 Jan 2003 18:27:20 -0000
d619 1
a619 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	17 Jan 2003 18:27:23 -0000
d634 1
a634 1
+++ src/usr.sbin/httpd/src/Configure	17 Jan 2003 18:27:23 -0000
d783 1
a783 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	17 Jan 2003 18:27:23 -0000
d866 1
a866 1
+++ src/usr.sbin/httpd/src/include/ap.h	17 Jan 2003 18:27:23 -0000
d883 1
a883 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	17 Jan 2003 18:27:23 -0000
d972 1
a972 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	17 Jan 2003 18:27:23 -0000
d989 1
a989 1
+++ src/usr.sbin/httpd/src/include/http_core.h	17 Jan 2003 18:27:23 -0000
d1006 1
a1006 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	17 Jan 2003 18:27:23 -0000
d1022 1
a1022 1
+++ src/usr.sbin/httpd/src/include/httpd.h	17 Jan 2003 18:27:23 -0000
d1083 1
a1083 1
+++ src/usr.sbin/httpd/src/main/http_config.c	17 Jan 2003 18:27:23 -0000
d1152 1
a1152 1
+++ src/usr.sbin/httpd/src/main/http_core.c	17 Jan 2003 18:27:23 -0000
d1539 1
a1539 1
+++ src/usr.sbin/httpd/src/main/http_main.c	17 Jan 2003 18:27:24 -0000
d1917 1
a1917 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	17 Jan 2003 18:27:24 -0000
d2570 1
a2570 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	17 Jan 2003 18:27:24 -0000
d2714 1
a2714 1
+++ src/usr.sbin/httpd/src/main/util.c	17 Jan 2003 18:27:24 -0000
d2905 1
a2905 1
+++ src/usr.sbin/httpd/src/main/util_script.c	17 Jan 2003 18:27:24 -0000
d2962 1
a2962 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	17 Jan 2003 18:27:24 -0000
d3064 1
a3064 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	17 Jan 2003 18:27:24 -0000
d3123 1
a3123 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	17 Jan 2003 18:27:24 -0000
d3139 1
a3139 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	17 Jan 2003 18:27:24 -0000
d3334 1
a3334 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	17 Jan 2003 18:27:24 -0000
d3643 1
a3643 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	17 Jan 2003 18:27:24 -0000
d3919 1
a3919 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	17 Jan 2003 18:27:24 -0000
d4077 1
a4077 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	17 Jan 2003 18:27:24 -0000
d4475 1
a4475 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	17 Jan 2003 18:27:24 -0000
d4610 1
a4610 1
+++ src/usr.sbin/httpd/src/support/ab.c	17 Jan 2003 18:27:24 -0000
d4770 1
a4770 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	17 Jan 2003 18:27:24 -0000
d5017 2
a5018 2
--- /dev/null	Sun Jan 19 18:20:15 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Fri Jan 17 18:27:24 2003
d5065 2
a5066 2
--- /dev/null	Sun Jan 19 18:20:15 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Fri Jan 17 18:27:24 2003
d5125 2
a5126 2
--- /dev/null	Sun Jan 19 18:20:15 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Fri Jan 17 18:27:24 2003
d5294 2
a5295 2
--- /dev/null	Sun Jan 19 18:20:15 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Fri Jan 17 18:27:24 2003
@


1.10
log
@sync
compile
@
text
@d25 1
a25 1
This diff, ID : regen-obsdp.sh,v 1.4 2003/01/10 21:37:46 tg Exp $
d27 1
a27 1
against CTM on Fri Jan 17 18:13:27 UTC 2003.
d29 2
a30 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.4 2003/01/10 21:37:46 tg Exp $
### CTM OpenBSD-cvs 2953
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	16 Jan 2003 14:48:20 -0000
d53 4
a56 3
+++ src/usr.sbin/httpd/conf/httpd.conf	16 Jan 2003 14:48:20 -0000
@@@@ -1,5 +1,5 @@@@
-#	$OpenBSD: httpd.conf,v 1.15 2002/10/06 12:00:21 henning Exp $
a57 1
+#	$MirBSD: obsd.httpd,v 1.9 2003/01/16 14:47:50 tg Exp $
d358 1
a358 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	16 Jan 2003 14:48:20 -0000
d380 1
a380 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	16 Jan 2003 14:48:20 -0000
d456 1
a456 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	16 Jan 2003 14:48:20 -0000
d471 1
a471 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	16 Jan 2003 14:48:20 -0000
d487 1
a487 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	16 Jan 2003 14:48:20 -0000
d503 1
a503 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	16 Jan 2003 14:48:20 -0000
d532 1
a532 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	16 Jan 2003 14:48:20 -0000
d548 1
a548 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	16 Jan 2003 14:48:20 -0000
d563 1
a563 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	16 Jan 2003 14:48:20 -0000
d578 1
a578 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	16 Jan 2003 14:48:20 -0000
d606 1
a606 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	16 Jan 2003 14:48:20 -0000
d621 1
a621 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	16 Jan 2003 14:48:20 -0000
d636 1
a636 1
+++ src/usr.sbin/httpd/src/Configure	16 Jan 2003 14:48:20 -0000
d785 1
a785 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	16 Jan 2003 14:48:20 -0000
d868 1
a868 1
+++ src/usr.sbin/httpd/src/include/ap.h	16 Jan 2003 14:48:20 -0000
d885 1
a885 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	16 Jan 2003 14:48:23 -0000
d974 1
a974 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	16 Jan 2003 14:48:23 -0000
d991 1
a991 1
+++ src/usr.sbin/httpd/src/include/http_core.h	16 Jan 2003 14:48:23 -0000
d1008 1
a1008 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	16 Jan 2003 14:48:23 -0000
d1024 1
a1024 1
+++ src/usr.sbin/httpd/src/include/httpd.h	16 Jan 2003 14:48:24 -0000
d1085 1
a1085 1
+++ src/usr.sbin/httpd/src/main/http_config.c	16 Jan 2003 14:48:24 -0000
d1154 1
a1154 1
+++ src/usr.sbin/httpd/src/main/http_core.c	16 Jan 2003 14:48:24 -0000
d1541 1
a1541 1
+++ src/usr.sbin/httpd/src/main/http_main.c	16 Jan 2003 14:48:24 -0000
d1919 1
a1919 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	16 Jan 2003 14:48:25 -0000
d2572 1
a2572 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	16 Jan 2003 14:48:25 -0000
d2716 1
a2716 1
+++ src/usr.sbin/httpd/src/main/util.c	16 Jan 2003 14:48:25 -0000
d2907 1
a2907 1
+++ src/usr.sbin/httpd/src/main/util_script.c	16 Jan 2003 14:48:25 -0000
d2964 1
a2964 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	16 Jan 2003 14:48:25 -0000
d3066 1
a3066 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	16 Jan 2003 14:48:25 -0000
d3125 1
a3125 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	16 Jan 2003 14:48:25 -0000
d3141 1
a3141 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	16 Jan 2003 14:48:25 -0000
d3336 1
a3336 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	16 Jan 2003 14:48:25 -0000
d3645 1
a3645 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	16 Jan 2003 14:48:25 -0000
d3921 1
a3921 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	16 Jan 2003 14:48:25 -0000
d4079 1
a4079 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	16 Jan 2003 14:48:25 -0000
d4477 1
a4477 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	16 Jan 2003 14:48:25 -0000
d4612 1
a4612 1
+++ src/usr.sbin/httpd/src/support/ab.c	16 Jan 2003 14:48:25 -0000
d4772 1
a4772 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	16 Jan 2003 14:48:25 -0000
d5019 2
a5020 2
--- /dev/null	Fri Jan 17 18:11:08 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Thu Jan 16 14:48:25 2003
d5067 2
a5068 2
--- /dev/null	Fri Jan 17 18:11:08 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Thu Jan 16 14:48:25 2003
d5127 2
a5128 2
--- /dev/null	Fri Jan 17 18:11:08 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Thu Jan 16 14:48:25 2003
d5296 2
a5297 2
--- /dev/null	Fri Jan 17 18:11:08 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Thu Jan 16 14:48:25 2003
@


1.9
log
@sync with -current
prepare for libpthread
convert ports to flavour style
dont use! untested
@
text
@d27 1
a27 1
against CTM on Thu Jan 16 14:45:00 UTC 2003.
d30 1
a30 1
### CTM OpenBSD-cvs 2950
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	10 Jan 2003 19:46:17 -0000
d53 1
a53 1
+++ src/usr.sbin/httpd/conf/httpd.conf	10 Jan 2003 19:46:17 -0000
d57 1
a57 1
+#	$MirBSD: obsd.httpd,v 1.8 2003/01/10 19:45:29 tg Exp $
d358 1
a358 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	10 Jan 2003 19:46:18 -0000
d380 1
a380 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	10 Jan 2003 19:46:18 -0000
d456 1
a456 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	10 Jan 2003 19:46:18 -0000
d471 1
a471 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	10 Jan 2003 19:46:18 -0000
d487 1
a487 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	10 Jan 2003 19:46:18 -0000
d503 1
a503 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	10 Jan 2003 19:46:18 -0000
d532 1
a532 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	10 Jan 2003 19:46:18 -0000
d548 1
a548 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	10 Jan 2003 19:46:18 -0000
d563 1
a563 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	10 Jan 2003 19:46:18 -0000
d578 1
a578 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	10 Jan 2003 19:46:18 -0000
d606 1
a606 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	10 Jan 2003 19:46:18 -0000
d621 1
a621 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	10 Jan 2003 19:46:18 -0000
d636 1
a636 1
+++ src/usr.sbin/httpd/src/Configure	10 Jan 2003 19:46:18 -0000
d785 1
a785 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	10 Jan 2003 19:46:18 -0000
d868 1
a868 1
+++ src/usr.sbin/httpd/src/include/ap.h	10 Jan 2003 19:46:18 -0000
d885 1
a885 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	10 Jan 2003 19:46:18 -0000
d974 1
a974 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	10 Jan 2003 19:46:18 -0000
d991 1
a991 1
+++ src/usr.sbin/httpd/src/include/http_core.h	10 Jan 2003 19:46:18 -0000
d1008 1
a1008 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	10 Jan 2003 19:46:18 -0000
d1024 1
a1024 1
+++ src/usr.sbin/httpd/src/include/httpd.h	10 Jan 2003 19:46:18 -0000
d1085 1
a1085 1
+++ src/usr.sbin/httpd/src/main/http_config.c	10 Jan 2003 19:46:18 -0000
d1154 1
a1154 1
+++ src/usr.sbin/httpd/src/main/http_core.c	10 Jan 2003 19:46:18 -0000
d1541 1
a1541 1
+++ src/usr.sbin/httpd/src/main/http_main.c	10 Jan 2003 19:46:18 -0000
d1919 1
a1919 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	10 Jan 2003 19:46:18 -0000
d2572 1
a2572 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	10 Jan 2003 19:46:18 -0000
d2716 1
a2716 1
+++ src/usr.sbin/httpd/src/main/util.c	10 Jan 2003 19:46:18 -0000
d2907 1
a2907 1
+++ src/usr.sbin/httpd/src/main/util_script.c	10 Jan 2003 19:46:18 -0000
d2964 1
a2964 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	10 Jan 2003 19:46:18 -0000
d3066 1
a3066 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	10 Jan 2003 19:46:19 -0000
d3125 1
a3125 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	10 Jan 2003 19:46:21 -0000
d3141 1
a3141 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	10 Jan 2003 19:46:21 -0000
d3336 1
a3336 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	10 Jan 2003 19:46:22 -0000
d3645 1
a3645 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	10 Jan 2003 19:46:22 -0000
d3921 1
a3921 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	10 Jan 2003 19:46:22 -0000
d4079 1
a4079 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	10 Jan 2003 19:46:22 -0000
d4477 1
a4477 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	10 Jan 2003 19:46:22 -0000
d4612 1
a4612 1
+++ src/usr.sbin/httpd/src/support/ab.c	10 Jan 2003 19:46:22 -0000
d4772 1
a4772 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	10 Jan 2003 19:46:22 -0000
d5019 2
a5020 2
--- /dev/null	Thu Jan 16 14:11:16 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Fri Jan 10 19:46:22 2003
d5067 2
a5068 2
--- /dev/null	Thu Jan 16 14:11:16 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Fri Jan 10 19:46:22 2003
d5127 2
a5128 2
--- /dev/null	Thu Jan 16 14:11:16 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Fri Jan 10 19:46:22 2003
d5296 2
a5297 2
--- /dev/null	Thu Jan 16 14:11:16 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Fri Jan 10 19:46:22 2003
@


1.8
log
@make build release. all ok. sync
@
text
@d25 3
a27 2
This diff (/usr/ports/mystuff/httpd-metafiles to obsd.httpd) is made
against CTM on Fri Jan 10 19:40:35 UTC 2003.
d29 2
a30 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.3 2003/01/06 01:52:24 tg Exp $
### CTM OpenBSD-cvs 2932
d37 1
a37 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	6 Jan 2003 16:24:01 -0000
d53 1
a53 1
+++ src/usr.sbin/httpd/conf/httpd.conf	6 Jan 2003 16:24:01 -0000
d57 1
a57 1
+#	$MirBSD: obsd.httpd,v 1.7 2003/01/06 16:23:42 tg Exp $
d358 1
a358 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	6 Jan 2003 16:24:01 -0000
d380 1
a380 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	6 Jan 2003 16:24:06 -0000
d456 1
a456 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	6 Jan 2003 16:24:07 -0000
d471 1
a471 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	6 Jan 2003 16:24:07 -0000
d487 1
a487 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	6 Jan 2003 16:24:07 -0000
d503 1
a503 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	6 Jan 2003 16:24:07 -0000
d532 1
a532 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	6 Jan 2003 16:24:07 -0000
d548 1
a548 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	6 Jan 2003 16:24:07 -0000
d563 1
a563 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	6 Jan 2003 16:24:07 -0000
d578 1
a578 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	6 Jan 2003 16:24:07 -0000
d606 1
a606 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	6 Jan 2003 16:24:07 -0000
d621 1
a621 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	6 Jan 2003 16:24:07 -0000
d636 1
a636 1
+++ src/usr.sbin/httpd/src/Configure	6 Jan 2003 16:24:07 -0000
d785 1
a785 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	6 Jan 2003 16:24:07 -0000
d868 1
a868 1
+++ src/usr.sbin/httpd/src/include/ap.h	6 Jan 2003 16:24:07 -0000
d885 1
a885 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	6 Jan 2003 16:24:07 -0000
d974 1
a974 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	6 Jan 2003 16:24:07 -0000
d991 1
a991 1
+++ src/usr.sbin/httpd/src/include/http_core.h	6 Jan 2003 16:24:07 -0000
d1008 1
a1008 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	6 Jan 2003 16:24:07 -0000
d1024 1
a1024 1
+++ src/usr.sbin/httpd/src/include/httpd.h	6 Jan 2003 16:24:07 -0000
d1085 1
a1085 1
+++ src/usr.sbin/httpd/src/main/http_config.c	6 Jan 2003 16:24:07 -0000
d1154 1
a1154 1
+++ src/usr.sbin/httpd/src/main/http_core.c	6 Jan 2003 16:24:07 -0000
d1541 1
a1541 1
+++ src/usr.sbin/httpd/src/main/http_main.c	6 Jan 2003 16:24:07 -0000
d1919 1
a1919 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	6 Jan 2003 16:24:07 -0000
d2572 1
a2572 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	6 Jan 2003 16:24:07 -0000
d2716 1
a2716 1
+++ src/usr.sbin/httpd/src/main/util.c	6 Jan 2003 16:24:07 -0000
d2907 1
a2907 1
+++ src/usr.sbin/httpd/src/main/util_script.c	6 Jan 2003 16:24:07 -0000
d2964 1
a2964 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	6 Jan 2003 16:24:08 -0000
d3066 1
a3066 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	6 Jan 2003 16:24:08 -0000
d3125 1
a3125 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	6 Jan 2003 16:24:08 -0000
d3141 1
a3141 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	6 Jan 2003 16:24:08 -0000
d3336 1
a3336 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	6 Jan 2003 16:24:08 -0000
d3645 1
a3645 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	10 Jan 2003 15:54:54 -0000
d3921 1
a3921 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	6 Jan 2003 16:24:08 -0000
d4079 1
a4079 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	6 Jan 2003 16:24:08 -0000
d4477 1
a4477 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	6 Jan 2003 16:24:08 -0000
d4612 1
a4612 1
+++ src/usr.sbin/httpd/src/support/ab.c	6 Jan 2003 16:24:08 -0000
d4772 1
a4772 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	6 Jan 2003 16:24:08 -0000
d5019 2
a5020 2
--- /dev/null	Fri Jan 10 19:12:14 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Mon Jan  6 16:24:08 2003
d5067 2
a5068 2
--- /dev/null	Fri Jan 10 19:12:14 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Mon Jan  6 16:24:09 2003
d5127 2
a5128 2
--- /dev/null	Fri Jan 10 19:12:14 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Mon Jan  6 16:24:09 2003
d5296 2
a5297 2
--- /dev/null	Fri Jan 10 19:12:14 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Mon Jan  6 16:24:09 2003
@


1.7
log
@sync for xsa; make index; nothing new
@
text
@d26 1
a26 1
against CTM on Mon Jan  6 16:20:23 UTC 2003.
d29 1
a29 1
### CTM OpenBSD-cvs 2920
d36 1
a36 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	5 Jan 2003 22:55:56 -0000
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	5 Jan 2003 22:55:56 -0000
d56 1
a56 1
+#	$MirBSD: obsd.httpd,v 1.6 2003/01/05 22:53:18 tg Exp $
d357 1
a357 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	5 Jan 2003 22:55:56 -0000
d379 1
a379 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	5 Jan 2003 22:55:56 -0000
d455 1
a455 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	5 Jan 2003 22:55:56 -0000
d470 1
a470 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	5 Jan 2003 22:55:56 -0000
d486 1
a486 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	5 Jan 2003 22:55:56 -0000
d502 1
a502 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	5 Jan 2003 22:55:56 -0000
d531 1
a531 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	5 Jan 2003 22:55:56 -0000
d547 1
a547 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	5 Jan 2003 22:55:56 -0000
d562 1
a562 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	5 Jan 2003 22:55:56 -0000
d577 1
a577 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	5 Jan 2003 22:55:56 -0000
d605 1
a605 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	5 Jan 2003 22:55:56 -0000
d620 1
a620 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	5 Jan 2003 22:55:56 -0000
d635 1
a635 1
+++ src/usr.sbin/httpd/src/Configure	5 Jan 2003 22:55:56 -0000
d784 1
a784 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	5 Jan 2003 22:55:56 -0000
d867 1
a867 1
+++ src/usr.sbin/httpd/src/include/ap.h	5 Jan 2003 22:55:56 -0000
d884 1
a884 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	5 Jan 2003 22:55:57 -0000
d973 1
a973 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	5 Jan 2003 22:55:57 -0000
d990 1
a990 1
+++ src/usr.sbin/httpd/src/include/http_core.h	5 Jan 2003 22:55:57 -0000
d1007 1
a1007 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	5 Jan 2003 22:55:57 -0000
d1023 1
a1023 1
+++ src/usr.sbin/httpd/src/include/httpd.h	5 Jan 2003 22:55:57 -0000
d1084 1
a1084 1
+++ src/usr.sbin/httpd/src/main/http_config.c	5 Jan 2003 22:55:57 -0000
d1153 1
a1153 1
+++ src/usr.sbin/httpd/src/main/http_core.c	5 Jan 2003 22:56:00 -0000
d1540 1
a1540 1
+++ src/usr.sbin/httpd/src/main/http_main.c	5 Jan 2003 22:56:00 -0000
d1918 1
a1918 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	5 Jan 2003 22:56:00 -0000
d2571 1
a2571 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	5 Jan 2003 22:56:00 -0000
d2715 1
a2715 1
+++ src/usr.sbin/httpd/src/main/util.c	5 Jan 2003 22:56:00 -0000
d2906 1
a2906 1
+++ src/usr.sbin/httpd/src/main/util_script.c	5 Jan 2003 22:56:00 -0000
d2963 1
a2963 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	5 Jan 2003 22:56:00 -0000
d3065 1
a3065 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	5 Jan 2003 22:56:00 -0000
d3124 1
a3124 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	5 Jan 2003 22:56:00 -0000
d3140 1
a3140 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	5 Jan 2003 22:56:00 -0000
d3335 1
a3335 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	5 Jan 2003 22:56:00 -0000
d3644 1
a3644 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	5 Jan 2003 22:56:00 -0000
d3664 11
a3674 1
@@@@ -194,6 +193,8 @@@@
d3683 1
a3683 1
@@@@ -213,7 +214,25 @@@@
d3710 1
a3710 1
@@@@ -222,80 +241,91 @@@@
d3850 1
a3850 1
@@@@ -597,31 +627,44 @@@@
d3920 1
a3920 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	5 Jan 2003 22:56:00 -0000
d4078 1
a4078 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	5 Jan 2003 22:56:01 -0000
d4476 1
a4476 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	5 Jan 2003 22:56:01 -0000
d4611 1
a4611 1
+++ src/usr.sbin/httpd/src/support/ab.c	5 Jan 2003 22:56:01 -0000
d4771 1
a4771 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	5 Jan 2003 22:56:01 -0000
d5018 2
a5019 2
--- /dev/null	Mon Jan  6 16:10:50 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Sun Jan  5 22:56:01 2003
d5066 2
a5067 2
--- /dev/null	Mon Jan  6 16:10:50 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Sun Jan  5 22:56:01 2003
d5126 2
a5127 2
--- /dev/null	Mon Jan  6 16:10:50 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Sun Jan  5 22:56:01 2003
d5295 2
a5296 2
--- /dev/null	Mon Jan  6 16:10:50 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Sun Jan  5 22:56:01 2003
d5457 1
@


1.6
log
@tg@@n1:/home/tg $ uname -a
OpenBSD n1.BOFH.gott.cx 3.2-20021231 GENERIC#132 i386

That one did fairly well, but there's a lot more commits,
diffs, conflicts, new sendmail, byebye amiga, etc. pp
@
text
@d4 1
a4 1
Copyright (c) 2000-2002 by Thorsten "mirabile" Glaser <x86@@ePost.de>
d26 1
a26 1
against CTM on Sun Jan  5 22:09:41 UTC 2003.
d28 2
a29 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.2 2002/12/20 19:11:26 tg Exp $
### CTM OpenBSD-cvs 2917
d36 1
a36 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	5 Jan 2003 21:08:19 -0000
d52 3
a54 4
+++ src/usr.sbin/httpd/conf/httpd.conf	31 Dec 2002 01:39:28 -0000
@@@@ -1,3 +1,4 @@@@
+#	$MirBSD: obsd.httpd,v 1.5 2002/12/31 01:38:57 tg Exp $
 #	$OpenBSD: httpd.conf,v 1.15 2002/10/06 12:00:21 henning Exp $
d56 1
d58 3
a60 1
@@@@ -77,6 +78,7 @@@@
d68 1
a68 1
@@@@ -132,14 +134,14 @@@@
d86 1
a86 1
@@@@ -169,6 +171,14 @@@@
d101 1
a101 1
@@@@ -312,7 +322,7 @@@@
d110 1
a110 1
@@@@ -340,7 +350,6 @@@@
d118 1
a118 1
@@@@ -366,7 +375,7 @@@@
d127 1
a127 1
@@@@ -403,7 +412,7 @@@@
d136 1
a136 1
@@@@ -479,7 +488,7 @@@@
d145 1
a145 1
@@@@ -492,7 +501,7 @@@@
d154 1
a154 1
@@@@ -501,7 +510,7 @@@@
d163 1
a163 1
@@@@ -511,14 +520,14 @@@@
d185 1
a185 1
@@@@ -535,18 +544,18 @@@@
d211 1
a211 1
@@@@ -562,47 +571,47 @@@@
d288 1
a288 1
@@@@ -651,19 +660,19 @@@@
d315 1
a315 1
@@@@ -684,7 +693,7 @@@@
d324 1
a324 1
@@@@ -881,7 +890,7 @@@@
d333 1
a333 1
@@@@ -958,7 +967,7 @@@@
d342 1
a342 1
@@@@ -1016,7 +1025,7 @@@@
a350 5
@@@@ -1027,4 +1036,3 @@@@
 </VirtualHost>                                  
 
 </IfDefine>
-
d357 1
a357 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	31 Dec 2002 01:39:28 -0000
d379 1
a379 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	31 Dec 2002 01:39:28 -0000
d455 1
a455 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	31 Dec 2002 01:39:28 -0000
d470 1
a470 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	31 Dec 2002 01:39:28 -0000
d486 1
a486 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	31 Dec 2002 01:39:28 -0000
d502 1
a502 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	31 Dec 2002 01:39:28 -0000
d531 1
a531 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	31 Dec 2002 01:39:29 -0000
d547 1
a547 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	31 Dec 2002 01:39:29 -0000
d562 1
a562 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	31 Dec 2002 01:39:29 -0000
d577 1
a577 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	31 Dec 2002 01:39:29 -0000
d605 1
a605 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	31 Dec 2002 01:39:29 -0000
d620 1
a620 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	31 Dec 2002 01:39:30 -0000
d635 1
a635 1
+++ src/usr.sbin/httpd/src/Configure	31 Dec 2002 01:39:30 -0000
d784 1
a784 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	31 Dec 2002 01:39:30 -0000
d867 1
a867 1
+++ src/usr.sbin/httpd/src/include/ap.h	31 Dec 2002 01:39:30 -0000
d884 1
a884 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	31 Dec 2002 01:39:30 -0000
d973 1
a973 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	31 Dec 2002 01:39:30 -0000
d990 1
a990 1
+++ src/usr.sbin/httpd/src/include/http_core.h	31 Dec 2002 01:39:30 -0000
d1007 1
a1007 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	31 Dec 2002 01:39:30 -0000
d1023 1
a1023 1
+++ src/usr.sbin/httpd/src/include/httpd.h	31 Dec 2002 01:39:30 -0000
d1084 1
a1084 1
+++ src/usr.sbin/httpd/src/main/http_config.c	31 Dec 2002 01:39:30 -0000
d1153 1
a1153 1
+++ src/usr.sbin/httpd/src/main/http_core.c	31 Dec 2002 01:39:33 -0000
d1540 1
a1540 1
+++ src/usr.sbin/httpd/src/main/http_main.c	31 Dec 2002 01:39:33 -0000
d1918 1
a1918 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	31 Dec 2002 01:39:34 -0000
d2571 1
a2571 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	31 Dec 2002 01:39:34 -0000
d2715 1
a2715 1
+++ src/usr.sbin/httpd/src/main/util.c	31 Dec 2002 01:39:34 -0000
d2906 1
a2906 1
+++ src/usr.sbin/httpd/src/main/util_script.c	31 Dec 2002 01:39:34 -0000
d2963 1
a2963 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	31 Dec 2002 01:39:34 -0000
d3065 1
a3065 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	31 Dec 2002 01:39:34 -0000
d3124 1
a3124 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	31 Dec 2002 01:39:34 -0000
d3140 1
a3140 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	31 Dec 2002 01:39:34 -0000
d3335 1
a3335 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	31 Dec 2002 01:39:34 -0000
d3644 1
a3644 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	31 Dec 2002 01:39:34 -0000
d3664 1
a3664 11
@@@@ -184,9 +183,6 @@@@
     if (conf->cache.root == NULL)
         nocache = 1;
 
-    memset(&server, '\0', sizeof(server));
-    server.sin_family = AF_INET;
-
     /* We break the URL into host, port, path-search */
 
     urlptr = strstr(url, "://");
@@@@ -194,6 +190,8 @@@@
d3673 1
a3673 1
@@@@ -213,7 +211,25 @@@@
d3700 1
a3700 1
@@@@ -222,80 +238,91 @@@@
d3840 1
a3840 1
@@@@ -597,31 +624,44 @@@@
d3910 1
a3910 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	31 Dec 2002 01:39:34 -0000
d4068 1
a4068 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	31 Dec 2002 01:39:34 -0000
d4466 1
a4466 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	31 Dec 2002 01:39:34 -0000
d4601 1
a4601 1
+++ src/usr.sbin/httpd/src/support/ab.c	31 Dec 2002 01:39:34 -0000
d4761 1
a4761 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	31 Dec 2002 01:39:34 -0000
d5008 2
a5009 2
--- /dev/null	Sun Jan  5 21:59:08 2003
+++ src/usr.sbin/httpd/src/include/sa_len.h	Tue Dec 31 01:39:34 2002
d5056 2
a5057 2
--- /dev/null	Sun Jan  5 21:59:08 2003
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Tue Dec 31 01:39:34 2002
d5116 2
a5117 2
--- /dev/null	Sun Jan  5 21:59:08 2003
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Tue Dec 31 01:39:34 2002
d5285 2
a5286 2
--- /dev/null	Sun Jan  5 21:59:08 2003
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Tue Dec 31 01:39:34 2002
@


1.5
log
@sync with -current, not more
@
text
@d26 1
a26 1
against CTM on Tue Dec 31 01:24:58 UTC 2002.
d29 1
a29 1
### CTM OpenBSD-cvs 2909
d33 4
a36 4
retrieving revision 1.37
diff -u -r1.37 Makefile.bsd-wrapper
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	10 Dec 2002 16:57:50 -0000	1.37
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	20 Dec 2002 23:24:50 -0000
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	31 Dec 2002 01:21:41 -0000
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.4 2002/12/20 23:24:35 tg Exp $
d360 1
a360 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	20 Dec 2002 23:24:50 -0000
d382 1
a382 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	20 Dec 2002 23:24:51 -0000
d458 1
a458 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	20 Dec 2002 23:24:51 -0000
d473 1
a473 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	20 Dec 2002 23:24:51 -0000
d489 1
a489 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	20 Dec 2002 23:24:51 -0000
d505 1
a505 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	20 Dec 2002 23:24:51 -0000
d534 1
a534 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	20 Dec 2002 23:24:51 -0000
d550 1
a550 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	20 Dec 2002 23:24:51 -0000
d565 1
a565 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	20 Dec 2002 23:24:51 -0000
d580 1
a580 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	20 Dec 2002 23:24:51 -0000
d608 1
a608 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	20 Dec 2002 23:24:51 -0000
d623 1
a623 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	20 Dec 2002 23:24:51 -0000
d638 1
a638 1
+++ src/usr.sbin/httpd/src/Configure	20 Dec 2002 23:24:51 -0000
d787 1
a787 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	20 Dec 2002 23:24:51 -0000
d870 1
a870 1
+++ src/usr.sbin/httpd/src/include/ap.h	20 Dec 2002 23:24:51 -0000
d887 1
a887 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	20 Dec 2002 23:24:51 -0000
d976 1
a976 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	20 Dec 2002 23:24:52 -0000
d993 1
a993 1
+++ src/usr.sbin/httpd/src/include/http_core.h	20 Dec 2002 23:24:54 -0000
d1010 1
a1010 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	20 Dec 2002 23:24:54 -0000
d1026 1
a1026 1
+++ src/usr.sbin/httpd/src/include/httpd.h	20 Dec 2002 23:24:54 -0000
d1087 1
a1087 1
+++ src/usr.sbin/httpd/src/main/http_config.c	20 Dec 2002 23:24:54 -0000
d1156 1
a1156 1
+++ src/usr.sbin/httpd/src/main/http_core.c	20 Dec 2002 23:24:54 -0000
d1543 1
a1543 1
+++ src/usr.sbin/httpd/src/main/http_main.c	20 Dec 2002 23:24:54 -0000
d1921 1
a1921 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	20 Dec 2002 23:24:54 -0000
d2574 1
a2574 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	20 Dec 2002 23:24:54 -0000
d2718 1
a2718 1
+++ src/usr.sbin/httpd/src/main/util.c	20 Dec 2002 23:24:54 -0000
d2909 1
a2909 1
+++ src/usr.sbin/httpd/src/main/util_script.c	20 Dec 2002 23:24:54 -0000
d2966 1
a2966 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	20 Dec 2002 23:24:54 -0000
d3068 1
a3068 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	20 Dec 2002 23:24:54 -0000
d3127 1
a3127 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	20 Dec 2002 23:24:54 -0000
d3143 1
a3143 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	20 Dec 2002 23:24:54 -0000
d3338 1
a3338 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	20 Dec 2002 23:24:55 -0000
d3647 1
a3647 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	20 Dec 2002 23:24:55 -0000
d3923 1
a3923 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	20 Dec 2002 23:24:55 -0000
d4081 1
a4081 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	20 Dec 2002 23:24:55 -0000
d4479 1
a4479 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	20 Dec 2002 23:24:55 -0000
d4614 1
a4614 1
+++ src/usr.sbin/httpd/src/support/ab.c	20 Dec 2002 23:24:55 -0000
d4774 1
a4774 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	20 Dec 2002 23:24:55 -0000
d5021 2
a5022 2
--- /dev/null	Tue Dec 31 00:57:39 2002
+++ src/usr.sbin/httpd/src/include/sa_len.h	Fri Dec 20 23:24:55 2002
d5069 2
a5070 2
--- /dev/null	Tue Dec 31 00:57:39 2002
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Fri Dec 20 23:24:55 2002
d5129 2
a5130 2
--- /dev/null	Tue Dec 31 00:57:39 2002
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Fri Dec 20 23:24:55 2002
d5298 2
a5299 2
--- /dev/null	Tue Dec 31 00:57:39 2002
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Fri Dec 20 23:24:55 2002
@


1.4
log
@sync/update/merge here, too
@
text
@d26 1
a26 1
against CTM on Fri Dec 20 23:23:17 UTC 2002.
d29 1
a29 1
### CTM OpenBSD-cvs 2906
d36 1
a36 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	20 Dec 2002 20:17:15 -0000
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	20 Dec 2002 19:52:34 -0000
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.3 2002/12/05 17:54:39 tg Exp $
d121 1
a121 1
+DirectoryIndex index.htm default.htm index.html
d360 1
a360 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	20 Dec 2002 19:52:34 -0000
d382 1
a382 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	20 Dec 2002 19:52:34 -0000
d458 1
a458 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	20 Dec 2002 19:52:35 -0000
d473 1
a473 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	20 Dec 2002 19:52:35 -0000
d489 1
a489 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	20 Dec 2002 19:52:35 -0000
d505 1
a505 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	20 Dec 2002 19:52:35 -0000
d534 1
a534 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	20 Dec 2002 19:52:35 -0000
d550 1
a550 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	20 Dec 2002 19:52:35 -0000
d565 1
a565 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	20 Dec 2002 19:52:35 -0000
d580 1
a580 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	20 Dec 2002 19:52:35 -0000
d608 1
a608 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	20 Dec 2002 19:52:35 -0000
d623 1
a623 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	20 Dec 2002 19:52:35 -0000
d638 1
a638 1
+++ src/usr.sbin/httpd/src/Configure	20 Dec 2002 19:52:35 -0000
d787 1
a787 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	20 Dec 2002 20:17:21 -0000
d870 1
a870 1
+++ src/usr.sbin/httpd/src/include/ap.h	20 Dec 2002 19:52:35 -0000
d887 1
a887 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	20 Dec 2002 19:52:35 -0000
d976 1
a976 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	20 Dec 2002 19:52:35 -0000
d993 1
a993 1
+++ src/usr.sbin/httpd/src/include/http_core.h	20 Dec 2002 19:52:35 -0000
d1010 1
a1010 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	20 Dec 2002 19:52:35 -0000
d1026 1
a1026 1
+++ src/usr.sbin/httpd/src/include/httpd.h	20 Dec 2002 19:52:35 -0000
d1087 1
a1087 1
+++ src/usr.sbin/httpd/src/main/http_config.c	20 Dec 2002 19:52:35 -0000
d1156 1
a1156 1
+++ src/usr.sbin/httpd/src/main/http_core.c	20 Dec 2002 19:52:35 -0000
d1543 1
a1543 1
+++ src/usr.sbin/httpd/src/main/http_main.c	20 Dec 2002 20:17:25 -0000
d1921 1
a1921 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	20 Dec 2002 19:52:38 -0000
d2574 1
a2574 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	20 Dec 2002 19:52:38 -0000
d2718 1
a2718 1
+++ src/usr.sbin/httpd/src/main/util.c	20 Dec 2002 23:17:52 -0000
d2909 1
a2909 1
+++ src/usr.sbin/httpd/src/main/util_script.c	20 Dec 2002 19:52:38 -0000
d2966 1
a2966 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	20 Dec 2002 19:52:38 -0000
d3068 1
a3068 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	20 Dec 2002 19:52:38 -0000
d3127 1
a3127 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	20 Dec 2002 19:52:38 -0000
d3143 1
a3143 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	20 Dec 2002 19:52:38 -0000
d3338 1
a3338 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	20 Dec 2002 19:52:38 -0000
d3647 1
a3647 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	20 Dec 2002 19:52:38 -0000
d3923 1
a3923 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	20 Dec 2002 19:52:38 -0000
d4081 1
a4081 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	20 Dec 2002 19:52:39 -0000
d4479 1
a4479 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	20 Dec 2002 19:52:39 -0000
d4614 1
a4614 1
+++ src/usr.sbin/httpd/src/support/ab.c	20 Dec 2002 19:52:39 -0000
d4774 1
a4774 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	20 Dec 2002 19:52:39 -0000
d5021 2
a5022 2
--- /dev/null	Fri Dec 20 23:07:58 2002
+++ src/usr.sbin/httpd/src/include/sa_len.h	Fri Dec 20 19:52:39 2002
d5069 2
a5070 2
--- /dev/null	Fri Dec 20 23:07:58 2002
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Fri Dec 20 19:52:39 2002
d5129 2
a5130 2
--- /dev/null	Fri Dec 20 23:07:58 2002
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Fri Dec 20 19:52:39 2002
d5298 2
a5299 2
--- /dev/null	Fri Dec 20 23:07:58 2002
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Fri Dec 20 19:52:39 2002
@


1.3
log
@LAST UPDATE EVER!
@
text
@d6 4
a9 3
Copyright (c) 1968-2002 NOP by the creators of UNIX, BSD / Berkeley
    Unix, NetBSD and OpenBSD. A patched file also shares the licence
    of the file before patching, unless special provisions are made.
d26 1
a26 1
against CTM on Thu Dec  5 16:58:38 UTC 2002.
d28 2
a29 2
### GENERATOR: @@(#)_MirBSD: regen-obsdp.sh,v 1.1 2002/12/03 20:04:25 tg Exp $
### CTM OpenBSD-cvs 2858
d33 4
a36 4
retrieving revision 1.36
diff -u -r1.36 Makefile.bsd-wrapper
--- src/usr.sbin/httpd/Makefile.bsd-wrapper	22 Nov 2002 13:03:12 -0000	1.36
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	4 Dec 2002 19:12:27 -0000
d52 1
a52 1
+++ src/usr.sbin/httpd/conf/httpd.conf	4 Dec 2002 19:12:28 -0000
d54 1
a54 1
+#	$MirBSD: obsd.httpd,v 1.2 2002/12/04 19:11:47 tg Exp $
d360 1
a360 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	4 Dec 2002 19:12:28 -0000
d382 1
a382 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	4 Dec 2002 19:12:28 -0000
d458 1
a458 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	4 Dec 2002 19:12:28 -0000
d473 1
a473 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	4 Dec 2002 19:12:28 -0000
d489 1
a489 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	4 Dec 2002 19:12:28 -0000
d505 1
a505 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	4 Dec 2002 19:12:28 -0000
d534 1
a534 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	4 Dec 2002 19:12:28 -0000
d550 1
a550 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	4 Dec 2002 19:12:28 -0000
d565 1
a565 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	4 Dec 2002 19:12:28 -0000
d580 1
a580 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	4 Dec 2002 19:12:28 -0000
d608 1
a608 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	4 Dec 2002 19:12:28 -0000
d623 1
a623 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	4 Dec 2002 19:12:28 -0000
d638 1
a638 1
+++ src/usr.sbin/httpd/src/Configure	4 Dec 2002 19:12:28 -0000
d784 4
a787 4
retrieving revision 1.8
diff -u -r1.8 ap_snprintf.c
--- src/usr.sbin/httpd/src/ap/ap_snprintf.c	7 Oct 2002 20:22:44 -0000	1.8
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	4 Dec 2002 19:12:28 -0000
d796 1
a796 1
@@@@ -504,6 +505,42 @@@@
d839 1
a839 1
@@@@ -1055,6 +1092,7 @@@@
d847 1
a847 1
@@@@ -1063,6 +1101,16 @@@@
d870 1
a870 1
+++ src/usr.sbin/httpd/src/include/ap.h	4 Dec 2002 19:12:28 -0000
d887 1
a887 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	4 Dec 2002 19:12:28 -0000
d976 1
a976 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	4 Dec 2002 19:12:28 -0000
d993 1
a993 1
+++ src/usr.sbin/httpd/src/include/http_core.h	4 Dec 2002 19:12:28 -0000
d1010 1
a1010 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	4 Dec 2002 19:12:28 -0000
d1026 1
a1026 1
+++ src/usr.sbin/httpd/src/include/httpd.h	4 Dec 2002 19:12:28 -0000
d1087 1
a1087 1
+++ src/usr.sbin/httpd/src/main/http_config.c	4 Dec 2002 19:12:28 -0000
d1156 1
a1156 1
+++ src/usr.sbin/httpd/src/main/http_core.c	4 Dec 2002 19:12:28 -0000
d1540 4
a1543 4
retrieving revision 1.26
diff -u -r1.26 http_main.c
--- src/usr.sbin/httpd/src/main/http_main.c	7 Oct 2002 20:22:44 -0000	1.26
+++ src/usr.sbin/httpd/src/main/http_main.c	4 Dec 2002 19:12:31 -0000
d1921 1
a1921 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	4 Dec 2002 19:12:31 -0000
d2574 1
a2574 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	4 Dec 2002 19:12:32 -0000
d2715 4
a2718 4
retrieving revision 1.12
diff -u -r1.12 util.c
--- src/usr.sbin/httpd/src/main/util.c	19 Jul 2002 21:30:54 -0000	1.12
+++ src/usr.sbin/httpd/src/main/util.c	4 Dec 2002 19:12:32 -0000
d2861 1
a2861 1
-            /* Since we found a fdqn, return it with no logged message. */
d2881 1
a2881 1
     /* If we don't have an fdqn or IP, fall back to the loopback addr */
d2909 1
a2909 1
+++ src/usr.sbin/httpd/src/main/util_script.c	4 Dec 2002 19:12:32 -0000
d2966 1
a2966 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	4 Dec 2002 19:12:32 -0000
d3068 1
a3068 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	4 Dec 2002 19:12:32 -0000
d3127 1
a3127 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	4 Dec 2002 19:12:32 -0000
d3143 1
a3143 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	4 Dec 2002 19:12:32 -0000
d3338 1
a3338 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	4 Dec 2002 19:12:32 -0000
d3647 1
a3647 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	4 Dec 2002 19:12:32 -0000
d3923 1
a3923 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	4 Dec 2002 19:12:32 -0000
d4081 1
a4081 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	4 Dec 2002 19:12:32 -0000
d4479 1
a4479 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	4 Dec 2002 19:12:32 -0000
d4614 1
a4614 1
+++ src/usr.sbin/httpd/src/support/ab.c	4 Dec 2002 19:12:32 -0000
d4774 1
a4774 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	4 Dec 2002 19:12:32 -0000
d5021 2
a5022 2
--- /dev/null	Thu Dec  5 16:15:28 2002
+++ src/usr.sbin/httpd/src/include/sa_len.h	Wed Dec  4 19:12:32 2002
d5069 2
a5070 2
--- /dev/null	Thu Dec  5 16:15:28 2002
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Wed Dec  4 19:12:32 2002
d5129 2
a5130 2
--- /dev/null	Thu Dec  5 16:15:28 2002
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Wed Dec  4 19:12:32 2002
d5298 2
a5299 2
--- /dev/null	Thu Dec  5 16:15:28 2002
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Wed Dec  4 19:12:32 2002
@


1.2
log
@current progress
@
text
@d25 1
a25 1
against CTM on Wed Dec  4 19:04:08 UTC 2002.
d35 1
a35 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	4 Dec 2002 18:13:39 -0000
d51 1
a51 1
+++ src/usr.sbin/httpd/conf/httpd.conf	4 Dec 2002 18:13:39 -0000
d53 1
a53 1
+#	$MirBSD$
d359 1
a359 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	4 Dec 2002 18:13:39 -0000
d381 1
a381 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	4 Dec 2002 18:13:39 -0000
d457 1
a457 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	4 Dec 2002 18:13:39 -0000
d472 1
a472 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	4 Dec 2002 18:13:39 -0000
d488 1
a488 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	4 Dec 2002 18:13:39 -0000
d504 1
a504 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	4 Dec 2002 18:13:39 -0000
d533 1
a533 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	4 Dec 2002 18:13:39 -0000
d549 1
a549 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	4 Dec 2002 18:13:39 -0000
d564 1
a564 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	4 Dec 2002 18:13:39 -0000
d579 1
a579 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	4 Dec 2002 18:13:39 -0000
d607 1
a607 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	4 Dec 2002 18:13:39 -0000
d622 1
a622 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	4 Dec 2002 18:13:39 -0000
d637 1
a637 1
+++ src/usr.sbin/httpd/src/Configure	4 Dec 2002 18:13:39 -0000
d786 1
a786 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	4 Dec 2002 18:13:39 -0000
d869 1
a869 1
+++ src/usr.sbin/httpd/src/include/ap.h	4 Dec 2002 18:13:40 -0000
d886 1
a886 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	4 Dec 2002 18:13:40 -0000
d975 1
a975 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	4 Dec 2002 18:13:40 -0000
d992 1
a992 1
+++ src/usr.sbin/httpd/src/include/http_core.h	4 Dec 2002 18:13:40 -0000
d1009 1
a1009 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	4 Dec 2002 18:13:40 -0000
d1025 1
a1025 1
+++ src/usr.sbin/httpd/src/include/httpd.h	4 Dec 2002 18:13:40 -0000
d1086 1
a1086 1
+++ src/usr.sbin/httpd/src/main/http_config.c	4 Dec 2002 18:13:40 -0000
d1155 1
a1155 1
+++ src/usr.sbin/httpd/src/main/http_core.c	4 Dec 2002 18:13:40 -0000
d1542 1
a1542 1
+++ src/usr.sbin/httpd/src/main/http_main.c	4 Dec 2002 18:13:40 -0000
d1920 1
a1920 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	4 Dec 2002 18:13:40 -0000
d2573 1
a2573 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	4 Dec 2002 18:13:40 -0000
d2717 1
a2717 1
+++ src/usr.sbin/httpd/src/main/util.c	4 Dec 2002 18:13:40 -0000
d2908 1
a2908 1
+++ src/usr.sbin/httpd/src/main/util_script.c	4 Dec 2002 18:13:43 -0000
d2965 1
a2965 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	4 Dec 2002 18:13:43 -0000
d3067 1
a3067 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	4 Dec 2002 18:13:43 -0000
d3126 1
a3126 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	4 Dec 2002 18:13:43 -0000
d3142 1
a3142 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	4 Dec 2002 18:13:43 -0000
d3337 1
a3337 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	4 Dec 2002 18:13:43 -0000
d3646 1
a3646 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	4 Dec 2002 18:13:43 -0000
d3922 1
a3922 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	4 Dec 2002 18:13:43 -0000
d4080 1
a4080 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	4 Dec 2002 18:13:43 -0000
d4478 1
a4478 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	4 Dec 2002 18:13:43 -0000
d4613 1
a4613 1
+++ src/usr.sbin/httpd/src/support/ab.c	4 Dec 2002 18:13:43 -0000
d4773 1
a4773 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	4 Dec 2002 18:13:43 -0000
d5020 2
a5021 2
--- /dev/null	Wed Dec  4 18:57:40 2002
+++ src/usr.sbin/httpd/src/include/sa_len.h	Wed Dec  4 18:13:43 2002
d5068 2
a5069 2
--- /dev/null	Wed Dec  4 18:57:40 2002
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Wed Dec  4 18:13:43 2002
d5128 2
a5129 2
--- /dev/null	Wed Dec  4 18:57:40 2002
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Wed Dec  4 18:13:43 2002
d5297 2
a5298 2
--- /dev/null	Wed Dec  4 18:57:40 2002
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Wed Dec  4 18:13:43 2002
@


1.1
log
@re-import the old BSD-mirabile patches

conversion to MirBSD will take place,
but first the compile problems regarding
the stack protector "propolice" have to
be resolved.
@
text
@d1 2
a2 1
>>> Apache diffs for BSD-mirabile against OpenBSD-current
d5 4
d12 4
a15 4
I retain the right to be known as the author of the work. For no fee
and further restrainments, all patents hold by the author or contri-
butors, applying to this work, shall be licensed to any copy of this
work, whether modified, merged or not.
d23 1
a23 2
Patched files share the license of the original files. - Followed by
the release notes, the list of modified/added files is at the EOF.
d25 1
a25 1
against CTM on Tue Dec  3 15:44:48 UTC 2002.
d27 2
a28 2
### GENERATOR: @@(#)_tgId: regen-obsdp.sh,v 3.19 2002/11/30 22:40:15 tg Exp $
### CTM OpenBSD-cvs 2855
d35 1
a35 1
+++ src/usr.sbin/httpd/Makefile.bsd-wrapper	3 Dec 2002 15:30:43 -0000
d51 1
a51 1
+++ src/usr.sbin/httpd/conf/httpd.conf	3 Dec 2002 15:30:43 -0000
d53 1
a53 1
+#	$tgId: obsd.httpd,v 3.25 2002/12/03 15:46:55 tg Exp $
d359 1
a359 1
+++ src/usr.sbin/httpd/conf/httpd.conf-dist	3 Dec 2002 15:30:43 -0000
d381 1
a381 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/core.html.html	3 Dec 2002 15:30:43 -0000
d457 1
a457 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.de	3 Dec 2002 15:30:43 -0000
d472 1
a472 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.en	3 Dec 2002 15:30:43 -0000
d488 1
a488 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.fr	3 Dec 2002 15:30:43 -0000
d504 1
a504 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.html	3 Dec 2002 15:30:43 -0000
d533 1
a533 1
+++ src/usr.sbin/httpd/htdocs/manual/mod/directives.html.ja.jis	3 Dec 2002 15:30:43 -0000
d549 1
a549 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.en	3 Dec 2002 15:30:44 -0000
d564 1
a564 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.fr	3 Dec 2002 15:30:44 -0000
d579 1
a579 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.html	3 Dec 2002 15:30:44 -0000
d607 1
a607 1
+++ src/usr.sbin/httpd/htdocs/manual/server-wide.html.ja.jis	3 Dec 2002 15:30:44 -0000
d622 1
a622 1
+++ src/usr.sbin/httpd/src/Configuration.tmpl	3 Dec 2002 15:30:44 -0000
d637 1
a637 1
+++ src/usr.sbin/httpd/src/Configure	3 Dec 2002 15:30:44 -0000
d786 1
a786 1
+++ src/usr.sbin/httpd/src/ap/ap_snprintf.c	3 Dec 2002 15:30:44 -0000
d869 1
a869 1
+++ src/usr.sbin/httpd/src/include/ap.h	3 Dec 2002 15:30:44 -0000
d886 1
a886 1
+++ src/usr.sbin/httpd/src/include/ap_config.h	3 Dec 2002 15:30:44 -0000
d975 1
a975 1
+++ src/usr.sbin/httpd/src/include/http_conf_globals.h	3 Dec 2002 15:30:44 -0000
d992 1
a992 1
+++ src/usr.sbin/httpd/src/include/http_core.h	3 Dec 2002 15:30:44 -0000
d1009 1
a1009 1
+++ src/usr.sbin/httpd/src/include/http_vhost.h	3 Dec 2002 15:30:44 -0000
d1025 1
a1025 1
+++ src/usr.sbin/httpd/src/include/httpd.h	3 Dec 2002 15:30:44 -0000
d1086 1
a1086 1
+++ src/usr.sbin/httpd/src/main/http_config.c	3 Dec 2002 15:30:44 -0000
d1155 1
a1155 1
+++ src/usr.sbin/httpd/src/main/http_core.c	3 Dec 2002 15:30:44 -0000
d1542 1
a1542 1
+++ src/usr.sbin/httpd/src/main/http_main.c	3 Dec 2002 15:30:48 -0000
d1920 1
a1920 1
+++ src/usr.sbin/httpd/src/main/http_vhost.c	3 Dec 2002 15:30:48 -0000
d2573 1
a2573 1
+++ src/usr.sbin/httpd/src/main/rfc1413.c	3 Dec 2002 15:30:48 -0000
d2717 1
a2717 1
+++ src/usr.sbin/httpd/src/main/util.c	3 Dec 2002 15:30:48 -0000
d2908 1
a2908 1
+++ src/usr.sbin/httpd/src/main/util_script.c	3 Dec 2002 15:30:48 -0000
d2965 1
a2965 1
+++ src/usr.sbin/httpd/src/main/util_uri.c	3 Dec 2002 15:30:48 -0000
d3067 1
a3067 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.c	3 Dec 2002 15:30:48 -0000
d3126 1
a3126 1
+++ src/usr.sbin/httpd/src/modules/proxy/mod_proxy.h	3 Dec 2002 15:30:48 -0000
d3142 1
a3142 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_connect.c	3 Dec 2002 15:30:48 -0000
d3337 1
a3337 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_ftp.c	3 Dec 2002 15:30:48 -0000
d3646 1
a3646 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_http.c	3 Dec 2002 15:30:48 -0000
d3922 1
a3922 1
+++ src/usr.sbin/httpd/src/modules/proxy/proxy_util.c	3 Dec 2002 15:30:48 -0000
d4080 1
a4080 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_access.c	3 Dec 2002 15:30:48 -0000
d4478 1
a4478 1
+++ src/usr.sbin/httpd/src/modules/standard/mod_unique_id.c	3 Dec 2002 15:30:48 -0000
d4613 1
a4613 1
+++ src/usr.sbin/httpd/src/support/ab.c	3 Dec 2002 15:30:48 -0000
d4773 1
a4773 1
+++ src/usr.sbin/httpd/src/support/logresolve.c	3 Dec 2002 15:30:48 -0000
d5020 2
a5021 2
--- /dev/null	Tue Dec  3 15:15:33 2002
+++ src/usr.sbin/httpd/src/include/sa_len.h	Tue Dec  3 15:30:48 2002
d5068 2
a5069 2
--- /dev/null	Tue Dec  3 15:15:33 2002
+++ src/usr.sbin/httpd/src/include/sockaddr_storage.h	Tue Dec  3 15:30:48 2002
d5128 2
a5129 2
--- /dev/null	Tue Dec  3 15:15:33 2002
+++ src/usr.sbin/httpd/src/main/getaddrinfo.c	Tue Dec  3 15:30:48 2002
d5297 2
a5298 2
--- /dev/null	Tue Dec  3 15:15:33 2002
+++ src/usr.sbin/httpd/src/main/getnameinfo.c	Tue Dec  3 15:30:48 2002
@

