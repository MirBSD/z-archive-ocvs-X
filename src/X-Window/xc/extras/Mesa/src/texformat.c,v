head	1.2;
branch	1.1.1;
access;
symbols
	tg-mergetmp-2:1.1.1.3
	cvs-200410241530:1.1.1.3
	cvs-200410012000:1.1.1.3
	cvs-200407141120:1.1.1.3
	cvs-200406231010:1.1.1.3
	MIRBSD_7quater:1.1.1.2
	cvs-200405271510:1.1.1.3
	XFree86_4_4_0:1.1.9.1
	cvs-200403021700:1.1.1.3
	XFREE86_20040213:1.1.9.1
	xc:1.1.9
	cvs-200401291925:1.1.1.2
	MIRBSD_7_ALPHA:1.1.1.2.0.4
	MIRBSD_7:1.1.1.2.0.2
	MIRBSD_7ter:1.1.1.2
	cvs-20011091815:1.1.1.2
	cvs-200309162130:1.1.1.2
	cvs-200308302005:1.1.1.2
	ctmx-0387:1.1.1.2
	ctmx-0384:1.1.1.2
	MIRBSD_5:1.1.1.2
	ctmx-0375:1.1.1.2
	ctmx-0373:1.1.1.2
	ctm-0371:1.1.1.2
	ctm-0370:1.1.1.2
	MIRBSD_4:1.1.1.2
	ctm-0363:1.1.1.2
	ctm-0359:1.1.1.2
	ctm-0349:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@ * @;


1.2
date	2003.05.16.16.28.21;	author tg;	state dead;
branches;
next	1.1;

1.1
date	2003.03.22.20.01.02;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.9.1;
next	;

1.1.1.1
date	2003.03.22.20.01.02;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.08.18.20.04;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2004.03.02.17.29.03;	author tg;	state Stab;
branches;
next	;

1.1.9.1
date	2004.02.14.19.04.47;	author tg;	state Exp;
branches;
next	;


desc
@@


1.2
log
@remove a bunch of files not used in MirBSD - clean tree. People who want them got cvs.
@
text
@
/*
 * Mesa 3-D graphics library
 * Version:  3.4
 *
 * Copyright (C) 1999-2000  Brian Paul   All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
 * BRIAN PAUL BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Author:
 *    Gareth Hughes <gareth@@valinux.com>
 */

#ifdef PC_HEADER
#include "all.h"
#else
#include "glheader.h"
#include "context.h"
#include "image.h"
#include "mem.h"
#include "mmath.h"
#include "span.h"
#include "texformat.h"
#include "teximage.h"
#include "texstate.h"
#include "types.h"
#endif


/* ================================================================
 * Texture internal formats:
 */

const struct gl_texture_format _mesa_texformat_rgba8888 = {
   MESA_FORMAT_RGBA8888,	/* IntFormat */
   8,				/* RedBits */
   8,				/* GreenBits */
   8,				/* BlueBits */
   8,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   4,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_abgr8888 = {
   MESA_FORMAT_ABGR8888,	/* IntFormat */
   8,				/* RedBits */
   8,				/* GreenBits */
   8,				/* BlueBits */
   8,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   4,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_argb8888 = {
   MESA_FORMAT_ARGB8888,	/* IntFormat */
   8,				/* RedBits */
   8,				/* GreenBits */
   8,				/* BlueBits */
   8,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   4,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_rgb888 = {
   MESA_FORMAT_RGB888,		/* IntFormat */
   8,				/* RedBits */
   8,				/* GreenBits */
   8,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   3,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_bgr888 = {
   MESA_FORMAT_BGR888,		/* IntFormat */
   8,				/* RedBits */
   8,				/* GreenBits */
   8,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   3,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_rgb565 = {
   MESA_FORMAT_RGB565,		/* IntFormat */
   5,				/* RedBits */
   6,				/* GreenBits */
   5,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   2,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_argb4444 = {
   MESA_FORMAT_ARGB4444,	/* IntFormat */
   4,				/* RedBits */
   4,				/* GreenBits */
   4,				/* BlueBits */
   4,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   2,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_argb1555 = {
   MESA_FORMAT_ARGB1555,	/* IntFormat */
   5,				/* RedBits */
   5,				/* GreenBits */
   5,				/* BlueBits */
   1,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   2,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_al88 = {
   MESA_FORMAT_AL88,		/* IntFormat */
   0,				/* RedBits */
   0,				/* GreenBits */
   0,				/* BlueBits */
   8,				/* AlphaBits */
   8,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   2,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_rgb332 = {
   MESA_FORMAT_RGB332,		/* IntFormat */
   3,				/* RedBits */
   3,				/* GreenBits */
   2,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   1,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_a8 = {
   MESA_FORMAT_A8,		/* IntFormat */
   0,				/* RedBits */
   0,				/* GreenBits */
   0,				/* BlueBits */
   8,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   1,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_l8 = {
   MESA_FORMAT_L8,		/* IntFormat */
   0,				/* RedBits */
   0,				/* GreenBits */
   0,				/* BlueBits */
   0,				/* AlphaBits */
   8,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   1,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_i8 = {
   MESA_FORMAT_I8,		/* IntFormat */
   0,				/* RedBits */
   0,				/* GreenBits */
   0,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   8,				/* IntensityBits */
   0,				/* IndexBits */
   1,				/* TexelBytes */
};

const struct gl_texture_format _mesa_texformat_ci8 = {
   MESA_FORMAT_CI8,		/* IntFormat */
   0,				/* RedBits */
   0,				/* GreenBits */
   0,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   8,				/* IndexBits */
   1,				/* TexelBytes */
};

const struct gl_texture_format _mesa_null_texformat = {
   -1,				/* IntFormat */
   0,				/* RedBits */
   0,				/* GreenBits */
   0,				/* BlueBits */
   0,				/* AlphaBits */
   0,				/* LuminanceBits */
   0,				/* IntensityBits */
   0,				/* IndexBits */
   0,				/* TexelBytes */
};



/*
 * Given an internal texture format enum or 1, 2, 3, 4 return the
 * corresponding _base_ internal format:  GL_ALPHA, GL_LUMINANCE,
 * GL_LUMANCE_ALPHA, GL_INTENSITY, GL_RGB, or GL_RGBA.
 * Return -1 if invalid enum.
 */
void _mesa_init_texture_format( GLcontext *ctx,
				struct gl_texture_image *texImage,
				GLenum internalFormat )
{
   texImage->IntFormat = internalFormat;

   /* Ask the driver for the base format, if it doesn't know, it will
    * return -1;
    */
   if ( ctx->Driver.BaseCompressedTexFormat ) {
      GLint format = 0;			/* Silence compiler warning */
      format = (*ctx->Driver.BaseCompressedTexFormat)( ctx, format );
      if ( format >= 0 ) {
	 internalFormat = format;
      }
   }

   switch ( internalFormat ) {
      /* GH: Bias towards GL_RGB, GL_RGBA texture formats.  This has
       * got to be better than sticking them way down the end of this
       * huge list.
       */
   case 4:				/* Quake3 uses this... */
   case GL_RGBA:
      texImage->Format = GL_RGBA;
      texImage->TexFormat = &_mesa_texformat_abgr8888;
      break;

   case 3:				/* ... and this. */
   case GL_RGB:
      texImage->Format = GL_RGB;
      texImage->TexFormat = &_mesa_texformat_bgr888;
      break;

      /* GH: Okay, keep checking as normal.  Still test for GL_RGB,
       * GL_RGBA formats first.
       */
   case GL_RGBA2:
   case GL_RGBA4:
   case GL_RGB5_A1:
   case GL_RGBA8:
   case GL_RGB10_A2:
   case GL_RGBA12:
   case GL_RGBA16:
      texImage->Format = GL_RGBA;
      texImage->TexFormat = &_mesa_texformat_abgr8888;
      break;

   case GL_R3_G3_B2:
   case GL_RGB4:
   case GL_RGB5:
   case GL_RGB8:
   case GL_RGB10:
   case GL_RGB12:
   case GL_RGB16:
      texImage->Format = GL_RGB;
      texImage->TexFormat = &_mesa_texformat_bgr888;
      break;

   case GL_ALPHA:
   case GL_ALPHA4:
   case GL_ALPHA8:
   case GL_ALPHA12:
   case GL_ALPHA16:
      texImage->Format = GL_ALPHA;
      texImage->TexFormat = &_mesa_texformat_a8;
      break;

   case 1:
   case GL_LUMINANCE:
   case GL_LUMINANCE4:
   case GL_LUMINANCE8:
   case GL_LUMINANCE12:
   case GL_LUMINANCE16:
      texImage->Format = GL_LUMINANCE;
      texImage->TexFormat = &_mesa_texformat_l8;
      break;

   case 2:
   case GL_LUMINANCE_ALPHA:
   case GL_LUMINANCE4_ALPHA4:
   case GL_LUMINANCE6_ALPHA2:
   case GL_LUMINANCE8_ALPHA8:
   case GL_LUMINANCE12_ALPHA4:
   case GL_LUMINANCE12_ALPHA12:
   case GL_LUMINANCE16_ALPHA16:
      texImage->Format = GL_LUMINANCE_ALPHA;
      texImage->TexFormat = &_mesa_texformat_al88;
      break;

   case GL_INTENSITY:
   case GL_INTENSITY4:
   case GL_INTENSITY8:
   case GL_INTENSITY12:
   case GL_INTENSITY16:
      texImage->Format = GL_INTENSITY;
      texImage->TexFormat = &_mesa_texformat_i8;
      break;

   case GL_COLOR_INDEX:
   case GL_COLOR_INDEX1_EXT:
   case GL_COLOR_INDEX2_EXT:
   case GL_COLOR_INDEX4_EXT:
   case GL_COLOR_INDEX8_EXT:
   case GL_COLOR_INDEX12_EXT:
   case GL_COLOR_INDEX16_EXT:
      texImage->Format = GL_COLOR_INDEX;
      texImage->TexFormat = &_mesa_texformat_ci8;
      break;

   default:
      gl_problem( ctx, "unexpected format in _mesa_init_texture_format" );
      return;
   }
}
@


1.1
log
@Initial revision
@
text
@@


1.1.9.1
log
@OpenBSD just has imported exactly this tree into their vendor branch,
called the same tag, in XF4/xc
This is, apparently, the last XFree86 snapshot before the licence change
(ie, addition of the advertising clause)

Since the developers don't see any problems with that, and we would like
to integrate improvements done by the remaining one or two (or so) XFree86
developers (j/k), this prepares enabling us to update X-Window in the future.
@
text
@d4 1
a4 1
 * Version:  3.5
d6 1
a6 1
 * Copyright (C) 1999-2001  Brian Paul   All Rights Reserved.
d26 1
a26 1
 *    Gareth Hughes
d29 3
a32 1
#include "colormac.h"
d35 1
a35 1
#include "imports.h"
d37 1
a37 1
#include "mtypes.h"
d41 2
d45 2
a46 1
/* Texel fetch routines for all supported formats:
a47 2
#define DIM 1
#include "texformat_tmp.h"
d49 10
a58 157
#define DIM 2
#include "texformat_tmp.h"

#define DIM 3
#include "texformat_tmp.h"

/* Have to have this so the FetchTexel function pointer is never NULL.
 */
static void fetch_null_texel( const struct gl_texture_image *texImage,
			      GLint i, GLint j, GLint k, GLvoid *texel )
{
   GLchan *rgba = (GLchan *) texel;
   rgba[RCOMP] = 0;
   rgba[GCOMP] = 0;
   rgba[BCOMP] = 0;
   rgba[ACOMP] = 0;
}


/* =============================================================
 * Default GLchan-based formats:
 */

const struct gl_texture_format _mesa_texformat_rgba = {
   MESA_FORMAT_RGBA,			/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   CHAN_BITS,				/* RedBits */
   CHAN_BITS,				/* GreenBits */
   CHAN_BITS,				/* BlueBits */
   CHAN_BITS,				/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4 * CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_rgba,			/* FetchTexel1D */
   fetch_2d_texel_rgba,			/* FetchTexel2D */
   fetch_3d_texel_rgba,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_rgb = {
   MESA_FORMAT_RGB,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   CHAN_BITS,				/* RedBits */
   CHAN_BITS,				/* GreenBits */
   CHAN_BITS,				/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   3 * CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_rgb,			/* FetchTexel1D */
   fetch_2d_texel_rgb,			/* FetchTexel2D */
   fetch_3d_texel_rgb,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_alpha = {
   MESA_FORMAT_ALPHA,			/* MesaFormat */
   GL_ALPHA,				/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   CHAN_BITS,				/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_alpha,		/* FetchTexel1D */
   fetch_2d_texel_alpha,		/* FetchTexel2D */
   fetch_3d_texel_alpha,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_luminance = {
   MESA_FORMAT_LUMINANCE,		/* MesaFormat */
   GL_LUMINANCE,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   CHAN_BITS,				/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_luminance,		/* FetchTexel1D */
   fetch_2d_texel_luminance,		/* FetchTexel2D */
   fetch_3d_texel_luminance,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_luminance_alpha = {
   MESA_FORMAT_LUMINANCE_ALPHA,		/* MesaFormat */
   GL_LUMINANCE_ALPHA,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   CHAN_BITS,				/* AlphaBits */
   CHAN_BITS,				/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2 * CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_luminance_alpha,	/* FetchTexel1D */
   fetch_2d_texel_luminance_alpha,	/* FetchTexel2D */
   fetch_3d_texel_luminance_alpha,	/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_intensity = {
   MESA_FORMAT_INTENSITY,		/* MesaFormat */
   GL_INTENSITY,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   CHAN_BITS,				/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_intensity,		/* FetchTexel1D */
   fetch_2d_texel_intensity,		/* FetchTexel2D */
   fetch_3d_texel_intensity,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_color_index = {
   MESA_FORMAT_COLOR_INDEX,		/* MesaFormat */
   GL_COLOR_INDEX,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   CHAN_BITS,				/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_color_index,		/* FetchTexel1D */
   fetch_2d_texel_color_index,		/* FetchTexel2D */
   fetch_3d_texel_color_index,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_depth_component = {
   MESA_FORMAT_DEPTH_COMPONENT,		/* MesaFormat */
   GL_DEPTH_COMPONENT,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   sizeof(GLfloat) * 8,			/* DepthBits */
   sizeof(GLfloat),			/* TexelBytes */
   fetch_1d_texel_depth_component,	/* FetchTexel1D */
   fetch_2d_texel_depth_component,	/* FetchTexel2D */
   fetch_3d_texel_depth_component,	/* FetchTexel3D */
d61 10
a70 20

/* =============================================================
 * Hardware formats:
 */

const struct gl_texture_format _mesa_texformat_rgba8888 = {
   MESA_FORMAT_RGBA8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_rgba8888,		/* FetchTexel1D */
   fetch_2d_texel_rgba8888,		/* FetchTexel2D */
   fetch_3d_texel_rgba8888,		/* FetchTexel3D */
d74 9
a82 14
   MESA_FORMAT_ARGB8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_argb8888,		/* FetchTexel1D */
   fetch_2d_texel_argb8888,		/* FetchTexel2D */
   fetch_3d_texel_argb8888,		/* FetchTexel3D */
d86 21
a106 14
   MESA_FORMAT_RGB888,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   3,					/* TexelBytes */
   fetch_1d_texel_rgb888,		/* FetchTexel1D */
   fetch_2d_texel_rgb888,		/* FetchTexel2D */
   fetch_3d_texel_rgb888,		/* FetchTexel3D */
d110 9
a118 14
   MESA_FORMAT_RGB565,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   5,					/* RedBits */
   6,					/* GreenBits */
   5,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_rgb565,		/* FetchTexel1D */
   fetch_2d_texel_rgb565,		/* FetchTexel2D */
   fetch_3d_texel_rgb565,		/* FetchTexel3D */
d122 9
a130 14
   MESA_FORMAT_ARGB4444,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   4,					/* RedBits */
   4,					/* GreenBits */
   4,					/* BlueBits */
   4,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_argb4444,		/* FetchTexel1D */
   fetch_2d_texel_argb4444,		/* FetchTexel2D */
   fetch_3d_texel_argb4444,		/* FetchTexel3D */
d134 9
a142 14
   MESA_FORMAT_ARGB1555,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   5,					/* RedBits */
   5,					/* GreenBits */
   5,					/* BlueBits */
   1,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_argb1555,		/* FetchTexel1D */
   fetch_2d_texel_argb1555,		/* FetchTexel2D */
   fetch_3d_texel_argb1555,		/* FetchTexel3D */
d146 9
a154 14
   MESA_FORMAT_AL88,			/* MesaFormat */
   GL_LUMINANCE_ALPHA,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   8,					/* AlphaBits */
   8,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_al88,			/* FetchTexel1D */
   fetch_2d_texel_al88,			/* FetchTexel2D */
   fetch_3d_texel_al88,			/* FetchTexel3D */
d158 9
a166 14
   MESA_FORMAT_RGB332,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   3,					/* RedBits */
   3,					/* GreenBits */
   2,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_rgb332,		/* FetchTexel1D */
   fetch_2d_texel_rgb332,		/* FetchTexel2D */
   fetch_3d_texel_rgb332,		/* FetchTexel3D */
d170 9
a178 14
   MESA_FORMAT_A8,			/* MesaFormat */
   GL_ALPHA,				/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_a8,			/* FetchTexel1D */
   fetch_2d_texel_a8,			/* FetchTexel2D */
   fetch_3d_texel_a8,			/* FetchTexel3D */
d182 9
a190 14
   MESA_FORMAT_L8,			/* MesaFormat */
   GL_LUMINANCE,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   8,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_l8,			/* FetchTexel1D */
   fetch_2d_texel_l8,			/* FetchTexel2D */
   fetch_3d_texel_l8,			/* FetchTexel3D */
d194 9
a202 14
   MESA_FORMAT_I8,			/* MesaFormat */
   GL_INTENSITY,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   8,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_i8,			/* FetchTexel1D */
   fetch_2d_texel_i8,			/* FetchTexel2D */
   fetch_3d_texel_i8,			/* FetchTexel3D */
d206 9
a214 31
   MESA_FORMAT_CI8,			/* MesaFormat */
   GL_COLOR_INDEX,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   8,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_ci8,			/* FetchTexel1D */
   fetch_2d_texel_ci8,			/* FetchTexel2D */
   fetch_3d_texel_ci8,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_ycbcr = {
   MESA_FORMAT_YCBCR,			/* MesaFormat */
   GL_YCBCR_MESA,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_ycbcr,		/* FetchTexel1D */
   fetch_2d_texel_ycbcr,		/* FetchTexel2D */
   fetch_3d_texel_ycbcr,		/* FetchTexel3D */
d217 10
a226 16

const struct gl_texture_format _mesa_texformat_ycbcr_rev = {
   MESA_FORMAT_YCBCR_REV,		/* MesaFormat */
   GL_YCBCR_MESA,			/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_ycbcr_rev,		/* FetchTexel1D */
   fetch_2d_texel_ycbcr_rev,		/* FetchTexel2D */
   fetch_3d_texel_ycbcr_rev,		/* FetchTexel3D */
a229 37
/* Big-endian */
#if 0
const struct gl_texture_format _mesa_texformat_abgr8888 = {
   MESA_FORMAT_ABGR8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_INT_8_8_8_8,		/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_abgr8888,		/* FetchTexel1D */
   fetch_2d_texel_abgr8888,		/* FetchTexel2D */
   fetch_3d_texel_abgr8888,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgra8888 = {
   MESA_FORMAT_BGRA8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_INT_8_8_8_8,		/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_bgra8888,		/* FetchTexel1D */
   fetch_2d_texel_bgra8888,		/* FetchTexel2D */
   fetch_3d_texel_bgra8888,		/* FetchTexel3D */
};
d231 5
a235 111
const struct gl_texture_format _mesa_texformat_bgr888 = {
   MESA_FORMAT_BGR888,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   3,					/* TexelBytes */
   fetch_1d_texel_bgr888,		/* FetchTexel1D */
   fetch_2d_texel_bgr888,		/* FetchTexel2D */
   fetch_3d_texel_bgr888,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgr565 = {
   MESA_FORMAT_BGR565,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_SHORT_5_6_5,		/* Type */
   5,					/* RedBits */
   6,					/* GreenBits */
   5,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_bgr565,		/* FetchTexel1D */
   fetch_2d_texel_bgr565,		/* FetchTexel2D */
   fetch_3d_texel_bgr565,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgra4444 = {
   MESA_FORMAT_BGRA4444,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_SHORT_4_4_4_4_REV,	/* Type */
   4,					/* RedBits */
   4,					/* GreenBits */
   4,					/* BlueBits */
   4,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_bgra4444,		/* FetchTexel1D */
   fetch_2d_texel_bgra4444,		/* FetchTexel2D */
   fetch_3d_texel_bgra4444,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgra5551 = {
   MESA_FORMAT_BGRA5551,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_SHORT_1_5_5_5_REV,	/* Type */
   5,					/* RedBits */
   5,					/* GreenBits */
   5,					/* BlueBits */
   1,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_bgra1555,		/* FetchTexel1D */
   fetch_2d_texel_bgra1555,		/* FetchTexel2D */
   fetch_3d_texel_bgra1555,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_la88 = {
   MESA_FORMAT_LA88,			/* MesaFormat */
   GL_LUMINANCE_ALPHA,			/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   8,					/* AlphaBits */
   8,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_la88,			/* FetchTexel1D */
   fetch_2d_texel_la88,			/* FetchTexel2D */
   fetch_3d_texel_la88,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgr233 = {
   MESA_FORMAT_BGR233,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_BYTE_3_3_2,		/* Type */
   3,					/* RedBits */
   3,					/* GreenBits */
   2,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_bgr233,		/* FetchTexel1D */
   fetch_2d_texel_bgr233,		/* FetchTexel2D */
   fetch_3d_texel_bgr233,		/* FetchTexel3D */
};
#endif

/* =============================================================
 * Null format (useful for proxy textures):
d237 3
a239 21

const struct gl_texture_format _mesa_null_texformat = {
   -1,					/* MesaFormat */
   0,					/* BaseFormat */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   0,					/* TexelBytes */
   fetch_null_texel,			/* FetchTexel1D */
   fetch_null_texel,			/* FetchTexel2D */
   fetch_null_texel,			/* FetchTexel3D */
};


GLboolean
_mesa_is_hardware_tex_format( const struct gl_texture_format *format )
d241 1
a241 2
   return (format->MesaFormat < MESA_FORMAT_RGBA);
}
d243 10
a252 13

/* Given an internal texture format (or 1, 2, 3, 4) return a pointer
 * to a gl_texture_format which which to store the texture.
 * This is called via ctx->Driver.ChooseTextureFormat().
 * Hardware drivers typically override this function with a specialized
 * version.
 */
const struct gl_texture_format *
_mesa_choose_tex_format( GLcontext *ctx, GLint internalFormat,
                         GLenum format, GLenum type )
{
   (void) format;
   (void) type;
d261 3
a263 1
      return &_mesa_texformat_rgba;
d267 3
a269 1
      return &_mesa_texformat_rgb;
d281 3
a283 1
      return &_mesa_texformat_rgba;
d292 3
a294 1
      return &_mesa_texformat_rgb;
d301 3
a303 1
      return &_mesa_texformat_alpha;
d311 3
a313 1
      return &_mesa_texformat_luminance;
d323 3
a325 1
      return &_mesa_texformat_luminance_alpha;
d332 3
a334 1
      return &_mesa_texformat_intensity;
d343 3
a345 48
      return &_mesa_texformat_color_index;

   case GL_DEPTH_COMPONENT:
   case GL_DEPTH_COMPONENT16_SGIX:
   case GL_DEPTH_COMPONENT24_SGIX:
   case GL_DEPTH_COMPONENT32_SGIX:
      if (!ctx->Extensions.SGIX_depth_texture)
	 _mesa_problem(ctx, "depth format without GL_SGIX_depth_texture");
      return &_mesa_texformat_depth_component;

   case GL_COMPRESSED_ALPHA_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_alpha;
   case GL_COMPRESSED_LUMINANCE_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_luminance;
   case GL_COMPRESSED_LUMINANCE_ALPHA_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_luminance_alpha;
   case GL_COMPRESSED_INTENSITY_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_intensity;
   case GL_COMPRESSED_RGB_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_rgb;
   case GL_COMPRESSED_RGBA_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_rgba;

   /* GL_MESA_ycrcr_texture */
   case GL_YCBCR_MESA:
      if (type == GL_UNSIGNED_SHORT_8_8_MESA)
         return &_mesa_texformat_ycbcr;
      else
         return &_mesa_texformat_ycbcr_rev;

   default:
      _mesa_problem(ctx, "unexpected format in _mesa_choose_tex_format()");
      return NULL;
   }
}

a346 25


/*
 * Return the base texture format for the given compressed format
 * Called via ctx->Driver.BaseCompressedTexFormat().
 * This function is used by software rasterizers.  Hardware drivers
 * which support texture compression should not use this function but
 * a specialized function instead.
 */
GLint
_mesa_base_compressed_texformat(GLcontext *ctx, GLint intFormat)
{
   switch (intFormat) {
   case GL_COMPRESSED_ALPHA_ARB:
      return GL_ALPHA;
   case GL_COMPRESSED_LUMINANCE_ARB:
      return GL_LUMINANCE;
   case GL_COMPRESSED_LUMINANCE_ALPHA_ARB:
      return GL_LUMINANCE_ALPHA;
   case GL_COMPRESSED_INTENSITY_ARB:
      return GL_INTENSITY;
   case GL_COMPRESSED_RGB_ARB:
      return GL_RGB;
   case GL_COMPRESSED_RGBA_ARB:
      return GL_RGBA;
d348 2
a349 1
      return -1;  /* not a recognized compressed format */
@


1.1.1.1
log
@Import OpenBSD 3.3 XF4 repository from CTM 3132 the first time
This finalizes starting an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@The X-Windowing System

Import XFree86 4.3 from OpenBSD by CTM, in the hope it's stable
@
text
@d4 1
a4 1
 * Version:  4.0.4
d6 1
a6 1
 * Copyright (C) 1999-2002  Brian Paul   All Rights Reserved.
d25 1
a25 1
 * Authors:
a26 1
 *    Brian Paul
a32 1
#include "colormac.h"
d37 1
a37 1
#include "mtypes.h"
d41 1
a41 1
#include "swrast/s_span.h"
d45 2
a46 175
/* Texel fetch routines for all supported formats:
 */
#define DIM 1
#include "texformat_tmp.h"

#define DIM 2
#include "texformat_tmp.h"

#define DIM 3
#include "texformat_tmp.h"

/* Have to have this so the FetchTexel function pointer is never NULL.
 */
static void fetch_null_texel( const struct gl_texture_image *texImage,
			      GLint i, GLint j, GLint k, GLvoid *texel )
{
   GLchan *rgba = (GLchan *) texel;
   rgba[RCOMP] = 0;
   rgba[GCOMP] = 0;
   rgba[BCOMP] = 0;
   rgba[ACOMP] = 0;
}


/* =============================================================
 * Default GLchan-based formats:
 */

const struct gl_texture_format _mesa_texformat_rgba = {
   MESA_FORMAT_RGBA,			/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   CHAN_TYPE,				/* Type */
   CHAN_BITS,				/* RedBits */
   CHAN_BITS,				/* GreenBits */
   CHAN_BITS,				/* BlueBits */
   CHAN_BITS,				/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4 * CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_rgba,			/* FetchTexel1D */
   fetch_2d_texel_rgba,			/* FetchTexel2D */
   fetch_3d_texel_rgba,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_rgb = {
   MESA_FORMAT_RGB,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   CHAN_TYPE,				/* Type */
   CHAN_BITS,				/* RedBits */
   CHAN_BITS,				/* GreenBits */
   CHAN_BITS,				/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   3 * CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_rgb,			/* FetchTexel1D */
   fetch_2d_texel_rgb,			/* FetchTexel2D */
   fetch_3d_texel_rgb,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_alpha = {
   MESA_FORMAT_ALPHA,			/* MesaFormat */
   GL_ALPHA,				/* BaseFormat */
   CHAN_TYPE,				/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   CHAN_BITS,				/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_alpha,		/* FetchTexel1D */
   fetch_2d_texel_alpha,		/* FetchTexel2D */
   fetch_3d_texel_alpha,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_luminance = {
   MESA_FORMAT_LUMINANCE,		/* MesaFormat */
   GL_LUMINANCE,			/* BaseFormat */
   CHAN_TYPE,				/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   CHAN_BITS,				/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_luminance,		/* FetchTexel1D */
   fetch_2d_texel_luminance,		/* FetchTexel2D */
   fetch_3d_texel_luminance,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_luminance_alpha = {
   MESA_FORMAT_LUMINANCE_ALPHA,		/* MesaFormat */
   GL_LUMINANCE_ALPHA,			/* BaseFormat */
   CHAN_TYPE,				/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   CHAN_BITS,				/* AlphaBits */
   CHAN_BITS,				/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2 * CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_luminance_alpha,	/* FetchTexel1D */
   fetch_2d_texel_luminance_alpha,	/* FetchTexel2D */
   fetch_3d_texel_luminance_alpha,	/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_intensity = {
   MESA_FORMAT_INTENSITY,		/* MesaFormat */
   GL_INTENSITY,			/* BaseFormat */
   CHAN_TYPE,				/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   CHAN_BITS,				/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_intensity,		/* FetchTexel1D */
   fetch_2d_texel_intensity,		/* FetchTexel2D */
   fetch_3d_texel_intensity,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_color_index = {
   MESA_FORMAT_COLOR_INDEX,		/* MesaFormat */
   GL_COLOR_INDEX,			/* BaseFormat */
   CHAN_TYPE,				/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   CHAN_BITS,				/* IndexBits */
   0,					/* DepthBits */
   CHAN_BITS / 8,			/* TexelBytes */
   fetch_1d_texel_color_index,		/* FetchTexel1D */
   fetch_2d_texel_color_index,		/* FetchTexel2D */
   fetch_3d_texel_color_index,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_depth_component = {
   MESA_FORMAT_DEPTH_COMPONENT,		/* MesaFormat */
   GL_DEPTH_COMPONENT,			/* BaseFormat */
   GL_FLOAT,				/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   sizeof(GLfloat) * 8,			/* DepthBits */
   sizeof(GLfloat),			/* TexelBytes */
   fetch_1d_texel_depth_component,	/* FetchTexel1D */
   fetch_2d_texel_depth_component,	/* FetchTexel2D */
   fetch_3d_texel_depth_component,	/* FetchTexel3D */
};


/* =============================================================
 * Hardware formats:
d50 21
a70 15
   MESA_FORMAT_RGBA8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_INT_8_8_8_8,		/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_rgba8888,		/* FetchTexel1D */
   fetch_2d_texel_rgba8888,		/* FetchTexel2D */
   fetch_3d_texel_rgba8888,		/* FetchTexel3D */
d74 9
a82 15
   MESA_FORMAT_ARGB8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_INT_8_8_8_8_REV,		/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_argb8888,		/* FetchTexel1D */
   fetch_2d_texel_argb8888,		/* FetchTexel2D */
   fetch_3d_texel_argb8888,		/* FetchTexel3D */
d86 21
a106 15
   MESA_FORMAT_RGB888,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   3,					/* TexelBytes */
   fetch_1d_texel_rgb888,		/* FetchTexel1D */
   fetch_2d_texel_rgb888,		/* FetchTexel2D */
   fetch_3d_texel_rgb888,		/* FetchTexel3D */
d110 9
a118 15
   MESA_FORMAT_RGB565,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_SHORT_5_6_5,		/* Type */
   5,					/* RedBits */
   6,					/* GreenBits */
   5,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_rgb565,		/* FetchTexel1D */
   fetch_2d_texel_rgb565,		/* FetchTexel2D */
   fetch_3d_texel_rgb565,		/* FetchTexel3D */
d122 9
a130 15
   MESA_FORMAT_ARGB4444,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_SHORT_4_4_4_4_REV,	/* Type */
   4,					/* RedBits */
   4,					/* GreenBits */
   4,					/* BlueBits */
   4,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_argb4444,		/* FetchTexel1D */
   fetch_2d_texel_argb4444,		/* FetchTexel2D */
   fetch_3d_texel_argb4444,		/* FetchTexel3D */
d134 9
a142 15
   MESA_FORMAT_ARGB1555,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_SHORT_1_5_5_5_REV,	/* Type */
   5,					/* RedBits */
   5,					/* GreenBits */
   5,					/* BlueBits */
   1,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_argb1555,		/* FetchTexel1D */
   fetch_2d_texel_argb1555,		/* FetchTexel2D */
   fetch_3d_texel_argb1555,		/* FetchTexel3D */
d146 9
a154 15
   MESA_FORMAT_AL88,			/* MesaFormat */
   GL_LUMINANCE_ALPHA,			/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   8,					/* AlphaBits */
   8,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_al88,			/* FetchTexel1D */
   fetch_2d_texel_al88,			/* FetchTexel2D */
   fetch_3d_texel_al88,			/* FetchTexel3D */
d158 9
a166 15
   MESA_FORMAT_RGB332,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_BYTE_3_3_2,		/* Type */
   3,					/* RedBits */
   3,					/* GreenBits */
   2,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_rgb332,		/* FetchTexel1D */
   fetch_2d_texel_rgb332,		/* FetchTexel2D */
   fetch_3d_texel_rgb332,		/* FetchTexel3D */
d170 9
a178 15
   MESA_FORMAT_A8,			/* MesaFormat */
   GL_ALPHA,				/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_a8,			/* FetchTexel1D */
   fetch_2d_texel_a8,			/* FetchTexel2D */
   fetch_3d_texel_a8,			/* FetchTexel3D */
d182 9
a190 15
   MESA_FORMAT_L8,			/* MesaFormat */
   GL_LUMINANCE,			/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   8,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_l8,			/* FetchTexel1D */
   fetch_2d_texel_l8,			/* FetchTexel2D */
   fetch_3d_texel_l8,			/* FetchTexel3D */
d194 9
a202 15
   MESA_FORMAT_I8,			/* MesaFormat */
   GL_INTENSITY,			/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   8,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_i8,			/* FetchTexel1D */
   fetch_2d_texel_i8,			/* FetchTexel2D */
   fetch_3d_texel_i8,			/* FetchTexel3D */
d206 9
a214 15
   MESA_FORMAT_CI8,			/* MesaFormat */
   GL_COLOR_INDEX,			/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   8,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_ci8,			/* FetchTexel1D */
   fetch_2d_texel_ci8,			/* FetchTexel2D */
   fetch_3d_texel_ci8,			/* FetchTexel3D */
d217 10
a226 17

const struct gl_texture_format _mesa_texformat_ycbcr = {
   MESA_FORMAT_YCBCR,			/* MesaFormat */
   GL_YCBCR_MESA,			/* BaseFormat */
   GL_UNSIGNED_SHORT_8_8_MESA,		/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_ycbcr,		/* FetchTexel1D */
   fetch_2d_texel_ycbcr,		/* FetchTexel2D */
   fetch_3d_texel_ycbcr,		/* FetchTexel3D */
a229 17
const struct gl_texture_format _mesa_texformat_ycbcr_rev = {
   MESA_FORMAT_YCBCR_REV,		/* MesaFormat */
   GL_YCBCR_MESA,			/* BaseFormat */
   GL_UNSIGNED_SHORT_8_8_REV_MESA,	/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_ycbcr_rev,		/* FetchTexel1D */
   fetch_2d_texel_ycbcr_rev,		/* FetchTexel2D */
   fetch_3d_texel_ycbcr_rev,		/* FetchTexel3D */
};
d231 5
a235 4


/* =============================================================
 * Null format:
d237 3
a239 23

const struct gl_texture_format _mesa_null_texformat = {
   -1,					/* MesaFormat */
   0,					/* BaseFormat */
   0,					/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   0,					/* TexelBytes */
   fetch_null_texel,			/* FetchTexel1D */
   fetch_null_texel,			/* FetchTexel2D */
   fetch_null_texel,			/* FetchTexel3D */
};



GLboolean
_mesa_is_hardware_tex_format( const struct gl_texture_format *format )
d241 1
a241 2
   return (format->MesaFormat < MESA_FORMAT_RGBA);
}
d243 10
a252 13

/* Given an internal texture format (or 1, 2, 3, 4) return a pointer
 * to a gl_texture_format which which to store the texture.
 * This is called via ctx->Driver.ChooseTextureFormat().
 * Hardware drivers should not use this function, but instead a 
 * specialized function.
 */
const struct gl_texture_format *
_mesa_choose_tex_format( GLcontext *ctx, GLint internalFormat,
                         GLenum format, GLenum type )
{
   (void) format;
   (void) type;
d261 3
a263 1
      return &_mesa_texformat_rgba;
d267 3
a269 1
      return &_mesa_texformat_rgb;
d281 3
a283 1
      return &_mesa_texformat_rgba;
d292 3
a294 1
      return &_mesa_texformat_rgb;
d301 3
a303 1
      return &_mesa_texformat_alpha;
d311 3
a313 1
      return &_mesa_texformat_luminance;
d323 3
a325 1
      return &_mesa_texformat_luminance_alpha;
d332 3
a334 1
      return &_mesa_texformat_intensity;
d343 3
a345 47
      return &_mesa_texformat_color_index;

   case GL_DEPTH_COMPONENT:
   case GL_DEPTH_COMPONENT16_SGIX:
   case GL_DEPTH_COMPONENT24_SGIX:
   case GL_DEPTH_COMPONENT32_SGIX:
      if (!ctx->Extensions.SGIX_depth_texture)
	 _mesa_problem(ctx, "depth format without GL_SGIX_depth_texture");
      return &_mesa_texformat_depth_component;

   case GL_COMPRESSED_ALPHA_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_alpha;
   case GL_COMPRESSED_LUMINANCE_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_luminance;
   case GL_COMPRESSED_LUMINANCE_ALPHA_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_luminance_alpha;
   case GL_COMPRESSED_INTENSITY_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_intensity;
   case GL_COMPRESSED_RGB_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_rgb;
   case GL_COMPRESSED_RGBA_ARB:
      if (!ctx->Extensions.ARB_texture_compression)
	 _mesa_problem(ctx, "texture compression extension not enabled");
      return &_mesa_texformat_rgba;

   case GL_YCBCR_MESA:
      if (type == GL_UNSIGNED_SHORT_8_8_MESA)
         return &_mesa_texformat_ycbcr;
      else
         return &_mesa_texformat_ycbcr_rev;

   default:
      _mesa_problem(ctx, "unexpected format in _mesa_choose_tex_format()");
      printf("intformat = %d %x\n", internalFormat, internalFormat);
      return NULL;
   }
}
a346 26



/*
 * Return the base texture format for the given compressed format
 * Called via ctx->Driver.BaseCompressedTexFormat().
 * This function is used by software rasterizers.  Hardware drivers
 * which support texture compression should not use this function but
 * a specialized function instead.
 */
GLint
_mesa_base_compressed_texformat(GLcontext *ctx, GLint intFormat)
{
   switch (intFormat) {
   case GL_COMPRESSED_ALPHA_ARB:
      return GL_ALPHA;
   case GL_COMPRESSED_LUMINANCE_ARB:
      return GL_LUMINANCE;
   case GL_COMPRESSED_LUMINANCE_ALPHA_ARB:
      return GL_LUMINANCE_ALPHA;
   case GL_COMPRESSED_INTENSITY_ARB:
      return GL_INTENSITY;
   case GL_COMPRESSED_RGB_ARB:
      return GL_RGB;
   case GL_COMPRESSED_RGBA_ARB:
      return GL_RGBA;
d348 2
a349 1
      return -1;  /* not a recognized compressed format */
a350 20
}


/*
 * Called via ctx->Driver.CompressedTextureSize().
 * This function is only used by software rasterizers.
 * Hardware drivers will have to implement a specialized function.
 */
GLint
_mesa_compressed_texture_size(GLcontext *ctx,
                              const struct gl_texture_image *texImage)
{
   GLint b;
   assert(texImage);
   assert(texImage->TexFormat);

   b = texImage->Width * texImage->Height * texImage->Depth *
      texImage->TexFormat->TexelBytes;
   assert(b > 0);
   return b;
@


1.1.1.3
log
@That's what OpenBSD will, probably, ship as XF4 in 3.5
their last sync against XFree86 4.3-current has been
imported into our vendor branch, too
@
text
@d4 1
a4 1
 * Version:  3.5
d6 1
a6 1
 * Copyright (C) 1999-2001  Brian Paul   All Rights Reserved.
d25 3
a27 2
 * Author:
 *    Gareth Hughes
d30 3
d37 1
a37 1
#include "imports.h"
d43 2
d78 1
d96 1
d114 1
d132 1
d150 1
d168 1
d186 1
d204 1
d227 1
d245 1
d263 1
d281 1
d299 1
d317 1
d335 1
d353 1
d371 1
d389 1
d407 1
d425 1
d440 1
d444 1
d463 1
a478 146
/* Big-endian */
#if 0
const struct gl_texture_format _mesa_texformat_abgr8888 = {
   MESA_FORMAT_ABGR8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_INT_8_8_8_8,		/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_abgr8888,		/* FetchTexel1D */
   fetch_2d_texel_abgr8888,		/* FetchTexel2D */
   fetch_3d_texel_abgr8888,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgra8888 = {
   MESA_FORMAT_BGRA8888,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_INT_8_8_8_8,		/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   8,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   4,					/* TexelBytes */
   fetch_1d_texel_bgra8888,		/* FetchTexel1D */
   fetch_2d_texel_bgra8888,		/* FetchTexel2D */
   fetch_3d_texel_bgra8888,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgr888 = {
   MESA_FORMAT_BGR888,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   8,					/* RedBits */
   8,					/* GreenBits */
   8,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   3,					/* TexelBytes */
   fetch_1d_texel_bgr888,		/* FetchTexel1D */
   fetch_2d_texel_bgr888,		/* FetchTexel2D */
   fetch_3d_texel_bgr888,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgr565 = {
   MESA_FORMAT_BGR565,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_SHORT_5_6_5,		/* Type */
   5,					/* RedBits */
   6,					/* GreenBits */
   5,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_bgr565,		/* FetchTexel1D */
   fetch_2d_texel_bgr565,		/* FetchTexel2D */
   fetch_3d_texel_bgr565,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgra4444 = {
   MESA_FORMAT_BGRA4444,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_SHORT_4_4_4_4_REV,	/* Type */
   4,					/* RedBits */
   4,					/* GreenBits */
   4,					/* BlueBits */
   4,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_bgra4444,		/* FetchTexel1D */
   fetch_2d_texel_bgra4444,		/* FetchTexel2D */
   fetch_3d_texel_bgra4444,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgra5551 = {
   MESA_FORMAT_BGRA5551,		/* MesaFormat */
   GL_RGBA,				/* BaseFormat */
   GL_UNSIGNED_SHORT_1_5_5_5_REV,	/* Type */
   5,					/* RedBits */
   5,					/* GreenBits */
   5,					/* BlueBits */
   1,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_bgra1555,		/* FetchTexel1D */
   fetch_2d_texel_bgra1555,		/* FetchTexel2D */
   fetch_3d_texel_bgra1555,		/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_la88 = {
   MESA_FORMAT_LA88,			/* MesaFormat */
   GL_LUMINANCE_ALPHA,			/* BaseFormat */
   GL_UNSIGNED_BYTE,			/* Type */
   0,					/* RedBits */
   0,					/* GreenBits */
   0,					/* BlueBits */
   8,					/* AlphaBits */
   8,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   2,					/* TexelBytes */
   fetch_1d_texel_la88,			/* FetchTexel1D */
   fetch_2d_texel_la88,			/* FetchTexel2D */
   fetch_3d_texel_la88,			/* FetchTexel3D */
};

const struct gl_texture_format _mesa_texformat_bgr233 = {
   MESA_FORMAT_BGR233,			/* MesaFormat */
   GL_RGB,				/* BaseFormat */
   GL_UNSIGNED_BYTE_3_3_2,		/* Type */
   3,					/* RedBits */
   3,					/* GreenBits */
   2,					/* BlueBits */
   0,					/* AlphaBits */
   0,					/* LuminanceBits */
   0,					/* IntensityBits */
   0,					/* IndexBits */
   0,					/* DepthBits */
   1,					/* TexelBytes */
   fetch_1d_texel_bgr233,		/* FetchTexel1D */
   fetch_2d_texel_bgr233,		/* FetchTexel2D */
   fetch_3d_texel_bgr233,		/* FetchTexel3D */
};
#endif
d481 1
a481 1
 * Null format (useful for proxy textures):
d487 1
d503 1
d514 2
a515 2
 * Hardware drivers typically override this function with a specialized
 * version.
a631 1
   /* GL_MESA_ycrcr_texture */
d640 1
d674 20
@


