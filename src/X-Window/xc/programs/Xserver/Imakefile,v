head	1.1;
branch	1.1.1;
access;
symbols
	tg-mergetmp-2:1.1.1.4
	cvs-200410241530:1.1.1.4
	cvs-200410012000:1.1.1.3
	cvs-200407141120:1.1.1.3
	cvs-200406231010:1.1.1.3
	MIRBSD_7quater:1.1.1.2
	cvs-200405271510:1.1.1.3
	XFree86_4_4_0:1.1.9.1
	cvs-200403021700:1.1.1.3
	XFREE86_20040213:1.1.9.1
	xc:1.1.9
	cvs-200401291925:1.1.1.2
	MIRBSD_7_ALPHA:1.1.1.2.0.4
	MIRBSD_7:1.1.1.2.0.2
	MIRBSD_7ter:1.1.1.2
	cvs-20011091815:1.1.1.2
	cvs-200309162130:1.1.1.2
	cvs-200308302005:1.1.1.2
	ctmx-0387:1.1.1.2
	ctmx-0384:1.1.1.2
	MIRBSD_5:1.1.1.2
	ctmx-0375:1.1.1.2
	ctmx-0373:1.1.1.2
	ctm-0371:1.1.1.2
	ctm-0370:1.1.1.2
	MIRBSD_4:1.1.1.2
	ctm-0363:1.1.1.2
	ctm-0359:1.1.1.2
	ctm-0349:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2003.03.22.20.05.26;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.9.1;
next	;

1.1.1.1
date	2003.03.22.20.05.26;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.08.18.33.41;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2004.03.02.18.09.01;	author tg;	state Stab;
branches;
next	1.1.1.4;

1.1.1.4
date	2004.10.24.16.14.56;	author tg;	state Exp;
branches;
next	;

1.1.9.1
date	2004.02.14.19.20.34;	author tg;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Initial revision
@
text
@XCOMM $Xorg: Imakefile,v 1.4 2001/03/14 18:42:02 pookie Exp $
/*
 * Server Master Makefile
 */
XCOMM $XFree86: xc/programs/Xserver/Imakefile,v 3.254 2002/01/07 20:38:21 dawes Exp $

#ifndef InstallXserverSetUID
#define InstallXserverSetUID NO
#endif
#define InstallServerSetUID InstallXserverSetUID

#include <Server.tmpl>

#ifdef XFree86Version
/* Do not strip server binaries */
INSTPGMFLAGS = 
#endif

#define PreFbLibs $(DIX) $(OS) $(XPDDX)
#define PreFbLibsNoFont $(DIX) $(OS)
#define BarePostFbLibs $(MFB) $(XPFBLIBS) $(MI)
#define PostFbLibs BarePostFbLibs $(EXTENSIONS)
#define NoMfbBarePostFbLibs $(XPFBLIBS) $(MI)
#if !BuildXinerama
#define NoMfbPostFbLibs NoMfbBarePostFbLibs $(EXTENSIONS)
#else
#define NoMfbPostFbLibs $(EXTENSIONS) NoMfbBarePostFbLibs $(EXTENSIONS)
#endif

#define MFBBareLibs PreFbLibs BarePostFbLibs
#define NoMFBBareLibs PreFbLibs NoMfbBarePostFbLibs
#define MFBLibs PreFbLibs PostFbLibs
#define NoMFBLibs PreFbLibs NoMfbPostFbLibs
#define CFBLibs PreFbLibs $(CFB) PostFbLibs
#define CFB4Libs PreFbLibs $(CFB4) PostFbLibs
#if BuildLowMem
#define LMFCFBLibs PreFbLibs $(LMFCFB) NoMfbBarePostFbLibs $(EXTENSIONS)
#endif
#define CFB8Libs PreFbLibs $(CFB8) PostFbLibs
#define CFB16Libs PreFbLibs $(CFB16) PostFbLibs
#define CFB24Libs PreFbLibs $(CFB24) PostFbLibs
#define CFB32Libs PreFbLibs $(CFB32) PostFbLibs

#define NoMFBCFBLibs PreFbLibs $(CFB) NoMfbPostFbLibs
#define NoMFBCFB8Libs PreFbLibs $(CFB8) NoMfbPostFbLibs
#define FbPostFbLibs  $(FB) NoMfbPostFbLibs
#define FBLibs PreFbLibs FbPostFbLibs

#define MiExtLibs $(SHADOW)

#define AllFBLibs PreFbLibs $(FB) $(CFB) PostFbLibs

#if BuildPexExt
         PEXLIBS = PEX5/dipex/dispatch/ModuleLibraryTargetName(didipex) \
                   PEX5/dipex/swap/ModuleLibraryTargetName(diswapex) \
                   PEX5/dipex/objects/ModuleLibraryTargetName(diobpex) \
                   PEX5/dipex/dispatch/ModuleLibraryTargetName(didipex) \
                   PEX5/ddpex/mi/level4/ModuleLibraryTargetName(ddpex4) \
                   PEX5/ddpex/mi/level3/ModuleLibraryTargetName(ddpex3) \
                   PEX5/ddpex/mi/shared/ModuleLibraryTargetName(ddpexs) \
                   PEX5/ddpex/mi/level2/ModuleLibraryTargetName(ddpex2) \
                   PEX5/ddpex/mi/level1/ModuleLibraryTargetName(ddpex1) \
		   PEX5/ospex/ModuleLibraryTargetName(ospex) 
          PEXDIR = PEX5
#endif

#if BuildGlxExt
#if GlxStubLib && !DoLoadableServer
      GLXLIB = glxStub/LibraryTargetName(ServerGlx) 
      GLXDIR = glxStub
#else
#if defined(GlxStaticServerLib) && !DoLoadableServer
      GLXLIB = GlxStaticServerLib
      GLXDIR = 
#else
#if BuildXF86DRI
      DRILIB = GL/dri/ModuleLibraryTargetName(dri)
#else
      DRILIB = 
#endif
#if GlxUseSGISI
      GLXLIB = GL/glx/ModuleLibraryTargetName(glx) \
               GL/sgi-si/ModuleLibraryTargetName(GLcore) \
               $(DRILIB)
#else
#if DoLoadableServer
      GLXLIB = GL/glx/ModuleLibraryTargetName(glx) \
               GL/mesa/src/ModuleLibraryTargetName(GLcore)
#else
      GLXLIB = GL/glx/ModuleLibraryTargetName(glx) \
               GL/mesa/src/X/ModuleLibraryTargetName(GLcoreX) \
               GL/mesa/src/ModuleLibraryTargetName(GLcore) \
               $(DRILIB)
#endif
#endif
      GLXDIR = GL
      GLXEXT = $(GLXLIB)
#endif
#endif
#endif

#if BuildXInputExt
      XINPUTEXT = Xi/LibraryTargetName(xinput)
          XIDIR = Xi
#endif
#if BuildXIE 
         XIEEXT = XIE/dixie/ModuleLibraryTargetName(dixie) \
	          XIE/mixie/ModuleLibraryTargetName(mixie)
         XIEDIR = XIE
#endif
#if BuildXKB
         XKBEXT = xkb/LibraryTargetName(xkb)
         XKBDIR = xkb
#endif
#if BuildLBX
         LBXEXT = lbx/LibraryTargetName(lbx) \
                  $(TOP)/lib/lbxutil/LibraryTargetName(lbxutil)
        LBXDIRS = lbx
#endif
#if BuildDBE
         DBEEXT = dbe/LibraryTargetName(dbe)
#endif
#if BuildDBE || BuildDBElib
         DBEDIR = dbe
#endif
#if BuildRECORD
      RECORDEXT = record/LibraryTargetName(record)
#endif
#if BuildRECORD || BuildRECORDlib
      RECORDDIR = record
#endif
#if BuildXTrap
       XTRAPEXT = XTrap/LibraryTargetName(xtrap)
       XTRAPDIR = XTrap
#endif
#ifdef SiteExtensionLibs
       SITEEXTS = SiteExtensionLibs
#endif
#ifdef SiteExtensionDirs
    SITEEXTDIRS = SiteExtensionDirs
#endif
#if DoLoadableServer && HasDlopen
          LIBDL = DlLibrary
#endif
       LIBREGEX = RegexLibrary

#if DoLoadableServer
    LIBCWRAPPER = os/libcwrapper.o
#endif

#if BuildXprint

#ifndef XpRasterDDX
#define XpRasterDDX YES
#endif
#ifndef XpColorPclDDX
#define XpColorPclDDX YES
#endif
#ifndef XpMonoPclDDX
#define XpMonoPclDDX NO
#endif
#ifndef XpPostScriptDDX
#define XpPostScriptDDX YES
#endif

#if XpRasterDDX
XPRASTLIB = Xprint/raster/LibraryTargetName(raster)
#endif
#if XpColorPclDDX
XPPCLLIB = Xprint/pcl/LibraryTargetName(pcl)
#endif
#if XpMonoPclDDX
XPMPCLLIB = Xprint/pcl-mono/LibraryTargetName(pcl)
#endif
#if XpPostScriptDDX
XPPSLIB = Xprint/ps/LibraryTargetName(ps)
#endif

XPDDXLIBS = Xprint/LibraryTargetName(printer) \
	    $(XPRASTLIB) $(XPPCLLIB) $(XPMPCLLIB) $(XPPSLIB)
XPDDXFBLIBS = $(MFB) $(CFB32)
#if !PrintOnlyServer
      XPFBLIBS = $(XPDDXFBLIBS)
      XPDDX = $(XPDDXLIBS)
#endif
      XPDDXDIR = Xprint
#endif
#if !BuildXprint || PrintOnlyServer
XPFBLIBS = dix/LibraryTargetName(xpstubs)
#endif

#if BuildRender
      RENDERDIR = render
      RENDERLIB = $(RENDERDIR)/librender.a
#endif
#if BuildRandR
      RANDRDIR = randr
      RANDRLIB = $(RANDRDIR)/librandr.a
#endif
#if DoLoadableServer
     EXTENSIONS = $(OTHEREXTS) $(RENDERLIB) $(RANDRLIB)
   LOADABLEEXTS = $(PEXLIBS) $(XIEEXT) $(MISCEXT) $(DBEEXT) $(RECORDEXT) \
                  $(GLXEXT) $(XTRAPEXT)
        MISCEXT = Xext/LibraryTargetName(ext)
      OTHEREXTS = Xext/LibraryTargetName(exts) $(XKBEXT) $(XINPUTEXT) \
                  $(LBXEXT) $(SITEEXTS)
#else
     EXTENSIONS = $(OTHEREXTS) $(PEXLIBS) $(GLXEXT) $(RENDERLIB) $(RANDRLIB)
      OTHEREXTS = Xext/LibraryTargetName(ext) $(XKBEXT) $(XINPUTEXT) \
                  $(XIEEXT) $(LBXEXT) $(DBEEXT) $(RECORDEXT) \
                  $(SITEEXTS) $(XTRAPEXT)
#endif
        EXTDIRS = Xext $(XKBDIR) $(XIDIR) $(XIEDIR) $(PEXDIR) $(GLXDIR) \
                  $(LBXDIRS) $(DBEDIR) $(RECORDDIR) $(SITEEXTDIRS) \
                  $(RENDERDIR) $(RANDRDIR) $(XTRAPDIR)
#if BuildLBX || GzipFontCompression
           ZLIB = GzipLibrary
#endif
             OS = os/LibraryTargetName(os) $(DEPXAUTHLIB) $(DEPXDMCPLIB)
        BSDEMUL = $(DEPXBSDLIB)
#if DoLoadableServer
            MFB = mfb/ModuleLibraryTargetName(mfb)
             FB = fb/ModuleLibraryTargetName(fb)
            CFB = cfb/ModuleLibraryTargetName(cfb) \
		  cfb16/ModuleLibraryTargetName(cfb16) \
		  cfb24/ModuleLibraryTargetName(cfb24) \
		  cfb32/ModuleLibraryTargetName(cfb32)
           CFB8 = cfb/ModuleLibraryTargetName(cfb)
           CFB4 = cfb/ModuleLibraryTargetName(cfb) \
		  cfb4/ModuleLibraryTargetName(cfb4)
          CFB16 = cfb/ModuleLibraryTargetName(cfb) \
		  cfb16/ModuleLibraryTargetName(cfb16)
          CFB24 = cfb/ModuleLibraryTargetName(cfb) \
		  cfb24/ModuleLibraryTargetName(cfb24)
          CFB32 = cfb/ModuleLibraryTargetName(cfb) \
		  cfb32/ModuleLibraryTargetName(cfb32)
         SHADOW = miext/shadow/ModuleLibraryTargetName(shadow)
          LAYER = miext/layer/ModuleLibraryTargetName(layer) 
#else 
            MFB = mfb/LibraryTargetName(mfb)
             FB = fb/LibraryTargetName(fb)
            CFB = cfb/LibraryTargetName(cfb) \
		  cfb16/LibraryTargetName(cfb16) \
		  cfb24/LibraryTargetName(cfb24) \
		  cfb32/LibraryTargetName(cfb32)
           CFB8 = cfb/LibraryTargetName(cfb)
           CFB4 = cfb/LibraryTargetName(cfb) \
		  cfb4/LibraryTargetName(cfb4)
          CFB16 = cfb/LibraryTargetName(cfb) \
		  cfb16/LibraryTargetName(cfb16)
          CFB24 = cfb/LibraryTargetName(cfb) \
		  cfb24/LibraryTargetName(cfb24)
          CFB32 = cfb/LibraryTargetName(cfb) \
		  cfb32/LibraryTargetName(cfb32)
         SHADOW = miext/shadow/LibraryTargetName(shadow)
          LAYER = miext/layer/LibraryTargetName(layer) 
#endif
#if BuildLowMem
         LMFCFB = lmfcfb/LibraryTargetName(cfb)
#endif
             MI = mi/LibraryTargetName(mi)
   MIINITEXTOBJ = mi/miinitext.o
            DIX = dix/LibraryTargetName(dix)
       FONTBASE = $(FONTLIBSRC)/fontbase.o \
		  $(FONTLIBSRC)/LibraryTargetName(fontbase)
#if XserverStaticFontLib
           FONT = $(FONTLIBSRC)/LibraryTargetName(Xfont)
#else
           FONT = $(LDPRELIB) $(XFONTLIB)
#endif
       FONTLIBS = $(FONT) $(XPFBLIBS)
#if !HasLibUsb
            USB = $(XF86OSSRC)/bsd/libusb/LibraryTargetName(usb)
#else
            USB = UsbHidLib
#endif
#ifdef ServerExtraSysLibs
   EXTRASYSLIBS = ServerExtraSysLibs
#endif
#if HasPam && HasPamMisc
        PAMLIBS = PamLibraries PamMiscLibraries
#endif
#if !(SystemV4 || defined(SGIArchitecture) || UseRgbTxt)
       DBMLIBS = DBMLibrary
#endif
        SYSLIBS = $(ZLIB) MathLibrary Krb5Libraries $(DBMLIBS) $(USB) \
		  $(PAMLIBS) $(EXTRASYSLIBS)
           CBRT = mi/LibraryTargetName(cbrt)
        STDDIRS = include dix os mi $(XPDDXDIR) $(EXTDIRS)

XCOMM
XCOMM This turns off the default rule for compiling .c files because
XCOMM this makefile does not really know how to build it.  This is really
XCOMM just a hack because of the Sun version of make and nfs.
XCOMM
.c.o:

.s.o:

/*  		  Build rule blocks, add one for each server
 *  
 *  If a server needs mfb, its build block should have a line like:
 *  MFBDIR = mfb
 *  Similarly, its build block should have:
 *  CFB4DIR  = cfb4  (if the server needs 4 bit cfb)
 *  CFB8DIR  = cfb   (8 bit cfb)
 *  CFB16DIR = cfb16 (16 bit cfb)
 *  CFB24DIR = cfb24 (24 bit cfb)
 *  CFB32DIR = cfb32 (32 bit cfb)
 *  
 *  If a server does not need all of the above components, simply
 *  omit the relevant lines from the build block.
 *  
 *  If these guidelines are followed, a make at the top of the server
 *  tree should result in each subdirectory being built only once,
 *  even if multiple servers that share subdirectories are being built.
 */

#if BuildLowMem
LMFCFBDIR = lmfcfb
#endif

#if XdecServer
XCOMM
XCOMM Digital MIPS based WS server (ultrix 4.2 and beyond)
XCOMM
MFBDIR  = mfb
CFB8DIR = cfb
DECWSDDXDIR = hw/dec/ws
#if BuildLowMem
DECDIRS = $(STDDIRS) $(LMFCFBDIR) $(DECWSDDXDIR) $(DEPDIRS)
#else
DECDIRS = $(STDDIRS) $(MFBDIR) $(CFB8DIR) $(DECWSDDXDIR) $(DEPDIRS)
#endif
DECOBJS = hw/dec/ws/init.o hw/dec/ws/sdepthinit.o
#if BuildLowMem
DECLIBS = hw/dec/ws/LibraryTargetName(dec) LMFCFBLibs
#else
DECLIBS = hw/dec/ws/LibraryTargetName(dec) CFB8Libs
#endif
ServerTarget(Xdec,$(DECDIRS),$(DECOBJS), \
	$(DECLIBS),$(FONTLIBS) $(SYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall Xdec
#endif
#endif /* XdecServer */


#if XdecMultiDepthServer
XCOMM
XCOMM Digital MIPS based WS server (ultrix 4.2 and beyond)
XCOMM Supports 8, 12, and 24 bit pixmaps
XCOMM
MFBDIR   = mfb
CFB8DIR  = cfb
CFB16DIR = cfb16
CFB24DIR = cfb24
CFB32DIR = cfb32
DECWSDDXDIR  = hw/dec/ws
DECDIRS1 = $(STDDIRS) $(MFBDIR) \
	   $(CFB8DIR) $(CFB16DIR) $(CFB24DIR) $(CFB32DIR) \
	   $(DECWSDDXDIR) $(DEPDIRS)
DECOBJS1 = hw/dec/ws/init.o hw/dec/ws/mdepthinit.o
DECLIBS1 = hw/dec/ws/LibraryTargetName(dec) CFBLibs
ServerTarget(Xdec_md,$(DECDIRS1),$(DECOBJS1), \
	$(DECLIBS1),$(FONTLIBS) $(SYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall Xdec_md
#endif
#endif /* XdecMultiDepthServer */


#if XsunServer
XCOMM
XCOMM Sun server
XCOMM
MFBDIR  = mfb
CFB8DIR = cfb
SUNDDXDIR = hw/sun
#if DoLoadableServer
SUNOBJS = hw/sun/sunInit.o hw/sun/sunInitExt.o hw/sun/stubs.o
#elif XF86Server
SUNOBJS = hw/sun/sunInit.o hw/sun/stubs.o
#else
SUNOBJS = hw/sun/sunInit.o
#endif
#if BuildLowMem
SUNDIRS = $(STDDIRS) $(LMFCFBDIR) $(SUNDDXDIR) $(DEPDIRS)
SUNLIBS = hw/sun/LibraryTargetName(sun) LMFCFBLibs
#else
SUNDIRS = $(STDDIRS) $(MFBDIR) $(CFB8DIR) $(SUNDDXDIR) $(DEPDIRS)
SUNLIBS = hw/sun/LibraryTargetName(sun) CFB8Libs
#endif
SUNSYSLIBS = $(FONTLIBS) $(WIDECHARSYSLIB) $(SYSLIBS)
SetUIDServerTarget(Xsun,$(SUNDIRS),$(SUNOBJS), \
	$(SUNLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(SUNSYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall Xsun
#endif
#endif /* XsunServer */


#if Xsun24Server
XCOMM
XCOMM Sun multiple pixmap depth (8, 12, 24) server
XCOMM
MFBDIR = mfb
CFB8DIR = cfb
CFB16DIR = cfb16
CFB24DIR = cfb24
CFB32DIR = cfb32
SUNDDXDIR = hw/sun
SUN24DIRS = $(STDDIRS) $(MFBDIR) \
	    $(CFB8DIR) $(CFB16DIR) $(CFB24DIR) $(CFB32DIR) \
	    $(SUNDDXDIR) $(DEPDIRS)
#if DoLoadableServer
SUN24OBJS = hw/sun/sunInitMulti.o hw/sun/sunInitExt.o hw/sun/stubs.o
#elif XF86Server
SUN24OBJS = hw/sun/sunInitMulti.o hw/sun/stubs.o
#else
SUN24OBJS = hw/sun/sunInitMulti.o
#endif
SUN24LIBS = hw/sun/LibraryTargetName(sun) CFBLibs
SetUIDServerTarget(Xsun24,$(SUN24DIRS),$(SUN24OBJS), \
	$(SUN24LIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(FONTLIBS) $(SYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall Xsun24
#endif
#endif /* Xsun24Server */


#if XsunMonoServer
XCOMM
XCOMM Sun monochrome server
XCOMM
MFBDIR = mfb
SUNDDXDIR = hw/sun
SUNMDIRS = $(STDDIRS) $(MFBDIR) $(SUNDDXDIR) $(DEPDIRS)
#if XF86Server
SUNMOBJS = hw/sun/sunInitMono.o hw/sun/sunInExMono.o hw/sun/stubs.o
#else
SUNMOBJS = hw/sun/sunInitMono.o hw/sun/sunInExMono.o
#endif
SUNMLIBS = hw/sun/LibraryTargetName(sun) MFBBareLibs $(EXTENSIONS)
SetUIDServerTarget(XsunMono,$(SUNMDIRS),$(SUNMOBJS), \
	$(SUNMLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(FONTLIBS) $(SYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall XsunMono
#endif
#endif /* XsunMonoServer */


#if XsunLynxServer
XCOMM
XCOMM Sun server for LynxOS microSPARC 2.4.0
XCOMM
MFBDIR = mfb
CFB8DIR = cfb
LYNXDDXDIR = hw/sunLynx
SUNDIRS = $(STDDIRS) $(MFBDIR) $(CFB8DIR) $(LYNXDDXDIR) $(DEPDIRS)
SUNOBJS = hw/sunLynx/sunLyInit.o
SUNLIBS = hw/sunLynx/libsun.a CFB8Libs
ServerTarget(Xsun,$(SUNDIRS),$(SUNOBJS), \
	$(SUNLIBS),$(FONTLIBS) $(SYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall Xsun
#endif
#endif /* XsunLynxServer */


#if XsunLynxMonoServer
XCOMM
XCOMM Sun monochrome server for LynxOS microSPARC 2.4.0
XCOMM
MFBDIR = mfb
LYNXDDXDIR = hw/sunLynx
SUNMDIRS = $(STDDIRS) $(MFBDIR) $(LYNXDDXDIR) $(DEPDIRS)
SUNMOBJS = hw/sunLynx/sunInitMono.o hw/sunLynx/sunInExMono.o
SUNMLIBS = hw/sunLynx/libsun.a MFBBareLibs $(OTHEREXTS)
ServerTarget(XsunMono,$(SUNMDIRS),$(SUNMOBJS), \
	$(SUNMLIBS),$(FONTLIBS) $(SYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall XsunMono
#endif
#endif /* XsunLynxMonoServer */


#if XhpServer
XCOMM
XCOMM Hewlett Packard CFB Server
XCOMM
MFBDIR  = mfb
CFB8DIR = cfb
CFB32DIR = cfb32
HPDDXDIR = hw/hp
HPOBJS = hw/hp/hp.o
#if BuildLowMem
HPSUBDIRS = $(STDDIRS) $(LMFCFBDIR) $(HPDDXDIR) $(DEPDIRS)
HPLIBS = LMFCFBLibs
#else
HPSUBDIRS = $(STDDIRS) $(MFBDIR) $(CFB8DIR) $(CFB32DIR) $(HPDDXDIR) $(DEPDIRS)
HPLIBS = CFB32Libs
#endif
HPSYSLIBS = $(FONTLIBS) $(CBRT) $(SYSLIBS)
ServerTarget(Xhp,$(HPSUBDIRS),$(HPOBJS), \
	$(HPLIBS),$(HPSYSLIBS))
#ifndef ServerToInstall
#define ServerToInstall Xhp
#endif
#endif	/* XhpServer */

#if HasParallelMake
XCOMM
XCOMM force non-parallel build of XF86 servers to prevent MUTEX overrides
XCOMM
#if XF86Server
XF86SERVER = XFree86
#endif
#if XnestServer
XNEST = Xnest
#endif
#if XVirtualFramebufferServer
XVFB = Xvfb
#endif
#if XWinServer && !MakeDllModules
XWIN = XWin
#endif
#if defined(XF86Server) || \
    defined(XnestServer) || \
    defined(XVirtualFramebufferServer) || \
    (!MakeDllModules && defined(XWinServer))
MakeMutex($(XF86SERVER) $(XNEST) $(XVFB) $(XWIN))
#endif
MakeMutex($(STDDIRS) mfb fb cfb cfb16 cfb24 cfb32)
#endif


#if XF86Server
XCOMM
XCOMM XFree86 Server
XCOMM
FBDIR = fb
MFBDIR  = mfb
CFB8DIR = cfb
CFB16DIR = cfb16
CFB24DIR = cfb24
CFB32DIR = cfb32
SHADOWDIR = miext/shadow
LAYERDIR = miext/layer
#if XF86AFB
AFBDIR = afb
#endif
XFREE86DDXDIR  = hw/xfree86
XF86SERVERSUBDIRS = $(STDDIRS) $(MFBDIR) $(FBDIR) $(AFBDIR) \
		    $(CFB8DIR) $(CFB16DIR) $(CFB24DIR) $(CFB32DIR) \
		    $(SHADOWDIR) $(LAYERDIR) $(XFREE86DDXDIR) $(DEPDIRS)
XF86INIT   = $(XF86COMSRC)/xf86Init.o $(XF86COMSRC)/xf86IniExt.o
XF86COMLIB = $(XF86COMSRC)/LibraryTargetName(xf86)
XF86PARSLIB= $(XF86PARSERSRC)/LibraryTargetName(xf86config)
XF86OSLIB  = $(XF86OSSRC)/LibraryTargetName(xf86_os)
#if XF86XAA
XF86XAALIB = $(XF86SRC)/xaa/LibraryTargetName(xaa)
#endif
#if XF86VgaHw
XF86VGAHWLIB = $(XF86SRC)/vgahw/LibraryTargetName(vgahw)
#endif
#if XF86FBDevHw
XF86FBDEVHWLIB = $(XF86SRC)/fbdevhw/LibraryTargetName(fbdevhw)
#endif
#if XF1Bpp || XF4Bpp
XF1BPPLIB = $(XF86SRC)/xf1bpp/LibraryTargetName(xf1bpp)
#endif
#if XF4Bpp
XF4BPPLIB = $(XF86SRC)/xf4bpp/LibraryTargetName(xf4bpp)
#endif
#if XF8_32Wid
XF8_32WIDLIB = $(XF86SRC)/xf8_32wid/LibraryTargetName(xf8_32wid)
#endif
#if XF8_32Bpp
XF8_32BPPLIB = $(XF86SRC)/xf8_32bpp/LibraryTargetName(xf8_32bpp)
#endif
#if XF8_16Bpp
XF8_16BPPLIB = $(XF86SRC)/xf8_16bpp/LibraryTargetName(xf8_16bpp)
#endif
#if XF24_32Bpp
XF24_32BPPLIB = $(XF86SRC)/xf24_32bpp/LibraryTargetName(xf24_32bpp)
#endif
#if XFShadowFB
XFSHADOWFBLIB = $(XF86SRC)/shadowfb/LibraryTargetName(shadowfb)
#endif
#if XF86AFB
AFBLIB = afb/LibraryTargetName(afb)
#endif
XF86DRIVERLIB = $(XF86SRC)/drivers/LibraryTargetName(driver)
#if XF86Ramdac
XF86RAMDACLIB = $(XF86SRC)/ramdac/LibraryTargetName(ramdac)
#endif
#if XF86I2C
XF86I2CLIB = $(XF86SRC)/i2c/LibraryTargetName(i2c)
#endif
#if XF86DDC
XF86DDCLIB = $(XF86SRC)/ddc/LibraryTargetName(ddc)
#endif
#if XF86VBE
XF86VBELIB = $(XF86OSSRC)/vbe/vbe.o
#endif
#if XF86RAC
XF86RACLIB = $(XF86SRC)/rac/LibraryTargetName(rac)
#endif
#if XF86INT10_BUILD > X86EMU_GENERIC
XF86INT10LIB = $(XF86OSSRC)/LibraryTargetName(int10)
#else
XF86INT10LIB = $(XF86SRC)/int10/LibraryTargetName(int10)
#endif
#if UseMemLeak
MEMDEBUGLIB = $(TOP)/util/memleak/LibraryTargetName(memleak)
#endif
XF86IDRIVERLIB = $(XF86SRC)/input/LibraryTargetName(idriver)
#if !DoLoadableServer
XF86DRVOBJS = $(XF86SRC)/drivers/drvConf.o
XF86DRVLIBS = $(XF86DRIVERLIB) $(XF86RAMDACLIB) $(XF86DDCLIB) $(XF86I2CLIB) \
              $(XF86XAALIB) $(XF86VGAHWLIB) $(XF86FBDEVHWLIB) \
	      $(XF8_32WIDLIB) $(XF8_32BPPLIB) $(XF86VBELIB) \
	      $(XF8_16BPPLIB) $(XF24_32BPPLIB) \
	      $(XF4BPPLIB) $(XF1BPPLIB) $(XFSHADOWFBLIB) $(AFBLIB)
XF86IDRVOBJS = $(XF86SRC)/input/drvConf.o
XF86IDRVLIBS = $(XF86IDRIVERLIB)
XF86SCANLIB = $(XF86SRC)/scanpci/LibraryTargetName(scanpci)
XF86LIBS  = $(MEMDEBUGLIB) $(XF86INIT) $(XF86COMLIB) $(XF86RACLIB) \
	    $(XF86PARSLIB) $(XF86OSLIB) $(XF86INT10LIB) 
#else
XF86LIBS  = $(MEMDEBUGLIB) $(XF86INIT) $(XF86COMLIB) \
	    $(XF86PARSLIB) $(XF86OSLIB) 
#endif
#if DoLoadableServer
XF86LOADERLIB = $(XF86SRC)/loader/LibraryTargetName(loader)
XF86MAINLIBS = MiExtLibs PreFbLibsNoFont \
	       $(FONTBASE) $(OTHEREXTS) $(XF86COMLIB) \
	       NoMfbPostFbLibs
XF86SERVERSYSLIBS = $(SYSLIBS) $(LIBDL) $(LIBREGEX)
#else
XF86MAINLIBS = MiExtLibs AllFBLibs $(XF86COMLIB) $(MI)
XF86SERVERSYSLIBS = $(FONTLIBS) $(SYSLIBS) $(LIBDL) $(LIBREGEX)
#endif
XF86SERVEROBJS = $(XF86DRVOBJS) $(XF86IDRVOBJS)
XF86SERVERLIBS = $(XF86DRVLIBS) $(XF86IDRVLIBS) $(XF86LIBS) $(XF86LOADERLIB) \
		 $(XF86COMLIB) $(XF86MAINLIBS) $(XF86SCANLIB) $(XF86OSLIB) \
		 $(XF86DDCLIB)
#if HasParallelMake
MakeMutex($(XF86SERVERSUBDIRS) $(XF86SERVERLIBS) $(XF86SERVERSYSLIBS))
#endif
#if ForceServerRemake
$(XF86SERVERLIBS) $(XF86SERVERSYSLIBS):: $(XF86SERVERSUBDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
SetUIDServerTarget(XFree86,$(XF86SERVERSUBDIRS),$(XF86SERVEROBJS), \
	$(XF86SERVERLIBS),$(XF86SERVERSYSLIBS))
#if DoLoadableServer
ServerDriverSDKTarget(XFree86)
#endif
#ifndef ServerToInstall
#define ServerToInstall XFree86
#endif
#endif        /* XF86Server */

#if KDriveXServer
XCOMM
XCOMM Tiny X server section
XCOMM

        KDRIVE = hw/kdrive
#ifdef LinuxArchitecture
       KDOSDIR = $(KDRIVE)/linux
          KDOS = $(KDOSDIR)/LibraryTargetName(linux)
#endif

#ifdef VXWORKS
       KDOSDIR = $(KDRIVE)/vxworks
          KDOS = $(KDOSDIR)/LibraryTargetName(vxworks)
#endif

#ifdef OpenBSDArchitecture
      KDOSDIR = $(KDRIVE)/bsd
         KDOS = $(KDOSDIR)/LibraryTargetName(bsd)
#endif

#if BuildPseudo8
       PSEUDO8 = $(KDRIVE)/pseudo8/LibraryTargetName(pseudo8)
    PSEUDO8DIR = $(KDRIVE)/pseudo8
#endif
     SHADOWDIR = miext/shadow
      LAYERDIR = miext/layer
            KD = $(KDRIVE)/LibraryTargetName(kdrive)
       KDFBDEV = $(KDRIVE)/fbdev/LibraryTargetName(fbdev)


#define StdKdDirs $(KDRIVE) $(KDOSDIR) $(PSEUDO8DIR) fb $(DEPDIRS)
#define StdKdSysLibs $(FONTLIBS) $(SYSLIBS)
#define KdLibs $(KD) $(KDOS) $(PSEUDO8) MiExtLibs $(RENDERLIB) $(RANDRLIB)

#if XfbdevServer
XCOMM
XCOMM server with Keith's fbdev driver only
XCOMM

    FBDEVDIR = $(KDRIVE)/fbdev
       FBDEV = $(FBDEVDIR)/LibraryTargetName(fbdev)

      KDDIRS = StdKdDirs

   FBDEVDIRS = $(STDDIRS) $(KDDIRS) $(FBDEVDIR) $(SHADOWDIR) $(LAYERDIR)

   FBDEVLIBS = PreFbLibs $(FBDEV) $(LAYER) KdLibs FbPostFbLibs
FBDEVSYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(FBDEVDIRS) $(FBDEVOBJS) $(FBDEVLIBS) $(FBDEVSYSLIBS))
#endif
#if ForceServerRemake
$(FBDEVOBJS) $(XFBDEV) $(FBDEVLIBS) $(FBDEVSYSLIBS):: $(FBDEVDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xfbdev,$(FBDEVDIRS),$(FBDEVOBJS), \
	$(FBDEVLIBS),$(FBDEVSYSLIBS))
#endif /* XfbdevServer */

#if XSavageServer
XCOMM
XCOMM server with Keith's S3 Savage driver
XCOMM

    SAVAGEDIR = $(KDRIVE)/savage
       SAVAGE = $(SAVAGEDIR)/LibraryTargetName(savage)
    
       KDDIRS = StdKdDirs
   
   SAVAGEDIRS = $(STDDIRS) $(KDDIRS) $(SAVAGEDIR)
   
   SAVAGELIBS = PreFbLibs $(SAVAGE) KdLibs FbPostFbLibs
SAVAGESYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(SAVAGEDIRS) $(SAVAGEOBJS) $(SAVAGELIBS) $(SAVAGESYSLIBS))
#endif
#if ForceServerRemake
$(SAVAGEOBJS) $(XSAVAGE) $(SAVAGELIBS) $(SAVAGESYSLIBS):: $(SAVAGEDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xsavage,$(SAVAGEDIRS),$(SAVAGEOBJS), \
	$(SAVAGELIBS),$(SAVAGESYSLIBS))
#endif /* XSavageServer */

#if XIgsServer
XCOMM
XCOMM server with Keith's S3 Igs driver
XCOMM

       IGSDIR = $(KDRIVE)/igs
          IGS = $(IGSDIR)/LibraryTargetName(igs)
    
       KDDIRS = StdKdDirs
   
      IGSDIRS = $(STDDIRS) $(KDDIRS) $(IGSDIR)
   
      IGSLIBS = PreFbLibs $(IGS) KdLibs FbPostFbLibs
   IGSSYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(IGSDIRS) $(IGSOBJS) $(IGSLIBS) $(IGSSYSLIBS))
#endif
#if ForceServerRemake
$(IGSOBJS) $(XIGS) $(IGSLIBS) $(IGSSYSLIBS):: $(IGSDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xigs,$(IGSDIRS),$(IGSOBJS), \
	$(IGSLIBS),$(IGSSYSLIBS))
#endif /* XIgsServer */

#if XTridentServer
XCOMM
XCOMM server with Keith's TRIDENT Cyber9525 driver
XCOMM

      FBDEVDIR = $(KDRIVE)/fbdev
         FBDEV = $(FBDEVDIR)/LibraryTargetName(fbdev)
       VESADIR = $(KDRIVE)/vesa
          VESA = $(VESADIR)/LibraryTargetName(vesa)
    TRIDENTDIR = $(KDRIVE)/trident
       TRIDENT = $(TRIDENTDIR)/LibraryTargetName(trident)

        KDDIRS = StdKdDirs
  
   TRIDENTDIRS = $(STDDIRS) $(KDDIRS) \
		 $(FBDEVDIR) $(VESADIR) $(SHADOWDIR) $(LAYERDIR) $(TRIDENTDIR)
   
   TRIDENTLIBS = PreFbLibs $(TRIDENT) $(FBDEV) $(VESA) $(LAYER) KdLibs FbPostFbLibs
TRIDENTSYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(TRIDENTDIRS) $(TRIDENTLIBS) $(TRIDENTSYSLIBS))
#endif
#if ForceServerRemake
$(TRIDENTOBJS) $(TRIDENTLIBS) $(TRIDENTSYSLIBS):: $(TRIDENTDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xtrident,$(TRIDENTDIRS),$(TRIDENTOBJS), \
	$(TRIDENTLIBS),$(TRIDENTSYSLIBS))
#endif /* XTridentServer */

#if XchipsServer
XCOMM
XCOMM server with Keith's C&T driver
XCOMM

       VESADIR = $(KDRIVE)/vesa
          VESA = $(VESADIR)/LibraryTargetName(vesa)
      CHIPSDIR = $(KDRIVE)/chips
         CHIPS = $(CHIPSDIR)/LibraryTargetName(chips)

        KDDIRS = StdKdDirs
  
   CHIPSDIRS = $(STDDIRS) $(KDDIRS) \
		 $(FBDEVDIR) $(VESADIR) $(SHADOWDIR) $(LAYERDIR) $(CHIPSDIR)
   
   CHIPSLIBS = PreFbLibs $(CHIPS) $(VESA) $(LAYER) KdLibs FbPostFbLibs
CHIPSSYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(CHIPSDIRS) $(CHIPSLIBS) $(CHIPSSYSLIBS))
#endif
#if ForceServerRemake
$(CHIPSOBJS) $(CHIPSLIBS) $(CHIPSSYSLIBS):: $(CHIPSDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xchips,$(CHIPSDIRS),$(CHIPSOBJS), \
	$(CHIPSLIBS),$(CHIPSSYSLIBS))
#endif /* XchipsServer */

#if Xmach64Server
XCOMM
XCOMM server with Keith's Mach64 driver (for Mobility 1 machines)
XCOMM

       VESADIR = $(KDRIVE)/vesa
          VESA = $(VESADIR)/LibraryTargetName(vesa)
     MACH64DIR = $(KDRIVE)/mach64
        MACH64 = $(MACH64DIR)/LibraryTargetName(mach64)

        KDDIRS = StdKdDirs

   MACH64DIRS = $(STDDIRS) $(KDDIRS) \
		 $(VESADIR) $(SHADOWDIR) $(LAYERDIR) $(MACH64DIR)

   MACH64LIBS = PreFbLibs $(MACH64) $(VESA) $(LAYER) KdLibs FbPostFbLibs
MACH64SYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(MACH64DIRS) $(MACH64LIBS) $(MACH64SYSLIBS))
#endif
#if ForceServerRemake
$(MACH64OBJS) $(MACH64LIBS) $(MACH64SYSLIBS):: $(MACH64DIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xmach64,$(MACH64DIRS),$(MACH64OBJS), \
	$(MACH64LIBS),$(MACH64SYSLIBS))
#endif /* Xmach64Server */

#if Xi810Server
XCOMM
XCOMM server with Intel i810 driver
XCOMM

      FBDEVDIR = $(KDRIVE)/fbdev
         FBDEV = $(FBDEVDIR)/LibraryTargetName(fbdev)
       VESADIR = $(KDRIVE)/vesa
          VESA = $(VESADIR)/LibraryTargetName(vesa)
       I810DIR = $(KDRIVE)/i810
          I810 = $(I810DIR)/LibraryTargetName(i810)

        KDDIRS = StdKdDirs
  
      I810DIRS = $(STDDIRS) $(KDDIRS) $(SHADOWDIR) $(I810DIR)
   
      I810LIBS = PreFbLibs $(I810) KdLibs FbPostFbLibs
   I810SYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(I810DIRS) $(I810LIBS) $(I810SYSLIBS))
#endif
#if ForceServerRemake
$(I810OBJS) $(I810LIBS) $(I810SYSLIBS):: $(I810DIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xi810,$(I810DIRS),$(I810OBJS), \
	$(I810LIBS),$(I810SYSLIBS))
#endif /* Xi810Server */


#if XSis530Server
XCOMM
XCOMM server with Keith's SiS 530 driver
XCOMM

    SIS530DIR = $(KDRIVE)/sis530
       SIS530 = $(SIS530DIR)/LibraryTargetName(sis530)

       KDDIRS = StdKdDirs

   SIS530DIRS = $(STDDIRS) $(KDDIRS) $(SIS530DIR)
   
   SIS530LIBS = PreFbLibs $(SIS530) KdLibs FbPostFbLibs
SIS530SYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(SIS530DIRS) $(SIS530OBJS) $(SIS530LIBS) $(SIS530SYSLIBS))
#endif
#if ForceServerRemake
$(SIS530OBJS) $(SIS530LIBS) $(SIS530SYSLIBS):: $(SIS530DIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xsis530,$(SIS530DIRS),$(SIS530OBJS), \
	$(SIS530LIBS),$(SIS530SYSLIBS))
#endif /* XSis530Server */

#if XTrioServer
XCOMM
XCOMM server with Keith's S3 Trio driver
XCOMM

    TRIODIR = $(KDRIVE)/trio
       TRIO = $(TRIODIR)/LibraryTargetName(trio)

     KDDIRS = StdKdDirs

   TRIODIRS = $(STDDIRS) $(KDDIRS) $(TRIODIR)
   
   TRIOLIBS = PreFbLibs $(TRIO) KdLibs FbPostFbLibs
TRIOSYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(TRIODIRS) $(TRIOOBJS) $(TRIOLIBS) $(TRIOSYSLIBS))
#endif
#if ForceServerRemake
$(TRIOOBJS) $(TRIOLIBS) $(TRIOSYSLIBS):: $(TRIODIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xtrio,$(TRIODIRS),$(TRIOOBJS), \
	$(TRIOLIBS),$(TRIOSYSLIBS))
#endif /* XTrioServer */

#if XipaqServer
XCOMM
XCOMM server with Alan's HP VGA Out PCMCIA driver & fbdev
XCOMM

     FBDEVDIR = $(KDRIVE)/fbdev
        FBDEV = $(FBDEVDIR)/LibraryTargetName(fbdev)

    PCMCIADIR = $(KDRIVE)/pcmcia
       PCMCIA = $(PCMCIADIR)/LibraryTargetName(pcmcia)

    SHADOWDIR = miext/shadow

      IPAQDIR = $(KDRIVE)/ipaq
         IPAQ = $(IPAQDIR)/LibraryTargetName(ipaq)

       KDDIRS = StdKdDirs
     
     IPAQDIRS = $(STDDIRS) $(KDDIRS) $(FBDEVDIR) $(LAYERDIR) $(SHADOWDIR) $(PCMCIADIR) $(IPAQDIR)
    
     IPAQLIBS = PreFbLibs $(IPAQ) $(FBDEV) $(LAYER) $(SHADOW) $(PCMCIA) KdLibs FbPostFbLibs
  IPAQSYSLIBS = StdKdSysLibs
    
#if HasParallelMake
MakeMutex($(IPAQDIRS) $(IPAQOBJS) $(IPAQLIBS) $(IPAQSYSLIBS))
#endif
#if ForceServerRemake
$(IPAQOBJS) $(IPAQLIBS) $(IPAQSYSLIBS):: $(IPAQDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xipaq,$(IPAQDIRS),$(IPAQOBJS), \
	$(IPAQLIBS),$(IPAQSYSLIBS))
#endif /* XIPAQServer */

#if XTS300Server
XCOMM
XCOMM server with Keith's S3 Trio and SiS530 driver for the TS300/TS400
XCOMM

      TRIODIR = $(KDRIVE)/trio
         TRIO = $(TRIODIR)/LibraryTargetName(trio)
	 
    SIS530DIR = $(KDRIVE)/sis530
       SIS530 = $(SIS530DIR)/LibraryTargetName(sis530)

     TS300DIR = $(KDRIVE)/ts300
        TS300 = $(TS300DIR)/LibraryTargetName(ts300)

       KDDIRS = StdKdDirs
     
    TS300DIRS = $(STDDIRS) $(KDDIRS) $(TRIODIR) $(SIS530DIR) $(TS300DIR)
    
    TS300LIBS = PreFbLibs $(TS300) $(TRIO) $(SIS530) KdLibs FbPostFbLibs
 TS300SYSLIBS = StdKdSysLibs
    
#if HasParallelMake
MakeMutex($(TS300DIRS) $(TS300OBJS) $(TS300LIBS) $(TS300SYSLIBS))
#endif
#if ForceServerRemake
$(TS300OBJS) $(TS300LIBS) $(TS300SYSLIBS):: $(TS300DIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xts300,$(TS300DIRS),$(TS300OBJS), \
	$(TS300LIBS),$(TS300SYSLIBS))
#endif /* XTS300Server */

#if XItsyServer
XCOMM
XCOMM server with Keith's FB driver only
XCOMM
    ITSYDIR = $(KDRIVE)/itsy
       ITSY = $(ITSYDIR)/LibraryTargetName(itsy)

     KDDIRS = StdKdDirs

   ITSYDIRS = $(STDDIRS) $(KDDIRS) $(ITSYDIR)
   
   ITSYLIBS = PreFbLibs $(ITSY) KdLibs FbPostFbLibs
ITSYSYSLIBS = StdKdSysLibs
   
#if HasParallelMake
MakeMutex($(ITSYDIRS) $(ITSYOBJS) $(ITSYLIBS) $(ITSYSYSLIBS))
#endif
#if ForceServerRemake
$(ITSYOBJS) $(ITSYLIBS) $(ITSYSYSLIBS):: $(ITSYDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xitsy,$(ITSYDIRS),$(ITSYOBJS), \
	$(ITSYLIBS),$(ITSYSYSLIBS))
#endif /* XItsyServer */

#if XvesaServer
XCOMM
XCOMM server with vesa driver only based on Keith's server
XCOMM

    VESADIR = $(KDRIVE)/vesa
       VESA = $(VESADIR)/LibraryTargetName(vesa)

      KDDIRS = StdKdDirs

    VESADIRS = $(STDDIRS) $(KDDIRS) $(VESADIR) $(SHADOWDIR) $(LAYERDIR)

   VESALIBS = PreFbLibs $(VESA) $(LAYER) KdLibs FbPostFbLibs
VESASYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(VESADIRS) $(VESAOBJS) $(VESALIBS) $(VESASYSLIBS))
#endif
#if ForceServerRemake
$(VESAOBJS) $(XVESA) $(VESALIBS) $(VESASYSLIBS):: $(VESADIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xvesa,$(VESADIRS),$(VESAOBJS), \
	$(VESALIBS),$(VESASYSLIBS))
#endif /* XvesaServer */

#if XwsfbServer
XCOMM
XCOMM server with wsfb driver only based on Keith's server
XCOMM

    WSFBDIR = $(KDRIVE)/wsfb
       WSFB = $(WSFBDIR)/LibraryTargetName(wsfb)

      KDDIRS = StdKdDirs

    WSFBDIRS = $(STDDIRS) $(KDDIRS) $(WSFBDIR) $(SHADOWDIR) $(LAYERDIR)

   WSFBLIBS = PreFbLibs $(WSFB) $(LAYER) KdLibs FbPostFbLibs
WSFBSYSLIBS = StdKdSysLibs

#if HasParallelMake
MakeMutex($(WSFBDIRS) $(WSFBOBJS) $(WSFBLIBS) $(WSFBSYSLIBS))
#endif
#if ForceServerRemake
$(WSFBOBJS) $(XWSFB) $(WSFBLIBS) $(WSFBSYSLIBS):: $(WSFBDIRS)
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
#endif
ServerTarget(Xwsfb,$(WSFBDIRS),$(WSFBOBJS), \
	$(WSFBLIBS),$(WSFBSYSLIBS))
#endif /* XwsfbServer */

KDRIVEDIRS=$(KDDIRS) $(FBDEVDIR) $(SAVAGEDIR) $(TRIDENTDIR) $(I810DIR) \
	   $(SIS530DIR) $(TRIODIR) $(TS300DIR) $(ITSYDIR) $(IGSDIR) \
	   $(VESADIR) $(PCMCIADIR) $(IPAQDIR) $(MACH64DIR) $(CHIPSDIR) \
	   $(WSFBDIR)
#endif	/* KDriveXServer */

#if XprtServer
XCOMM
XCOMM Print Server
XCOMM
MFBDIR  = mfb
CFB8DIR = cfb
CFB32DIR = cfb32
XPSUBDIRS = $(STDDIRS) $(MFBDIR) $(CFB8DIR) $(CFB32DIR) $(DEPDIRS)
#if PrintOnlyServer
#if BuildDPMS
XPDPMSSTUBOBJS = Xprint/dpmsstubs.o
#endif
XPOBJS = Xprint/ddxInit.o Xprint/miinitext.o $(XPDPMSSTUBOBJS)
XPLIBS = PreFbLibs $(XPDDXLIBS) $(XPDDXFBLIBS) PostFbLibs
#else
XPOBJS = Xprint/ddxInit.o
XPLIBS = PreFbLibs PostFbLibs
#endif
#if (defined(SunArchitecture) || defined(SparcArchitecture)) && \
    defined(SVR4Architecture)
XPSYSLIBS = $(FONTLIBS) $(CBRT) $(SYSLIBS) -lw
#else
XPSYSLIBS = $(FONTLIBS) $(CBRT) $(SYSLIBS)
#endif
#if HasParallelMake
MakeMutex($(XPSUBDIRS) $(XPOBJS) $(XPLIBS) $(XPSYSLIBS))
#endif
#if ForceServerRemake
$(XPOBJS) $(XPLIBS) $(XPSYSLIBS):: $(XPSUBDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xprt,$(XPSUBDIRS),$(XPOBJS), \
	$(XPLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(XPSYSLIBS))
#endif	/* XprtServer */

#if XnestServer
XCOMM
XCOMM Server with Xlib-based ddx
XCOMM
#ifndef Win32Architecture
XNESTDDXDIR = hw/xnest
#else
XNESTDDXDIR = hw
#endif
XNESTDIRS = $(STDDIRS) $(XNESTDDXDIR) $(DEPDIRS)
#if !defined(LynxOSArchitecture) && \
    !defined(Win32Architecture) && \
    !defined(QNX4Architecture)
XNESTOBJS = hw/xnest/miinitext.o
#else
XNESTOBJS = hw/xnest/miinitext.o dix/main.o
#endif
XNEST = hw/xnest/LibraryTargetName(xnest)
XNESTLIBS = PreFbLibs $(XNEST) NoMfbPostFbLibs $(XNEST)
XNESTSYSLIBS = $(FONTLIBS) $(LDPRELIBS) $(XLIB) $(SYSLIBS)
#if HasParallelMake
MakeMutex($(XNESTDIRS) $(XNESTOBJS) $(XNESTLIBS) $(XNESTSYSLIBS))
#endif
#if ForceServerRemake
$(XNESTOBJS) $(XNESTLIBS) $(XNESTSYSLIBS):: $(XNESTDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xnest,$(XNESTDIRS),$(XNESTOBJS), \
	$(XNESTLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(XNESTSYSLIBS))
#endif /* XnestServer */


#if XnonServer
XCOMM
XCOMM non server, just compile sources for build test
XCOMM
MFBDIR   = mfb
CFB8DIR  = cfb
CFB16DIR = cfb16
CFB32DIR = cfb32
#if HasParallelMake
MakeMutex($(STDDIRS) $(MFBDIR) $(CFB8DIR) $(CFB16DIR) $(CFB32DIR) $(DEPDIRS))
#endif
Xnon: $(STDDIRS) $(MFBDIR) $(CFB8DIR) $(CFB16DIR) $(CFB32DIR) $(DEPDIRS)
#endif /* XnonServer */


#if XVirtualFramebufferServer
XCOMM
XCOMM server with Virtual (malloced) framebuffer
XCOMM
MFBDIR = mfb
FBDIR  = fb
#if defined(Win32Architecture)
XVFBDDXDIR = hw
#else
XVFBDDXDIR = hw/vfb
#endif
XVFBDIRS = $(STDDIRS) $(MFBDIR) $(FBDIR) $(XVFBDDXDIR) $(DEPDIRS)
#ifndef Win32Architecture
#if BuildDPMS
XVFBDPMSSTUBOBJS = $(XVFBDDXDIR)/dpmsstubs.o
#endif
XVFBOBJS = $(XVFBDDXDIR)/stubs.o $(XVFBDDXDIR)/miinitext.o $(XVFBDPMSSTUBOBJS)
#else
XVFBOBJS = dix/main.o hw/vfb/stubs.o hw/vfb/miinitext.o
#endif
XVFB = $(XVFBDDXDIR)/LibraryTargetName(vfb)
XVFBLIBS = PreFbLibs $(XVFB) $(FB) PostFbLibs $(MI)
XVFBSYSLIBS = $(FONTLIBS) $(SYSLIBS)
#if HasParallelMake
MakeMutex($(XVFBDIRS) $(XVFBOBJS) $(XVFB) $(XVFBLIBS) $(XVFBSYSLIBS))
#endif
#if ForceServerRemake
$(XVFBOBJS) $(XVFB) $(XVFBLIBS) $(XVFBSYSLIBS):: $(XVFBDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif
ServerTarget(Xvfb,$(XVFBDIRS),$(XVFBOBJS), \
	$(XVFBLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(XVFBSYSLIBS))
#endif /* XVirtualFramebufferServer */


#if XWinServer
XCOMM
XCOMM X Server for MS Windows
XCOMM
FBDIR = fb
SHADOWDIR = miext/shadow
LAYERDIR = miext/layer
XWINDDXDIR = hw/xwin
XWINLIB = $(XWINDDXDIR)/LibraryTargetName(Xwin)
XWINDIRS = $(STDDIRS) $(FBDIR) $(SHADOWDIR) $(LAYERDIR) $(XWINDDXDIR) \
	   $(DEPDIRS)
XWINOBJS = $(XWINDDXDIR)/stubs.o
XWINLIBS = PreFbLibs $(XWINLIB) FbPostFbLibs $(LAYER) $(SHADOW)
XWINSYSLIBS = $(FONTLIBS) $(LDPRELIBS) $(XLIB) $(SYSLIBS) -lgdi32 -lddraw

/*
 * These flags cause XWin.exe to be a Windows executable, which
 * prevents XWin.exe from opening a Command Prompt window when it is
 * started.  However, the flags also prevent XWin.exe from outputting
 * its status and error message to a Command Prompt; thus, one most
 * implement a method to redirect status and error messages to a file
 * before enabling these flags.
 */
EXTRA_LDOPTIONS = -mwindows -e _mainCRTStartup

#if HasParallelMake
MakeMutex($(XWINDIRS) $(XWINOBJS) $(XWINLIB) $(XWINLIBS) $(XWINSYSLIBS))
#endif

#if ForceServerRemake
$(XWINOBJS) $(XWINLIB) $(XWINLIBS) $(XWINSYSLIBS):: $(XWINDIRS)
	@@if [ -f $@@ ]; then touch $@@; fi
#endif

ServerTarget(XWin,$(XWINDIRS),$(XWINOBJS), \
	     $(XWINLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER),$(XWINSYSLIBS)) 

#ifndef ServerToInstall
#define ServerToInstall XWin
#endif

#endif /* XWinServer */


#ifdef DarwinArchitecture
/*
 * To allow building even when building the client-side libraries is turned
 * off, libraries in ProjectRoot are listed as dependencies for some targets.
 * This causes problems unless we tell make where to find these dependencies.
 */
VPATH = $(BUILDLIBDIR):$(USRLIBDIR)
#endif

#if XDarwinServer
XCOMM
XCOMM X Darwin server for Mac OS X / Darwin
XCOMM
FBDIR = fb
DARWINDDXDIR = hw/darwin
DARWINDIRS = $(STDDIRS) $(FBDIR) $(DARWINDDXDIR) $(DEPDIRS)
DARWINOBJS = $(DARWINDDXDIR)/xfIOKitStartup.o
DARWINLIBS = PreFbLibs $(DARWINDDXDIR)/LibraryTargetName(darwin) FbPostFbLibs
DARWINSYSLIBS = $(FONTLIBS) $(SYSLIBS) -framework IOKit

/*
 * IOKit X server
 */
SetUIDServerTarget(XDarwin,$(DARWINDIRS),$(DARWINOBJS), \
	$(DARWINLIBS),$(DARWINSYSLIBS))

#if DarwinQuartzSupport

/*
 * We need the IOKit framework. For Quartz support, we also need
 * CoreGraphics in ApplicationServices, HIToolbox in Carbon, CoreAudio
 * and Cocoa.
 */
QUARTZSYSLIBS = -framework ApplicationServices -framework Cocoa \
                -framework CoreAudio -framework Carbon -ObjC
QUARTZOBJS = $(DARWINDDXDIR)/bundle/quartzStartup.o
#if NothingOutsideProjectRoot
XDARWINAPPDIR = $(BINDIR)/XDarwin.app/Contents/MacOS
#else
XDARWINAPPDIR = /Applications/XDarwin.app/Contents/MacOS
#endif

/*
 * Quartz X server (installed in its application bundle)
 */
SetUIDServerTarget(XDarwinApp,$(DARWINDIRS),$(QUARTZOBJS), \
	$(DARWINLIBS) $(DARWINDDXDIR)/bundle/LibraryTargetName(XQuartz), \
	$(DARWINSYSLIBS) $(QUARTZSYSLIBS))

install::
	mkdir -p $(DESTDIR)$(XDARWINAPPDIR)
	mv $(DESTDIR)$(BINDIR)/XDarwinApp $(DESTDIR)$(XDARWINAPPDIR)/XDarwin
	-(cd $(DESTDIR)$(BINDIR); $(RM) XDarwinQuartz; \
		$(LN) $(XDARWINAPPDIR)/XDarwin XDarwinQuartz)

#else /* !DarwinQuartzSupport */

#define ServerToInstall XDarwin

#endif /* DarwinQuartzSupport */

#endif /* XDarwinServer */


CFBDIRS = $(CFB8DIR) $(CFB16DIR) $(CFB24DIR) $(CFB32DIR)
MIEXTDIRS = $(SHADOWDIR) $(LAYERDIR)
IPLANDIRS = $(IPLAN2P2DIR) $(IPLAN2P4DIR) $(IPLAN2P8DIR)
DDXDIRS = $(DECWSDDXDIR) $(SUNDDXDIR) $(LYNXDDXDIR) \
	  $(HPDDXDIR) $(XFREE86DDXDIR) $(XWINDDXDIR) $(DARWINDDXDIR) \
	  $(XVFBDDXDIR) $(XNESTDDXDIR)
SUBDIRS = $(STDDIRS) $(MFBDIR) $(CFBDIRS) $(IPLANDIRS) $(ILBMDIR) $(AFBDIR) \
          $(LMFCFBDIR) $(DDXDIRS) $(FBDIR) $(KDRIVEDIRS) $(MIEXTDIRS)

#if  defined(ServerToInstall) && \
    !defined(OS2Architecture)
install::
	-(cd $(DESTDIR)$(BINDIR); $(RM) X; $(LN) ServerToInstall X)
#endif

#define IHaveSubdirs

DependSubdirs($(SUBDIRS))
MakeLintLibSubdirs($(SUBDIRS))
LintSubdirs($(SUBDIRS))

ForceSubdirs($(DEPDIRS) $(SUBDIRS))

InstallManPage(Xserver,$(MANDIR))
@


1.1.9.1
log
@OpenBSD just has imported exactly this tree into their vendor branch,
called the same tag, in XF4/xc
This is, apparently, the last XFree86 snapshot before the licence change
(ie, addition of the advertising clause)

Since the developers don't see any problems with that, and we would like
to integrate improvements done by the remaining one or two (or so) XFree86
developers (j/k), this prepares enabling us to update X-Window in the future.
@
text
@d5 1
a5 1
XCOMM $XFree86: xc/programs/Xserver/Imakefile,v 3.297 2004/01/12 21:43:19 herrb Exp $
d53 14
d68 8
d88 1
a88 1
               GL/mesa/GLcore/ModuleLibraryTargetName(GLcore)
d91 2
a92 1
               GL/mesa/GLcore/ModuleLibraryTargetName(GLcore) \
d99 2
d106 5
a113 3
#ifdef XFree86Version
    XF86XKBOBJS = xkb/xf86KillSrv.o xkb/xf86VT.o xkb/xf86Private.o
#endif
d201 3
a203 2
     EXTENSIONS = $(OTHEREXTS) $(RANDRLIB) $(RENDERLIB)
   LOADABLEEXTS = $(MISCEXT) $(DBEEXT) $(RECORDEXT) $(GLXEXT) $(XTRAPEXT)
d208 1
a208 1
     EXTENSIONS = $(OTHEREXTS) $(GLXEXT) $(RANDRLIB) $(RENDERLIB)
d210 2
a211 1
                  $(LBXEXT) $(DBEEXT) $(RECORDEXT) $(SITEEXTS) $(XTRAPEXT)
d213 1
a213 1
        EXTDIRS = Xext $(XKBDIR) $(XIDIR) $(GLXDIR) \
d215 1
a215 1
                  $(RANDRDIR) $(RENDERDIR) $(XTRAPDIR)
d219 1
a219 1
             OS = os/LibraryTargetName(os)
d242 2
a243 1
            CFB = cfb16/LibraryTargetName(cfb16) \
d245 1
a245 2
		  cfb32/LibraryTargetName(cfb32) \
		  cfb/LibraryTargetName(cfb)
d247 8
a254 8
           CFB4 = cfb4/LibraryTargetName(cfb4) \
		  cfb/LibraryTargetName(cfb)
          CFB16 = cfb16/LibraryTargetName(cfb16) \
		  cfb/LibraryTargetName(cfb)
          CFB24 = cfb24/LibraryTargetName(cfb24) \
		  cfb/LibraryTargetName(cfb)
          CFB32 = cfb32/LibraryTargetName(cfb32) \
		  cfb/LibraryTargetName(cfb)
d267 1
a267 1
           FONT = $(FONTLIBSRC)/LibraryTargetName(Xfont) $(FREETYPE2LIB)
d269 1
a269 1
           FONT = $(LDPRELIB) $(XFONTLIB) $(FREETYPE2LIB)
a271 1
#if UsbMouseSupport 
a276 1
#endif
d287 1
a287 2
		  $(PAMLIBS)  $(XAUTHLIB) $(XDMCPLIB) $(EXTRASYSLIBS)
#if !HasCbrt
a288 1
#endif
a289 8
          FBDIR = fb
         MFBDIR = mfb
        CFB4DIR = cfb4
        CFB8DIR = cfb
       CFB16DIR = cfb16
       CFB24DIR = cfb24
       CFB32DIR = cfb32
         AFBDIR = afb
d303 1
a303 1
 *  MFBSUBDIR = mfb
d305 5
a309 5
 *  CFB4SUBDIR  = cfb4  (if the server needs 4 bit cfb)
 *  CFB8SUBDIR  = cfb   (8 bit cfb)
 *  CFB16SUBDIR = cfb16 (16 bit cfb)
 *  CFB24SUBDIR = cfb24 (24 bit cfb)
 *  CFB32SUBDIR = cfb32 (32 bit cfb)
d323 1
a323 1
#if defined(XdecServer) && XdecServer
d327 2
a328 2
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
d349 1
a349 1
#if defined(XdecMultiDepthServer) && XdecMultiDepthServer
d354 5
a358 5
MFBSUBDIR   = mfb
CFB8SUBDIR  = cfb
CFB16SUBDIR = cfb16
CFB24SUBDIR = cfb24
CFB32SUBDIR = cfb32
d373 1
a373 1
#if defined(XsunServer) && XsunServer
d377 2
a378 2
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
d382 1
a382 1
#elif defined(XF86Server) && XF86Server
d396 1
a396 1
	$(LIBCWRAPPER) $(SUNLIBS) $(LOADABLEEXTS),$(SUNSYSLIBS))
d403 1
a403 1
#if defined(Xsun24Server) && Xsun24Server
d407 5
a411 5
MFBSUBDIR = mfb
CFB8SUBDIR = cfb
CFB16SUBDIR = cfb16
CFB24SUBDIR = cfb24
CFB32SUBDIR = cfb32
d418 1
a418 1
#elif defined(XF86Server) && XF86Server
d425 1
a425 1
	$(LIBCWRAPPER) $(SUN24LIBS) $(LOADABLEEXTS),$(FONTLIBS) $(SYSLIBS))
d432 1
a432 1
#if defined(XsunMonoServer) && XsunMonoServer
d436 1
a436 1
MFBSUBDIR = mfb
d439 1
a439 1
#if defined(XF86Server) && XF86Server
d446 1
a446 1
	$(LIBCWRAPPER) $(SUNMLIBS) $(LOADABLEEXTS),$(FONTLIBS) $(SYSLIBS))
d453 1
a453 1
#if defined(XsunLynxServer) && XsunLynxServer
d457 2
a458 2
MFBSUBDIR = mfb
CFB8SUBDIR = cfb
d471 1
a471 1
#if defined(XsunLynxMonoServer) && XsunLynxMonoServer
d475 1
a475 1
MFBSUBDIR = mfb
d488 24
d516 1
a516 1
#if defined(XF86Server) && XF86Server
d519 1
a519 1
#if defined(XnestServer) && XnestServer
d522 1
a522 1
#if defined(XVirtualFramebufferServer) && XVirtualFramebufferServer
d525 1
a525 1
#if defined(XWinServer) && XWinServer && !MakeDllModules
d528 4
a531 4
#if (defined(XF86Server) && XF86Server) || \
    (defined(XnestServer) && XnestServer) || \
    (defined(XVirtualFramebufferServer) && XVirtualFramebufferServer) || \
    (!MakeDllModules && defined(XWinServer) && XWinServer)
d538 1
a538 1
#if defined(XF86Server) && XF86Server
d542 6
a547 6
FBSUBDIR = fb
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
CFB16SUBDIR = cfb16
CFB24SUBDIR = cfb24
CFB32SUBDIR = cfb32
a549 5
#ifdef OS2Architecture
SERVERDEFFILE = XFree86.def
XNESTDEFFILE = Xnest.def
XVFBDEFFILE = Xvfb.def
#endif
d551 1
a551 1
AFBSUBDIR = afb
d605 1
a605 1
XF86VBELIB = $(XF86SRC)/vbe/LibraryTargetName(vbe)
d623 1
a623 1
	      $(XF8_32WIDLIB) $(XF8_32BPPLIB) \
d630 1
a630 1
	    $(XF86PARSLIB) $(XF86VBELIB) $(XF86OSLIB) $(XF86INT10LIB) 
d637 1
a637 1
XF86MAINLIBS = PreFbLibsNoFont \
a640 2
XF86SERVERLIBS = $(XF86DRVLIBS) $(XF86IDRVLIBS) $(XF86LIBS) $(XF86LOADERLIB) \
		 $(XF86COMLIB) $(XF86MAINLIBS) $(XF86SCANLIB) $(XF86OSLIB)
d644 2
a648 2
#endif
XF86SERVEROBJS = $(XF86XKBOBJS) $(XF86DRVOBJS) $(XF86IDRVOBJS)
d654 1
a654 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d656 1
a656 1
SetUIDServerTarget(XFree86,$(XF86SERVERSUBDIRS),$(XF86SERVEROBJS) $(SERVERDEFFILE), \
d666 1
a666 1
#if defined(KDriveXServer) && KDriveXServer
a671 3
#if HasTsLib
       KDTSLIB = -lts
#endif
d674 1
a674 1
          KDOS = $(KDOSDIR)/LibraryTargetName(linux) $(KDTSLIB)
d682 5
d699 1
a699 1
#define KdLibs $(KD) $(KDOS) $(PSEUDO8) MiExtLibs $(RANDRLIB) $(RENDERLIB)
d701 1
a701 1
#if defined(XfbdevServer) && XfbdevServer
d708 1
a708 1
       
d712 1
a712 1
   
d721 1
a721 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d727 1
a727 1
#if defined(XSavageServer) && XSavageServer
d747 1
a747 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d753 1
a753 1
#if defined(XIgsServer) && XIgsServer
d773 1
a773 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d779 1
a779 1
#if defined(XTridentServer) && XTridentServer
d804 1
a804 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d810 1
a810 1
#if defined(XchipsServer) && XchipsServer
d833 1
a833 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d839 1
a839 1
#if defined(Xmach64Server) && Xmach64Server
d850 1
a850 1
  
d853 1
a853 1
   
d862 1
a862 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d868 1
a868 1
#if defined(Xi810Server) && Xi810Server
d892 1
a892 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d899 1
a899 1
#if defined(XSis530Server) && XSis530Server
d919 1
a919 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d925 1
a925 1
#if defined(XTrioServer) && XTrioServer
d945 1
a945 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d951 1
a951 1
#if defined(XipaqServer) && XipaqServer
d979 1
a979 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d985 1
a985 1
#if defined(XTS300Server) && XTS300Server
d1011 1
a1011 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1017 1
a1017 1
#if defined(XItsyServer) && XItsyServer
d1036 1
a1036 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1042 1
a1042 1
#if defined(XvesaServer) && XvesaServer
d1062 1
a1062 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1068 26
d1096 2
a1097 1
	   $(VESADIR) $(PCMCIADIR) $(IPAQDIR) $(MACH64DIR) $(CHIPSDIR)
d1100 1
a1100 1
#if defined(XprtServer) && XprtServer
d1104 3
a1106 3
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
CFB32SUBDIR = cfb32
d1129 1
a1129 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1132 1
a1132 1
	$(LIBCWRAPPER) $(XPLIBS) $(LOADABLEEXTS),$(XPSYSLIBS))
d1135 1
a1135 1
#if defined(XnestServer) && XnestServer
d1160 1
a1160 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1162 2
a1163 2
ServerTarget(Xnest,$(XNESTDIRS),$(XNESTOBJS) $(XNESTDEFFILE), \
	$(LIBCWRAPPER) $(XNESTLIBS) $(LOADABLEEXTS),$(XNESTSYSLIBS))
d1167 1
a1167 1
#if defined(XnonServer) && XnonServer
d1171 4
a1174 4
MFBSUBDIR   = mfb
CFB8SUBDIR  = cfb
CFB16SUBDIR = cfb16
CFB32SUBDIR = cfb32
d1182 1
a1182 1
#if defined(XVirtualFramebufferServer) && XVirtualFramebufferServer
d1186 2
a1187 2
MFBSUBDIR = mfb
FBSUBDIR  = fb
d1210 1
a1210 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1212 2
a1213 2
ServerTarget(Xvfb,$(XVFBDIRS),$(XVFBOBJS) $(XVFBDEFFILE), \
	$(LIBCWRAPPER) $(XVFBLIBS) $(LOADABLEEXTS),$(XVFBSYSLIBS))
d1217 1
a1217 1
#if defined(XWinServer) && XWinServer
d1221 1
a1221 1
FBSUBDIR = fb
a1222 1
#if 0
a1223 3
#else
LAYERDIR = 
#endif
a1224 2
XWINPARSERDIR = hw/xfree86/parser
XWINPARSERLIB = $(XWINPARSERDIR)/LibraryTargetName(xf86config)
d1227 4
a1230 10
	   $(DEPDIRS) $(XWINPARSERDIR)
XWINOBJS = $(XWINDDXDIR)/stubs.o $(XWINDDXDIR)/XWin.res
#if 0
XWINLIBS = PreFbLibs $(XWINLIB) FbPostFbLibs $(LAYER) $(SHADOW) \
           $(XWINPARSERLIB)
#else
XWINLIBS = PreFbLibs $(XWINLIB) FbPostFbLibs $(SHADOW) \
           $(XWINPARSERLIB)
#endif
XWINSYSLIBS = $(FONTLIBS) $(LDPRELIBS) $(XLIB) $(SYSLIBS) -lgdi32
d1248 1
a1248 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1252 1
a1252 1
	     $(LIBCWRAPPER) $(XWINLIBS) $(LOADABLEEXTS),$(XWINSYSLIBS)) 
d1270 1
a1270 1
#if defined(XDarwinServer) && XDarwinServer
d1274 1
a1274 3
FBSUBDIR = fb
SHADOWDIR = miext/shadow
ROOTLESSDIR = miext/rootless
d1276 3
a1278 3
DARWINDIRS = $(STDDIRS) $(FBDIR) $(SHADOWDIR) $(DARWINDDXDIR) $(DEPDIRS)
DARWINLIBS = PreFbLibs $(DARWINDDXDIR)/LibraryTargetName(darwin)
DARWINEXTLIBS = MiExtLibs FbPostFbLibs
a1279 1
IOKITLIB = $(DARWINDDXDIR)/iokit/LibraryTargetName(iokit)
d1285 1
a1285 1
	$(DARWINLIBS) $(IOKITLIB) $(DARWINEXTLIBS),$(DARWINSYSLIBS))
d1290 3
a1292 1
 * Quartz modes load a GLX extension dynamically, so we can't build it in.
a1293 10
AQUAEXTENSIONS = $(OTHEREXTS) $(RANDRLIB) $(RENDERLIB)
#if !BuildXinerama
#define AquaPostFbLibs NoMfbBarePostFbLibs $(AQUAEXTENSIONS)
#else
#define AquaPostFbLibs $(AQUAEXTENSIONS) NoMfbBarePostFbLibs $(AQUAEXTENSIONS)
#endif
QUARTZEXTLIBS = MiExtLibs $(FB) AquaPostFbLibs

QUARTZDIR = $(DARWINDDXDIR)/quartz
QUARTZLIB = $(QUARTZDIR)/LibraryTargetName(XQuartz)
d1296 1
a1296 5
ROOTLESSLIB = $(ROOTLESSDIR)/LibraryTargetName(rootless) \
              $(ROOTLESSDIR)/safeAlpha/LibraryTargetName(safeAlpha) \
              $(ROOTLESSDIR)/accel/LibraryTargetName(rlAccel)
XPLUGINLIB = XpluginLibrary

d1298 1
a1298 1
XDARWINAPPDIR = $(BINDIR)/XDarwin.app/Contents
d1300 1
a1300 1
XDARWINAPPDIR = /Applications/XDarwin.app/Contents
d1307 2
a1308 2
	$(DARWINLIBS) $(QUARTZLIB) $(QUARTZEXTLIBS), \
	$(DARWINSYSLIBS) $(QUARTZSYSLIBS) -u _miDCInitialize)
d1311 2
a1312 3
	$(MKDIRHIER) $(DESTDIR)$(XDARWINAPPDIR)/MacOS
	$(MV) $(DESTDIR)$(BINDIR)/XDarwinApp \
		$(DESTDIR)$(XDARWINAPPDIR)/MacOS/XDarwin
d1314 1
a1314 45
		$(LN) $(XDARWINAPPDIR)/MacOS/XDarwin XDarwinQuartz)

/*
 * Display mode bundles for Quartz
 * (installed in their own bundles inside XDarwin's)
 */
#if HasXplugin
XPRDIRS = $(QUARTZDIR)/xpr $(ROOTLESSDIR) $(ROOTLESSDIR)/safeAlpha
XPRLIBS = $(QUARTZDIR)/xpr/LibraryTargetName(xpr) $(ROOTLESSLIB)

BundleProgramTarget(xpr,XDarwinApp,$(XPRDIRS),$(QUARTZDIR)/xpr/xprScreen.o, \
	$(XPRLIBS),-framework ApplicationServices \
	$(XPLUGINLIB),$(XDARWINAPPDIR)/Resources)
#endif

CRDIRS = $(QUARTZDIR)/cr $(ROOTLESSDIR) $(ROOTLESSDIR)/safeAlpha
CRLIBS = $(QUARTZDIR)/cr/LibraryTargetName(cr) $(ROOTLESSLIB)

BundleProgramTarget(cr,XDarwinApp,$(CRDIRS),$(QUARTZDIR)/cr/crScreen.o, \
	$(CRLIBS),-framework ApplicationServices -framework Cocoa \
	-framework Carbon -ObjC,$(XDARWINAPPDIR)/Resources)

FSDIRS = $(QUARTZDIR)/fullscreen $(SHADOWDIR)
FSLIBS = $(QUARTZDIR)/fullscreen/LibraryTargetName(fullscreen) $(SHADOW)

BundleProgramTarget(fullscreen,XDarwinApp,$(FSDIRS), \
	$(QUARTZDIR)/fullscreen/fullscreen.o,$(FSLIBS), \
	-framework ApplicationServices,$(XDARWINAPPDIR)/Resources)

/*
 * GLX bundles for Quartz
 * (installed in their own bundles inside XDarwin's)
 */
BundleProgramTarget(glxAGL,XDarwinApp,GL,GL/glx/glxext.o,GL/glx/libglx.a \
	GL/apple/libAGLcore.a, \
	-framework AGL -framework OpenGL,$(XDARWINAPPDIR)/Resources)

#if BuildAppleDRI
BundleProgramTarget(glxCGL,XDarwinApp,GL,GL/glx/glxext.o,GL/glx/libglx.a \
	GL/apple/libCGLcore.a, \
	-framework OpenGL $(XPLUGINLIB),$(XDARWINAPPDIR)/Resources)
#endif

BundleProgramTarget(glxMesa,XDarwinApp,GL,GL/glx/glxext.o,GL/glx/libglx.a \
	GL/mesa/GLcore/libGLcore.a,NullParameter,$(XDARWINAPPDIR)/Resources)
d1325 2
a1326 2
CFBSUBDIRS = $(CFB8SUBDIR) $(CFB16SUBDIR) $(CFB24SUBDIR) $(CFB32SUBDIR)
MIEXTDIRS = $(SHADOWDIR) $(LAYERDIR) $(ROOTLESSDIR)
d1331 2
a1332 4
SUBDIRS = $(STDDIRS) $(MFBSUBDIR) $(CFBSUBDIRS) \
	  $(IPLANDIRS) $(ILBMDIR) $(AFBSUBDIR) \
          $(LMFCFBDIR) $(DDXDIRS) $(FBSUBDIR) $(KDRIVEDIRS) $(MIEXTDIRS) \
	  $(XWINPARSERDIR)
d1334 2
a1335 1
#if  defined(ServerToInstall) && !defined(OS2Architecture)
a1346 3

DEFAULTFONTPATH = DefaultFontPath
EXTRAMANDEFS = -D__default_font_path__="`echo $(DEFAULTFONTPATH) | sed -e 's/,/, /g'`"
@


1.1.1.1
log
@Import OpenBSD 3.3 XF4 repository from CTM 3132 the first time
This finalizes starting an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright  1968-2003  The authors of And contributors to UNIX, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@The X-Windowing System

Import XFree86 4.3 from OpenBSD by CTM, in the hope it's stable
@
text
@d5 1
a5 1
XCOMM $XFree86: xc/programs/Xserver/Imakefile,v 3.278 2003/02/17 17:06:40 dawes Exp $
d88 1
a88 1
               GL/mesa/GLcore/ModuleLibraryTargetName(GLcore)
d91 2
a92 1
               GL/mesa/GLcore/ModuleLibraryTargetName(GLcore) \
a113 3
#ifdef XFree86Version
    XF86XKBOBJS = xkb/xf86KillSrv.o xkb/xf86VT.o xkb/xf86Private.o
#endif
d201 1
a201 1
     EXTENSIONS = $(OTHEREXTS) $(RANDRLIB) $(RENDERLIB)
d208 1
a208 2
     EXTENSIONS = $(OTHEREXTS) $(PEXLIBS) $(GLXEXT) $(RANDRLIB) \
                  $(RENDERLIB)
d215 1
a215 1
                  $(RANDRDIR) $(RENDERDIR) $(XTRAPDIR)
d242 2
a243 1
            CFB = cfb16/LibraryTargetName(cfb16) \
d245 1
a245 2
		  cfb32/LibraryTargetName(cfb32) \
		  cfb/LibraryTargetName(cfb)
d247 8
a254 8
           CFB4 = cfb4/LibraryTargetName(cfb4) \
		  cfb/LibraryTargetName(cfb)
          CFB16 = cfb16/LibraryTargetName(cfb16) \
		  cfb/LibraryTargetName(cfb)
          CFB24 = cfb24/LibraryTargetName(cfb24) \
		  cfb/LibraryTargetName(cfb)
          CFB32 = cfb32/LibraryTargetName(cfb32) \
		  cfb/LibraryTargetName(cfb)
d267 1
a267 1
           FONT = $(FONTLIBSRC)/LibraryTargetName(Xfont) $(FREETYPE2LIB)
d271 1
a271 4
#if FontLibSharedFreeType
      SERVERFT2 = $(FREETYPE2LIB)
#endif
       FONTLIBS = $(FONT) $(XPFBLIBS) $(SERVERFT2)
a287 1
#if !HasCbrt
a288 1
#endif
d323 1
a323 1
#if defined(XdecServer) && XdecServer
d349 1
a349 1
#if defined(XdecMultiDepthServer) && XdecMultiDepthServer
d373 1
a373 1
#if defined(XsunServer) && XsunServer
d382 1
a382 1
#elif defined(XF86Server) && XF86Server
d403 1
a403 1
#if defined(Xsun24Server) && Xsun24Server
d418 1
a418 1
#elif defined(XF86Server) && XF86Server
d432 1
a432 1
#if defined(XsunMonoServer) && XsunMonoServer
d439 1
a439 1
#if defined(XF86Server) && XF86Server
d453 1
a453 1
#if defined(XsunLynxServer) && XsunLynxServer
d471 1
a471 1
#if defined(XsunLynxMonoServer) && XsunLynxMonoServer
d488 1
a488 1
#if defined(XhpServer) && XhpServer
a511 1

d516 1
a516 1
#if defined(XF86Server) && XF86Server
d519 1
a519 1
#if defined(XnestServer) && XnestServer
d522 1
a522 1
#if defined(XVirtualFramebufferServer) && XVirtualFramebufferServer
d525 1
a525 1
#if defined(XWinServer) && XWinServer && !MakeDllModules
d528 4
a531 4
#if (defined(XF86Server) && XF86Server) || \
    (defined(XnestServer) && XnestServer) || \
    (defined(XVirtualFramebufferServer) && XVirtualFramebufferServer) || \
    (!MakeDllModules && defined(XWinServer) && XWinServer)
d538 1
a538 1
#if defined(XF86Server) && XF86Server
d605 1
a605 1
XF86VBELIB = $(XF86SRC)/vbe/LibraryTargetName(vbe)
d623 1
a623 1
	      $(XF8_32WIDLIB) $(XF8_32BPPLIB) \
d630 1
a630 1
	    $(XF86PARSLIB) $(XF86VBELIB) $(XF86OSLIB) $(XF86INT10LIB) 
d637 1
a637 1
XF86MAINLIBS = PreFbLibsNoFont \
a640 2
XF86SERVERLIBS = $(XF86DRVLIBS) $(XF86IDRVLIBS) $(XF86LIBS) $(XF86LOADERLIB) \
		 $(XF86COMLIB) $(XF86MAINLIBS) $(XF86SCANLIB) $(XF86OSLIB)
d644 2
a648 2
#endif
XF86SERVEROBJS = $(XF86XKBOBJS) $(XF86DRVOBJS) $(XF86IDRVOBJS)
d654 1
a654 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d666 1
a666 1
#if defined(KDriveXServer) && KDriveXServer
a671 3
#if HasTsLib
       KDTSLIB = -lts
#endif
d674 1
a674 1
          KDOS = $(KDOSDIR)/LibraryTargetName(linux) $(KDTSLIB)
d699 1
a699 1
#define KdLibs $(KD) $(KDOS) $(PSEUDO8) MiExtLibs $(RANDRLIB) $(RENDERLIB)
d701 1
a701 1
#if defined(XfbdevServer) && XfbdevServer
d708 1
a708 1
       
d712 1
a712 1
   
d721 1
a721 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d727 1
a727 1
#if defined(XSavageServer) && XSavageServer
d734 1
a734 1

d736 1
a736 1

d738 1
a738 1

d747 1
a747 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d753 1
a753 1
#if defined(XIgsServer) && XIgsServer
d773 1
a773 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d779 1
a779 1
#if defined(XTridentServer) && XTridentServer
d792 1
a792 1

d795 1
a795 1

d804 1
a804 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d810 1
a810 1
#if defined(XchipsServer) && XchipsServer
d833 1
a833 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d839 1
a839 1
#if defined(Xmach64Server) && Xmach64Server
d862 1
a862 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d868 1
a868 1
#if defined(Xi810Server) && Xi810Server
d881 1
a881 1

d883 1
a883 1

d892 1
a892 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d899 1
a899 1
#if defined(XSis530Server) && XSis530Server
d919 1
a919 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d925 1
a925 1
#if defined(XTrioServer) && XTrioServer
d936 1
a936 1

d945 1
a945 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d951 1
a951 1
#if defined(XipaqServer) && XipaqServer
d979 1
a979 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d985 1
a985 1
#if defined(XTS300Server) && XTS300Server
d992 1
a992 1

d1000 1
a1000 1

d1002 1
a1002 1

d1005 1
a1005 1

d1011 1
a1011 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1017 1
a1017 1
#if defined(XItsyServer) && XItsyServer
d1036 1
a1036 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1042 1
a1042 1
#if defined(XvesaServer) && XvesaServer
d1062 1
a1062 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1100 1
a1100 1
#if defined(XprtServer) && XprtServer
d1129 1
a1129 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1135 1
a1135 1
#if defined(XnestServer) && XnestServer
d1160 1
a1160 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1167 1
a1167 1
#if defined(XnonServer) && XnonServer
d1182 1
a1182 1
#if defined(XVirtualFramebufferServer) && XVirtualFramebufferServer
d1210 1
a1210 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1217 1
a1217 1
#if defined(XWinServer) && XWinServer
a1222 1
#if 0
a1223 3
#else
LAYERDIR = 
#endif
a1224 2
XWINPARSERDIR = hw/xfree86/parser
XWINPARSERLIB = $(XWINPARSERDIR)/LibraryTargetName(xf86config)
d1227 4
a1230 10
	   $(DEPDIRS) $(XWINPARSERDIR)
XWINOBJS = $(XWINDDXDIR)/stubs.o $(XWINDDXDIR)/XWin.res
#if 0
XWINLIBS = PreFbLibs $(XWINLIB) FbPostFbLibs $(LAYER) $(SHADOW) \
           $(XWINPARSERLIB)
#else
XWINLIBS = PreFbLibs $(XWINLIB) FbPostFbLibs $(SHADOW) \
           $(XWINPARSERLIB)
#endif
XWINSYSLIBS = $(FONTLIBS) $(LDPRELIBS) $(XLIB) $(SYSLIBS) -lgdi32
d1248 1
a1248 1
	@@if [ -f $@@ ]; then touch $@@ >/dev/null 2>&1 || exit 0; fi
d1270 1
a1270 1
#if defined(XDarwinServer) && XDarwinServer
a1274 1
SHADOWDIR = miext/shadow
d1276 1
a1276 1
DARWINDIRS = $(STDDIRS) $(FBDIR) $(SHADOWDIR) $(DARWINDDXDIR) $(DEPDIRS)
d1278 1
a1278 2
DARWINLIBS = PreFbLibs $(DARWINDDXDIR)/LibraryTargetName(darwin)
DARWINEXTLIBS = MiExtLibs FbPostFbLibs
d1285 1
a1285 1
	$(DARWINLIBS) $(DARWINEXTLIBS),$(DARWINSYSLIBS))
d1289 5
a1293 16
#if GlxUseAqua

AQUAEXTENSIONS = $(OTHEREXTS) $(PEXLIBS) $(RANDRLIB) $(RENDERLIB)
#if !BuildXinerama
#define AquaPostFbLibs NoMfbBarePostFbLibs $(AQUAEXTENSIONS)
#else
#define AquaPostFbLibs $(AQUAEXTENSIONS) NoMfbBarePostFbLibs $(AQUAEXTENSIONS)
#endif
QUARTZEXTLIBS = MiExtLibs $(FB) AquaPostFbLibs

#else /* !GlxUseAqua */

QUARTZEXTLIBS = $(DARWINEXTLIBS)

#endif /* GlxUseAqua */

d1296 1
a1296 1
QUARTZOBJS = $(DARWINDDXDIR)/quartz/quartzStartup.o
d1298 1
a1298 1
XDARWINAPPDIR = $(BINDIR)/XDarwin.app/Contents
d1300 1
a1300 1
XDARWINAPPDIR = /Applications/XDarwin.app/Contents
a1301 2
AGLBUNDLEDIR = $(XDARWINAPPDIR)/Resources/glxAGL.bundle/Contents/MacOS
MESABUNDLEDIR = $(XDARWINAPPDIR)/Resources/glxMesa.bundle/Contents/MacOS
d1307 2
a1308 2
	$(DARWINLIBS) $(DARWINDDXDIR)/quartz/LibraryTargetName(XQuartz) \
	$(QUARTZEXTLIBS),$(DARWINSYSLIBS) $(QUARTZSYSLIBS))
d1311 2
a1312 3
	$(MKDIRHIER) $(DESTDIR)$(XDARWINAPPDIR)/MacOS
	$(MV) $(DESTDIR)$(BINDIR)/XDarwinApp \
		$(DESTDIR)$(XDARWINAPPDIR)/MacOS/XDarwin
d1314 1
a1314 18
		$(LN) $(XDARWINAPPDIR)/MacOS/XDarwin XDarwinQuartz)

/*
 * GLX bundles for Quartz (installed in their own bundles inside XDarwin's)
 */
AllTarget(glxAGL)
glxAGL: XDarwinApp
	$(CC) -bundle -o glxAGL GL/glx/glxext.o GL/glx/libglx.a \
		GL/aqua/libAquaGLcore.a -framework AGL -framework OpenGL \
		-bundle_loader XDarwinApp
InstallProgram(glxAGL,$(AGLBUNDLEDIR))

AllTarget(glxMesa)
glxMesa: XDarwinApp
	$(CC) -bundle -o glxMesa GL/glx/glxext.o \
		GL/glx/libglx.a GL/mesa/GLcore/libGLcore.a \
		-bundle_loader XDarwinApp
InstallProgram(glxMesa,$(MESABUNDLEDIR))
d1332 1
a1332 2
          $(LMFCFBDIR) $(DDXDIRS) $(FBDIR) $(KDRIVEDIRS) $(MIEXTDIRS) \
	  $(XWINPARSERDIR)
d1334 2
a1335 1
#if  defined(ServerToInstall) && !defined(OS2Architecture)
@


1.1.1.3
log
@That's what OpenBSD will, probably, ship as XF4 in 3.5
their last sync against XFree86 4.3-current has been
imported into our vendor branch, too
@
text
@d5 1
a5 1
XCOMM $XFree86: xc/programs/Xserver/Imakefile,v 3.297 2004/01/12 21:43:19 herrb Exp $
d53 14
d68 8
d98 2
d105 5
d204 2
a205 1
   LOADABLEEXTS = $(MISCEXT) $(DBEEXT) $(RECORDEXT) $(GLXEXT) $(XTRAPEXT)
d210 2
a211 1
     EXTENSIONS = $(OTHEREXTS) $(GLXEXT) $(RANDRLIB) $(RENDERLIB)
d213 2
a214 1
                  $(LBXEXT) $(DBEEXT) $(RECORDEXT) $(SITEEXTS) $(XTRAPEXT)
d216 1
a216 1
        EXTDIRS = Xext $(XKBDIR) $(XIDIR) $(GLXDIR) \
d222 1
a222 1
             OS = os/LibraryTargetName(os)
d272 4
a275 1
           FONT = $(LDPRELIB) $(XFONTLIB) $(FREETYPE2LIB)
d277 1
a277 1
       FONTLIBS = $(FONT) $(XPFBLIBS)
d293 1
a293 1
		  $(PAMLIBS)  $(XAUTHLIB) $(XDMCPLIB) $(EXTRASYSLIBS)
a297 8
          FBDIR = fb
         MFBDIR = mfb
        CFB4DIR = cfb4
        CFB8DIR = cfb
       CFB16DIR = cfb16
       CFB24DIR = cfb24
       CFB32DIR = cfb32
         AFBDIR = afb
d311 1
a311 1
 *  MFBSUBDIR = mfb
d313 5
a317 5
 *  CFB4SUBDIR  = cfb4  (if the server needs 4 bit cfb)
 *  CFB8SUBDIR  = cfb   (8 bit cfb)
 *  CFB16SUBDIR = cfb16 (16 bit cfb)
 *  CFB24SUBDIR = cfb24 (24 bit cfb)
 *  CFB32SUBDIR = cfb32 (32 bit cfb)
d335 2
a336 2
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
d362 5
a366 5
MFBSUBDIR   = mfb
CFB8SUBDIR  = cfb
CFB16SUBDIR = cfb16
CFB24SUBDIR = cfb24
CFB32SUBDIR = cfb32
d385 2
a386 2
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
d404 1
a404 1
	$(LIBCWRAPPER) $(SUNLIBS) $(LOADABLEEXTS),$(SUNSYSLIBS))
d415 5
a419 5
MFBSUBDIR = mfb
CFB8SUBDIR = cfb
CFB16SUBDIR = cfb16
CFB24SUBDIR = cfb24
CFB32SUBDIR = cfb32
d433 1
a433 1
	$(LIBCWRAPPER) $(SUN24LIBS) $(LOADABLEEXTS),$(FONTLIBS) $(SYSLIBS))
d444 1
a444 1
MFBSUBDIR = mfb
d454 1
a454 1
	$(LIBCWRAPPER) $(SUNMLIBS) $(LOADABLEEXTS),$(FONTLIBS) $(SYSLIBS))
d465 2
a466 2
MFBSUBDIR = mfb
CFB8SUBDIR = cfb
d483 1
a483 1
MFBSUBDIR = mfb
d496 25
d551 6
a556 6
FBSUBDIR = fb
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
CFB16SUBDIR = cfb16
CFB24SUBDIR = cfb24
CFB32SUBDIR = cfb32
a558 5
#ifdef OS2Architecture
SERVERDEFFILE = XFree86.def
XNESTDEFFILE = Xnest.def
XVFBDEFFILE = Xvfb.def
#endif
d560 1
a560 1
AFBSUBDIR = afb
d667 1
a667 1
SetUIDServerTarget(XFree86,$(XF86SERVERSUBDIRS),$(XF86SERVEROBJS) $(SERVERDEFFILE), \
d696 5
d774 1
a774 1

d776 1
a776 1

d778 1
a778 1

d835 1
a835 1

d838 1
a838 1

d924 1
a924 1

d982 1
a982 1

d984 1
a984 1

d987 1
a987 1

d1041 1
a1041 1

d1044 1
a1044 1

d1082 26
d1110 2
a1111 1
	   $(VESADIR) $(PCMCIADIR) $(IPAQDIR) $(MACH64DIR) $(CHIPSDIR)
d1118 3
a1120 3
MFBSUBDIR  = mfb
CFB8SUBDIR = cfb
CFB32SUBDIR = cfb32
d1146 1
a1146 1
	$(LIBCWRAPPER) $(XPLIBS) $(LOADABLEEXTS),$(XPSYSLIBS))
d1176 2
a1177 2
ServerTarget(Xnest,$(XNESTDIRS),$(XNESTOBJS) $(XNESTDEFFILE), \
	$(LIBCWRAPPER) $(XNESTLIBS) $(LOADABLEEXTS),$(XNESTSYSLIBS))
d1185 4
a1188 4
MFBSUBDIR   = mfb
CFB8SUBDIR  = cfb
CFB16SUBDIR = cfb16
CFB32SUBDIR = cfb32
d1200 2
a1201 2
MFBSUBDIR = mfb
FBSUBDIR  = fb
d1226 2
a1227 2
ServerTarget(Xvfb,$(XVFBDIRS),$(XVFBOBJS) $(XVFBDEFFILE), \
	$(LIBCWRAPPER) $(XVFBLIBS) $(LOADABLEEXTS),$(XVFBSYSLIBS))
d1235 1
a1235 1
FBSUBDIR = fb
d1278 1
a1278 1
	     $(LIBCWRAPPER) $(XWINLIBS) $(LOADABLEEXTS),$(XWINSYSLIBS)) 
d1300 1
a1300 1
FBSUBDIR = fb
a1301 1
ROOTLESSDIR = miext/rootless
d1304 1
a1307 1
IOKITLIB = $(DARWINDDXDIR)/iokit/LibraryTargetName(iokit)
d1313 1
a1313 1
	$(DARWINLIBS) $(IOKITLIB) $(DARWINEXTLIBS),$(DARWINSYSLIBS))
d1317 3
a1319 4
/*
 * Quartz modes load a GLX extension dynamically, so we can't build it in.
 */
AQUAEXTENSIONS = $(OTHEREXTS) $(RANDRLIB) $(RENDERLIB)
d1327 6
a1332 2
QUARTZDIR = $(DARWINDDXDIR)/quartz
QUARTZLIB = $(QUARTZDIR)/LibraryTargetName(XQuartz)
d1335 1
a1335 5
ROOTLESSLIB = $(ROOTLESSDIR)/LibraryTargetName(rootless) \
              $(ROOTLESSDIR)/safeAlpha/LibraryTargetName(safeAlpha) \
              $(ROOTLESSDIR)/accel/LibraryTargetName(rlAccel)
XPLUGINLIB = XpluginLibrary

d1341 2
d1348 2
a1349 2
	$(DARWINLIBS) $(QUARTZLIB) $(QUARTZEXTLIBS), \
	$(DARWINSYSLIBS) $(QUARTZSYSLIBS) -u _miDCInitialize)
d1359 1
a1359 2
 * Display mode bundles for Quartz
 * (installed in their own bundles inside XDarwin's)
d1361 13
a1373 39
#if HasXplugin
XPRDIRS = $(QUARTZDIR)/xpr $(ROOTLESSDIR) $(ROOTLESSDIR)/safeAlpha
XPRLIBS = $(QUARTZDIR)/xpr/LibraryTargetName(xpr) $(ROOTLESSLIB)

BundleProgramTarget(xpr,XDarwinApp,$(XPRDIRS),$(QUARTZDIR)/xpr/xprScreen.o, \
	$(XPRLIBS),-framework ApplicationServices \
	$(XPLUGINLIB),$(XDARWINAPPDIR)/Resources)
#endif

CRDIRS = $(QUARTZDIR)/cr $(ROOTLESSDIR) $(ROOTLESSDIR)/safeAlpha
CRLIBS = $(QUARTZDIR)/cr/LibraryTargetName(cr) $(ROOTLESSLIB)

BundleProgramTarget(cr,XDarwinApp,$(CRDIRS),$(QUARTZDIR)/cr/crScreen.o, \
	$(CRLIBS),-framework ApplicationServices -framework Cocoa \
	-framework Carbon -ObjC,$(XDARWINAPPDIR)/Resources)

FSDIRS = $(QUARTZDIR)/fullscreen $(SHADOWDIR)
FSLIBS = $(QUARTZDIR)/fullscreen/LibraryTargetName(fullscreen) $(SHADOW)

BundleProgramTarget(fullscreen,XDarwinApp,$(FSDIRS), \
	$(QUARTZDIR)/fullscreen/fullscreen.o,$(FSLIBS), \
	-framework ApplicationServices,$(XDARWINAPPDIR)/Resources)

/*
 * GLX bundles for Quartz
 * (installed in their own bundles inside XDarwin's)
 */
BundleProgramTarget(glxAGL,XDarwinApp,GL,GL/glx/glxext.o,GL/glx/libglx.a \
	GL/apple/libAGLcore.a, \
	-framework AGL -framework OpenGL,$(XDARWINAPPDIR)/Resources)

#if BuildAppleDRI
BundleProgramTarget(glxCGL,XDarwinApp,GL,GL/glx/glxext.o,GL/glx/libglx.a \
	GL/apple/libCGLcore.a, \
	-framework OpenGL $(XPLUGINLIB),$(XDARWINAPPDIR)/Resources)
#endif

BundleProgramTarget(glxMesa,XDarwinApp,GL,GL/glx/glxext.o,GL/glx/libglx.a \
	GL/mesa/GLcore/libGLcore.a,NullParameter,$(XDARWINAPPDIR)/Resources)
d1384 2
a1385 2
CFBSUBDIRS = $(CFB8SUBDIR) $(CFB16SUBDIR) $(CFB24SUBDIR) $(CFB32SUBDIR)
MIEXTDIRS = $(SHADOWDIR) $(LAYERDIR) $(ROOTLESSDIR)
d1390 2
a1391 3
SUBDIRS = $(STDDIRS) $(MFBSUBDIR) $(CFBSUBDIRS) \
	  $(IPLANDIRS) $(ILBMDIR) $(AFBSUBDIR) \
          $(LMFCFBDIR) $(DDXDIRS) $(FBSUBDIR) $(KDRIVEDIRS) $(MIEXTDIRS) \
a1405 3

DEFAULTFONTPATH = DefaultFontPath
EXTRAMANDEFS = -D__default_font_path__="`echo $(DEFAULTFONTPATH) | sed -e 's/,/, /g'`"
@


1.1.1.4
log
@sync with openbsd, for bugfixes and build optimisation
@
text
@d243 1
a243 1
#if !HasLibUsbHid
@


