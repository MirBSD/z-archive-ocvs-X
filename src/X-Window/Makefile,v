head	1.34;
access;
symbols
	tg-mergetmp-2:1.33
	cvs-200410241530:1.1.1.8
	cvs-200410012000:1.1.1.8
	cvs-200407141120:1.1.1.8
	cvs-200406231010:1.1.1.8
	MIRBSD_7quater:1.11
	cvs-200405271510:1.1.1.8
	cvs-200403021700:1.1.1.7
	cvs-200401291925:1.1.1.6
	MIRBSD_7_ALPHA:1.11.0.4
	MIRBSD_7:1.11.0.2
	MIRBSD_7ter:1.11
	cvs-20011091815:1.1.1.5
	cvs-200309162130:1.1.1.5
	cvs-200308302005:1.1.1.5
	ctmx-0387:1.1.1.4
	ctmx-0384:1.1.1.4
	MIRBSD_5:1.4
	ctmx-0375:1.1.1.3
	ctmx-0373:1.1.1.3
	ctm-0371:1.1.1.3
	ctm-0370:1.1.1.3
	MIRBSD_4:1.1.1.3
	ctm-0363:1.1.1.3
	ctm-0359:1.1.1.2
	ctm-0349:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.34
date	2004.12.25.16.26.40;	author tg;	state Exp;
branches;
next	1.33;

1.33
date	2004.11.30.07.13.51;	author tg;	state Exp;
branches;
next	1.32;

1.32
date	2004.11.21.12.35.40;	author tg;	state Exp;
branches;
next	1.31;

1.31
date	2004.11.15.16.23.16;	author tg;	state Exp;
branches;
next	1.30;

1.30
date	2004.11.13.21.10.56;	author tg;	state Exp;
branches;
next	1.29;

1.29
date	2004.08.22.16.07.16;	author tg;	state Stab;
branches;
next	1.28;

1.28
date	2004.08.13.15.46.28;	author tg;	state Exp;
branches;
next	1.27;

1.27
date	2004.08.13.04.52.47;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2004.06.25.12.48.54;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2004.05.27.18.32.20;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2004.03.08.03.15.54;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2004.03.07.18.01.39;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2004.03.02.20.10.34;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2004.03.02.10.42.57;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2004.01.31.02.17.16;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2004.01.20.19.31.20;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2004.01.20.19.22.15;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2004.01.19.16.23.35;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2004.01.11.18.59.14;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2004.01.05.06.41.43;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2004.01.05.01.22.07;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2004.01.04.20.04.20;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.11.30.18.49.00;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.11.20.12.05.52;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.16.10.53.58;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.15.21.00.16;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.08.31.20.54.00;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.07.24.17.09.11;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.07.19.13.11.17;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.29.20.50.55;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.07.13.27.12;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.18.12.14.07;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.16.15.55.06;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.19.59.27;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.19.59.27;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.08.18.17.15;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.04.13.15.11.21;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.06.29.19.02.14;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.08.30.21.16.23;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2004.01.29.20.53.31;	author tg;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2004.03.02.17.20.17;	author tg;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2004.05.27.15.59.18;	author tg;	state Exp;
branches;
next	;


desc
@@


1.34
log
@#7 had no MKC_USAP= in bsd.own.mk

found and asked for by bsiegert@@
@
text
@# $MirBSD: src/X-Window/Makefile,v 1.33 2004/11/30 07:13:51 tg Exp $
# $NetBSD: Makefile,v 1.3 1997/12/09 11:58:28 mrg Exp $
# $OpenBSD: Makefile,v 1.42 2004/03/30 00:21:45 millert Exp $
#
# The purpose of this file is to build and install X11,
# and create release tarfiles.
#
# To build a release, you can take two paths:
#   1. # mkdir -p dest rel && make b-r
#       .. you will see sparse output, this has been designed for low remote
#	   network bandwidth consumption
#   2. # env DESTDIR=/some/dest/dir RELEASEDIR=/some/release/dir
#      # mkdir -p ${DESTDIR} ${RELEASEDIR} && make build && make release
#
#  Option 2 is provided for similar functionality to /usr/src/Makefile and
#  /usr/src/etc/Makefile.  Option 1 is how the OpenBSD X releases are built.
#  It uses the 'build' and 'release' targets, so there is no inconsistency
#  between the two.
#
#  The official MirOS BSD X-Window releases are built by issuing the
#  "make b-r" command in $(BSDSRCDIR), not from this Makefile. Please avoid
#  invoking this Makefile directly if possible.

.include <bsd.own.mk>

.if ${MACHINE} == i386
XMACH=		ix86
.else
XMACH=		${MACHINE}
.endif
BINDIST=	programs/Xserver/hw/xfree86/etc/bindist
HOSTDEF=	xc/${BINDIST}/OpenBSD-${XMACH}/host.def
CONFHOSTDEF=	xc/config/cf/host.def
XCONFIG=	xc/${BINDIST}/OpenBSD-${XMACH}/XF86Config
MKC_USAP?=	no

LN?=		/bin/ln
CHOWN?=		/sbin/chown
CHMOD?=		/bin/chmod
ECHO?=		/bin/echo
RM?=		/bin/rm
DIROWN?=	root
DIRGRP?=	wheel

LOCALAPPD=	/usr/local/lib/X11/app-defaults
LOCALAPPX=	/usr/local/lib/X11
REALAPPD=	/etc/X11/app-defaults


all:	compile

obj:
	@@cd ${.CURDIR}; \
	here=$$(/bin/pwd); bsdsrcdir=$$(cd ${BSDSRCDIR}; /bin/pwd); \
	bsdobjdir=$$(cd ${BSDOBJDIR}; /bin/pwd); \
	subdir=$${here#$${bsdsrcdir}/}; \
	dest=$${bsdobjdir}/$$subdir; \
	echo "linking $$here -> $$dest"; \
	if test -d $${bsdobjdir} -a ! -d $$dest; then \
		mkdir -p $$dest; \
		( cd $$dest; lndir $$here ); \
	else \
		true; \
	fi;

compile:
	${RM} -f ${CONFHOSTDEF}
	${INSTALL} ${HOSTDEF} ${CONFHOSTDEF}
.if ${MKC_USAP:L} != "yes"
	echo '#define Freetype2BuildDefines	'\
		'-DTT_CONFIG_OPTION_BYTECODE_INTERPRETER' >>${CONFHOSTDEF}
.endif
.ifdef	NOFONTS
	echo "#define BuildFonts		NO" >>${CONFHOSTDEF}
.endif
	cd xc && exec ${MAKE} World \
	    WORLDOPTS="CC=${CC:Q} CXX=${CXX:Q} COPTS=${COPTS:Q}" \
	    CC="${CC}" CXX="${CXX}" COPTS="${COPTS}"
	cd extras && ${MAKE} obj && ${MAKE} depend && exec ${MAKE}

build:
	${MAKE} compile
	${SUDO} ${MAKE} install
	${SUDO} ${MAKE} fix-appd

release: release-clean release-mkdir release-install fix-appd dist

release-clean:
.if ! ( defined(DESTDIR) && defined(RELEASEDIR) )
	@@echo You must set DESTDIR and RELEASEDIR for a release.; exit 255
.endif
	${RM} -rf ${DESTDIR}/usr/X11R6/* ${DESTDIR}/usr/X11R6/.[a-zA-Z0-9]*
	${RM} -rf ${DESTDIR}/var/X11/*
	${RM} -rf ${DESTDIR}/etc/X11/*
	${RM} -rf ${DESTDIR}/etc/fonts/*
	@@if [ -d ${DESTDIR}/usr/X11R6 ] && [ "$$(cd ${DESTDIR}/usr/X11R6;ls)" ]; then \
		echo "Files found in ${DESTDIR}/usr/X11R6:"; \
		(cd ${DESTDIR}/usr/X11R6;/bin/pwd;ls -a); \
		echo "Cleanup before proceeding."; \
		exit 255; \
	fi

release-mkdir:
	@@${INSTALL} -d -o ${DIROWN} -g ${DIRGRP} -m ${DIRMODE} \
		${DESTDIR}/usr/X11R6 ${DESTDIR}/etc/X11 \
		${DESTDIR}/usr/local/lib/X11 \
		${DESTDIR}/usr/X11R6/man \
		${DESTDIR}/usr/X11R6/man/cat1
	@@${MAKE} perms

release-install:
	@@${MAKE} install
.if ${MACHINE} == macppc || ${MACHINE} == sparc
	@@if [ -f $(DESTDIR)/etc/X11/XF86Config ]; then \
		echo "Not overwriting existing $(DESTDIR)/etc/X11/XF86Config"; \
	  else \
		set -x; \
		${INSTALL} ${INSTALL_COPY} -o root -g wheel -m 644 \
		    ${XCONFIG} ${DESTDIR}/etc/X11 ; \
	fi
.endif
	@@${MAKE} fix-appd

PERMDIRS = / /usr /usr/X11R6 /etc /etc/X11 /usr/local /usr/local/lib
PERMDIRS+= /usr/local/lib/X11
perms:
.for _dir in ${PERMDIRS}
	${CHOWN} ${DIROWN}:${DIRGRP} ${DESTDIR}${_dir}/.
.endfor
	find ${DESTDIR}/usr/X11R6/. ${DESTDIR}/etc/. ${DESTDIR}/usr/local/. \
		-type d \
		\( \! -user ${DIROWN} -o \! -group ${DIRGRP} \) \
		-ls
	find ${DESTDIR}/usr/X11R6/. ${DESTDIR}/etc/. \
		-type f \
		\( \! -user ${BINOWN} -o \! -group wheel \) \
		-ls

dist:
	${MAKE} perms
	@@echo "============================================================"
	@@echo "Checking files:"
	@@echo ""
	cd ${BSDSRCDIR}/distrib/lists/x11 && MACHINE=${MACHINE} \
	    ${SHELL} ${BSDSRCDIR}/scripts/checkflist
	@@echo "============================================================"
.ifdef WAIT_CHECKFLIST
	@@read a?'Press Return to continue...'
.endif
	cd ${BSDSRCDIR}/distrib/lists/x11 && MACHINE=${MACHINE} \
	    ${SHELL} ${BSDSRCDIR}/scripts/maketars ${OSrev}

install: install-xc install-extra install-distrib
	/usr/libexec/makewhatis ${DESTDIR}/usr/X11R6/man
	chown root:wheel ${DESTDIR}/usr/X11R6/man/whatis.db

install-xc:
	cd xc; ${MAKE} install CC="${CC}" && ${MAKE} install.man
	cd xc/programs/rstart; ${MAKE} install && ${MAKE} install.man

install-extra:
	cd extras && exec ${MAKE} install

install-distrib:
	cd distrib/notes; ${MAKE} install

fix-appd:
	# Make sure /usr/local/lib/X11/app-defaults is a link
	if [ ! -L $(DESTDIR)${LOCALAPPD} ]; then \
	    if [ -d $(DESTDIR)${LOCALAPPD} ]; then \
		mv $(DESTDIR)${LOCALAPPD}/* $(DESTDIR)${REALAPPD} || true; \
		rmdir $(DESTDIR)${LOCALAPPD}; \
	    fi; \
	    mkdir -p ${DESTDIR}${LOCALAPPX}; \
	    ln -s ${REALAPPD} ${DESTDIR}${LOCALAPPD}; \
	fi

clean:
	cd xc; ${MAKE} clean

distclean:
	${MAKE} clean
	rm -f xc/xmakefile

b-r:
	@@echo ${SHELL} ${.CURDIR}/build-release
	@@exec ${SHELL} ${.CURDIR}/build-release

.PHONY: all build release dist install install-xc \
    install-distrib clean distclean fix-appd b-r \
    release-clean release-mkdir release-install install-extra
@


1.33
log
@provide ${CC} to 'make install' too.

Imakefile-generated Makefiles contain a line in the form
    CC = ${CC}
which is (obviously) recursive, but I see no clean way
to change this, since there is no "default C compiler"
in MirOS (any more), and we want X and X-Ports to
_always_ honour CC - this comes at the price to always
having to set it from the invoking Makefile (which must
in turn get it via <bsd.own.mk>), or manually (if the
imake-generated Makefile is invoked directly via the
command line).
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.32 2004/11/21 12:35:40 tg Exp $
d35 1
@


1.32
log
@don't abort if /usr/local/X11/app-defaults is empty
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.31 2004/11/15 16:23:16 tg Exp $
d157 1
a157 1
	cd xc; ${MAKE} install && ${MAKE} install.man
@


1.31
log
@should work now, I'm through with a full snapshot
fix #if/#elif syntax, cc -> ${CC}, /usr/sbin/chmod -> /sbin/chmod,
add libexpat to make includes, sync for now
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.30 2004/11/13 21:10:56 tg Exp $
d170 1
a170 1
		mv $(DESTDIR)${LOCALAPPD}/* $(DESTDIR)${REALAPPD}; \
@


1.30
log
@more mirppc, sparc, fixup
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.29 2004/08/22 16:07:16 tg Stab $
d37 1
a37 1
CHOWN?=		/usr/sbin/chown
@


1.29
log
@* sync after building base (with fixes)
* add acronyms
* sync acronyms to TNF
* use own xfree86 shlib versioning template
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.28 2004/08/13 15:46:28 tg Exp $
d112 1
a112 1
.if ${MACHINE} == macppc || ${MACHINE} == alpha || ${MACHINE} == sparc
@


1.28
log
@call checkflist before makeflist, optionally wait
remove a few superfluous targets (leftovers from MirOS #0 or #1 or so)
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.27 2004/08/13 04:52:47 tg Exp $
a24 1
NO_CXX?=	Yes
a67 5
.if ${NO_CXX:L} == "yes"
	echo '#define HasCplusplus		NO' >>${CONFHOSTDEF}
.else
	echo '#define HasCplusplus		YES' >>${CONFHOSTDEF}
.endif
a152 5
.if ${NO_CXX:L} == "yes"
	echo '#define HasCplusplus		NO' >>${DESTDIR}/usr/X11R6/lib/X11/config/host.def
.else
	echo '#define HasCplusplus		YES' >>${DESTDIR}/usr/X11R6/lib/X11/config/host.def
.endif
@


1.27
log
@no C++, Java(TM), Pascal, Objective C or Fortran 77 for a while
as discussed on the mailing list
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.26 2004/06/25 12:48:54 tg Exp $
a90 4
release-rel:
	mkdir -p rel
	${MAKE} RELEASEDIR=$$(pwd)/rel DESTDIR=$$(pwd)/dest release

a143 3
dist-rel:
	${MAKE} RELEASEDIR=$$(pwd)/rel DESTDIR=$$(pwd)/dest dist 2>&1 | tee distlog

d146 9
a156 2
	cd ${BSDSRCDIR}/distrib/lists/x11 && MACHINE=${MACHINE} \
	    ${SHELL} ${BSDSRCDIR}/scripts/checkflist
@


1.26
log
@fix the worst errors, and sync the distribution set lists
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.25 2004/05/27 18:32:20 tg Exp $
d25 1
@


1.25
log
@merge OpenBSD 3.5-current
@
text
@d1 1
a1 1
# $MirBSD: src/X-Window/Makefile,v 1.24 2004/03/08 03:15:54 tg Exp $
d153 1
a153 1
	    sh ${BSDSRCDIR}/scripts/maketars ${OSrev}
d155 1
a155 1
	    sh ${BSDSRCDIR}/scripts/checkflist
d195 2
a196 2
	@@echo sh ${.CURDIR}/build-release
	@@exec sh ${.CURDIR}/build-release
@


1.24
log
@preliminary efforts to clean up the tree
missing now:
 * libFOO_pic.a for all X11 libs
 * check if all X11 libs are built normal+pic+solib
 * pascal and pascal RTS in gcc
 * java in gcc (?)
 * small fixes (such as, check if ~/.etc/fonts is really in)
 * dist set sync
 * ensure quality
 * fix docs
 * go to .cgz for sets
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.23 2004/03/07 18:01:39 tg Exp $
d3 1
a3 1
# $OpenBSD: Makefile,v 1.41 2004/02/09 19:26:21 marc Exp $
@


1.23
log
@make MKC_USAP a global yes/NO toggle
no being the default, i.e. to build code which infringes
patents in the USA (has been like this since... long)
enable truetype bytecode hinting interpreter if not MKC_USAP
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.22 2004/03/02 20:10:34 tg Exp $
d81 2
a82 1
	    WORLDOPTS="CC=${CC:Q} CXX=${CXX:Q} COPTS=${COPTS:Q}"
@


1.22
log
@semi-automatic merge and whitespace adjustment of OpenBSD XF4 subtree
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.21 2004/03/02 10:42:57 tg Exp $
d73 6
a78 2
.ifdef NOFONTS
	echo "#define BuildFonts NO" >>${CONFHOSTDEF}
@


1.21
log
@no need to askdefine NO_CXX here any longer
this code won't be used on any older OS
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.20 2004/01/31 02:17:16 tg Exp $
d3 1
a3 1
# $OpenBSD: Makefile,v 1.40 2003/12/20 18:37:55 matthieu Exp $
d80 3
a82 3
build: 
	${MAKE} compile 
	${SUDO} ${MAKE} install 
d135 1
a135 1
		\! -user ${DIROWN} -o \! -group ${DIRGRP} \
d139 1
a139 1
		\! -user ${BINOWN} -o \! -group wheel \
@


1.20
log
@* this time, make b-r for real
* including X-Window
* merge evilwm import
* install all .cf etc. files, especially the MirBSD.cf one
* cope in X for MirOS changes
* refine anoncvssh: all defines in Makefile, etc.
* cope for XFree86 1.1 licence
* merge nlist.c import
* nuke unused files
* remove warnings
* fix really bogus bug in rcdb again
* offer bsd.slim for installation
* fix the default route bug
* sync distrib stuff
(...)

thanks for alpha-testing to
 * Jannis "Kabelaffe" Konrad
 * José António "T0ni" "jesus_" Matias de Jesus
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.19 2004/01/20 19:31:20 tg Exp $
a42 1
NO_CXX?=	no
@


1.19
log
@move release-generation scripts into new "src/scripts" directory,
which will be the home for maintainer scripte (such as pre-import
ones) as well.
adjust the Makefiles which refer to the scripts.
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.18 2004/01/20 19:22:15 tg Exp $
d3 1
a3 1
# $OpenBSD: Makefile,v 1.38 2003/08/18 21:32:24 matthieu Exp $
d27 1
a27 1
XMACH= ix86
d29 1
a29 1
XMACH= ${MACHINE}
d31 17
a47 17
BINDIST=programs/Xserver/hw/xfree86/etc/bindist
HOSTDEF=xc/${BINDIST}/OpenBSD-${XMACH}/host.def
CONFHOSTDEF=xc/config/cf/host.def
XCONFIG=xc/${BINDIST}/OpenBSD-${XMACH}/XF86Config

LN?= /bin/ln
CHOWN?=/usr/sbin/chown
CHMOD?=/bin/chmod
ECHO?=/bin/echo
RM?= /bin/rm
DIROWN?=root
DIRGRP?=wheel
NO_CXX?=no

LOCALAPPD=/usr/local/lib/X11/app-defaults
LOCALAPPX=/usr/local/lib/X11
REALAPPD=/etc/X11/app-defaults
d87 1
@


1.18
log
@* nuke duplicate code
* automatically md5 the X sets
* move distrib/sets/lists/* and X-Window/distrib/sets/lists/*
  into a common distrib/lists/* (subdir'd, though)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.17 2004/01/19 16:23:35 tg Exp $
d147 4
a150 5
	cd ${BSDSRCDIR}/distrib/lists/x11 && \
	    env MACHINE=${MACHINE} sh \
	      ${BSDSRCDIR}/distrib/sets/maketars ${OSrev} \
	    && env MACHINE=${MACHINE} sh \
	      ${BSDSRCDIR}/distrib/sets/checkflist
@


1.17
log
@NO_CXX defaults to "no", not "yes" for hysterical raisins
(and compatibility with #7 mk.conf)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.16 2004/01/11 18:59:14 tg Exp $
a27 2
.elif ${MACHINE} == hp700
XMACH= hppa
a44 2
MACHINE?=$$(uname -m)

d147 1
a147 1
	cd distrib/sets && \
@


1.16
log
@NO_CXX boolean change
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.15 2004/01/05 06:41:43 tg Exp $
d45 1
a45 1
NO_CXX?=yes
d73 1
a73 1
.if ${NO_CXX:L} != "no"
d158 1
a158 1
.if ${NO_CXX:L} != "no"
@


1.15
log
@damn thinko
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.14 2004/01/05 01:22:07 tg Exp $
d45 1
d73 1
a73 1
.ifdef NO_CXX
d158 1
a158 1
.ifdef NO_CXX
@


1.14
log
@rewrite and unify the distrib/sets tools, (c) to me
not tested yet, will do overnight
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.13 2004/01/04 20:04:20 tg Exp $
d151 4
a154 2
	    env MACHINE=${MACHINE} sh ${BSDSRCDIR}/distrib/maketars ${OSrev} \
	    && env MACHINE=${MACHINE} sh ${BSDSRCDIR}/distrib/checkflist
@


1.13
log
@make X-Window honour ${CC}, ${CXX} and ${COPTS}
more on request
@
text
@d1 3
a3 3
#	$MirBSD: Makefile,v 1.12 2003/11/30 18:49:00 tg Exp $
#	$NetBSD: Makefile,v 1.3 1997/12/09 11:58:28 mrg Exp $
#	$OpenBSD: Makefile,v 1.38 2003/08/18 21:32:24 matthieu Exp $
a36 5
.if defined(NOFONTS) || ${MACHINE} == "vax" || ${MACHINE} == "hppa"
DIST_LISTS=xbase xserv xshare
.else
DIST_LISTS=xbase xserv xshare xfont
.endif
d151 2
a152 3
		env MACHINE=${MACHINE} ksh ./maketars ${OSrev} ${OSREV} && \
		(env MACHINE=${MACHINE} lists_override="${DIST_LISTS}" \
		    ksh ./checkflist ${OSREV}; true)
@


1.12
log
@hm well
* build base/X with gcc 3.2.3
  -> surprise, the library majors shrink
  -> dont sync _that_
* nuke DRI (switch it off)
* hm. well. I think, except propolice I'm finished.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.11 2003/11/20 12:05:52 tg Exp $
d85 2
a86 1
	cd xc && exec ${MAKE} World WORLDOPTS=
@


1.11
log
@fix perms of man whatis database directly after it's build;
should solve certain variable conflicts
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.10 2003/11/16 10:53:58 tg Exp $
d37 5
d156 2
a157 1
		(env MACHINE=${MACHINE} ksh ./checkflist ${OSREV}; true)
@


1.10
log
@this is my idea of a fine i386 b-r of base and X-Window.
features correcting of permissions in X-Window, and
estimated set sizes (compressed/uncompressed) overall,
as well as a better (still bad) checkflist for X.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.9 2003/11/15 21:00:16 tg Exp $
a131 1
	chown root:wheel ${DESTDIR}/usr/X11R6/man/whatis.db
d160 1
@


1.9
log
@okay, that was it why XF86Config on sparc didn't get installed.
some wording / docu fixes while here
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.8 2003/08/31 20:54:00 tg Exp $
d132 1
@


1.8
log
@Merge import of OpenBSD source, ports and XF4 tree.

While here,
o clean up differences where possible
o whitespace cleanup
o ifdef ./. if defined()
o '...' ./. "..."
o echo foo > bar ./. echo foo >bar
o `...` ./. $(...) ./. $$(...)
o `...' ./. '...'
o modernize "our" tree, e.g. WWW in ports
o fix some typos and brainos introduced when renaming OpenBSD to MirBSD
o use hardware 80387 by default
o migrate Apache 1.3.28 OpenBSD ./. MirBSD ./. KAME
o work around as many CVS bugs as possible (add back/delete files, ...)

Synchronize stuff, ready for ongoing changes.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.7 2003/07/24 17:09:11 tg Exp $
d16 1
a16 1
#  /usr/src/etc/Makefile.  Option 1 is how the official X releases are built.
d20 3
d118 9
@


1.7
log
@rename NO_CXX_INSTALLED to NO_CXX and change semantics:
if NO_CXX_INSTALLED is defined, signal that no c++ compiler is installed
if NO_CXX is defined, additionally don't compile the in-tree g++
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.6 2003/07/19 13:11:17 tg Exp $
d3 1
a3 1
#	$OpenBSD: Makefile,v 1.35 2003/06/11 06:18:56 miod Exp $
d43 1
a43 1
MACHINE?=$((uname -m)
d69 1
a69 1
.if defined(NO_CXX)
d74 3
d86 1
a86 1
	${MAKE} RELEASEDIR=`pwd`/rel DESTDIR=`pwd`/dest release
d98 1
a98 1
	@@if [ -d ${DESTDIR}/usr/X11R6 ] && [ "`cd ${DESTDIR}/usr/X11R6;ls`" ]; then \
d127 1
a127 1
	find ${DESTDIR}/usr/X11R6/. \ ${DESTDIR}/etc/. \
d133 1
a133 1
	${MAKE} RELEASEDIR=`pwd`/rel DESTDIR=`pwd`/dest dist 2>&1 | tee distlog
d139 1
a139 1
		env MACHINE=${MACHINE} ksh ./checkflist ${OSREV}
d142 1
a142 1
.if defined(NO_CXX)
@


1.6
log
@move NO_CXX_INSTALLED logic out of Imakefile, which
does not include <bsd.own.mk>, to top-level BSD Makefile,
which patches host.def accordingly.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.5 2003/06/29 20:50:55 tg Exp $
d69 1
a69 1
.if defined(NO_CXX_INSTALLED)
d139 1
a139 1
.if defined(NO_CXX_INSTALLED)
@


1.5
log
@merge
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.4 2003/06/07 13:27:12 tg Exp $
d69 5
d139 5
@


1.4
log
@POSIX chown	user:group
instead of	user.group
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.3 2003/05/18 12:14:07 tg Exp $
d3 1
a3 1
#	$OpenBSD: Makefile,v 1.34 2003/04/12 16:32:03 todd Exp $
@


1.3
log
@implement 'make obj' for X-Window and document it
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.2 2003/05/16 15:55:06 tg Exp $
d113 1
a113 1
	${CHOWN} ${DIROWN}.${DIRGRP} ${DESTDIR}${_dir}/.
@


1.2
log
@get rid of XC-OLD (XFree86 3.3.6) finally.

This removes the dependancy on tcl/tk and cleans up the tree even more.
People with old cards should get themselfes new boxen for work, and
use the other ones for router, server, etc. - or Microsoft Windows
for Workgroups 3.11 with Starnet X-Win32 as an X terminal (works fine here).
@
text
@d1 1
a1 1
#	$MirBSD$
d21 2
d52 14
a170 2

.include <bsd.own.mk>
@


1.1
log
@Initial revision
@
text
@d1 1
d3 1
a3 1
#	$OpenBSD: Makefile,v 1.31 2003/01/04 11:58:35 matthieu Exp $
a30 2
HOSTDEFo=xc-old/${BINDIST}/OpenBSD-${XMACH}/host.def
CONFHOSTDEFo=xc-old/config/cf/host.def
a32 13
.if ${MACHINE} == i386 || ${MACHINE} == mac68k
NEED_XC_OLD?=yes
.else
NEED_XC_OLD?=no
.endif

.if ${MACHINE} == hp300
NEED_XC_MIT?=yes
XHP?=${.CURDIR}/xc-mit/server/XhpBSD
.else
NEED_XC_MIT?=no
.endif

d41 1
a41 1
MACHINE?=`uname -m`
a50 5
.if (${NEED_XC_MIT:L} == "yes")
	cd xc-mit && exec ${MAKE} -f Makefile.ini World \
		BOOTSTRAPCFLAGS="-Dhp300 -Dhp9000" \
		WORLDOPTS=
.endif
a53 4
.if (${NEED_XC_OLD:L} == "yes")
	${INSTALL} ${HOSTDEFo} ${CONFHOSTDEFo}
	cd xc-old && exec ${MAKE} World WORLDOPTS=
.endif
d73 1
a90 14
.if defined(MACHINE) && ${MACHINE} == hp300
	@@${INSTALL} ${INSTALL_STRIP} -m 755 -o ${DIROWN} -g ${DIRGRP} \
		${XHP} ${DESTDIR}/usr/X11R6/bin
	@@${LN} -s XhpBSD ${DESTDIR}/usr/X11R6/bin/X
	@@${ECHO} /dev/grf0 > ${DESTDIR}/usr/X11R6/lib/X11/X0screens
.endif
.if ${MACHINE} == macppc || ${MACHINE} == alpha || ${MACHINE} == sparc
	@@if [ -f $(DESTDIR)/etc/X11/XF86Config ]; then \
	 echo "Not overwriting existing" $(DESTDIR)/etc/X11/XF86Config; \
	else set -x; \
	 ${INSTALL} ${INSTALL_COPY} -o root -g wheel -m 644 \
		${XCONFIG} ${DESTDIR}/etc/X11 ; \
	fi
.endif
d113 3
a115 2
	cd distrib/sets && env MACHINE=${MACHINE} csh ./maketars ${OSrev} && \
		env MACHINE=${MACHINE} csh ./checkflist
d117 1
a117 1
install: install-xc install-xc-old install-extra install-distrib
a121 4
.if (${MACHINE} == "hp300")
	echo /dev/grf0 > ${DESTDIR}/usr/X11R6/lib/X11/X0screens
	${CHOWN} root.wheel ${DESTDIR}/usr/X11R6/lib/X11/X0screens
.endif
a126 5
install-xc-old:
.if (${NEED_XC_OLD:L} == "yes")
	cd xc-old; ${MAKE} install && ${MAKE} install.man
.endif

a142 3
.if (${NEED_XC_OLD:L} == "yes")
	cd xc-old; ${MAKE} clean
.endif
a146 3
.if (${NEED_XC_OLD:L} == "yes")
	rm -f xc-old/xmakefile
.endif
d152 1
a152 1
.PHONY: all build release dist install install-xc install-xc-old \
@


1.1.1.1
log
@Import OpenBSD 3.3 XF4 repository from CTM 3132 the first time
This finalizes starting an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@The X-Windowing System

Import XFree86 4.3 from OpenBSD by CTM, in the hope it's stable
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.33 2003/04/07 16:24:04 todd Exp $
a95 1
	${RM} -rf ${DESTDIR}/etc/fonts/*
d149 2
a150 5
	install -d -m 755 -o root -g wheel \
		${DESTDIR}/var ${DESTDIR}/var/db ${DESTDIR}/var/db/pkg
	cd distrib/sets && \
		env MACHINE=${MACHINE} ksh ./maketars ${OSrev} ${OSREV} && \
		env MACHINE=${MACHINE} ksh ./checkflist ${OSREV}
@


1.1.1.3
log
@Import OpenBSD tree again due to CVS bugs
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.34 2003/04/12 16:32:03 todd Exp $
d150 2
@


1.1.1.4
log
@Sync XFree86 with OpenBSD, too...
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.35 2003/06/11 06:18:56 miod Exp $
d134 1
a134 1
	${CHOWN} ${DIROWN}:${DIRGRP} ${DESTDIR}${_dir}/.
@


1.1.1.5
log
@Synchronize with OpenBSD 3.4-beta
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.38 2003/08/18 21:32:24 matthieu Exp $
a71 3
.ifdef NOFONTS
	@@echo "#define BuildFonts NO" >> ${CONFHOSTDEF}
.endif
d140 1
a140 1
	find ${DESTDIR}/usr/X11R6/. ${DESTDIR}/etc/. \
d152 1
a152 1
		(env MACHINE=${MACHINE} ksh ./checkflist ${OSREV}; true)
@


1.1.1.6
log
@A bunch of improvements and fixes from the one-man OpenBSD XF4/X11 team,
Matthieu Herrb :)
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.40 2003/12/20 18:37:55 matthieu Exp $
a87 1
	mkdir -p rel
d155 1
a155 1
		(env MACHINE=${MACHINE} ksh ./checkflist ${OSREV} || true)
@


1.1.1.7
log
@That's what OpenBSD will, probably, ship as XF4 in 3.5
their last sync against XFree86 4.3-current has been
imported into our vendor branch, too
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.41 2004/02/09 19:26:21 marc Exp $
d142 1
a142 1
		\( \! -user ${DIROWN} -o \! -group ${DIRGRP} \) \
d146 1
a146 1
		\( \! -user ${BINOWN} -o \! -group wheel \) \
@


1.1.1.8
log
@Import OpenBSD X-Window subsystem (based upon XFree86 4.4RC2)
into vendor branch
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.42 2004/03/30 00:21:45 millert Exp $
a121 5
	@@${INSTALL} -d -o ${DIROWN} -g ${DIRGRP} -m ${DIRMODE} \
		${DESTDIR}/usr/X11R6/man/man1
	@@${INSTALL} -o ${DIROWN} -g ${DIRGRP} -m 644 \
		${.CURDIR}/xc-mit/server/Xserver.man \
		${DESTDIR}/usr/X11R6/man/man1/Xserver.1
@


