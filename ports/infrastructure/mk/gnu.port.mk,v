head	1.55;
access;
symbols
	cvs-200406091925:1.1.1.5
	cvs-200406012030:1.1.1.4
	cvs-200405281530:1.1.1.4
	cvs-200403091710:1.1.1.3
	cvs-200402211630:1.1.1.2
	cvs-200401261625:1.1.1.2
	cvs-200401181215:1.1.1.2
	cvs-200401162142:1.1.1.2
	cvs-200301141450:1.1.1.2
	cvs-200312021610:1.1.1.2
	cvs-200311151930:1.1.1.2
	cvs-200310311830:1.1.1.2
	cvs-200310021000:1.1.1.2
	cvs-200309281111:1.1.1.2
	cvs-200309171515:1.1.1.2
	cvs-200308302005:1.1.1.2
	cvs-200308221505:1.1.1.2
	cvs-200308171200:1.1.1.2
	ctm-3449:1.1.1.1
	cvs-200307191610:1.1.1.1
	ctm-3416:1.1.1.1
	cvs-200307091500:1.1.1.1
	ctm-3389:1.1.1.1
	cvs-200307030815:1.1.1.1
	cvs-200306301400:1.1.1.1
	cvs-200306291800:1.1.1.1
	ctm-3369:1.1.1.1
	ctm-3341:1.1.1.1
	MIRBSD_5:1.1.1.1
	cvs-200306082100:1.1.1.1
	ctm-3316:1.1.1.1
	ctm-3272:1.1.1.1
	ctm-3264:1.1.1.1
	ctm-3258:1.1.1.1
	MIRBSD_4:1.1.1.1
	ctm-3200:1.1.1.1
	ctm-3188:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.55
date	2005.02.28.22.28.04;	author tg;	state Exp;
branches;
next	1.54;

1.54
date	2005.02.11.02.06.18;	author tg;	state Exp;
branches;
next	1.53;

1.53
date	2005.02.10.22.16.58;	author tg;	state Exp;
branches;
next	1.52;

1.52
date	2005.02.10.22.15.47;	author tg;	state Exp;
branches;
next	1.51;

1.51
date	2004.12.07.15.18.40;	author tg;	state Exp;
branches;
next	1.50;

1.50
date	2004.11.23.14.05.33;	author tg;	state Exp;
branches;
next	1.49;

1.49
date	2004.11.21.00.38.57;	author tg;	state Exp;
branches;
next	1.48;

1.48
date	2004.11.21.00.35.51;	author tg;	state Exp;
branches;
next	1.47;

1.47
date	2004.08.25.16.56.06;	author tg;	state Stab;
branches;
next	1.46;

1.46
date	2004.08.10.16.45.20;	author tg;	state Exp;
branches;
next	1.45;

1.45
date	2004.08.10.16.16.08;	author tg;	state Exp;
branches;
next	1.44;

1.44
date	2004.08.10.15.15.29;	author tg;	state Exp;
branches;
next	1.43;

1.43
date	2004.08.10.01.36.37;	author tg;	state Exp;
branches;
next	1.42;

1.42
date	2004.08.09.23.50.24;	author tg;	state Exp;
branches;
next	1.41;

1.41
date	2004.08.09.21.58.37;	author tg;	state Exp;
branches;
next	1.40;

1.40
date	2004.08.09.16.46.30;	author tg;	state Exp;
branches;
next	1.39;

1.39
date	2004.08.09.16.14.25;	author tg;	state Exp;
branches;
next	1.38;

1.38
date	2004.08.04.12.25.04;	author tg;	state Exp;
branches;
next	1.37;

1.37
date	2004.07.23.12.05.00;	author bsiegert;	state Exp;
branches;
next	1.36;

1.36
date	2004.06.15.15.55.46;	author tg;	state Exp;
branches;
next	1.35;

1.35
date	2004.06.09.19.39.24;	author tg;	state Exp;
branches;
next	1.34;

1.34
date	2004.06.01.21.41.06;	author tg;	state Exp;
branches;
next	1.33;

1.33
date	2004.05.23.21.34.24;	author tg;	state Exp;
branches;
next	1.32;

1.32
date	2004.05.20.21.39.55;	author tg;	state Exp;
branches;
next	1.31;

1.31
date	2004.05.08.12.42.44;	author tg;	state Exp;
branches;
next	1.30;

1.30
date	2004.04.23.19.21.01;	author tg;	state Exp;
branches;
next	1.29;

1.29
date	2004.04.23.18.51.29;	author tg;	state Exp;
branches;
next	1.28;

1.28
date	2004.04.19.18.18.59;	author tg;	state Exp;
branches;
next	1.27;

1.27
date	2004.04.10.00.09.14;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2004.03.13.23.43.28;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2004.03.13.23.12.07;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2004.03.13.11.48.12;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2004.03.11.18.12.08;	author bsiegert;	state Exp;
branches;
next	1.22;

1.22
date	2004.03.11.11.46.06;	author bsiegert;	state Exp;
branches;
next	1.21;

1.21
date	2004.03.09.20.36.28;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2004.03.09.18.14.15;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2004.03.06.00.55.42;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2004.03.06.00.43.50;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2004.03.01.21.39.17;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2004.02.23.16.21.25;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2004.02.21.21.09.43;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2004.02.19.18.01.40;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2004.02.19.17.50.08;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2004.02.18.11.53.30;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2004.02.15.13.47.28;	author bsiegert;	state Exp;
branches;
next	1.10;

1.10
date	2004.02.15.01.55.31;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2004.02.15.01.24.21;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2004.02.15.01.11.46;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2004.02.15.01.05.27;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2004.02.15.00.43.15;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2004.02.05.21.34.34;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2004.02.05.21.13.49;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2004.02.04.22.17.04;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.07.14.38.15;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.19.51.19;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.19.51.19;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.08.17.13.19.49;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2004.03.09.17.12.42;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2004.05.28.16.48.12;	author bsiegert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2004.06.09.19.27.06;	author tg;	state Exp;
branches;
next	;


desc
@@


1.55
log
@use /usr/bin/gm4 (GNU m4) on Macs
@
text
@# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.54 2005/02/11 02:06:18 tg Exp $
# $OpenBSD: gnu.port.mk,v 1.19 2004/06/06 11:49:08 espie Exp $
#-
# Largely improved support for GNU stuff, including automatic
# conversion to MirLibtool.

# Variables
AUTOCONF_NEW?=		No
.if ${AUTOCONF_NEW:L} == "yes"
AUTOCONF_VERSION?=	2.59
.else
AUTOCONF_VERSION?=	2.13
.endif
AUTOMAKE_VERSION?=	1.4

MODGNU_CONFIG_GUESS_DIRS?= ${WRKSRC}
AUTOGEN?=		${SHELL} ${PORTSDIR}/infrastructure/db/autogen.sh
MODGNU_COPIES?=		_gplwarn.c compile config-ml.in config.guess \
			config.libpath config.rpath config.sub depcomp \
			install-reloc install-sh m4salt.inc m4sugar.inc \
			mdate-sh missing mkinstalldirs move-if-change \
			reloc-ldflags ylwrap ${MODGNU_EXTRA_COPIES}

PATCH_CHECK_ONLY?=	No
MODGNU_configure=	${MODSIMPLE_configure}
REGRESS_TARGET?=	check
AUTOCONF?=		autoconf
AUTOUPDATE?=		autoupdate
AUTOHEADER?=		autoheader
# missing ?= not an oversight
AUTOCONF_ENV=		PATH=${PORTPATH} PORTSDIR=${PORTSDIR} \
			M4='${M4}' \
			AUTOCONF_VERSION=${AUTOCONF_VERSION} \
			AUTOMAKE_VERSION=${AUTOMAKE_VERSION}

MODGNU_AUTOMAKE_DEPS=	::devel/metaauto ::devel/automake/${AUTOMAKE_VERSION}
MODGNU_AUTOCONF_DEPS=	::devel/metaauto ::devel/autoconf/${AUTOCONF_VERSION}

# Dependencies
.if ${CONFIGURE_STYLE:L:Mautogen}
CONFIGURE_STYLE+=	automake no-autoheader
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPS}
.endif
.if ${CONFIGURE_STYLE:L:Mautoupdate}
CONFIGURE_STYLE+=	autoconf
.endif

.if ${CONFIGURE_STYLE:L:Mautomake}
BUILD_DEPENDS+=		${MODGNU_AUTOMAKE_DEPS}
.else
REORDER_DEPENDENCIES+=	${PORTSDIR}/infrastructure/mk/automake.dep
.endif

.if ${CONFIGURE_STYLE:L:Mautoconf}
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPS}
MAKE_ENV+=		AUTOCONF_VERSION=${AUTOCONF_VERSION}
.  if !${CONFIGURE_STYLE:L:Mno-autoheader}
CONFIGURE_STYLE+=	autoheader
.  endif
.endif

# needed stuff
.if ${CONFIGURE_STYLE:L:Mautoconf} || ${CONFIGURE_STYLE:L:Mautogen}
MODGNU_MIRLIBTOOL?=	Yes
.endif
MODGNU_MIRLIBTOOL?=	No

.if ${CONFIGURE_STYLE:L:Mgnu}
.  if ${CONFIGURE_STYLE:L:Mdest}
CONFIGURE_ARGS+=	--prefix='$${${DESTDIRNAME}}${PREFIX}'
.  else
CONFIGURE_ARGS+=	--prefix='${PREFIX}'
.  endif
.  if empty(CONFIGURE_STYLE:L:Mold)
.    if ${CONFIGURE_STYLE:L:Mdest}
CONFIGURE_ARGS+=	--sysconfdir='$${${DESTDIRNAME}}${SYSCONFDIR}'
.    else
CONFIGURE_ARGS+=	--sysconfdir='${SYSCONFDIR}'
.    endif
.  endif
.endif

# Files
.if ${MODGNU_MIRLIBTOOL:L} == "yes"
MODGNU_COPIES+=		libtool.m4 ltmain.sh
.endif
MODGNU_NUKES=		${MODGNU_COPIES} libtool ltconfig

# post-patch per-directory loop

# 1. copy over MirGNUTOOLS into target directories, no matter what
_MODGNU_loop=	rm -f ${MODGNU_NUKES}; ( cd ${PORTSDIR}/infrastructure/db/; \
		install -c -m 555 ${MODGNU_COPIES} $$d/ ); F=configure.ac; \
		test -e $$F || F=configure.in; test -e $$F && ACAUX=$$(grep \
		^AC_CONFIG_AUX_DIR\( $$F | sed -e 's/AC_CONFIG_AUX_DIR(\[*//' \
		-e 's/\]*).*$$//'); test -z "$$ACAUX" && ACAUX=.; if [ . != \
		"$$ACAUX" ]; then ( cd $$ACAUX && rm -f ${MODGNU_NUKES} ); \
		install -c -m 555 ${MODGNU_COPIES} $$ACAUX/; fi; export ACAUX;

# 2. update Libtool to MirLibtool
.if ${MODGNU_MIRLIBTOOL:L} != "no"
_MODGNU_loop+=	print "Updating to MirLibtool in $$d"; \
		touch $$F; L=aclocal.m4; test -s $$L || L=$$ACAUX/$$L; touch \
		$$L; for LP in $${L}${PATCHORIG} $$L; do test -e $$LP || \
		continue; print "/^\\\# serial [0-9]* AC_PROG_LIBTOOL/ka\n" \
		"'a,\$$g/^ifelse(\\[AC_DISABLE_FAST_INSTALL])/kb\n" \
		"'b,\$$g/^AC_MSG_RESULT(\\[\$$SED])/+1kb\n'a,'bd\nwq" \
		| ed -s $$LP 2>/dev/null || true; print "0a\n" \
		"builtin([include], [libtool.m4])\n.\nwq" | ed -s $$LP; done;
.endif

# 3. run the various GNU tools
.if ${CONFIGURE_STYLE:L:Mautoupdate}
_MODGNU_loop+=	echo "Running autoupdate-${AUTOCONF_VERSION} in $$d"; \
		${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
.endif
.if ${CONFIGURE_STYLE:L:Mautoconf}
_MODGNU_loop+=	echo "Running autoconf-${AUTOCONF_VERSION} in $$d"; \
		${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
.endif
.if ${CONFIGURE_STYLE:L:Mautoheader}
_MODGNU_loop+=	echo "Running autoheader-${AUTOCONF_VERSION} in $$d"; \
		${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOHEADER};
.endif

# finally: everything run after patch
.if ${PATCH_CHECK_ONLY:L} != "yes"
MODGNU_post-patch+=	for d in ${MODGNU_CONFIG_GUESS_DIRS}; do \
				( cd $$d; ${_MODGNU_loop} ); done;

# autogen is an exception, it is run only once in the toplevel directory.
# If you need more, use a custom autogen.sh script.
.if ${CONFIGURE_STYLE:L:Mautogen}
MODGNU_post-patch+=	echo "Running autotools regeneration script in ${WRKSRC}"; \
			cd ${WRKSRC}; \
			${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOGEN};
.endif

.endif
@


1.54
log
@update to MirLibtool 1.5.12

breakage not expected, but there be bugs
please test and feed back as much as possible
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.53 2005/02/10 22:16:58 tg Exp $
d32 1
@


1.53
log
@change: autogen ports don't get libtoolize installed automatically any more
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.52 2005/02/10 22:15:47 tg Exp $
d20 1
a20 1
			install-reloc install-sh m4salt.m4 m4sugar.m4 \
@


1.52
log
@documentary update, and nuke the licence boilerplates
I still consider the MirPorts to be licenced under the
same terms and with the same authors as MirOS base, but
it's such a conglomerate...
@
text
@d1 1
a1 1
# $MirBSD: src/share/misc/licence.template,v 1.20 2004/12/03 16:18:37 tg Rel $
a126 4
.  if ${CONFIGURE_STYLE:L:Mautogen}
MODGNU_post-patch+=	\
	install -m 555 ${PORTSDIR}/infrastructure/db/libtoolize ${WRKDIR}/bin/;
.  endif
@


1.51
log
@copy _gplwarn.c too
@
text
@d2 1
d4 2
a5 22
# Copyright (c) 2002, 2003, 2004
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
#
# Licensee is hereby permitted to deal in this work without restric-
# tion, including unlimited rights to use, publicly perform, modify,
# merge, distribute, sell, give away or sublicence, provided all co-
# pyright notices above, these terms and the disclaimer are retained
# in all redistributions or reproduced in accompanying documentation
# or other materials provided with binary redistributions.
#
# Licensor hereby provides this work "AS IS" and WITHOUT WARRANTY of
# any kind, expressed or implied, to the maximum extent permitted by
# applicable law, but with the warranty of being written without ma-
# licious intent or gross negligence; in no event shall licensor, an
# author or contributor be held liable for any damage, direct, indi-
# rect or other, however caused, arising in any way out of the usage
# of this work, even if advised of the possibility of such damage.
#-
# This module for the MirPorts Framework was originally based upon
# $OpenBSD: gnu.port.mk,v 1.19 2004/06/06 11:49:08 espie Exp $
# from the OpenBSD ports tree, but has been greatly improved and
# modified since.
@


1.50
log
@full sync
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.49 2004/11/21 00:38:57 tg Exp $
d7 5
a11 5
# tion, including unlimited rights to use, publically perform, modi-
# fy, merge, distribute, sell, give away or sublicence, provided the
# above copyright notices, these terms and the disclaimer are retai-
# ned in all redistributions, or reproduced in accompanying documen-
# tation or other materials provided with binary redistributions.
d19 1
a19 1
# of covered work, even if advised of the possibility of such damage.
d37 5
a41 5
MODGNU_COPIES?=		compile config-ml.in config.guess config.libpath \
			config.rpath config.sub depcomp install-reloc \
			install-sh m4salt.m4 m4sugar.m4 mdate-sh missing \
			mkinstalldirs move-if-change reloc-ldflags ylwrap \
			${MODGNU_EXTRA_COPIES}
@


1.49
log
@oops, add AUTOMAKE_VERSION to environment too
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.48 2004/11/21 00:35:51 tg Exp $
d37 1
a37 1
MODGNU_COPIES?=		config-ml.in config.guess config.libpath \
@


1.48
log
@metatoolify automake, defaulting to 1.4
there's not really a reason for a port to switch to 1.x
right now, since they all work, but I need 1.9 for my
work with ncvs in base now
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.47 2004/08/25 16:56:06 tg Stab $
d50 3
a52 2
AUTOCONF_ENV=		PATH=${PORTPATH} AUTOCONF_VERSION=${AUTOCONF_VERSION} \
			PORTSDIR=${PORTSDIR}
@


1.47
log
@only search for AC_CONFIG_AUX_DIR at the beginning of the line
(maybe a better solution would be to strip off the dnl, but this
 is not only stylistically better)
update description
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.46 2004/08/10 16:45:20 tg Exp $
d33 1
d53 1
a53 1
MODGNU_AUTOMAKE_DEPS=	::devel/automake
@


1.46
log
@MODGNU_CONFIG_GUESS_DIRS, not MODGNU_TWIDDLE_DIRS

here too
*slaps himself*
@
text
@d1 21
a21 2
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.45 2004/08/10 16:16:08 tg Exp $
# This module tries to restructure the old, more-than-grown one.
d23 2
d110 2
a111 2
		test -e $$F || F=configure.in; test -e $$F && ACAUX=$$(fgrep \
		AC_CONFIG_AUX_DIR\( $$F | sed -e 's/AC_CONFIG_AUX_DIR(\[*//' \
@


1.45
log
@I was just sick of having to hand-edit aclocal.m4-patchfiles
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.44 2004/08/10 15:15:29 tg Exp $
d13 1
a13 1
MODGNU_TWIDDLE_DIRS?=	${WRKSRC}
d127 1
a127 1
MODGNU_post-patch+=	for d in ${MODGNU_TWIDDLE_DIRS}; do \
@


1.44
log
@* some ports (libltdl *cough*) have AC_AUX_DIR([.]), cope
* optics
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.43 2004/08/10 01:36:37 tg Exp $
d99 2
a100 1
		$$L; print "/^\\\# serial [0-9]* AC_PROG_LIBTOOL/ka\n" \
d102 3
a104 2
		"'b,\$$g/^AC_MSG_RESULT(\\[\$$SED])/+1kb\n'a,'bd\nwq" | ed -s \
		$$L 2>/dev/null || true; print "0r libtool.m4\nwq" | ed -s $$L;
@


1.43
log
@Update to most recent MirLibtool based upon GNU Libtool 1.5.8;
this means mirlibtool-old dies.

XXX untested, yes I know stuff might break
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.42 2004/08/09 23:50:24 tg Exp $
d91 3
a93 3
		-e 's/\]*).*$$//'); if test -z "$$ACAUX"; then ACAUX=.; else \
		( cd $$ACAUX && rm -f ${MODGNU_NUKES} ); install -c -m 555 \
		${MODGNU_COPIES} $$ACAUX/; fi; export ACAUX;
d97 1
a97 1
_MODGNU_loop+=	print "Updating to MirLibtool-${MODGNU_MIRLIBTOOL:L} in $$d"; \
@


1.42
log
@fix issues arising with AC_AUX (subdir in which autotools are moved),
mirlibtool-new, renaming, copying and deleting files, and ./libtool
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.41 2004/08/09 21:58:37 tg Exp $
d28 2
a29 1
AUTOCONF_ENV=		PATH=${PORTPATH} AUTOCONF_VERSION=${AUTOCONF_VERSION}
d59 1
a59 1
MODGNU_MIRLIBTOOL?=	new
d79 1
a79 1
.if ${MODGNU_MIRLIBTOOL:L} == "old"
a81 6
.if ${MODGNU_MIRLIBTOOL:L} == "new"
MODGNU_COPIES+=		1_5-libtool.m4 1_5-ltmain.sh
.  if ${NO_CXX:L} == "yes"
IGNORE+=		"cannot work: Libtool 1.5 requires a C++ compiler"
.  endif
.endif
a95 6
.if ${MODGNU_MIRLIBTOOL:L} == "new"
_MODGNU_loop+=	rm -f libtool.m4 ltmain.sh; mv 1_5-libtool.m4 libtool.m4; \
		mv 1_5-ltmain.sh ltmain.sh; if [ $$ACAUX != . ]; then ( cd \
		$$ACAUX; rm -f libtool.m4 ltmain.sh; mv 1_5-libtool.m4 \
		libtool.m4; mv 1_5-ltmain.sh ltmain.sh ); fi;
.endif
a121 3
.    if ${PORTSDIR} != "/usr/ports"
BROKEN=			libtoolize hardcodes /usr/ports, off for now
.    else
a123 1
.    endif
@


1.41
log
@* pull libtoolize independent on mirlibtool version
* if PORTSDIR != /usr/ports, mark as broken if using libtoolize
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.40 2004/08/09 16:46:30 tg Exp $
d87 1
d92 1
a92 1
_MODGNU_loop=	rm -f ${MODGNU_COPIES}; ( cd ${PORTSDIR}/infrastructure/db/; \
d96 3
a98 4
		-e 's/\]*).*$$//'); if test -z "$$ACAUX"; then ACAUX=.; rm \
		-f ltconfig; else ( cd $$ACAUX && rm -f ${MODGNU_COPIES} \
		ltconfig ); ( cd ${PORTSDIR}/infrastructure/db/; install -c \
		-m 555 ${MODGNU_COPIES} $$d/$$ACAUX/ ); fi; export ACAUX;
d102 4
a105 2
_MODGNU_loop+=	rm -f libtool.m4 ltmain.sh; mv 1_5-libtool.m4 \
		libtool.m4; mv 1_5-ltmain.sh ltmain.sh;
@


1.40
log
@default to MirLibtool-new

XXX _everyone_, please test and report
XXX having to add no-autoheader is _not_ a problem!

tested with devel/glib (2.13) and audio/lame (2.59)
XXX audio/lame still picks up nasm if it exists?!
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.39 2004/08/09 16:14:25 tg Exp $
d130 4
a133 1
.  if ${CONFIGURE_STYLE:L:Mautogen} && ${MODGNU_MIRLIBTOOL:L} == "old"
d136 1
@


1.39
log
@glib-1.2.10 _configures_ with mirlibtool-new, now let's test it
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.38 2004/08/04 12:25:04 tg Exp $
d58 1
a58 1
MODGNU_MIRLIBTOOL?=	old
@


1.38
log
@actualize MirLibtool and MirGNUtools
XXX _gplwarn.c isn't copied automatically; porters can do that
XXX if needed; MODGNU_EXTRA_COPIES is the preferred way to do it ;)
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.37 2004/07/23 12:05:00 bsiegert Exp $
d17 2
a18 2
			install-sh mdate-sh missing mkinstalldirs \
			move-if-change reloc-ldflags ylwrap \
@


1.37
log
@For CONFIGURE_STYLE=autogen, run autogen.sh only in the top-level source
directory, not in every one of the MODGNU_TWIDDLE_DIRS.

Rationale:
Some ports (*cough* teTeX-base *cough*) have more than one configure script
for which MirLibtool is needed, but the autoconf scripts have to be
recreated by a weird custom script that dives into the needed directories
itself. If your port really wants autogen.sh or something similar run in
several directories, provide your own AUTOGEN script.
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.36 2004/06/15 15:55:46 tg Exp $
d15 5
a19 2
MODGNU_COPIES?=		config.guess config.rpath config.sub depcomp \
			install-sh missing mkinstalldirs move-if-change
@


1.36
log
@who's afraid of Makefiles?
Not me.

Implement stuff for new, more portable, more flexible MirPorts
and os-dependant infrastructure; fix indenting, use \${SHELL},
have a baseline of sane defaults, etc.
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.35 2004/06/09 19:39:24 tg Exp $
a123 5
.if ${CONFIGURE_STYLE:L:Mautogen}
_MODGNU_loop+=	echo "Running autotools regeneration script in $$d"; \
		${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOGEN};
.endif

d133 9
@


1.35
log
@merge (heavy effort ;)
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.34 2004/06/01 21:41:06 tg Exp $
d14 1
a14 1
AUTOGEN?=		/bin/sh ${PORTSDIR}/infrastructure/db/autogen.sh
@


1.34
log
@* merge all the latest stuff from OpenBSD
* shovel some stuff into the right place
* update licence, pointers etc.
* update <sys.port.mk> with stuff which is already in our
  <sys.mk> but not in the <sys.mk> of ekkoBSD
  (maybe need more? who knows)
* style (lines <80 chars, the obnoxious 0x60 character,
  whitespace at end of line/file, etc.)
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.33 2004/05/23 21:34:24 tg Exp $
d3 1
a17 4
MODGNU_TOUCHES?=	/Makefile.am configure.files configure.in \
			configure.ac acinclude.m4 aclocal.m4 acconfig.h \
			stamp-h.in config.h.in /Makefile.in configure

d41 2
a128 7
# 4. touch the not-so-innocent files
_MODGNU_loop+=	for f in ${MODGNU_TOUCHES}; do case $$f in \
		  /*)	find . -name $${f\#/} | while read i; \
				do echo "Touching $$i"; touch $$i; done	;; \
		  *)	if test -e $$f; then \
				echo "Touching $$f"; touch $$f; fi	;; \
		esac; done; true;
@


1.33
log
@simplify (c) and move it to ports/README from all the single
files it was spread before
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.32 2004/05/20 21:39:55 tg Exp $
d35 1
a35 1
CONFIGURE_STYLE+=	automake
d49 3
@


1.32
log
@fucking libtool 1.5 needs a C++ compiler (and Fortran 77, d'oh)
and libtool-current is not compatible with 1.5, nor yet 1.6 fleshy enough
@
text
@d1 1
a1 20
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.31 2004/05/08 12:42:44 tg Exp $
#-
# Copyright (c) 2004
#	The MirPorts Team, MirOS Project
#	Thorsten "mirabile" Glaser <x86@@ePost.de>
#
# Subject to these terms, everybody who obtained a copy of this work
# is hereby permitted to deal in the work without restriction inclu-
# ding without limitation the rights to use, distribute, sell, modi-
# fy, publically perform, give away, merge or sublicence it provided
# this notice is kept and the authors and contributors are given due
# credit in derivates or accompanying documents.
#
# This work is provided by its developers (authors and contributors)
# "as is" and without any warranties whatsoever, express or implied,
# to the maximum extent permitted by applicable law; in no event may
# developers be held liable for damage caused, directly or indirect-
# ly, but not by a developer's malice intent, even if advised of the
# possibility of such damage.
#-
a2 1

@


1.31
log
@fixup so net/irc builds again:
- better check for AC_AUX_DIR
- cope with AC_AUX_DIR being the current dir

also, ltconfig gets removed correctly
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.30 2004/04/23 19:21:01 tg Exp $
d98 3
@


1.30
log
@unbreak ports with autoconf but without libtool
that wasn't an oversight, just slowness
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.29 2004/04/23 18:51:29 tg Exp $
d106 5
a110 4
		AC_CONFIG_AUX_DIR $$F | sed -e 's/AC_CONFIG_AUX_DIR(\[*//' -e \
		's/\]*).*$$//'); if test -z "$$ACAUX"; then ACAUX=.; else \
		( cd $$ACAUX && rm -f ${MODGNU_COPIES} ltconfig; ); install \
		-c -m 555 ${MODGNU_COPIES} $$ACAUX/; fi; export ACAUX;
@


1.29
log
@if LT_AC_PROG_SED is content of the libtool.m4-copy which was already
in aclocal.m4, delete it as well
this should fix dovecot and numerous others as well (I remember adding
a kludge (patch-aclocal_m4) somewhere)
@
text
@d1 1
a1 1
# $MirBSD: ports/infrastructure/mk/gnu.port.mk,v 1.28 2004/04/19 18:18:59 tg Exp $
d121 2
a122 2
		"'b,'b+150g/^AC_MSG_RESULT(\\[\$$SED])/+1kb\n'a,'bd\nwq" | ed \
		-s $$L 2>/dev/null; print "0r libtool.m4\nwq\n" | ed -s $$L;
@


1.28
log
@sync tools with contrib/gnu/
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.27 2004/04/10 00:09:14 tg Exp $
d108 2
a109 2
		( cd $$ACAUX && rm -f ${MODGNU_COPIES}; ); install -c -m 555 \
		${MODGNU_COPIES} $$ACAUX/; fi; export ACAUX;
d117 6
a122 6
_MODGNU_loop+=	echo "Updating to MirLibtool-${MODGNU_MIRLIBTOOL:L} in $$d"; \
		touch $$F; ( F=aclocal.m4; test -s $$F || F=$$ACAUX/$$F; \
		test -s $$F && { printf '%s%s\nwq\n' '/^\# serial [0-9]*' \
		' AC_PROG_LIBTOOL/,/^ifelse(\[AC_DISABLE_FAST_INSTALL])/d' \
		| ed -s $$F 2>/dev/null || true; }; touch $$F; printf \
		'0r libtool.m4\nwq\n' | ed -s $$F; rm -f ltconfig; true; );
@


1.27
log
@mirlibtool2-1.5 comes into MirPorts
tested to succeed with bochs
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.26 2004/03/13 23:43:28 tg Exp $
d14 6
a19 5
# This work is provided "as is" with no explicit or implicit warran-
# ties whatsoever to the maximum extent permitted by applicable law;
# in no event may an author or contributor be held liable for damage
# that is, directly or indirectly, caused by the work, even if advi-
# sed of the possibility of such damage.
d34 1
a34 1
MODGNU_COPIES?=		config.guess config.rpath config.sub \
@


1.26
log
@I don't think we want to omit the ?= for setting AUTOCONF_VERSION
depending on AUTOCONF_NEW

this way, ports always can override that (but ought not to)
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.25 2004/03/13 23:12:07 tg Exp $
d96 1
a96 1
IGNORE+=		fatal: MirLibtool-1.5 does not exist yet
d111 4
d116 2
a117 2
_MODGNU_loop+=	echo "Updating to MirLibtool in $$d"; touch $$F; ( \
		F=aclocal.m4; test -s $$F || F=$$ACAUX/$$F; export F; \
@


1.25
log
@MirLibtool is only installed when CONFIGURE_STYLE=autoconf, but the
other files (originally, only config.{guess,sub}) _do_ have to be
installed into the target autoconf auxiliary directory. If they do
not exist there, they are searched for in ../ and ../../ and (only
with 2.13 apparently) $GNUSYSTEM_AUX_DIR (IIRC not in ports).

This diff removes the brackets(?) around the directory name, how
many it may ever be, unconditionally. (tested)
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.24 2004/03/13 11:48:12 tg Exp $
d26 1
a26 1
AUTOCONF_VERSION=	2.59
@


1.24
log
@(first post-mortem commit on odem/kaput)
Handle the case when there is no aclocal.m4, ed(1) kept complaining.
Discovered first by bsiegert@@, then and fixed by myself
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.23 2004/03/11 18:12:08 bsiegert Exp $
d105 2
a106 2
		AC_CONFIG_AUX_DIR $$F | sed -e 's/AC_CONFIG_AUX_DIR(//' -e \
		's/).*$$//'); if test -z "$$ACAUX"; then ACAUX=.; else \
@


1.23
log
@autogen.sh in infrastructure/db is not executable by default because CVS
does not replicate permissions; append "sh" to call.
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.22 2004/03/11 11:46:06 bsiegert Exp $
d116 2
a117 2
		| ed -s $$F 2>/dev/null || true; }; printf '%s\nwq\n' \
		'0r libtool.m4' | ed -s $$F; rm -f ltconfig; true; );
@


1.22
log
@Repair autotools dependencies. The variables were renamed to
MODGNU_AUTO{CONF,MAKE}_DEPS, but the rest of the file still used the old
names.

Discovered while testing on #7ter.
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.21 2004/03/09 20:36:28 tg Exp $
d32 1
a32 1
AUTOGEN?=		${PORTSDIR}/infrastructure/db/autogen.sh
@


1.21
log
@fuckup
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.20 2004/03/09 18:14:15 tg Exp $
d49 3
d55 1
a55 1
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPENDS}
a60 3
MODGNU_AUTOMAKE_DEPS=	::devel/automake
MODGNU_AUTOCONF_DEPS=	::devel/metaauto ::devel/autoconf/${AUTOCONF_VERSION}

d62 1
a62 1
BUILD_DEPENDS+=		${MODGNU_AUTOMAKE_DEPENDS}
d66 1
a66 1
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPENDS}
@


1.20
log
@woohoo, my first after-birthday merge XDD
@
text
@d1 1
a1 1
# $MirBSD: licence.template,v 1.8 2003/12/17 14:35:00 tg Exp $
d31 1
a31 1
MODGNU_CONFIG_GUESS_DIRS?= ${WRKSRC}
d103 6
a108 1
		install -c -m 555 ${MODGNU_COPIES} $$d/ );
d112 6
a117 5
_MODGNU_loop+=	echo "Updating to MirLibtool in $$d; ignore errors"; \
		{ rm -f ltconfig; if test -s aclocal.m4; then \
		  printf '%s%s\nwq\n' '/^\# serial [0-9]* AC_PROG_LIBTOOL/' \
		  ',/^ifelse(\[AC_DISABLE_FAST_INST/d' | ed -s aclocal.m4; \
		  cat libtool.m4 >>aclocal.m4; touch configure.in; true; };
d143 2
a144 2
				echo "Touching $$i"; touch $$i; fi	;; \
		esac; done;
d152 1
a152 1
MODGNU_post-patch+=	for d in MODGNU_CONFIG_GUESS_DIRS; do \
@


1.19
log
@check configure.ac too
use cp -f instead of just cp
better syntax
-> fixes bison
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.18 2004/03/06 00:43:50 tg Exp $
d4 2
a5 1
#	The MirPorts Framework Team, MirOS Project
d20 1
a20 2
# $OpenBSD: gnu.port.mk,v 1.14 2003/07/28 17:17:05 sturm Exp $
# Based on bsd.port.mk, originally PD by Jordan K. Hubbard.
d22 2
d25 5
d31 17
a47 3
MODGNU_AUTOMAKE_DEPENDS=::devel/automake
MODGNU_AUTOCONF_DEPENDS=::devel/metaauto \
			::devel/autoconf/${AUTOCONF_VERSION}
d49 1
d52 1
a52 3
.endif
.if ${CONFIGURE_STYLE:L:Mautomake}
BUILD_DEPENDS+=		${MODGNU_AUTOMAKE_DEPENDS}
d58 5
a62 4
.if ${AUTOCONF_NEW:L} == "yes"
AUTOCONF_VERSION=	2.59
.else
AUTOCONF_VERSION?=	2.13
d64 1
a66 5
AUTOCONF?=		autoconf
AUTOUPDATE?=		autoupdate
AUTOHEADER?=		autoheader
# missing ?= not an oversight
AUTOCONF_ENV=		PATH=${PORTPATH} AUTOCONF_VERSION=${AUTOCONF_VERSION}
d70 3
a72 6
MODGNU_CONFIG_GUESS_DIRS?=${WRKSRC}
.if ${CONFIGURE_STYLE:L:Mautoupdate} || ${CONFIGURE_STYLE:L:Mautoconf} \
    || ${CONFIGURE_STYLE:L:Mautogen}
MODGNU_CONFIG_MIRLIBTOOL?=Yes
.else
MODGNU_CONFIG_MIRLIBTOOL?=No
d74 1
a74 19
MODGNU_CONFIG_AUTOGEN?=   ${PORTSDIR}/infrastructure/db/autogen.sh

MODGNU_files=	config.guess config.rpath config.sub \
		install-sh missing mkinstalldirs move-if-change
.if ${MODGNU_CONFIG_MIRLIBTOOL:L} != "no"
MODGNU_files+=	libtool.m4 ltmain.sh
.endif

.for _d in ${MODGNU_CONFIG_GUESS_DIRS}
MODGNU_post-patch+= for f in ${MODGNU_files}; do \
			rm -f ${_d}/$$f; install -c -m 555 \
			${PORTSDIR}/infrastructure/db/$$f ${_d}; \
		    done;
MODGNU_post-patch+= (cd ${_d}; F=configure.ac; test -e $$F || F=configure.in; \
			test -e $$F && D=$$(fgrep AC_CONFIG_AUX_DIR $$F \
			| sed -e 's/AC_CONFIG_AUX_DIR(//' -e 's/).*$$//'); \
			test -n "$$D" && cp -f ${MODGNU_files} $$D || true);
.endfor
MODGNU_configure=	${MODSIMPLE_configure}
a81 1

d91 48
a138 1
REGRESS_TARGET?=	check
d140 1
a140 1
PATCH_CHECK_ONLY?=	No
d142 3
a144 36
.  if ${MODGNU_CONFIG_MIRLIBTOOL:L} != "no"
.    for _d in ${MODGNU_CONFIG_GUESS_DIRS}
MODGNU_post-patch+= rm -f ${_d}/ltconfig || true;
MODGNU_post-patch+= { test -s ${_d}/aclocal.m4 && { printf \
			'%s%s\nwq\n' '/^\# serial [0-9]* AC_PROG_LIBTOOL/' \
			',/^ifelse(\[AC_DISABLE_FAST_INSTALL])/d' \
			 | ed -s ${_d}/aclocal.m4 || true; cat \
			${_d}/libtool.m4 >>${_d}/aclocal.m4 || true; \
			touch -c ${_d}/configure.in; }; true; };
.    endfor
.  endif
.  if ${CONFIGURE_STYLE:L:Mautoupdate}
.    for _d in ${MODGNU_CONFIG_GUESS_DIRS}
MODGNU_post-patch+= cd ${_d} && ${_SYSTRACE_CMD} \
			${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
.    endfor
.  endif
.  if ${CONFIGURE_STYLE:L:Mautoconf}
.    for _d in ${MODGNU_CONFIG_GUESS_DIRS}
MODGNU_post-patch+= cd ${_d} && ${_SYSTRACE_CMD} \
			${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
.    endfor
.  endif
.  if !${CONFIGURE_STYLE:L:Mautomake}
MODGNU_post-patch+= for f in autoheader {automake,aclocal}{,-1.{4,6}}; do \
			ln -s /usr/bin/false ${WRKDIR}/bin/$$f; done;
.  endif
.  if ${CONFIGURE_STYLE:L:Mautogen}
BUILD_DEPENDS+=     ${MODGNU_AUTOCONF_DEPENDS}
MODGNU_post-patch+= install -m 555 ${PORTSDIR}/infrastructure/db/libtoolize \
			${WRKDIR}/bin/;
.    for _d in ${MODGNU_CONFIG_GUESS_DIRS}
MODGNU_post-patch+= cd ${_d} && \
	${_SYSTRACE_CMD} ${SETENV} AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    PATH=${PORTPATH} /bin/sh ${MODGNU_CONFIG_AUTOGEN}
.    endfor
d146 2
@


1.18
log
@make <gnu.port.mk> grok AC_CONFIG_AUX_DIR; idea joint from me and bsiegert@@
enough to fix expat without ugly copying
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.17 2004/03/01 21:39:17 tg Exp $
d73 2
a74 1
MODGNU_post-patch+= (cd ${_d}; AUXDIR=$$(fgrep AC_CONFIG_AUX_DIR configure.in \
d76 1
a76 1
			[ -n "$$AUXDIR" ] && cp ${MODGNU_files} $$AUXDIR);
@


1.17
log
@sync
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.16 2004/02/23 16:21:25 tg Exp $
d73 3
@


1.16
log
@who would've thought you'd need this?
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.15 2004/02/21 21:09:43 tg Exp $
d62 2
a63 1
MODGNU_files=	config.guess config.rpath config.sub
@


1.15
log
@AUTOCONF_NEW := 2.59

objected by bsiegert@@ but I'll push this through and encourage
porters to use AUTOCONF_NEW=Yes/No instead of setting AUTOCONF_VERSION
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.14 2004/02/19 18:01:40 tg Exp $
d62 1
a62 1
MODGNU_files=	config.guess config.sub
@


1.14
log
@use new generic autogen.sh by default, idea ok'd by bsiegert@@
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.13 2004/02/19 17:50:08 tg Exp $
d39 1
a39 1
AUTOCONF_VERSION=	2.52
@


1.13
log
@* MirLibtoolify
* make these ports build
* add "generic" autogen.sh
* fix ${SHELL} not being replaced
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.12 2004/02/18 11:53:30 tg Exp $
a29 1
MODGNU_CONFIG_AUTOGEN?=	${WRKSRC}/autogen.sh
d60 1
@


1.12
log
@there are always ports trying to be clever

hint: if configure_style is automake, it's expected that Makefile.am
is patched, and not Makefile.in

if configure_style is not automake, the port ought to not have dependencies
on it, and automake cannot be called from the port (configure or Makefile.in),
thus changes must be patched into Makefile.in not Makefile.am to be accepted.

Now, some ports call automake-1.4 when they discover it exists and is working,
and automake isn't (since it's linked to /bin/false because configure_style
is not automake)

someone call the openbsd ppl about this, it might be an issue.
@
text
@d1 1
a1 1
# $MirBSD: licence.template,v 1.8 2003/12/17 14:35:00 tg Exp $
d129 1
a129 1
	    PATH=${PORTPATH} ${SHELL} ${MODGNU_CONFIG_AUTOGEN}
@


1.11
log
@Add ${WRKSRC}/autogen.sh as default location for autogen configure style.

agreed by tg@@
@
text
@d1 18
a18 1
# $MirBSD: gnu.port.mk,v 1.10 2004/02/15 01:55:31 tg Exp $
d20 1
a20 2
#	Based on bsd.port.mk, originally by Jordan K. Hubbard.
#	This file is in the public domain.
d119 2
a120 3
MODGNU_post-patch+= ln -s /usr/bin/false ${WRKDIR}/bin/autoheader;
MODGNU_post-patch+= ln -s /usr/bin/false ${WRKDIR}/bin/automake;
MODGNU_post-patch+= ln -s /usr/bin/false ${WRKDIR}/bin/aclocal;
@


1.10
log
@autogen needs autoconf
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.9 2004/02/15 01:24:21 tg Exp $
d14 1
@


1.9
log
@/me likes this GNU crap even more now
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.8 2004/02/15 01:11:46 tg Exp $
d107 1
@


1.8
log
@autogen is a more appropriate, and shorter, name
it's also more common between GNU folks
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.7 2004/02/15 01:05:27 tg Exp $
d45 5
a49 1
MODGNU_configure =
d51 4
a54 4
MODGNU_configure += cp -f ${PORTSDIR}/infrastructure/db/config.guess ${_d};
MODGNU_configure += chmod a+rx ${_d}/config.guess;
MODGNU_configure += cp -f ${PORTSDIR}/infrastructure/db/config.sub ${_d};
MODGNU_configure += chmod a+rx ${_d}/config.sub;
d56 1
a56 1
MODGNU_configure += ${MODSIMPLE_configure}
a79 3
MODGNU_post-patch+= cp -f ${PORTSDIR}/infrastructure/db/libtool.m4 ${_d};
MODGNU_post-patch+= cp -f ${PORTSDIR}/infrastructure/db/ltmain.sh ${_d};
MODGNU_post-patch+= chmod a+rx ${_d}/libtool.m4 ${_d}/ltmain.sh;
@


1.7
log
@this GNU stuff really is funny
but now, we've hidden some magic, _and_ got rid of a port USE_LIBTOOL
left: 16

builds
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.6 2004/02/15 00:43:15 tg Exp $
d12 1
a12 1
.if ${CONFIGURE_STYLE:L:Mautobootstrap}
d39 1
a39 1
    || ${CONFIGURE_STYLE:L:Mautobootstrap}
d105 1
a105 1
.  if ${CONFIGURE_STYLE:L:Mautobootstrap}
d111 1
a111 1
	    PATH=${PORTPATH} ${SHELL} ${MODGNU_CONFIG_BOOTSTRAP}
@


1.6
log
@shuffle the order of execution a bit to help modules
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.5 2004/02/05 21:34:34 tg Exp $
d12 3
d38 2
a39 1
.if ${CONFIGURE_STYLE:L:Mautoupdate} || ${CONFIGURE_STYLE:L:Mautoconf}
d80 1
a80 1
MODGNU_post-patch+= test -s ${_d}/aclocal.m4 && { printf \
d85 1
a85 1
			touch -c ${_d}/configure.in; };
d104 9
@


1.5
log
@another one
* nullify autoheader, too
* always autoconf the MODGNU_GUESS dirs,
  since they're almost the same
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.4 2004/02/05 21:13:49 tg Exp $
d19 1
a19 2
.if ${CONFIGURE_STYLE:L:Mautoconf}
.  if ${AUTOCONF_NEW:L} == "yes"
d21 1
a21 1
.  else
d23 2
a24 1
.  endif
@


1.4
log
@* solve the libtool problem. finally. (I hope so)
* nuke unused docs
@
text
@d1 1
a1 1
# $MirBSD: gnu.port.mk,v 1.3 2004/02/04 22:17:04 tg Exp $
a34 1
MODGNU_CONFIG_AUTOX_DIRS?=${WRKSRC}
d85 1
a85 1
.    for _d in ${MODGNU_CONFIG_AUTOX_DIRS}
d91 1
a91 1
.    for _d in ${MODGNU_CONFIG_AUTOX_DIRS}
d97 1
@


1.3
log
@A (so far successless) start for these copying MirLibtool into a port
@
text
@d1 1
a1 1
# $MirBSD$
a28 1
AUTOCONF_DIR?=${WRKSRC}
d30 2
a31 2
AUTOCONF_ENV=PATH=${PORTPATH} AUTOCONF_VERSION=${AUTOCONF_VERSION}
MAKE_ENV+=AUTOCONF_VERSION=${AUTOCONF_VERSION}
d35 2
d38 3
a47 6
.  if ${MODGNU_CONFIG_MIRLIBTOOL:L} != "no"
MODGNU_configure += cp -f ${PORTSDIR}/infrastructure/db/libtool.m4 ${_d};
MODGNU_configure += chmod a+rx ${_d}/libtool.m4;
MODGNU_configure += cp -f ${PORTSDIR}/infrastructure/db/ltmain.sh ${_d};
MODGNU_configure += chmod a+rx ${_d}/ltmain.sh;
.  endif
d71 14
d86 4
a89 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
d92 4
a95 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
@


1.2
log
@add systrace policy for ports builds
by Nikolay Sturm
@
text
@d1 2
a2 3
#-*- mode: Fundamental; tab-width: 4; -*-
# ex:ts=4 sw=4 filetype=make:
# $OpenBSD: gnu.port.mk,v 1.13 2003/02/27 19:27:00 espie Exp $
d6 1
a6 1
AUTOCONF_NEW?=	No
d8 3
a10 3
MODGNU_AUTOCONF_DEPENDS=	::devel/metaauto \
							::devel/autoconf/${AUTOCONF_VERSION}
MODGNU_AUTOMAKE_DEPENDS=	::devel/automake
d16 1
a16 1
CONFIGURE_STYLE+=autoconf
d21 1
a21 1
AUTOCONF_VERSION=2.52
d23 1
a23 1
AUTOCONF_VERSION?=2.13
d26 1
a26 1
AUTOCONF?=			autoconf
d36 1
d44 6
d74 1
a74 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${SYSTRACE_PROGRAM} ${SYSTRACE_FLAGS} ${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
d77 1
a77 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${SYSTRACE_PROGRAM} ${SYSTRACE_FLAGS} ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
a83 1

@


1.1
log
@Initial revision
@
text
@d68 1
a68 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
d71 1
a71 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
@


1.1.1.1
log
@Import OpenBSD 3.3 ports repository from CTM 3132 the first time
This continues opening an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import OpenBSD CVS repository (checked out) of roughly 12:00 UTC today,
retrieved from the canadian anoncvs server (due to CTM unavailability)
@
text
@d3 1
a3 1
# $OpenBSD: gnu.port.mk,v 1.14 2003/07/28 17:17:05 sturm Exp $
d68 1
a68 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
d71 1
a71 1
MODGNU_post-patch+= cd ${AUTOCONF_DIR} && ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
@


1.1.1.3
log
@OpenBSD Ports Tree infrastructure from now, before we are going to
fix all ports I'm going to "lock" the infrastructure ;)
@
text
@d3 1
a3 1
# $OpenBSD: gnu.port.mk,v 1.17 2004/03/03 01:17:39 brad Exp $
d7 2
d10 1
a10 1
				::devel/autoconf/${AUTOCONF_VERSION}
d21 5
a25 1
AUTOCONF_VERSION?=	2.13
a64 9
# Files to touch in order...
MODGNU_AUTOCONF_FILES?= /Makefile.am configure.files configure.in configure.ac \
	acinclude.m4 aclocal.m4 acconfig.h stamp-h.in \
	config.h.in /Makefile.in configure

# internal stuff to run on each directory.
MODGNU_post-patch= for d in ${AUTOCONF_DIR}; do cd $$d; ${_MODGNU_loop} done;
_MODGNU_loop=

d68 1
a68 2
_MODGNU_loop+= echo "Running autoupdate-${AUTOCONF_VERSION} in $$d";
_MODGNU_loop+= ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOUPDATE};
d71 1
a71 20
_MODGNU_loop+= echo "Running autoconf-${AUTOCONF_VERSION} in $$d";
_MODGNU_loop+= ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF};
.    if ${CONFIGURE_STYLE:L:Mautoheader}
_MODGNU_loop+= echo "Running autoheader-${AUTOCONF_VERSION} in $$d";
_MODGNU_loop+= ${_SYSTRACE_CMD} ${SETENV} ${AUTOCONF_ENV} ${AUTOHEADER};
.    endif
.    if !${CONFIGURE_STYLE:L:Mautomake}
_MODGNU_loop+= for f in ${MODGNU_AUTOCONF_FILES}; do \
		case $$f in \
		/*) \
			find . -name $${f\#/} -print| while read i; \
				do echo "Touching $$i"; touch $$i; done \
			;; \
		*) \
			if test -e $$f ; then \
				echo "Touching $$f"; touch $$f; \
			fi \
			;; \
		esac; done; 
.    endif
d73 3
d77 2
@


1.1.1.4
log
@Import OpenBSD ports tree checked out from anoncvs.ca.openbsd.org at
2004-05-28 15:30 UTC.

Lots of SECURITY fixes, at least:

 * databases/mysql: tmpfile issue
 * www/squid: acl bypass
 * games/xonix: privilege escalation
 * archivers/lha: buffer overflow
 * mail/exim: buffer overflows
 * net/rsync: path checking issue
 * net/icecast: buffer overflow
 * www/opera
@
text
@d3 1
a3 1
# $OpenBSD: gnu.port.mk,v 1.18 2004/05/05 11:17:22 espie Exp $
a27 3
.  if !${CONFIGURE_STYLE:L:Mno-autoheader}
CONFIGURE_STYLE+=autoheader
.  endif
@


1.1.1.5
log
@Bugfixes in the ports Infrastructure
@
text
@d3 1
a3 1
# $OpenBSD: gnu.port.mk,v 1.19 2004/06/06 11:49:08 espie Exp $
d62 5
d85 12
a96 1
REORDER_DEPENDENCIES+=${PORTSDIR}/infrastructure/mk/automake.dep
@


