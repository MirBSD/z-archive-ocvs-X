head	1.22;
access;
symbols
	cvs-200405281530:1.1.1.1
	cvs-200402211630:1.1.1.1
	cvs-200401261625:1.1.1.1
	cvs-200401162142:1.1.1.1
	cvs-200301141450:1.1.1.1
	cvs-200312021610:1.1.1.1
	cvs-200311151930:1.1.1.1
	cvs-200310311830:1.1.1.1
	cvs-200310021000:1.1.1.1
	cvs-200309281111:1.1.1.1
	cvs-200309171515:1.1.1.1
	cvs-200308302005:1.1.1.1
	cvs-200308171200:1.1.1.1
	ctm-3449:1.1.1.1
	cvs-200307191610:1.1.1.1
	ctm-3416:1.1.1.1
	cvs-200307091500:1.1.1.1
	ctm-3389:1.1.1.1
	cvs-200306291800:1.1.1.1
	ctm-3369:1.1.1.1
	ctm-3341:1.1.1.1
	MIRBSD_5:1.3
	cvs-200306082100:1.1.1.1
	ctm-3316:1.1.1.1
	ctm-3272:1.1.1.1
	ctm-3264:1.1.1.1
	ctm-3258:1.1.1.1
	MIRBSD_4:1.3
	ctm-3200:1.1.1.1
	ctm-3188:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.22
date	2004.08.23.18.19.27;	author tg;	state Stab;
branches;
next	1.21;

1.21
date	2004.08.19.08.05.43;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2004.08.19.08.02.17;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2004.08.19.07.58.08;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2004.08.12.22.33.42;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2004.08.12.21.52.34;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2004.07.29.13.37.48;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2004.05.18.12.25.00;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2004.05.16.20.24.34;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.12.05.15.33.36;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.09.01.17.46.58;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.09.01.17.21.23;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.09.01.17.18.13;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.08.18.19.43.17;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.08.18.19.28.08;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.08.18.19.01.25;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.07.14.19.45.36;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.07.14.19.15.34;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.07.06.11.27.09;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.03.24.18.32.25;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.15.23.41;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.19.53.01;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.19.53.01;	author tg;	state Exp;
branches;
next	;


desc
@@


1.22
log
@sirc patchlevel 10:
* add back ssfe(1) programme and manual page
* bring ssfe about to the level of base
* some unifying and fixing
infrastructure:
* add HAS_SSFE_BASE according to the other ones,
  but defaulting to no (not needing patch in mpsup/)
@
text
@$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.21 2004/08/19 08:05:43 tg Exp $
--- dsirc.orig	Tue Mar 10 12:55:29 1998
+++ dsirc	Mon Aug 23 18:15:22 2004
@@@@ -1,30 +1,40 @@@@
-#!/usr/local/bin/perl
-
-# dsirc: dumb-mode small irc client in perl
+#!/usr/bin/perl
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.21 2004/08/19 08:05:43 tg Exp $
+#-
+# dsircp: dumb-mode small irc client in perl
 # by orabidoo <roger.espel.llima@@pobox.com>
 #
 # Copyright (C) 1995-1997 Roger Espel Llima
+# Copyright (c) 2002-2003 Hubert Feyrer
+# Copyright (c) 2001-2004 Thorsten Glaser
 #
 # for a full-screen termcap interface, use this with ssfe
 #
-# use: dsirc [options] [nick [server[:port[:password]]]]
+# use: dsircp [options] [nick [server[:port[:password]]]]
 # options are:
 #	-p = specify port number
 #	-i = specify IRCNAME
+#	-u = specify username (quite useless as an option)
 #	-n = specify nickname (quite useless as an option)
 #	-s = specify server (quite useless as an option)
-#	-l = specify file to be loaded instead of ~/.sircrc.pl
-#	-L = specify file to be loaded instead of ~/.sircrc
+#	-l = specify file to be loaded instead of ~/.etc/sircrc.pl
+#	-L = specify file to be loaded instead of ~/.etc/sircrc
 #	-H = specify virtual host to bind to
-#	-q = don't load ~/.sircrc or ~/.sircrc.pl
+#	-q = don't load ~/.etc/sircrc or ~/.etc/sircrc.pl
 #	-Q = don't load system sircrc or sircrc.pl
 #	-R = run in restricted (secure) mode
 #	-r = raw mode (no control-char filtering)
-#	-8 = 8-bit mode
+#	-8 = 8-bit mode (enabled by default, use -7 to disable)
+#	-7 = 7-bit (ISO_646.irv:1991) mode
+#	-U = non-UTF-8 (Unicode) mode
+#	-C = set local charset to optarg
+#	-X = set local charset to UTF-8
 
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation. See the file LICENSE for more details.
+# The version of the GNU General Public License incorporated herein
+# shall be Version 2, June 1991.
 #
 # If you make improvements to sirc, please send me the modifications
 # (context diffs appreciated) and they might make it to the next release.
@@@@ -36,11 +46,11 @@@@
 
 $version='2.211';
 $date='10 Mar 1998';
-$add_ons='';
+$add_ons='+[mirabile-p10]';
 
-$libdir=$ENV{"SIRCLIB"} || ".";
-push(@@INC, $libdir, $ENV{"HOME"});
-@@loadpath=($ENV{"HOME"}."/.sirc", $libdir, ".");
+$libdir=$ENV{"SIRCLIB"} || "PREFIX.SED/share/sirc/";
+push(@@INC, $libdir, $ENV{"HOME"}."/.etc/sirc");
+@@loadpath=($ENV{"HOME"}."/.etc/sirc", $libdir, ".");
 
 $|=1;
 
@@@@ -52,6 +62,7 @@@@ even there! Have you even bothered to ru
 }
 
 if ($] >= 5 && (eval "use Socket;", $@@ eq '')) {
+  use Socket6;
 } elsif (-f "$libdir/sircsock.ph") {
   do "$libdir/sircsock.ph";
 } elsif (-f $ENV{'HOME'}."/sircsock.ph") {
@@@@ -62,39 +73,44 @@@@ Your perl installation is wrong somewher
 couldn't be found. Have you even bothered to run 'install'?\n";
     exit;
 }
+use Encode;
 
-&Getopts('n:s:p:u:i:l:L:H:rqQR78');
+&Getopts('n:s:p:u:i:l:L:H:rqQR78UC:X');
 
 %set=("LOGFILE", "", "LOG", "off", "PRINTUH", "none", "PRINTCHAN", "off",
- 	"LOCALHOST", "", "CTCP", "noflood", "SENDAHEAD", 4096,
+ 	"LOCALHOST", "", "CTCP", "no", "SENDAHEAD", 4096,
 	"USERINFO", "", "FINGER", "", "IRCNAME", "", "EIGHT_BIT", "on",
-	"LOADPATH", join(":", @@loadpath), "CTRL_T", "/next");
+	"LOADPATH", join(":", @@loadpath), "CTRL_T", "/next", "UTF", "on",
+	"CHARSET", "iso-8859-1");
 
 $raw_mode=$opt_r || (!-t STDOUT);
 $ansi=!$raw_mode && $ENV{"TERM"} =~ /^vt|^xterm|^ansi/i;
 $server=$opt_s || $ARGV[1] || $ENV{"SIRCSERVER"} || $ENV{"IRCSERVER"} ||
-                  "irc.primenet.com";
+		"irc.eu.freenode.net";
 $port0=$opt_p || $ENV{"SIRCPORT"} || $ENV{"IRCPORT"} || 6667;
 $username=$opt_u || $ENV{"SIRCUSER"} || $ENV{"IRCUSER"} || (getpwuid($<))[0] ||
                 $ENV{"USER"} || "blah";
-$set{"IRCNAME"}=$opt_i || $ENV{"SIRCNAME"} || $ENV{"IRCNAME"} || "sirc user";
+$set{"IRCNAME"}=$opt_i || $ENV{"SIRCNAME"} || $ENV{"IRCNAME"} || "/whois your father?";
 $nick=$opt_n || $ARGV[0] || $ENV{"SIRCNICK"} || $ENV{"IRCNICK"} || $username;
 $set{"FINGER"}=$ENV{"IRCFINGER"} || "keep your fingers to yourself";
-$set{"USERINFO"}=$ENV{"USERINFO"} || "yep, I'm a user";
+$set{"USERINFO"}=$ENV{"USERINFO"} || "yep, I'm a happy MirBSD user";
 ($server, $port, $pass)=split(/[\s:]+/, $server);
 $port || ($port=$port0);
 $server0=$server1=$server;
-$initfile=$opt_l || $ENV{"SIRCRCPL"} || $ENV{'HOME'}."/.sircrc.pl" 
+$initfile=$opt_l || $ENV{"SIRCRCPL"} || $ENV{'HOME'}."/.etc/sircrc.pl"
   if $opt_l || !$opt_q;
 $sysinit=$libdir."/sircrc.pl" if $libdir ne '.' && !$opt_Q;
-$rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV{'HOME'}."/.sircrc" 
+$rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV{'HOME'}."/.etc/sircrc"
   if $opt_L || !$opt_q;
 $sysrc=$libdir."/sircrc" if $libdir ne '.' && !$opt_Q;
 $set{"LOGFILE"}=$logfile=$ENV{'HOME'}."/sirc.log";
-$opt_8 || ($set{"EIGHT_BIT"}="off");
+$opt_7 && ($set{"EIGHT_BIT"}="off");
 $restrict=$opt_R;
 $set{"LOCALHOST"}=$opt_H || $ENV{"SIRCHOST"} || $ENV{"IRCHOST"} ||
 		$ENV{"LOCALHOST"} || "";
+$opt_U && ($set{"UTF"}="off");
+$opt_C && ($set{"CHARSET"}=$opt_C);
+$opt_X && ($set{"CHARSET"}="utf8");
 
 if ($set{"LOCALHOST"}) {
   $bindaddr=&resolve($set{"LOCALHOST"});
@@@@ -148,7 +164,16 @@@@ sub resolve {
   } elsif ($_[0] =~ /^(\d+)\.(\d+)\.(\d+)\.(\d+)$/) {
     return pack("c4", $1, $2, $3, $4);
   } else {
-    return (gethostbyname($_[0]))[4];
+      local $rc;
+
+      $rc = (gethostbyname2($_[0], AF_INET6))[4];
+
+      if ($rc) {
+	  $use_ipv6 = 1;
+	  return $rc;
+      } else {
+	  return (gethostbyname($_[0]))[4];
+      }
   }
 }
 
@@@@ -162,19 +187,31 @@@@ sub connect {
   local($fh, $host, $port)=@@_;
   local($adr, $otherend)=&resolve($host);
   &tell("*\cbE\cb* Hostname `$host' not found"), return 0 unless $adr;
-  $otherend=pack("S n a4 x8", &AF_INET, $port, $adr);
-  &print("*\cbE\cb* Out of file descriptors"), return 0
-    unless socket($fh, &PF_INET, &SOCK_STREAM, 0);
-  if ($set{"LOCALHOST"}) {
-    bind($fh, pack("S n a4 x8", &AF_INET, 0, $bindaddr)) ||
-      &tell("*\cbE\cb* Warning: can't bind to sirc host ".$set{'LOCALHOST'});
+  if ($use_ipv6) {
+      $otherend=pack_sockaddr_in6($port, $adr);
+      &print("*\cbE\cb* Out of file descriptors"), return 0
+	  unless socket($fh, &PF_INET6, &SOCK_STREAM, 0);
+  } else {
+      $otherend=pack_sockaddr_in($port, $adr);
+      &print("*\cbE\cb* Out of file descriptors"), return 0
+	  unless socket($fh, &PF_INET, &SOCK_STREAM, 0);
   }
+  if (! $use_ipv6) {
+      if ($set{"LOCALHOST"}) {
+	  bind($fh, pack("S n a4 x8", &AF_INET, 0, $bindaddr)) ||
+	      &tell("*\cbE\cb* Warning: can't bind to sirc host ".$set{'LOCALHOST'});
+      }
+  }
   $trysock=$fh;
   $SIG{'QUIT'}='sigquit';
   &print("*\cbE\cb* Can't connect to host: $!"), close $fh,
     $SIG{'QUIT'}='IGNORE', return 0 unless connect($fh, $otherend);
   $SIG{'QUIT'}='IGNORE';
-  $bindaddr=(unpack("S n a4", getsockname($fh)))[2] if !$bindaddr;
+  if ($use_ipv6) {
+      $bindaddr=(unpack_sockaddr_in6(getsockname($fh)))[2] if !$bindaddr;
+  } else {
+      $bindaddr=(unpack_sockaddr_in(getsockname($fh)))[2] if !$bindaddr;
+  }
   select($fh); $|=1; select(STDOUT);
   return 1;
 }
@@@@ -183,15 +220,26 @@@@ sub listen {
   $_[0]=&newfh;
   local($fh, $port)=@@_;
   local($thisend);
-  $bindaddr=pack("x4", 0) unless $bindaddr;
-  $thisend=pack("S n a4 x8", &AF_INET, $port+0, $bindaddr);
-  &tell("*\cbE\cb* Out of file descriptors"), return 0
-    unless socket($fh, &PF_INET, &SOCK_STREAM, 0);
+  if ($use_ipv6) {
+      $bindaddr=pack_sockaddr_in6(0, 0) unless $bindaddr;
+      $thisend=pack_sockaddr_in6($port+0, $bindaddr);
+      &tell("*\cbE\cb* Out of file descriptors"), return 0
+	  unless socket($fh, &PF_INET6, &SOCK_STREAM, 0);
+  } else {
+      $bindaddr=pack_sockaddr_in(0, 0) unless $bindaddr;
+      $thisend=pack_sockaddr_in($port+0, $bindaddr);
+      &tell("*\cbE\cb* Out of file descriptors"), return 0
+	  unless socket($fh, &PF_INET, &SOCK_STREAM, 0);
+  }
   &tell("*\cbE\cb* Can't bind local socket!"), close $fh, return 0
     unless bind($fh, $thisend);
   &tell("*\cbE\cb* Can't listen to socket!"), close $fh, return
     unless listen($fh, 5);
-  return (unpack("S n", getsockname($fh)))[1];
+  if ($use_ipv6) {
+      return (unpack_sockaddr_in6(getsockname($fh)))[1];
+  } else {
+      return (unpack_sockaddr_in(getsockname($fh)))[1];
+  }
 }
 
 sub accept {
@@@@ -200,7 +248,7 @@@@ sub accept {
 }
 
 sub bindtoserver {
-  @@channels=(); $talkchannel='';
+  @@channels=(); $talkchannel=''; $use_ipv6=0;
   %mode=(); $umode=''; %limit=(); %haveops=(); %chankey=(); $away='';
   $listmin=0; $listmax=100000; $listpat='';
   @@waituh=(); @@douh=(); @@erruh=(); $invited='';
@@@@ -223,8 +271,15 @@@@ sub gl {
     return 1;
   }
   local($buf)='';
+  local($buf2)='';
   if (sysread($_[0], $buf, 4096)) {
-    $buffer{$_[0]}.=$buf;
+    if ($_[0] eq $S) {
+      $buf2 .= Encode::decode("utf8", $buf, Encode::FB_QUIET);
+      $buf2 .= Encode::decode("iso-8859-1", $buf, Encode::FB_QUIET);
+      $buffer{$_[0]} .= Encode::encode($set{"CHARSET"}, $buf2, 0);
+    } else {
+      $buffer{$_[0]} .= $buf;
+    }
     if ($buffer{$_[0]} =~ /^([^\n\r]*)\r?\n\r?/) {
       $buffer{$_[0]}=$';
       $_=$1."\n";
@@@@ -237,7 +292,19 @@@@ sub gl {
 }
 
 sub sl {
-  &print("*\cbE\cb* Error writing to server: $!") unless print $S $_[0]."\n";
+  local($buf)=$_[0];
+  local($buf2)='';
+  local($buf3)='';
+  $buf2 .= Encode::decode($set{"CHARSET"}, $buf, Encode::FB_QUIET);
+  $buf2 .= Encode::decode("utf8", $buf, Encode::FB_QUIET);
+  $buf2 .= Encode::decode("iso-8859-1", $buf, Encode::FB_QUIET);
+  $buf2 .= Encode::decode("windows-1252", $buf, 0);
+  if ($set{"UTF"} ne 'off') {
+    $buf3 = Encode::encode("utf8", $buf2, 0);
+  } else {
+    $buf3 = Encode::encode("iso-8859-1", $buf2, 0);
+  }
+  &print("*\cbE\cb* Error writing to server: $!") unless print $S $buf3."\n";
 }
 
 sub dostatus {
@@@@ -276,6 +343,8 @@@@ sub print {
   &dohooks("print", $what);
   return if $skip;
   $what =~ s/\s+$//;
+  # windows-1252 and broken (not converted) utf-8 => latin-1
+#  $what =~ tr/\x80-\x9F/e ,f,.tT\^×S<ö Z  ''""·\-\-\~Ts>ö zÿ/;
   # thanks to Toy (wacren@@obspm.fr) for this translation
   $what =~ tr/\x80-\xff/\x00-\x1f !cLxY|$_ca<\-\-R_o+23\'mp.,1o>123?AAAAAAACEEEEIIIIDNOOOOO*0UUUUYPBaaaaaaaceeeeiiiidnooooo:0uuuuypy/
     if $set{"EIGHT_BIT"} ne 'on';
@@@@ -348,7 +417,17 @@@@ sub dgsclose {
 
 sub msg {
   local($towho, $what)=@@_;
-  print "`#ssfe#t/m $towho \n" if $ssfe && !&eq($towho, $talkchannel);
+  if ($ssfe) {
+    local($x)=0;
+    if ($query) {
+      $x=1;
+    } elsif (!&eq($towho, $talkchannel)) {
+      $x=1;
+    }
+    if ($x) {
+      print "`#ssfe#t/m $towho \n";
+    }
+  }
   if ($towho =~ s/^=//) {
     local($n, $fh)=($towho);
     $n =~ tr/A-Z/a-z/;
@@@@ -537,6 +616,11 @@@@ sub doset {
   } elsif ($var eq 'PRINTCHAN') {
     $set{$var}="on", $printchan=1 if $val =~ /^on$/i;
     $set{$var}="off", $printchan=0 if $val =~ /^off$/i;
+  } elsif ($var eq 'UTF') {
+    $set{$var}="on" if $val =~ /^on$/i;
+    $set{$var}="off" if $val =~ /^off$/i;
+  } elsif ($var eq 'CHARSET') {
+    $set{$var}=$val;
   } elsif ($var eq 'CTCP') {
     $val =~ tr/A-Z/a-z/;
     $set{$var}=$val if $val =~ /^(none|all)$/;
@@@@ -574,7 +658,7 @@@@ sub doset {
     &restrict || return;
     if ($val =~ /^on$/i) {
       $logging && close LOG;
-      if (open(LOG, 
+      if (open(LOG,
 	  ($logfile =~ /\.gz$/ ? "| gzip >> $logfile" : ">> $logfile"))) {
 	$logging=1;
 	$set{$var}="on";
@@@@ -721,7 +805,7 @@@@ sub docommand {
 	&tell("*** $s is ".($set{$s} ne '' ? "set to $set{$s}" : "unset"));
       }
     }
-  } elsif ($cmd eq 'NOTIFY' || $cmd eq 'N') {
+  } elsif ($cmd eq 'NOTIFY' || $cmd eq 'NO') {
     if ($args eq '-') {
       &tell("*** Notify list cleared");
       %notify=();
@@@@ -867,7 +951,7 @@@@ sub docommand {
     } else {
       &tell("*\cbE\cb* You must specify a nick or channel!");
     }
-  } elsif ($cmd eq 'QUERY' || $cmd eq 'Q') {
+  } elsif ($cmd eq 'QUERY') {
     if ($args) {
       $args =~ s/\s+$//;
       $query=$args;
@@@@ -918,9 +1002,9 @@@@ sub docommand {
       &getarg;
       if ($newarg) {
 	local($fh)=grep(&eq($dcnick{$_}, $n), keys(%dcnick));
-	&tell("*\cbE\cb* No DCC CHAT established with $n"), return 
+	&tell("*\cbE\cb* No DCC CHAT established with $n"), return
 	  unless $fh;
-	&tell("*\cbE\cb* DCC CHAT already established with $newarg"), return 
+	&tell("*\cbE\cb* DCC CHAT already established with $newarg"), return
 	  if grep(&eq($dcnick{$_}, $newarg), keys(%dcnick));
 	&tell("*\cbD\cb* DCC CHAT with $n renamed to $newarg");
 	$dcnick{$fh}=$newarg;
@@@@ -974,7 +1058,7 @@@@ sub docommand {
 	  if (!$found && $dgrfh{$sfh}) {
 	    local($fh)=$dgrfh{$sfh};
 	    next if $args && ($args ne $dfile{$fh});
-	    &dohooks("dcc_disconnect", $dnick{$sfh}, $dfile{$fh}, 
+	    &dohooks("dcc_disconnect", $dnick{$sfh}, $dfile{$fh},
 		$dtransferred{$sfh}, time-$dstarttime{$fh});
 	    &tell("*\cbE\cb* Closing DCC GET connection with $newarg");
 	    $found=1;
@@@@ -999,7 +1083,7 @@@@ sub docommand {
 	  if ($newarg eq '' || $dfile{$fh} =~ /^${newarg}$/ ||
 	      $dfile{$fh} =~ /\/${newarg}$/) {
 	    &tell("*\cbD\cb* DCC SEND connection with $n closed");
-	    &dohooks("dcc_disconnect", $dnick{$sfh}, $dfile{$fh}, 
+	    &dohooks("dcc_disconnect", $dnick{$sfh}, $dfile{$fh},
 		$dtransferred{$sfh}, time-$dstarttime{$fh});
 	    close($sfh);
 	    close($fh);
@@@@ -1122,7 +1206,7 @@@@ sub docommand {
     }
   } elsif ($cmd eq 'SAY' || $cmd eq '') {
     &say($args);
-  } elsif ($cmd eq 'NOTICE' || $cmd eq 'NO') {
+  } elsif ($cmd eq 'NOTICE' || $cmd eq 'N') {
     &dosplat;
     if ($args) {
       ($newarg, $args)=split(/ /, $args, 2);
@@@@ -1183,7 +1267,7 @@@@ sub docommand {
     } else {
       &tell("*\cbE\cb* You must specify a nick or channel!");
     }
-  } elsif ($cmd eq 'PING' || $cmd eq 'P') {
+  } elsif ($cmd eq 'PING') {
     &dosplat;
     if ($args) {
       &getarg;
@@@@ -1194,7 +1278,7 @@@@ sub docommand {
     } else {
       &tell("*\cbE\cb* You must specify a nick or channel!");
     }
-  } elsif ($cmd eq 'ME') {
+  } elsif ($cmd eq 'ME' || $cmd eq 'D') {
     if ($talkchannel) {
       &describe($talkchannel, $args);
     } else {
@@@@ -1212,7 +1296,7 @@@@ sub docommand {
     } else {
       &sl("TOPIC $c");
     }
-  } elsif ($cmd eq 'LEAVE' || $cmd eq 'PART' || $cmd eq 'HOP') {
+  } elsif ($cmd eq 'PART' || $cmd eq 'P') {
     &dosplat;
     $args=$talkchannel if $args eq '';
     &sl("PART $args");
@@@@ -1222,7 +1306,7 @@@@ sub docommand {
     } else {
       &tell("*\cbE\cb* Not on a channel");
     }
-  } elsif ($cmd eq 'O' || $cmd eq 'OP') {
+  } elsif ($cmd eq 'OP') {
     local($c, $n, $l)=($talkchannel, 0, '');
     &getarg, $c=$newarg if ($args =~ /^[\#\&\+]/);
     local(@@ppl)=split(/ +/, $args);
@@@@ -1237,7 +1321,7 @@@@ sub docommand {
       }
     }
     $l && &sl("MODE $c +oooo $l");
-  } elsif ($cmd eq 'D' || $cmd eq 'DEOP') {
+  } elsif ($cmd eq 'DEOP') {
     local($c, $n, $l)=($talkchannel, 0, '');
     &getarg, $c=$newarg if ($args =~ /^[\#\&\+]/);
     local(@@ppl)=split(/ +/, $args);
@@@@ -1252,9 +1336,9 @@@@ sub docommand {
       }
     }
     $l && &sl("MODE $c -oooo $l");
-  } elsif ($cmd eq 'W' || $cmd eq 'WHOIS') {
+  } elsif ($cmd eq 'WI' || $cmd eq 'WHOIS') {
     &sl($args eq '' ? "WHOIS $nick" : "WHOIS $args");
-  } elsif ($cmd eq 'WI') {
+  } elsif ($cmd eq 'W') {
     &getarg;
     $newarg=$nick if $newarg eq '';
     &sl("WHOIS $newarg $newarg");
@@@@ -1277,7 +1361,7 @@@@ sub docommand {
     } else {
       &sl("JOIN $args");
     }
-  } elsif ($cmd eq 'QUOTE') {
+  } elsif ($cmd eq 'QUOTE' || $cmd eq 'Q') {
     $args ne '' && &sl($args);
   } elsif ($cmd eq 'UMODE') {
     &sl("MODE $nick $args");
@@@@ -1611,7 +1695,7 @@@@ sub dorcfile {
 }
 
 sub loadrc {
-  $rcloaded=1; 
+  $rcloaded=1;
   $sysrc && &dorcfile($sysrc);
   $rcfile && &dorcfile($rcfile);
 }
@@@@ -2127,8 +2211,8 @@@@ while (1) {
 	$talkchannel && !$ssfe && &tell("*** Talking to $talkchannel now");
 	&dostatus;
       } else {
-	&dohooks("leave", $newarg);
-	&tell("*\cb<\cb* $who$puh2 has left channel $newarg");
+	&dohooks("leave", $newarg, $args);
+	&tell("*\cb<\cb* $who$puh2 has left channel $newarg ($args)");
       }
     } elsif ($cmd eq 'JOIN') {
       &yetonearg;
@@@@ -2205,4 +2289,3 @@@@ while (1) {
     }
   }
 }
-
@


1.21
log
@can't display own
@
text
@d1 3
a3 3
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.20 2004/08/19 08:02:17 tg Exp $
--- dsirc.orig	1998-03-10 12:55:29.000000000 +0000
+++ dsirc	2004-08-19 08:05:01.000000000 +0000
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.20 2004/08/19 08:02:17 tg Exp $
d167 1
a167 1
+  }
d173 1
a173 1
   }
@


1.20
log
@some people like to add a message to their PART
@
text
@d1 1
a1 1
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.19 2004/08/19 07:58:08 tg Exp $
d3 1
a3 1
+++ dsirc	2004-08-19 08:01:54.000000000 +0000
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.19 2004/08/19 07:58:08 tg Exp $
a447 9
@@@@ -2111,7 +2195,7 @@@@ while (1) {
     } elsif ($cmd eq 'PART') {
       &yetonearg;
       if (&eq($who, $nick)) {
-	&tell("*\cb<\cb* You have left channel $newarg");
+	&tell("*\cb<\cb* You have left channel $newarg ($args)");
 	@@channels=grep(!&eq($_, $newarg), @@channels);
 	if (@@channels) {
 	  $talkchannel=$channels[$#channels];
@


1.19
log
@swap /w and /wi so that /w shows idle time again (on OFTC), where
/wi is the new alias for /whois (which showed idle time on OPN only)
bump version
@
text
@d1 1
a1 1
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.18 2004/08/12 22:33:42 tg Exp $
d3 1
a3 1
+++ dsirc	2004-08-19 07:55:29.000000000 +0000
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.18 2004/08/12 22:33:42 tg Exp $
d448 20
@


1.18
log
@revert, two things missing
@
text
@d1 3
a3 3
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.16 2004/07/29 13:37:48 tg Exp $
--- dsirc.orig	Tue Mar 10 12:55:29 1998
+++ dsirc	Thu Aug 12 22:31:57 2004
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.16 2004/07/29 13:37:48 tg Exp $
d58 1
a58 1
+$add_ons='+[mirabile-p9]';
d167 1
a167 1
   }
d173 1
a173 1
+  }
d418 12
@


1.17
log
@make Socket6 optional

help by Marcus Thiesen
@
text
@d3 1
a3 1
+++ dsirc	Thu Aug 12 21:48:51 2004
d69 1
a69 1
@@@@ -52,6 +62,11 @@@@ even there! Have you even bothered to ru
d73 1
a73 5
+  $use_ipv6 = 1;
+  eval {
+    require Socket6;
+    import Socket6;
+  } or $use_ipv6 = 0;
d77 1
a77 1
@@@@ -62,39 +77,44 @@@@ Your perl installation is wrong somewher
d131 1
a131 1
@@@@ -148,7 +168,17 @@@@ sub resolve {
d138 4
a141 3
+      if ($use_ipv6) {
+	$rc = (gethostbyname2($_[0], AF_INET6))[4];
+	if ($rc) {
d143 2
a144 3
+        } else {
+	  $use_ipv6 = 0;
+	}
a145 1
+      return (gethostbyname($_[0]))[4];
d149 1
a149 1
@@@@ -162,19 +192,31 @@@@ sub connect {
d188 1
a188 1
@@@@ -183,15 +225,26 @@@@ sub listen {
d220 1
a220 1
@@@@ -200,7 +253,7 @@@@ sub accept {
d229 1
a229 1
@@@@ -223,8 +276,15 @@@@ sub gl {
d246 1
a246 1
@@@@ -237,7 +297,19 @@@@ sub gl {
d267 1
a267 1
@@@@ -276,6 +348,8 @@@@ sub print {
d276 1
a276 1
@@@@ -348,7 +422,17 @@@@ sub dgsclose {
d295 1
a295 1
@@@@ -537,6 +621,11 @@@@ sub doset {
d307 1
a307 1
@@@@ -574,7 +663,7 @@@@ sub doset {
d316 1
a316 1
@@@@ -721,7 +810,7 @@@@ sub docommand {
d325 1
a325 1
@@@@ -867,7 +956,7 @@@@ sub docommand {
d334 1
a334 1
@@@@ -918,9 +1007,9 @@@@ sub docommand {
d346 1
a346 1
@@@@ -974,7 +1063,7 @@@@ sub docommand {
d355 1
a355 1
@@@@ -999,7 +1088,7 @@@@ sub docommand {
d364 1
a364 1
@@@@ -1122,7 +1211,7 @@@@ sub docommand {
d373 1
a373 1
@@@@ -1183,7 +1272,7 @@@@ sub docommand {
d382 1
a382 1
@@@@ -1194,7 +1283,7 @@@@ sub docommand {
d391 1
a391 1
@@@@ -1212,7 +1301,7 @@@@ sub docommand {
d400 1
a400 1
@@@@ -1222,7 +1311,7 @@@@ sub docommand {
d409 1
a409 1
@@@@ -1237,7 +1326,7 @@@@ sub docommand {
d418 1
a418 1
@@@@ -1277,7 +1366,7 @@@@ sub docommand {
d427 1
a427 1
@@@@ -1611,7 +1700,7 @@@@ sub dorcfile {
d436 1
a436 1
@@@@ -2205,4 +2294,3 @@@@ while (1) {
@


1.16
log
@tweak:	if pressing <tab>, sirc shows the list of "/m"s the user
	has had, excluding a /m to the current channel.
	now: the /m #currentchannel is also added if the user is
	in the channel, but has a query currently open
@
text
@d1 1
a1 1
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.15 2004/05/18 12:25:00 tg Exp $
d3 1
a3 1
+++ dsirc	Thu Jul 29 13:36:10 2004
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.15 2004/05/18 12:25:00 tg Exp $
d69 1
a69 1
@@@@ -52,6 +62,7 @@@@ even there! Have you even bothered to ru
d73 5
a77 1
+  use Socket6;
d81 1
a81 1
@@@@ -62,39 +73,44 @@@@ Your perl installation is wrong somewher
d135 1
a135 1
@@@@ -148,7 +164,16 @@@@ sub resolve {
d142 3
a144 4
+      $rc = (gethostbyname2($_[0], AF_INET6))[4];
+
+      if ($rc) {
+	  $use_ipv6 = 1;
d146 3
a148 2
+      } else {
+	  return (gethostbyname($_[0]))[4];
d150 1
d154 1
a154 1
@@@@ -162,19 +187,31 @@@@ sub connect {
d193 1
a193 1
@@@@ -183,15 +220,26 @@@@ sub listen {
d225 1
a225 1
@@@@ -200,7 +248,7 @@@@ sub accept {
d234 1
a234 1
@@@@ -223,8 +271,15 @@@@ sub gl {
d251 1
a251 1
@@@@ -237,7 +292,19 @@@@ sub gl {
d272 1
a272 1
@@@@ -276,6 +343,8 @@@@ sub print {
d281 1
a281 1
@@@@ -348,7 +417,17 @@@@ sub dgsclose {
d300 1
a300 1
@@@@ -537,6 +616,11 @@@@ sub doset {
d312 1
a312 1
@@@@ -574,7 +658,7 @@@@ sub doset {
d321 1
a321 1
@@@@ -721,7 +805,7 @@@@ sub docommand {
d330 1
a330 1
@@@@ -867,7 +951,7 @@@@ sub docommand {
d339 1
a339 1
@@@@ -918,9 +1002,9 @@@@ sub docommand {
d351 1
a351 1
@@@@ -974,7 +1058,7 @@@@ sub docommand {
d360 1
a360 1
@@@@ -999,7 +1083,7 @@@@ sub docommand {
d369 1
a369 1
@@@@ -1122,7 +1206,7 @@@@ sub docommand {
d378 1
a378 1
@@@@ -1183,7 +1267,7 @@@@ sub docommand {
d387 1
a387 1
@@@@ -1194,7 +1278,7 @@@@ sub docommand {
d396 1
a396 1
@@@@ -1212,7 +1296,7 @@@@ sub docommand {
d405 1
a405 1
@@@@ -1222,7 +1306,7 @@@@ sub docommand {
d414 1
a414 1
@@@@ -1237,7 +1321,7 @@@@ sub docommand {
d423 1
a423 1
@@@@ -1277,7 +1361,7 @@@@ sub docommand {
d432 1
a432 1
@@@@ -1611,7 +1695,7 @@@@ sub dorcfile {
d441 1
a441 1
@@@@ -2205,4 +2289,3 @@@@ while (1) {
@


1.15
log
@resolve -u -u conflict, use -X for utf-8
@
text
@d1 3
a3 3
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.14 2004/05/16 20:24:34 tg Exp $
--- dsirc.orig	1998-03-10 12:55:29.000000000 +0000
+++ dsirc	2004-05-18 12:23:57.000000000 +0000
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.14 2004/05/16 20:24:34 tg Exp $
d167 1
a167 1
+  }
d173 1
a173 1
   }
d276 20
a295 1
@@@@ -537,6 +606,11 @@@@ sub doset {
d307 1
a307 1
@@@@ -574,7 +648,7 @@@@ sub doset {
d316 1
a316 1
@@@@ -721,7 +795,7 @@@@ sub docommand {
d325 1
a325 1
@@@@ -867,7 +941,7 @@@@ sub docommand {
d334 1
a334 1
@@@@ -918,9 +992,9 @@@@ sub docommand {
d346 1
a346 1
@@@@ -974,7 +1048,7 @@@@ sub docommand {
d355 1
a355 1
@@@@ -999,7 +1073,7 @@@@ sub docommand {
d364 1
a364 1
@@@@ -1122,7 +1196,7 @@@@ sub docommand {
d373 1
a373 1
@@@@ -1183,7 +1257,7 @@@@ sub docommand {
d382 1
a382 1
@@@@ -1194,7 +1268,7 @@@@ sub docommand {
d391 1
a391 1
@@@@ -1212,7 +1286,7 @@@@ sub docommand {
d400 1
a400 1
@@@@ -1222,7 +1296,7 @@@@ sub docommand {
d409 1
a409 1
@@@@ -1237,7 +1311,7 @@@@ sub docommand {
d418 1
a418 1
@@@@ -1277,7 +1351,7 @@@@ sub docommand {
d427 1
a427 1
@@@@ -1611,7 +1685,7 @@@@ sub dorcfile {
d436 1
a436 1
@@@@ -2205,4 +2279,3 @@@@ while (1) {
@


1.14
log
@support for arbitrary charsets
tested with xvkbd, japanese (katakana only, wtf?) and uxterm.
@
text
@d1 1
a1 1
$MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.13 2003/12/05 15:33:36 tg Exp $
d3 2
a4 2
+++ dsirc	2004-05-16 18:56:14.000000000 +0000
@@@@ -1,30 +1,39 @@@@
d9 1
a9 1
+# $MirBSD: ports/net/sirc/patches/patch-dsirc,v 1.13 2003/12/05 15:33:36 tg Exp $
d25 1
d43 1
a43 1
+#	-u = set local charset to UTF-8
d53 1
a53 1
@@@@ -36,11 +45,11 @@@@
d69 1
a69 1
@@@@ -52,6 +61,7 @@@@ even there! Have you even bothered to ru
d77 1
a77 1
@@@@ -62,39 +72,44 @@@@ Your perl installation is wrong somewher
d84 1
a84 1
+&Getopts('n:s:p:u:i:l:L:H:rqQR78UC:u');
d127 1
a127 1
+$opt_u && ($set{"CHARSET"}="utf8");
d131 1
a131 1
@@@@ -148,7 +163,16 @@@@ sub resolve {
d149 1
a149 1
@@@@ -162,19 +186,31 @@@@ sub connect {
d188 1
a188 1
@@@@ -183,15 +219,26 @@@@ sub listen {
d220 1
a220 1
@@@@ -200,7 +247,7 @@@@ sub accept {
d229 1
a229 1
@@@@ -223,8 +270,15 @@@@ sub gl {
d246 1
a246 1
@@@@ -237,7 +291,19 @@@@ sub gl {
d267 1
a267 1
@@@@ -276,6 +342,8 @@@@ sub print {
d276 1
a276 1
@@@@ -537,6 +605,11 @@@@ sub doset {
d288 1
a288 1
@@@@ -574,7 +647,7 @@@@ sub doset {
d297 1
a297 1
@@@@ -721,7 +794,7 @@@@ sub docommand {
d306 1
a306 1
@@@@ -867,7 +940,7 @@@@ sub docommand {
d315 1
a315 1
@@@@ -918,9 +991,9 @@@@ sub docommand {
d327 1
a327 1
@@@@ -974,7 +1047,7 @@@@ sub docommand {
d336 1
a336 1
@@@@ -999,7 +1072,7 @@@@ sub docommand {
d345 1
a345 1
@@@@ -1122,7 +1195,7 @@@@ sub docommand {
d354 1
a354 1
@@@@ -1183,7 +1256,7 @@@@ sub docommand {
d363 1
a363 1
@@@@ -1194,7 +1267,7 @@@@ sub docommand {
d372 1
a372 1
@@@@ -1212,7 +1285,7 @@@@ sub docommand {
d381 1
a381 1
@@@@ -1222,7 +1295,7 @@@@ sub docommand {
d390 1
a390 1
@@@@ -1237,7 +1310,7 @@@@ sub docommand {
d399 1
a399 1
@@@@ -1277,7 +1350,7 @@@@ sub docommand {
d408 1
a408 1
@@@@ -1611,7 +1684,7 @@@@ sub dorcfile {
d417 1
a417 1
@@@@ -2205,4 +2278,3 @@@@ while (1) {
@


1.13
log
@bump patchlevel; increase utf-8 abilities for perl 5.8.2
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.12 2003/09/01 17:46:58 tg Exp $
d3 2
a4 2
+++ dsirc	2003-12-05 15:24:55.000000000 +0000
@@@@ -1,30 +1,37 @@@@
d9 1
a9 1
+# $MirBSD: patch-dsirc,v 1.12 2003/09/01 17:46:58 tg Exp $
d16 1
a16 1
+# Copyright (c) 2001-2003 Thorsten Glaser <x86@@ePost.de>
d41 2
d52 1
a52 1
@@@@ -36,11 +43,11 @@@@
d57 1
a57 1
+$add_ons='+[mirabile-p8]';
d68 1
a68 1
@@@@ -52,6 +59,7 @@@@ even there! Have you even bothered to ru
d76 1
a76 1
@@@@ -62,39 +70,41 @@@@ Your perl installation is wrong somewher
d83 1
a83 1
+&Getopts('n:s:p:u:i:l:L:H:rqQR78U');
d90 2
a91 1
+	"LOADPATH", join(":", @@loadpath), "CTRL_T", "/next", "UTF", "on");
d125 2
d130 1
a130 1
@@@@ -148,7 +158,16 @@@@ sub resolve {
d148 1
a148 1
@@@@ -162,19 +181,31 @@@@ sub connect {
d187 1
a187 1
@@@@ -183,15 +214,26 @@@@ sub listen {
d219 1
a219 1
@@@@ -200,7 +242,7 @@@@ sub accept {
d228 1
a228 1
@@@@ -223,8 +265,15 @@@@ sub gl {
d238 1
a238 1
+      $buffer{$_[0]} .= Encode::encode("iso-8859-1", $buf2, 0);
d245 1
a245 1
@@@@ -237,7 +286,17 @@@@ sub gl {
d252 5
d258 1
a258 5
+    $buf2 .= Encode::decode("utf8", $buf, Encode::FB_QUIET);
+    $buf2 .= Encode::decode("iso-8859-1", $buf, Encode::FB_QUIET);
+    $buf2 .= Encode::decode("windows-1252", $buf, 0);
+    &print("*\cbE\cb* Error writing to server: $!") unless print $S
+	Encode::encode("utf8", $buf2, 0)."\n";
d260 1
a260 1
+    &print("*\cbE\cb* Error writing to server: $!") unless print $S $buf."\n";
d262 1
d266 1
a266 1
@@@@ -276,6 +335,8 @@@@ sub print {
d271 1
a271 1
+  $what =~ tr/\x80-\x9F/e ,f,.tT\^×S<ö Z  ''""·\-\-\~Ts>ö zÿ/;
d275 1
a275 1
@@@@ -537,6 +598,9 @@@@ sub doset {
d282 2
d287 1
a287 1
@@@@ -574,7 +638,7 @@@@ sub doset {
d296 10
a305 1
@@@@ -867,7 +931,7 @@@@ sub docommand {
d314 1
a314 1
@@@@ -918,9 +982,9 @@@@ sub docommand {
d326 1
a326 1
@@@@ -974,7 +1038,7 @@@@ sub docommand {
d335 1
a335 1
@@@@ -999,7 +1063,7 @@@@ sub docommand {
d344 10
a353 1
@@@@ -1183,7 +1247,7 @@@@ sub docommand {
d362 1
a362 1
@@@@ -1194,7 +1258,7 @@@@ sub docommand {
d371 1
a371 1
@@@@ -1212,7 +1276,7 @@@@ sub docommand {
d380 1
a380 1
@@@@ -1222,7 +1286,7 @@@@ sub docommand {
d389 1
a389 1
@@@@ -1237,7 +1301,7 @@@@ sub docommand {
d398 1
a398 1
@@@@ -1277,7 +1341,7 @@@@ sub docommand {
d407 1
a407 1
@@@@ -1611,7 +1675,7 @@@@ sub dorcfile {
d416 1
a416 1
@@@@ -2205,4 +2269,3 @@@@ while (1) {
@


1.12
log
@~/.sirc/ -> ~/.etc/sirc/ (load directory)
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.11 2003/09/01 17:21:23 tg Exp $
d3 1
a3 1
+++ dsirc	2003-09-01 17:45:51.000000000 +0000
d6 2
d9 2
a10 3
+# $MirBSD: patch-dsirc,v 1.11 2003/09/01 17:21:23 tg Exp $
 
-# dsirc: dumb-mode small irc client in perl
d16 1
a16 1
+# Copyright (c) 2001-2003 Thorsten Glaser
d55 1
a55 1
+$add_ons='+[mirabile-p7]';
d108 1
a108 1
+$initfile=$opt_l || $ENV{"SIRCRCPL"} || $ENV{'HOME'}."/.etc/sircrc.pl" 
d112 1
a112 1
+$rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV{'HOME'}."/.etc/sircrc" 
d223 2
a224 1
@@@@ -224,7 +266,11 @@@@ sub gl {
d227 1
d231 3
a233 1
+      $buffer{$_[0]}.=Encode::encode("ISO-8859-1", Encode::decode("utf8", $buf), 4) or $buffer{$_[0]}.=$buf;
d235 1
a235 1
+      $buffer{$_[0]}.=$buf;
d240 1
a240 1
@@@@ -237,7 +283,11 @@@@ sub gl {
d245 2
d248 5
a252 1
+    &print("*\cbE\cb* Error writing to server: $!") unless print $S Encode::encode("utf8", Encode::decode("ISO-8859-1", $_[0]))."\n";
d254 1
a254 1
+    &print("*\cbE\cb* Error writing to server: $!") unless print $S $_[0]."\n";
d259 1
a259 1
@@@@ -276,6 +326,8 @@@@ sub print {
d268 1
a268 1
@@@@ -537,6 +589,9 @@@@ sub doset {
d278 10
a287 1
@@@@ -867,7 +922,7 @@@@ sub docommand {
d296 31
a326 1
@@@@ -1183,7 +1238,7 @@@@ sub docommand {
d335 1
a335 1
@@@@ -1194,7 +1249,7 @@@@ sub docommand {
d344 1
a344 1
@@@@ -1212,7 +1267,7 @@@@ sub docommand {
d353 1
a353 1
@@@@ -1222,7 +1277,7 @@@@ sub docommand {
d362 1
a362 1
@@@@ -1237,7 +1292,7 @@@@ sub docommand {
d371 1
a371 1
@@@@ -1277,7 +1332,7 @@@@ sub docommand {
d380 10
a389 1
@@@@ -2205,4 +2260,3 @@@@ while (1) {
@


1.11
log
@o ouch, call me stupid: it's
  ${HOME}/.etc/	and not
  ${HOME}/.bin/	*d'oh*
o while here: ssfe.diff is long gone
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.10 2003/09/01 17:18:13 tg Exp $
d3 1
a3 1
+++ dsirc	2003-09-01 17:13:33.000000000 +0000
d7 1
a7 1
+# $MirBSD: patch-dsirc,v 1.10 2003/09/01 17:18:13 tg Exp $
d49 1
a49 1
@@@@ -36,9 +43,9 @@@@
d57 2
d60 4
a63 2
 push(@@INC, $libdir, $ENV{"HOME"});
 @@loadpath=($ENV{"HOME"}."/.sirc", $libdir, ".");
@


1.10
log
@o .sircrc	-> .bin/sircrc
o .sircrc.pl	-> .bin/sircrc.pl
o dsirc		-> dsircp
  (to avoid conflicts with KDE)
o bump patchlevel
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.9 2003/08/18 19:43:17 tg Exp $
d7 1
a7 1
+# $MirBSD: patch-dsirc,v 1.9 2003/08/18 19:43:17 tg Exp $
d28 2
a29 2
+#	-l = specify file to be loaded instead of ~/.bin/sircrc.pl
+#	-L = specify file to be loaded instead of ~/.bin/sircrc
d32 1
a32 1
+#	-q = don't load ~/.bin/sircrc or ~/.bin/sircrc.pl
d103 1
a103 1
+$initfile=$opt_l || $ENV{"SIRCRCPL"} || $ENV{'HOME'}."/.bin/sircrc.pl" 
d107 1
a107 1
+$rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV{'HOME'}."/.bin/sircrc" 
@


1.9
log
@set the needed module list once higher again:
always use the Encode module, and always try to parse
incoming text as utf-8 first, before falling back to
pass-through (i.e. latin1) mode.

bump patchlevel to p6, by the way.
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.8 2003/08/18 19:28:08 tg Exp $
d3 2
a4 2
+++ dsirc	2003-08-18 19:41:25.000000000 +0000
@@@@ -1,9 +1,12 @@@@
d7 1
a7 1
+# $MirBSD: patch-dsirc,v 1.8 2003/08/18 19:28:08 tg Exp $
d9 2
a10 1
 # dsirc: dumb-mode small irc client in perl
d19 14
a32 1
@@@@ -20,11 +23,15 @@@@
d54 1
a54 1
+$add_ons='+[mirabile-p6]+ipv6';
d69 1
a69 1
@@@@ -62,25 +70,26 @@@@ Your perl installation is wrong somewher
d102 6
a107 1
@@@@ -91,10 +100,11 @@@@ $rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV
@


1.8
log
@o mop up
o fix buglet: after connecting to an IPv6 server, $use_ipv6 was not
  zero (0) any more. this led to the unability to connect to an
  IPv4 server afterwards using /server .
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.7 2003/08/18 19:01:25 tg Exp $
d3 1
a3 1
+++ dsirc	2003-08-18 19:27:06.000000000 +0000
d7 1
a7 1
+# $MirBSD: patch-dsirc,v 1.7 2003/08/18 19:01:25 tg Exp $
d25 1
a25 1
+#	-U = disable UTF-8 (Unicode) mode
d47 1
a47 1
@@@@ -52,35 +59,36 @@@@ even there! Have you even bothered to ru
d55 1
a55 5
   do $ENV{'HOME'}."/sircsock.ph";
 } elsif (!eval "require 'sys/socket.ph';") {
-    print "\n\n\
+  print "\n\n\
 Your perl installation is wrong somewhere, the sys/socket.ph include file
d57 1
a57 2
-    exit;
+  exit;
d59 1
d88 1
a88 1
@@@@ -91,15 +99,21 @@@@ $rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV
d101 1
a101 11
 }
 
+if ($set{"UTF"} ne 'off') {
+  $add_ons.="+utf-8";
+  use Encode;
+}
+
 @@ARGV=();  # ignore any more arguments
 
 if (open(H, "$libdir/sirc.help") || ((-f "$libdir/sirc.help.gz") &&
@@@@ -148,7 +162,16 @@@@ sub resolve {
d119 1
a119 1
@@@@ -162,19 +185,31 @@@@ sub connect {
d158 1
a158 1
@@@@ -183,15 +218,26 @@@@ sub listen {
d190 1
a190 1
@@@@ -200,7 +246,7 @@@@ sub accept {
d199 1
a199 1
@@@@ -224,7 +270,15 @@@@ sub gl {
d204 2
a205 6
+    if ($set{"UTF"} ne 'off') {
+      if ($_[0] eq $S) {
+        $buffer{$_[0]}.=Encode::encode("ISO-8859-1", Encode::decode("utf8", $buf), 4) or $buffer{$_[0]}.=$buf;
+      } else {
+        $buffer{$_[0]}.=$buf;
+      }
d212 1
a212 1
@@@@ -237,7 +291,11 @@@@ sub gl {
d225 1
a225 1
@@@@ -276,6 +334,8 @@@@ sub print {
d234 1
a234 1
@@@@ -537,6 +597,9 @@@@ sub doset {
d244 1
a244 1
@@@@ -867,7 +930,7 @@@@ sub docommand {
d253 1
a253 1
@@@@ -1183,7 +1246,7 @@@@ sub docommand {
d262 1
a262 1
@@@@ -1194,7 +1257,7 @@@@ sub docommand {
d271 1
a271 1
@@@@ -1212,7 +1275,7 @@@@ sub docommand {
d280 1
a280 1
@@@@ -1222,7 +1285,7 @@@@ sub docommand {
d289 1
a289 1
@@@@ -1237,7 +1300,7 @@@@ sub docommand {
d298 1
a298 1
@@@@ -1277,7 +1340,7 @@@@ sub docommand {
d307 1
a307 1
@@@@ -2205,4 +2268,3 @@@@ while (1) {
@


1.7
log
@switch sirc port to require IPv6 module that just got imported
mop up
@
text
@d1 1
a1 1
$MirBSD$
d3 1
a3 1
+++ dsirc	2003-08-18 18:54:12.000000000 +0000
d7 1
a7 1
+# $MirBSD: patch-dsirc,v 1.6 2003/07/14 19:45:36 tg Exp $
d47 1
a47 1
@@@@ -52,35 +59,37 @@@@ even there! Have you even bothered to ru
a74 1
+$use_ipv6=0;	# enabled when the given server is resolved by gethostbyname2
d92 1
a92 1
@@@@ -91,15 +100,21 @@@@ $rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV
d115 1
a115 1
@@@@ -148,7 +163,16 @@@@ sub resolve {
d133 1
a133 1
@@@@ -162,19 +186,31 @@@@ sub connect {
d172 1
a172 1
@@@@ -183,15 +219,26 @@@@ sub listen {
d204 10
a213 1
@@@@ -224,7 +271,15 @@@@ sub gl {
d230 1
a230 1
@@@@ -237,7 +292,11 @@@@ sub gl {
d243 1
a243 1
@@@@ -276,6 +335,8 @@@@ sub print {
d252 1
a252 1
@@@@ -537,6 +598,9 @@@@ sub doset {
d262 1
a262 1
@@@@ -867,7 +931,7 @@@@ sub docommand {
d271 1
a271 1
@@@@ -1183,7 +1247,7 @@@@ sub docommand {
d280 1
a280 1
@@@@ -1194,7 +1258,7 @@@@ sub docommand {
d289 1
a289 1
@@@@ -1212,7 +1276,7 @@@@ sub docommand {
d298 1
a298 1
@@@@ -1222,7 +1286,7 @@@@ sub docommand {
d307 1
a307 1
@@@@ -1237,7 +1301,7 @@@@ sub docommand {
d316 1
a316 1
@@@@ -1277,7 +1341,7 @@@@ sub docommand {
d325 1
a325 1
@@@@ -2205,4 +2269,3 @@@@ while (1) {
@


1.6
log
@fix /set UTF
@
text
@d1 4
a4 4
$MirBSD: patch-dsirc,v 1.5 2003/07/14 19:15:34 tg Exp $
--- dsirc.orig	Tue Mar 10 12:55:29 1998
+++ dsirc	Mon Jul 14 19:41:35 2003
@@@@ -1,13 +1,15 @@@@
d7 1
d13 1
a14 1
+# $MirBSD: patch-dsirc,v 1.5 2003/07/14 19:15:34 tg Exp $
d18 1
a18 6
-# use: dsirc [options] [nick [server[:port[:password]]]]
+# use: dsirc[6] [options] [nick [server[:port[:password]]]]
 # options are:
 #	-p = specify port number
 #	-i = specify IRCNAME
@@@@ -20,11 +22,14 @@@@
d23 1
d35 1
a35 1
@@@@ -36,9 +41,9 @@@@
d40 1
a40 1
+$add_ons='+[mirabile-p5]';
d47 16
a62 2
@@@@ -63,24 +68,24 @@@@ couldn't be found. Have you even bothere
     exit;
d75 1
d80 1
a80 1
+                  "irc.eu.freenode.net";
d93 1
a93 1
@@@@ -91,15 +96,21 @@@@ $rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV
d116 90
a205 1
@@@@ -224,7 +235,15 @@@@ sub gl {
d222 1
a222 1
@@@@ -237,7 +256,11 @@@@ sub gl {
d235 1
a235 1
@@@@ -276,6 +299,8 @@@@ sub print {
d244 1
a244 1
@@@@ -537,6 +562,9 @@@@ sub doset {
d254 1
a254 1
@@@@ -867,7 +895,7 @@@@ sub docommand {
d263 1
a263 1
@@@@ -1183,7 +1211,7 @@@@ sub docommand {
d272 1
a272 1
@@@@ -1194,7 +1222,7 @@@@ sub docommand {
d281 1
a281 1
@@@@ -1212,7 +1240,7 @@@@ sub docommand {
d290 1
a290 1
@@@@ -1222,7 +1250,7 @@@@ sub docommand {
d299 1
a299 1
@@@@ -1237,7 +1265,7 @@@@ sub docommand {
d308 1
a308 1
@@@@ -1277,7 +1305,7 @@@@ sub docommand {
d317 1
a317 1
@@@@ -2205,4 +2233,3 @@@@ while (1) {
@


1.5
log
@add an option to disable UTF-8 support
UTF-8 is still enabled by default
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.4 2003/07/06 11:27:09 tg Exp $
d3 1
a3 1
+++ dsirc	Mon Jul 14 19:12:10 2003
d13 1
a13 1
+# $MirBSD: patch-dsirc,v 1.4 2003/07/06 11:27:09 tg Exp $
d62 1
a62 1
+	"LOADPATH", join(":", @@loadpath), "CTRL_T", "/next", "UTF8", "on");
d90 1
a90 1
+$opt_U && ($set{"UTF8"}="off");
d96 1
a96 1
+if ($set{"UTF8"} ne "off") {
d109 1
a109 1
+    if ($set{"UTF8"} ne "off") {
d126 1
a126 1
+  if ($set{"UTF8"} ne "off") {
d143 11
a153 1
@@@@ -867,7 +892,7 @@@@ sub docommand {
d162 1
a162 1
@@@@ -1183,7 +1208,7 @@@@ sub docommand {
d171 1
a171 1
@@@@ -1194,7 +1219,7 @@@@ sub docommand {
d180 1
a180 1
@@@@ -1212,7 +1237,7 @@@@ sub docommand {
d189 1
a189 1
@@@@ -1222,7 +1247,7 @@@@ sub docommand {
d198 1
a198 1
@@@@ -1237,7 +1262,7 @@@@ sub docommand {
d207 1
a207 1
@@@@ -1277,7 +1302,7 @@@@ sub docommand {
d216 1
a216 1
@@@@ -2205,4 +2230,3 @@@@ while (1) {
@


1.4
log
@update patches a bit (only cosmetic changes yet)
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.3 2003/03/24 18:32:25 tg Exp $
d3 1
a3 1
+++ dsirc	Sun Jul  6 11:17:16 2003
d13 1
a13 1
+# $MirBSD: patch-dsirc,v 1.3 2003/03/24 18:32:25 tg Exp $
d22 1
a22 1
@@@@ -20,11 +22,13 @@@@
d28 1
d38 1
a38 1
@@@@ -36,9 +40,9 @@@@
d43 1
a43 1
+$add_ons='+[mirabile-p5]-utf8';
d50 1
a50 1
@@@@ -63,24 +67,25 @@@@ couldn't be found. Have you even bothere
d54 2
a55 2
+use Encode;
 &Getopts('n:s:p:u:i:l:L:H:rqQR78');
d61 2
a62 1
 	"LOADPATH", join(":", @@loadpath), "CTRL_T", "/next");
d81 1
a81 1
@@@@ -91,7 +96,7 @@@@ $rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV
d90 15
a104 1
@@@@ -224,7 +229,11 @@@@ sub gl {
d109 6
a114 2
+    if ($_[0] eq $S) {
+      $buffer{$_[0]}.=Encode::encode("ISO-8859-1", Encode::decode("utf8", $buf), 4) or $buffer{$_[0]}.=$buf;
d121 1
a121 1
@@@@ -237,7 +246,7 @@@@ sub gl {
d126 5
a130 1
+  &print("*\cbE\cb* Error writing to server: $!") unless print $S Encode::encode("utf8", Encode::decode("ISO-8859-1", $_[0]))."\n";
d134 1
a134 1
@@@@ -276,6 +285,8 @@@@ sub print {
d143 1
a143 1
@@@@ -867,7 +878,7 @@@@ sub docommand {
d152 1
a152 1
@@@@ -1183,7 +1194,7 @@@@ sub docommand {
d161 1
a161 1
@@@@ -1194,7 +1205,7 @@@@ sub docommand {
d170 1
a170 1
@@@@ -1212,7 +1223,7 @@@@ sub docommand {
d179 1
a179 1
@@@@ -1222,7 +1233,7 @@@@ sub docommand {
d188 1
a188 1
@@@@ -1237,7 +1248,7 @@@@ sub docommand {
d197 1
a197 1
@@@@ -1277,7 +1288,7 @@@@ sub docommand {
d206 1
a206 1
@@@@ -2205,4 +2216,3 @@@@ while (1) {
@


1.3
log
@fix sirc script (utf-8 handling):
- incoming chars from 0x80 to 0x9F are converted as if
  they came from a windows-1252 host. They may as well be
  "broken" (i.e. not converted to latin1) utf-8 chars.
- fix addons

if you ever need to fix a broken screen:
- ^Z
- echo -e \\033c
- fg
@
text
@d1 1
a1 1
$MirBSD: patch-dsirc,v 1.2 2003/03/23 15:23:41 tg Exp $
d3 1
a3 1
+++ dsirc	Mon Mar 24 18:27:29 2003
d12 2
a13 2
+# Copyright (c) 2001-2003 Thorsten "mirabile" Glaser
+# $MirBSD: patch-dsirc,v 1.2 2003/03/23 15:23:41 tg Exp $
d22 1
a22 1
@@@@ -20,7 +22,7 @@@@
d31 7
a37 1
@@@@ -36,9 +38,9 @@@@
d42 1
a42 1
+$add_ons='+[mirabile-p3]-utf8';
d49 1
a49 1
@@@@ -63,24 +65,25 @@@@ couldn't be found. Have you even bothere
d66 1
a66 1
+                  "irc.freenode.net";
d73 1
a73 1
-$set{"FINGER"}=$ENV{"IRCFINGER"} || "keep your fingers to yourself";
d75 1
a75 2
+$set{"FINGER"}=$ENV{"IRCFINGER"} || "keep your fingers touching yourself";
+$set{"USERINFO"}=$ENV{"USERINFO"} || "yep, I'm a happy OpenBSD-mirabile user";
d79 1
a79 1
@@@@ -91,7 +94,7 @@@@ $rcfile=$opt_L || $ENV{"SIRCRC"} || $ENV
d88 1
a88 1
@@@@ -224,7 +227,11 @@@@ sub gl {
d101 1
a101 1
@@@@ -237,7 +244,7 @@@@ sub gl {
d110 1
a110 1
@@@@ -276,6 +283,8 @@@@ sub print {
d119 1
a119 1
@@@@ -867,7 +876,7 @@@@ sub docommand {
d128 1
a128 1
@@@@ -1183,7 +1192,7 @@@@ sub docommand {
d137 1
a137 1
@@@@ -1194,7 +1203,7 @@@@ sub docommand {
d146 1
a146 1
@@@@ -1212,7 +1221,7 @@@@ sub docommand {
d155 1
a155 1
@@@@ -1222,7 +1231,7 @@@@ sub docommand {
d164 1
a164 1
@@@@ -1237,7 +1246,7 @@@@ sub docommand {
d173 1
a173 1
@@@@ -1277,7 +1286,7 @@@@ sub docommand {
d182 1
a182 1
@@@@ -2205,4 +2214,3 @@@@ while (1) {
@


1.2
log
@import utf-8 and ipv6 sirc from MirBSD-old
@
text
@d1 1
a1 1
$MirBSD: obsd.ports,v 1.62 2003/03/22 22:33:27 tg Exp $
d3 1
a3 1
+++ dsirc	Sun Feb 23 14:41:10 2003
d13 1
a13 1
+# $MirBSD: obsd.ports,v 1.62 2003/03/22 22:33:27 tg Exp $
d36 1
a36 1
+$add_ons='+[mirabile]-utf8';
d70 1
a70 1
+$set{"USERINFO"}=$ENV{"USERINFO"} || "yep, I'm a happy OpenBSD user";
d105 10
a114 1
@@@@ -867,7 +874,7 @@@@ sub docommand {
d123 1
a123 1
@@@@ -1183,7 +1190,7 @@@@ sub docommand {
d132 1
a132 1
@@@@ -1194,7 +1201,7 @@@@ sub docommand {
d141 1
a141 1
@@@@ -1212,7 +1219,7 @@@@ sub docommand {
d150 1
a150 1
@@@@ -1222,7 +1229,7 @@@@ sub docommand {
d159 1
a159 1
@@@@ -1237,7 +1244,7 @@@@ sub docommand {
d168 1
a168 1
@@@@ -1277,7 +1284,7 @@@@ sub docommand {
d177 1
a177 1
@@@@ -2205,4 +2212,3 @@@@ while (1) {
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD: patch-dsirc,v 1.1.1.1 2001/02/24 11:25:59 reinhard Exp $
--- dsirc.orig	Tue Mar 10 12:55:50 1998
+++ dsirc	Fri Feb  9 22:50:08 2001
@@@@ -1,4 +1,4 @@@@
d10 24
a33 1
@@@@ -38,7 +38,7 @@@@ $version='2.211';
d35 2
a36 1
 $add_ons='';
d43 130
@


1.1.1.1
log
@Import OpenBSD 3.3 ports repository from CTM 3132 the first time
This continues opening an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@
